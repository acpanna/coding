var GUI = { release: true };

(function () {

    if (typeof console !== 'undefined') {
        console.$log = console.log;
    } else {
        window.console = {};
    }
    
    console.log = function () { };

    //JXG.debug = function () {};
})();/* Version na */


/*
    Copyright 2011-2012
        Matthias Ehmann,
        Michael Gerhaeuser,
        Carsten Miller,
        Heiko Vogel,
        Alfred Wassermann

    This file is part of the JSXGraph Sketchometry User Interface project and has not been licensed yet.

    You are currently NOT ALLOWED to copy, modify, merge, publish, distribute, sublicense, or sell copies of this Software.
*/


    (function(){if($.browser.msie){return}var b=window.applicationCache;if(typeof b=="undefined"){}b.on=b.addEventListener;var a=function(c){console.log("appCacheEvent: "+c.type+" -- "+new Date().toISOString());if(!("progress"===c.type||"downloading"===c.type||"checking"===c.type||"noupdate"===c.type||"cached"===c.type)){if("updateready"==c.type){if(!GUI.release){GUI.alert("new version available, updating")}window.location.reload()}if("error"===c.type&&!GUI.release){if(navigator.onLine){GUI.alert("appcache error!")}else{console.log("appcache error!")}}}};b.on("checking",a,false);b.on("error",a,false);b.on("noupdate",a,false);b.on("downloading",a,false);b.on("progress",a,false);b.on("updateready",a,false);b.on("cached",a,false)}());var ND={strokes:[{name:"bisector",nbr:1,data:new Array(new Array([231,231],[231,232],[231,233],[232,234],[233,235],[242,260],[243,263],[244,266],[244,268],[244,271],[246,273],[246,276],[248,278],[248,280],[249,282],[250,286],[250,289],[251,291],[251,294],[252,297],[254,302],[254,305],[255,308],[256,310],[257,313],[258,319],[258,320],[259,321],[260,323],[260,324],[261,326],[262,328],[262,329],[262,330],[262,332],[263,334],[263,335],[263,336],[263,337],[264,337],[264,338],[264,339],[265,339],[265,341],[265,342],[265,343],[265,344],[265,345],[266,345],[266,347],[266,350],[266,351],[267,351],[267,353],[267,354],[267,353],[267,352],[267,351],[268,350],[269,346],[273,336],[274,334],[275,331],[278,325],[280,323],[283,316],[284,314],[285,312],[286,310],[288,306],[290,301],[292,298],[293,297],[293,296],[293,295],[294,293],[295,291],[295,290],[296,289],[296,288],[298,284],[299,280],[300,279],[300,278],[300,277],[302,274],[302,273],[302,274],[304,277],[305,279],[309,287],[310,289],[313,296],[315,302],[317,307],[326,329],[328,335],[329,338],[331,340],[333,346],[335,351],[335,352],[335,353],[336,353],[336,354],[337,356],[337,356],[337,355],[337,352],[339,347],[339,343],[340,338],[340,335],[342,326],[343,317],[345,309],[345,304],[346,302],[346,299],[347,297],[348,290],[349,286],[349,281],[350,279],[351,274],[351,272],[352,268],[353,263],[353,261],[355,257],[357,252],[359,248],[360,245],[361,243],[361,242],[363,238],[363,237],[365,234],[365,233],[366,231],[368,227],[368,226],[369,225],[369,224],[370,224]))},{name:"bisector",nbr:1,data:new Array(new Array([501,375],[519,373],[522,373],[523,373],[525,373],[529,373],[533,373],[537,373],[539,373],[541,373],[546,373],[548,373],[551,373],[558,373],[561,373],[564,373],[566,373],[571,373],[575,373],[583,373],[586,373],[589,373],[596,373],[597,373],[599,373],[603,372],[605,372],[607,372],[609,371],[612,371],[617,371],[619,371],[621,371],[624,371],[626,371],[629,371],[632,371],[634,371],[636,371],[639,371],[642,371],[645,371],[652,371],[655,371],[658,371],[661,371],[663,371],[667,371],[668,371],[669,371],[670,371],[671,371],[673,371],[676,371],[678,371],[682,372],[685,372],[687,372],[687,373],[689,373],[695,374],[711,375],[710,375],[663,353],[591,306],[589,302],[587,300],[585,298],[582,296],[581,294],[579,292],[577,291],[575,289],[573,286],[572,285],[571,283],[570,282],[569,281],[566,280],[565,278],[564,276],[561,273],[561,271],[560,270],[559,269],[557,267],[556,266],[556,265],[555,265],[554,264],[554,263],[555,264],[557,265],[609,304],[610,305],[612,306],[613,307],[617,309],[619,311],[621,313],[623,314],[625,316],[629,319],[631,320],[633,321],[634,322],[636,324],[641,327],[643,329],[645,330],[647,331],[648,333],[653,335],[654,335],[655,336],[656,336],[658,336],[661,339],[663,341],[665,341],[666,343],[668,344],[672,347],[674,349],[677,350],[679,352],[681,354],[683,355],[685,356],[686,358],[690,361],[694,362],[697,363],[698,364],[702,366],[704,366],[706,367],[711,369],[715,370],[717,371],[718,372],[722,374],[724,374],[725,375],[726,375],[727,375],[727,374],[719,322],[718,319],[718,318],[718,316],[718,315],[718,313],[717,312],[717,309],[717,308],[716,304],[716,302],[715,298],[715,296],[715,295],[714,293],[714,291],[714,289],[713,286],[713,284],[712,281],[712,280],[712,279],[712,278],[712,276],[711,273],[711,271],[710,268],[710,265],[710,264],[709,262],[709,261],[709,258],[709,256],[709,252],[709,250],[709,249],[709,248],[709,247],[709,245],[709,243],[709,239],[709,236],[709,234],[709,230],[709,227],[709,224],[709,223],[709,220],[709,219],[709,218],[709,217],[709,216],[708,197]))},{name:"bisector",nbr:1,data:new Array(new Array([261,174],[261,175],[261,177],[261,180],[262,186],[263,191],[263,196],[265,204],[267,210],[270,224],[273,241],[275,249],[279,266],[282,274],[285,284],[285,293],[290,311],[293,318],[296,326],[299,341],[301,349],[306,357],[306,363],[310,374],[311,381],[314,384],[316,391],[317,392],[318,395],[318,396],[318,397],[319,399],[320,400],[320,401],[320,402],[320,403],[320,402],[322,399],[325,389],[327,383],[329,376],[331,370],[333,362],[336,357],[337,351],[341,342],[342,338],[342,336],[345,332],[345,330],[347,327],[347,326],[348,326],[349,324],[350,324],[350,325],[350,326],[350,327],[351,331],[351,334],[351,335],[351,338],[351,340],[351,341],[351,342],[350,342],[350,343],[350,344],[349,344],[349,345],[348,347],[348,348],[347,350],[347,351],[347,352],[346,355],[346,356],[346,357],[345,359],[345,361],[345,362],[345,363],[345,365],[344,368],[344,369],[344,370],[343,372],[343,373],[343,376],[342,378],[342,379],[342,380],[342,382],[342,383],[342,384],[342,385],[342,386],[342,388],[342,389],[341,389],[341,390],[341,391],[340,392],[340,392],[340,392],[340,393],[340,394],[340,393],[342,393],[351,385],[358,378],[389,352],[401,342],[433,312],[443,302],[458,285],[464,279],[469,271],[473,262],[480,254],[493,241],[497,240],[505,233],[508,231],[512,227],[515,226],[516,223],[527,217],[528,216],[529,216],[531,216],[532,216]))},{name:"bisector",nbr:1,data:new Array(new Array([143,233],[144,233],[144,235],[149,240],[153,244],[157,248],[163,251],[170,257],[177,262],[185,270],[192,276],[200,282],[223,300],[248,317],[271,328],[289,341],[297,348],[311,356],[324,365],[329,370],[336,373],[351,382],[356,383],[365,388],[373,392],[377,393],[381,396],[385,398],[393,401],[396,403],[397,403],[398,403],[399,404],[401,405],[402,405],[403,407],[404,408],[405,406],[405,404],[404,402],[404,392],[402,385],[402,379],[402,365],[402,359],[402,352],[402,345],[402,332],[402,326],[402,321],[402,316],[402,305],[402,302],[402,299],[402,296],[402,294],[402,293],[402,294],[402,295],[402,299],[402,302],[402,304],[402,305],[403,310],[403,312],[403,314],[403,317],[403,319],[403,321],[403,323],[403,326],[403,328],[403,332],[403,334],[403,337],[403,338],[403,340],[404,344],[404,346],[405,348],[405,349],[405,351],[405,353],[405,354],[405,355],[405,359],[405,360],[406,361],[406,363],[406,367],[406,368],[407,370],[407,372],[409,376],[410,377],[410,379],[411,381],[411,382],[413,386],[413,388],[414,389],[414,390],[414,391],[414,392],[414,392],[415,393],[414,394],[414,395],[414,396],[414,397],[416,399],[416,400],[417,402],[417,403],[418,403],[418,404],[420,405],[420,406],[420,407],[421,405],[423,403],[427,399],[429,387],[432,380],[438,370],[443,361],[450,352],[465,333],[473,321],[482,309],[492,297],[512,275],[520,265],[527,253],[535,245],[554,220],[560,214],[570,201],[573,195],[578,189],[582,185],[583,181],[586,178],[587,175],[588,174],[589,172],[591,171],[592,170],[594,166],[596,163],[597,162],[596,161],[597,160],[598,160],[599,159],[600,158],[601,157],[602,157]))},{name:"circle",nbr:1,data:new Array(new Array([399,167],[399,167],[398,165],[397,164],[395,162],[393,160],[391,159],[388,156],[385,155],[385,155],[383,154],[379,152],[375,152],[365,149],[362,149],[355,147],[350,147],[335,147],[324,147],[319,147],[312,146],[306,146],[294,147],[287,148],[274,150],[258,151],[250,153],[238,157],[230,157],[225,159],[216,163],[211,165],[207,170],[195,182],[190,187],[180,200],[175,207],[169,227],[166,232],[166,239],[168,271],[168,282],[172,293],[174,303],[175,314],[177,322],[185,340],[196,356],[202,363],[217,378],[223,384],[234,390],[245,397],[255,405],[280,417],[305,425],[317,427],[345,430],[354,430],[363,430],[381,430],[390,430],[414,428],[425,427],[435,422],[449,414],[456,407],[478,387],[485,377],[493,356],[495,343],[496,312],[496,301],[496,290],[496,281],[492,262],[490,253],[486,238],[484,232],[474,217],[469,212],[457,202],[450,196],[444,191],[431,182],[425,177],[422,173],[419,172],[418,172],[416,170],[415,170],[414,167],[412,167],[409,164],[408,163],[405,161],[404,161]))},{name:"circle",nbr:1,data:new Array(new Array([384,109],[382,108],[380,108],[379,107],[376,106],[370,104],[367,103],[359,103],[354,103],[346,103],[341,103],[333,103],[328,103],[316,103],[304,103],[300,105],[293,105],[286,108],[283,110],[280,112],[276,117],[271,122],[261,132],[250,143],[245,150],[234,162],[230,167],[229,178],[227,183],[225,196],[225,204],[225,212],[225,228],[225,237],[225,245],[230,262],[239,277],[244,284],[250,289],[257,299],[263,302],[266,304],[271,306],[282,309],[288,311],[311,314],[319,316],[335,316],[344,316],[359,316],[365,316],[372,316],[374,317],[375,317],[378,317],[382,317],[384,316],[388,313],[392,313],[395,312],[396,311],[400,307],[402,306],[405,305],[406,303],[408,302],[408,301],[408,300],[409,300],[409,299],[410,298],[412,297],[413,297],[414,297],[415,297],[415,295]))},{name:"circle",nbr:1,data:new Array(new Array([440,127],[440,126],[440,125],[439,124],[438,123],[434,122],[433,122],[429,119],[428,119],[425,117],[423,117],[419,116],[416,115],[411,114],[409,114],[404,112],[401,112],[395,111],[390,111],[387,111],[385,111],[382,111],[377,111],[375,111],[371,111],[369,111],[363,111],[361,111],[357,112],[355,113],[353,114],[345,117],[341,119],[327,122],[322,127],[314,133],[310,137],[308,137],[303,140],[299,143],[298,146],[296,147],[294,153],[293,156],[291,158],[289,163],[288,166],[286,170],[285,172],[285,175],[282,182],[282,187],[282,198],[282,204],[282,219],[282,228],[282,244],[285,257],[285,260],[287,263],[295,277],[299,282],[315,296],[320,300],[325,303],[330,307],[344,312],[349,314],[363,318],[368,322],[370,322],[376,323],[382,324],[448,323],[452,322],[462,318],[468,313],[471,310],[478,303],[480,300],[487,292],[490,288],[494,285],[496,282],[501,271],[503,267],[510,248],[510,245],[511,240],[511,235],[512,233],[512,223],[512,219],[512,217],[512,214],[512,212],[512,207],[511,204],[511,202],[510,200],[509,197],[509,197],[506,191],[505,189],[503,185],[501,183],[501,182],[496,177],[496,177],[494,175],[493,173],[490,170],[488,168],[479,157],[477,154],[475,152],[470,147],[469,144],[467,143],[465,142],[463,140],[460,137],[457,135],[456,134],[456,133],[455,132],[454,132],[453,131],[451,130],[450,129],[449,129]))},{name:"circle",nbr:1,data:new Array(new Array([445,106],[444,104],[443,103],[442,101],[440,99],[432,92],[427,88],[409,77],[393,70],[375,63],[365,62],[315,56],[306,56],[298,56],[278,56],[245,56],[235,56],[227,58],[213,67],[205,72],[198,77],[184,91],[176,97],[164,111],[158,118],[146,132],[140,142],[128,157],[122,164],[114,185],[112,197],[109,221],[109,237],[109,249],[109,262],[109,287],[113,308],[119,319],[125,328],[130,337],[145,356],[153,365],[160,374],[180,389],[191,393],[213,397],[227,399],[275,399],[290,399],[348,399],[400,392],[415,386],[427,380],[436,374],[455,354],[468,332],[474,322],[480,307],[485,297],[491,286],[493,264],[495,253],[495,232],[495,221],[493,199],[491,190],[489,181],[482,164],[480,155],[469,138],[463,131],[457,124],[446,109],[440,102],[431,92],[430,89],[423,82],[419,77],[405,62],[400,56],[393,51],[391,51]))},{name:"circle2points",nbr:1,data:new Array(new Array([364,211],[365,211],[366,211],[368,211],[376,211],[384,211],[395,212],[401,212],[409,212],[416,212],[422,212],[429,212],[434,212],[439,212],[445,212],[449,212],[454,212],[457,212],[462,212],[466,212],[470,212],[474,213],[479,213],[483,213],[489,213],[495,213],[503,213],[511,213],[518,213],[524,213],[532,213],[539,213],[545,213],[552,212],[561,211],[567,210],[573,209],[578,209],[584,208],[589,208],[592,207],[595,207],[598,207],[601,207],[603,207],[607,207],[609,207],[612,207],[613,207],[616,207],[617,206],[618,206],[611,234],[609,240],[607,243],[606,246],[605,249],[603,252],[602,255],[601,258],[599,260],[597,263],[595,266],[594,269],[591,274],[589,278],[587,281],[585,284],[583,287],[580,290],[578,292],[575,294],[573,296],[569,299],[567,301],[564,303],[561,305],[558,307],[554,309],[552,310],[549,311],[546,313],[543,313],[540,314],[537,316],[535,317],[531,319],[527,320],[524,321],[521,322],[518,323],[514,324],[511,325],[505,327],[499,328],[496,328],[493,329],[489,329],[485,330],[481,331],[476,332],[474,332],[469,333],[465,334],[461,335],[458,335],[455,335],[454,335]))},{name:"circle2points",nbr:1,data:new Array(new Array([658,224],[657,224],[656,224],[655,224],[644,223],[638,223],[631,223],[625,223],[618,223],[611,223],[605,223],[599,223],[592,223],[585,223],[578,223],[571,223],[563,223],[555,223],[546,222],[540,222],[531,221],[522,221],[516,221],[507,221],[499,221],[491,221],[485,221],[478,221],[471,221],[463,220],[457,220],[450,220],[444,220],[439,220],[435,220],[430,220],[425,220],[419,220],[414,220],[411,220],[408,220],[406,220],[404,220],[402,220],[402,219],[401,219],[399,219],[398,219],[397,219],[397,220],[397,223],[397,226],[397,228],[397,230],[397,231],[397,232],[397,233],[397,235],[397,236],[397,237],[397,238],[397,239],[397,240],[397,242],[397,243],[397,246],[397,248],[397,251],[397,254],[398,256],[399,259],[400,262],[401,264],[401,267],[402,269],[403,272],[404,275],[404,278],[405,280],[406,283],[407,285],[408,288],[410,291],[411,294],[413,298],[415,301],[417,305],[419,311],[422,315],[424,319],[427,322],[429,325],[432,328],[434,331],[437,334],[439,337],[442,340],[445,343],[448,345],[452,349],[455,351],[459,354],[462,357],[466,360],[469,362],[474,365],[478,368],[482,370],[488,373],[494,376],[499,379],[505,381],[511,383],[516,384],[519,385],[523,386],[526,388],[529,389],[533,390],[535,390],[539,391],[542,391],[543,391],[544,391],[545,391],[546,391],[548,391],[549,391],[552,391],[553,391],[555,391],[556,391]))},{name:"line",nbr:1,data:new Array(new Array([0,0],[100,0]))},{name:"line",nbr:1,data:new Array(new Array([12,347],[119,347]))},{name:"midpoint",nbr:1,data:new Array(new Array([88,230],[89,230],[90,230],[93,230],[93,230],[95,230],[98,230],[100,230],[102,230],[103,231],[105,231],[107,231],[108,231],[110,231],[111,231],[114,231],[117,231],[121,231],[123,231],[126,232],[129,232],[133,232],[136,232],[139,232],[145,232],[150,232],[156,232],[159,232],[161,233],[165,234],[168,234],[171,234],[174,234],[179,234],[184,234],[189,234],[194,234],[198,234],[201,234],[204,233],[210,233],[213,233],[219,232],[226,231],[232,231],[237,231],[245,231],[252,231],[256,231],[261,231],[265,231],[271,231],[276,231],[281,231],[285,231],[287,233],[291,236],[293,239],[295,243],[295,247],[296,250],[296,254],[295,257],[294,259],[291,261],[288,262],[282,262],[273,262],[256,255],[255,249],[253,244],[253,239],[257,233],[262,228],[270,225],[280,224],[289,224],[294,226],[300,230],[303,235],[303,240],[304,245],[304,247],[301,249],[295,252],[279,252],[270,252],[265,249],[261,245],[261,241],[261,237],[261,235],[264,231],[273,229],[282,229],[287,230],[290,231],[297,233],[304,235],[306,235],[309,236],[316,240],[321,241],[323,242],[325,243],[328,243],[333,246],[340,247],[346,247],[351,247],[360,248],[366,248],[372,248],[377,248],[387,248],[391,248],[395,247],[401,247],[407,247],[412,247],[416,247],[421,247],[426,246],[432,246],[435,246],[441,245],[449,245],[453,245],[456,245],[460,244],[463,244],[465,244],[465,244],[466,244],[467,244],[468,244],[470,244],[472,244],[474,244],[477,244],[482,244]))},{name:"midpoint",nbr:1,data:new Array(new Array([43,471],[57,474],[58,475],[78,482],[85,485],[95,487],[102,489],[111,490],[120,490],[129,492],[142,492],[153,492],[162,492],[173,492],[189,492],[205,494],[224,495],[243,497],[260,503],[270,511],[270,518],[265,524],[256,525],[249,525],[243,521],[239,512],[240,502],[243,496],[252,489],[261,484],[270,483],[280,485],[309,494],[319,496],[328,497],[335,496],[343,496],[350,497],[359,498],[377,499],[387,500],[395,500],[400,501],[405,500],[411,501],[416,501],[420,501],[425,502],[429,502],[432,502],[436,503],[440,504],[444,505],[447,506],[450,506],[453,507],[455,507],[456,507],[458,507],[459,508],[459,507],[462,509],[462,509],[463,509],[465,509],[467,509],[467,508],[469,507],[470,508],[472,507],[473,507],[474,505],[476,504],[477,503],[480,501],[482,500],[483,499],[486,497],[487,495],[489,495],[492,493],[492,492],[494,491]))},{name:"midpoint",nbr:1,data:new Array(new Array([147,121],[148,121],[149,121],[150,121],[161,121],[169,122],[175,122],[181,122],[186,123],[191,123],[196,124],[201,124],[207,124],[212,124],[217,124],[220,124],[224,124],[231,124],[236,124],[239,124],[245,123],[251,120],[255,117],[258,114],[261,110],[263,107],[265,104],[266,102],[266,98],[266,95],[264,91],[261,88],[258,88],[253,87],[247,87],[242,87],[238,87],[234,88],[233,90],[231,91],[230,92],[228,94],[226,96],[225,98],[223,100],[223,102],[222,105],[222,107],[222,109],[223,112],[224,115],[225,117],[227,118],[228,120],[229,120],[231,121],[233,122],[234,123],[237,123],[240,123],[242,124],[246,124],[250,124],[252,124],[257,124],[260,123],[262,123],[265,122],[267,122],[269,121],[271,121],[273,121],[276,120],[280,120],[282,120],[285,120],[286,120],[287,120],[289,120],[291,120],[292,121],[294,121],[295,121],[298,121],[300,121],[302,121],[305,121],[309,121],[312,121],[314,121],[315,121],[316,121],[319,121],[321,121],[322,121],[323,121],[326,121],[327,121],[328,122],[334,122],[337,123]))},{name:"normal",nbr:1,data:new Array(new Array([304,255],[304,256],[304,261],[304,264],[304,266],[304,287],[304,291],[304,294],[304,295],[304,297],[304,301],[303,302],[303,304],[303,306],[303,308],[303,315],[303,318],[303,323],[304,327],[304,328],[304,333],[304,334],[304,335],[304,338],[304,339],[304,342],[304,343],[304,344],[304,345],[304,346],[305,368],[305,370],[305,371],[305,373],[305,374],[305,375],[305,376],[305,377],[305,378],[305,379],[305,381],[306,381],[307,381],[309,380],[316,379],[330,378],[334,378],[338,378],[340,378],[341,378],[344,378],[371,378],[373,378],[376,378],[380,378],[392,378],[394,378],[395,378],[396,378]))},{name:"normal",nbr:1,data:new Array(new Array([300,35],[300,36],[300,38],[300,43],[300,45],[302,71],[302,77],[302,79],[302,81],[302,84],[304,95],[304,98],[304,100],[304,104],[304,105],[304,115],[304,118],[304,119],[304,121],[304,122],[304,127],[304,128],[305,129],[305,130],[305,132],[306,138],[306,140],[306,141],[306,142],[306,143],[306,148],[306,150],[306,153],[306,154],[306,155],[306,161],[306,162],[305,162],[303,162],[301,162],[294,163],[291,163],[288,163],[284,163],[282,163],[271,163],[269,163],[268,163],[266,163],[261,163],[251,165],[249,166],[248,166],[247,166],[244,166],[241,167],[240,167],[239,167],[237,167],[236,168],[234,168],[232,168],[227,168],[225,168],[225,167],[219,165],[216,165],[216,164],[213,163],[208,163]))},{name:"normal",nbr:1,data:new Array(new Array([247,60],[247,61],[247,62],[247,62],[246,65],[246,67],[246,69],[246,71],[247,73],[247,74],[247,87],[247,89],[247,90],[247,92],[247,94],[247,95],[247,96],[247,98],[247,100],[247,102],[247,105],[248,107],[245,107],[245,111],[245,114],[245,117],[245,119],[246,121],[246,123],[246,125],[246,127],[246,128],[246,130],[247,132],[247,134],[247,136],[247,139],[247,140],[247,143],[247,147],[247,150],[247,153],[247,158],[247,161],[247,162],[247,165],[247,168],[247,171],[246,173],[246,177],[246,181],[246,185],[246,190],[246,194],[246,200],[246,205],[246,210],[246,215],[246,219],[246,226],[247,232],[247,239],[250,246],[250,250],[250,254],[250,258],[250,260],[250,262],[250,263],[250,265],[250,271],[250,273],[250,276],[250,278],[250,280],[250,282],[250,283],[250,285],[251,288],[252,291],[252,292],[252,293],[252,294],[252,296],[252,298],[252,299],[251,301],[251,303],[251,304],[250,306],[250,308],[250,311],[250,313],[250,315],[250,318],[250,320],[249,323],[249,326],[249,329],[248,332],[248,335],[248,337],[248,341],[248,343],[248,346],[248,349],[248,351],[248,353],[248,357],[248,359],[248,361],[248,363],[247,366],[247,368],[247,370],[247,371],[246,373],[246,375],[246,377],[246,379],[246,380],[245,381],[245,382],[245,384],[244,384],[244,386],[244,387],[243,389],[243,391],[243,392],[243,394],[243,397],[242,407],[242,409],[242,411],[241,412],[241,413],[241,414],[241,417],[241,418],[241,420],[241,422],[241,425],[241,426],[241,428],[241,429],[241,431],[241,433],[241,435],[241,436],[241,436],[241,439],[241,441],[241,443],[241,446],[241,447],[241,449],[241,452],[242,454],[242,456],[242,458],[242,460],[242,462],[242,465],[242,468],[242,469],[242,471],[242,473],[242,475],[242,477],[242,478],[243,480],[243,480],[242,481],[242,483],[242,484],[242,485],[242,486],[242,487],[242,488],[242,490],[242,491],[241,491],[241,492],[241,493],[241,494],[241,495],[241,496],[241,497],[242,498],[243,499],[244,500],[245,500],[247,501],[249,501],[250,502],[252,502],[254,503],[256,503],[258,503],[260,504],[262,504],[263,504],[264,504],[265,504],[266,504],[267,504],[268,504],[269,505],[270,505],[271,505],[273,505],[274,505],[276,506],[277,506],[281,506],[283,506],[285,506],[288,506],[291,506],[294,506],[297,507],[300,507],[303,507],[306,507],[309,507],[311,507],[313,507],[316,507],[318,507],[320,507],[323,507],[326,507],[329,507],[338,507],[340,507],[344,507],[347,507],[351,507],[355,507],[360,507],[366,508],[369,508],[373,510],[376,510],[380,511],[384,511],[385,511],[388,511],[397,513],[398,513],[401,513],[403,513],[405,513],[407,514],[409,514],[411,514],[414,514],[416,515],[419,516],[421,516],[423,516],[425,516],[427,516],[428,516],[430,516],[432,516],[434,516],[435,516],[437,516],[438,516],[439,516],[441,516],[443,517],[445,517],[447,517],[450,517],[452,517],[455,517],[458,517],[460,517],[462,517],[465,517],[468,517],[471,517],[473,517],[475,517],[478,517],[481,517],[483,516],[485,516],[487,516],[489,516],[492,516],[493,516],[494,516],[496,516],[497,516],[499,516],[501,516],[503,516],[505,516],[508,516],[511,516],[514,516],[516,516],[518,516],[521,516],[523,516],[525,516],[527,516],[528,516],[530,516],[531,515],[533,515],[535,515],[537,515],[538,515],[540,515],[542,515],[545,515],[547,515],[549,515],[550,515],[553,515],[555,515],[557,515],[559,515],[561,515],[563,515],[564,515],[565,515],[567,515],[569,515],[570,515],[571,515],[573,515],[575,515],[576,515],[578,515],[579,515],[580,514],[582,514],[582,514],[583,513],[584,513],[585,513],[586,513],[587,513],[588,513]))},{name:"parallel",nbr:1,data:new Array(new Array([487,142],[559,142],[561,142],[564,142],[567,142],[570,142],[574,143],[579,143],[582,143],[585,143],[591,143],[597,143],[600,143],[602,143],[604,143],[606,143],[609,143],[611,143],[614,143],[620,143],[623,143],[625,143],[627,143],[629,143],[630,143],[631,142],[632,142],[632,143],[593,179],[588,183],[585,185],[583,187],[580,190],[577,192],[574,195],[571,197],[568,199],[565,202],[562,204],[559,207],[557,209],[555,211],[553,213],[551,215],[550,217],[548,219],[547,221],[546,224],[545,226],[544,229],[543,232],[541,234],[540,237],[538,239],[538,241],[537,243],[537,245],[536,247],[535,248],[535,250],[534,252],[533,254],[532,255],[532,257],[531,259],[530,261],[529,263],[527,265],[526,267],[525,270],[523,272],[521,274],[519,276],[517,278],[516,279],[515,279],[514,280],[513,281],[512,281],[512,282],[511,282],[511,283],[511,284],[511,285],[510,285],[509,286],[509,287],[507,289],[506,290],[507,290],[598,284],[601,283],[602,283],[603,283],[604,282],[605,282],[606,282],[607,282],[608,282],[610,282],[612,282],[614,282],[615,282],[616,282],[617,282],[632,284],[634,285],[635,285],[637,285],[640,286],[641,286],[643,286],[644,286],[644,287]))},{name:"parallel",nbr:1,data:new Array(new Array([450,377],[451,377],[452,377],[453,377],[456,376],[470,373],[481,372],[495,372],[503,372],[519,372],[529,372],[537,372],[545,372],[561,372],[569,372],[576,372],[589,372],[596,372],[608,372],[614,372],[620,372],[625,372],[628,372],[634,372],[637,372],[640,372],[642,371],[423,295],[421,295],[422,294],[649,286],[651,286],[652,286]))},{name:"parallel",nbr:1,data:new Array(new Array([286,103],[287,103],[288,103],[290,103],[292,103],[300,103],[310,105],[316,106],[328,108],[345,110],[358,112],[374,112],[391,112],[404,112],[416,112],[422,112],[424,112],[425,112],[426,112],[429,112],[430,112],[429,119],[428,126],[427,134],[426,143],[426,155],[426,164],[425,176],[425,185],[425,196],[425,206],[425,213],[425,216],[425,223],[425,227],[425,232],[425,241],[425,244],[425,246],[426,246],[432,246],[440,246],[461,246],[500,246],[524,246],[544,246],[566,246],[584,248],[602,248],[609,249],[610,249],[624,249],[634,249],[647,249],[659,249],[665,249],[666,249],[675,249],[680,249]))},{name:"parallel",nbr:1,data:new Array(new Array([664,213],[664,214],[667,216],[669,218],[672,221],[675,224],[677,227],[679,230],[682,232],[684,234],[687,236],[689,238],[690,241],[693,244],[695,246],[696,249],[698,250],[701,254],[702,255],[704,256],[705,257],[706,259],[707,260],[708,261],[709,262],[710,263],[711,264],[712,266],[712,267],[712,266],[863,99],[873,90],[878,86],[883,84],[885,82],[886,82],[1013,174],[1014,174],[1014,175]))},{name:"quadrilateral",nbr:1,data:new Array(new Array([457,274],[459,251],[459,243],[459,234],[455,157],[455,156],[693,147],[730,152],[734,261],[730,343],[729,343],[511,358],[503,359],[498,360],[495,361],[491,361],[485,362],[478,363],[474,364],[467,364],[463,364],[461,364],[456,315],[456,308],[456,303],[456,296],[456,291],[456,284],[456,278],[456,275]))},{name:"quadrilateral",nbr:1,data:new Array(new Array([387,189],[388,189],[389,189],[390,188],[398,184],[407,179],[415,176],[424,172],[432,168],[442,163],[451,160],[460,155],[472,150],[487,143],[498,137],[514,129],[527,123],[541,115],[560,105],[579,94],[599,86],[617,78],[633,70],[645,63],[653,60],[661,56],[665,55],[667,54],[668,54],[672,60],[678,70],[683,77],[690,87],[696,96],[705,108],[719,127],[732,145],[746,164],[759,179],[772,194],[783,206],[795,219],[805,227],[811,233],[816,236],[818,237],[819,238],[818,238],[810,241],[801,243],[791,247],[782,251],[771,255],[757,260],[741,265],[721,274],[700,283],[679,294],[652,307],[625,321],[596,332],[558,347],[519,363],[491,375],[464,388],[434,403],[411,415],[384,428],[356,440],[335,448],[311,457],[295,462],[280,467],[269,470],[247,471],[250,464],[257,449],[262,441],[265,434],[270,422],[275,413],[282,398],[287,382],[297,362],[303,348],[312,333],[320,322],[326,312],[329,304],[333,296],[336,288],[339,279],[343,270],[346,263],[349,258],[351,253],[352,250],[354,245],[356,241],[358,237],[360,234],[361,231],[363,226],[364,220],[365,214],[366,211],[367,209],[367,207],[368,206],[368,205],[371,200],[373,196],[375,194],[376,191],[377,190],[378,188],[379,187],[380,187],[381,186]))},{name:"quadrilateral",nbr:1,data:new Array(new Array([489,275],[489,274],[489,273],[491,271],[508,251],[524,233],[537,220],[554,202],[569,186],[586,170],[604,152],[622,134],[642,114],[654,102],[665,92],[672,86],[676,82],[678,79],[680,77],[681,76],[681,75],[681,73],[682,72],[682,69],[683,67],[683,66],[684,66],[685,66],[692,74],[701,82],[714,91],[729,101],[748,112],[773,125],[799,135],[837,148],[861,156],[903,165],[937,169],[969,172],[996,173],[1024,174],[1040,175],[1052,175],[1057,176],[1060,176],[1060,177],[1053,181],[1040,189],[1024,201],[1012,209],[998,219],[983,228],[965,241],[944,254],[921,270],[891,291],[861,313],[832,333],[803,354],[779,371],[756,387],[730,405],[712,417],[695,428],[683,436],[672,442],[665,446],[660,448],[658,450],[657,450],[657,451],[656,451],[655,451],[654,451],[653,451],[651,451],[649,451],[646,451],[640,447],[632,443],[623,438],[611,431],[597,422],[584,412],[571,404],[560,395],[549,385],[536,373],[522,363],[507,353],[491,344],[479,337],[467,330],[456,323],[447,318],[440,314],[436,313],[432,311],[429,310],[427,309],[426,309],[426,308]))},{name:"quadrilateral",nbr:1,data:new Array(new Array([479,269],[479,268],[479,267],[479,264],[479,252],[478,245],[477,232],[474,221],[470,203],[465,190],[461,176],[456,164],[453,153],[448,141],[446,133],[443,126],[441,120],[440,115],[438,111],[436,106],[435,102],[434,100],[434,98],[434,96],[434,95],[434,94],[434,93],[435,93],[437,94],[444,95],[454,96],[467,97],[487,97],[505,97],[534,97],[567,97],[598,97],[633,95],[679,90],[713,87],[753,85],[787,83],[812,82],[834,80],[844,80],[851,78],[854,78],[854,79],[854,92],[853,117],[853,151],[852,185],[852,212],[852,241],[852,262],[852,285],[854,297],[855,307],[856,312],[857,313],[856,313],[847,307],[837,304],[823,299],[803,295],[778,291],[751,288],[722,286],[690,285],[647,281],[612,277],[573,273],[547,272],[522,271],[497,270],[470,269],[451,268],[436,268],[423,267],[416,267],[413,266],[412,266]))},{name:"quadrilateral",nbr:1,data:new Array(new Array([436,331],[436,330],[434,330],[434,329],[429,328],[424,326],[420,324],[413,322],[408,321],[397,318],[387,315],[377,312],[366,309],[349,304],[334,300],[318,296],[305,291],[287,287],[273,283],[259,280],[251,277],[243,276],[234,275],[229,274],[223,273],[220,272],[217,272],[215,272],[214,272],[212,272],[211,272],[210,272],[209,272],[209,271],[214,268],[218,264],[222,262],[231,256],[241,249],[255,239],[267,230],[285,215],[311,194],[333,175],[358,147],[375,125],[389,106],[400,88],[411,70],[418,59],[423,52],[428,46],[432,41],[434,38],[435,36],[437,35],[437,34],[438,34],[442,34],[447,36],[455,41],[468,45],[481,50],[502,57],[533,66],[564,70],[611,71],[662,71],[720,68],[780,67],[816,66],[839,66],[850,66],[855,66],[854,66],[846,71],[827,83],[810,94],[791,105],[776,115],[755,128],[733,139],[713,151],[698,160],[679,170],[665,180],[647,192],[633,202],[616,214],[597,226],[585,234],[570,243],[558,249],[550,255],[540,261],[532,266],[527,269],[520,274],[513,278],[506,283],[500,286],[495,289],[491,292],[488,294],[484,296],[481,298],[477,300],[473,302],[469,305],[466,307],[464,309],[462,310],[460,312],[458,313],[456,315],[454,316],[452,318],[450,320],[448,321],[445,324],[443,325],[442,326],[442,327],[441,327],[440,328],[440,329],[439,329],[438,329],[437,331],[435,332],[433,333],[433,334]))},{name:"quadrilateral",nbr:1,data:new Array(new Array([82,200],[81,200],[81,203],[81,204],[82,209],[83,214],[84,216],[85,223],[85,228],[85,234],[85,242],[85,249],[85,261],[85,269],[87,275],[87,282],[87,296],[87,303],[87,315],[87,326],[87,331],[89,335],[89,338],[91,346],[91,349],[92,355],[92,356],[91,356],[91,357],[92,357],[94,357],[96,357],[102,357],[107,357],[110,357],[131,356],[137,356],[144,356],[151,356],[177,354],[186,354],[195,354],[204,354],[223,354],[232,354],[240,352],[259,351],[268,349],[286,349],[296,348],[306,348],[315,348],[334,348],[341,348],[351,348],[359,348],[374,348],[382,348],[389,348],[399,346],[408,344],[424,342],[431,342],[446,340],[453,340],[459,340],[471,340],[476,340],[482,340],[487,340],[497,340],[503,340],[507,342],[513,342],[523,344],[527,344],[540,344],[546,344],[554,344],[557,344],[562,344],[565,344],[567,344],[571,344],[571,344],[572,344],[573,344],[574,342],[575,341],[575,339],[576,337],[577,336],[578,333],[579,330],[580,328],[582,324],[582,321],[582,318],[582,316],[583,310],[583,308],[584,305],[584,301],[584,299],[585,296],[585,294],[585,289],[585,287],[585,280],[585,276],[585,272],[585,271],[585,268],[585,264],[585,261],[585,260],[585,257],[585,252],[585,249],[585,248],[585,241],[585,238],[584,236],[585,232],[586,228],[586,227],[587,225],[587,223],[587,222],[587,221],[588,218],[588,217],[588,215],[588,214],[588,213],[588,211],[588,210],[589,209],[589,207],[589,206],[589,205],[589,205],[589,204],[589,203],[589,202],[589,201],[589,200],[588,200],[585,200],[582,200],[580,200],[571,200],[565,200],[557,200],[539,201],[531,201],[522,201],[513,203],[495,205],[486,206],[477,207],[460,207],[452,207],[444,207],[421,207],[414,207],[398,207],[391,207],[384,207],[376,207],[362,209],[354,209],[347,209],[332,209],[325,209],[318,209],[310,209],[296,209],[279,209],[270,211],[263,211],[255,211],[248,211],[235,211],[230,213],[224,213],[213,213],[208,214],[205,214],[197,214],[194,214],[190,214],[184,214],[180,215],[175,215],[173,215],[170,215],[165,215],[163,215],[160,215],[158,215],[154,215],[153,215],[152,215],[150,215],[146,215],[145,215],[143,215],[142,215],[140,215],[138,215],[136,215],[132,215],[131,215],[130,215],[122,215],[120,215],[117,215],[116,215],[115,215],[114,215],[111,215],[109,215],[108,215],[107,215],[103,215],[101,215],[100,215],[98,215],[96,216]))},{name:"quadrilateral",nbr:1,data:new Array(new Array([215,148],[215,150],[215,151],[215,153],[215,160],[215,163],[213,168],[211,180],[211,187],[211,196],[211,203],[211,222],[211,232],[210,242],[211,258],[211,267],[213,276],[213,297],[213,304],[215,322],[215,327],[216,337],[216,341],[216,344],[217,352],[217,353],[216,353],[216,352],[216,352],[217,352],[218,352],[222,351],[225,351],[247,351],[270,351],[302,351],[318,351],[348,351],[360,351],[371,351],[382,351],[402,351],[406,350],[406,349],[406,347],[405,345],[405,344],[405,342],[405,337],[405,334],[405,324],[405,317],[405,289],[405,280],[405,250],[405,240],[403,212],[403,204],[401,187],[401,182],[403,169],[402,168],[402,167],[402,166],[402,163],[402,162],[402,159],[401,158],[401,157],[401,156],[400,155],[400,154],[400,153],[400,152],[398,152],[396,152],[391,153],[390,153],[384,153],[381,153],[378,153],[374,153],[355,154],[346,154],[318,154],[309,154],[282,154],[275,154],[257,154],[254,154],[249,154],[247,154],[245,154],[244,154],[240,154],[238,154],[234,154],[233,153],[228,153],[226,153]))},{name:"quadrilateral",nbr:1,data:new Array(new Array([277,141],[277,142],[277,142],[277,144],[277,150],[276,152],[276,157],[276,171],[275,187],[273,197],[275,328],[275,336],[275,343],[273,349],[273,354],[272,361],[272,364],[272,365],[272,366],[272,367],[272,367],[271,368],[271,372],[271,372],[271,373],[273,372],[275,372],[278,372],[287,372],[293,371],[300,371],[310,371],[334,369],[347,369],[365,369],[396,369],[412,369],[426,367],[464,367],[473,367],[497,367],[500,367],[501,367],[502,367],[503,367],[503,366],[503,364],[503,362],[503,359],[503,353],[503,350],[503,345],[503,337],[503,328],[503,307],[503,297],[503,261],[503,249],[501,215],[500,204],[498,175],[496,167],[496,152],[496,150],[496,145],[496,143],[496,140],[496,139],[496,137],[496,136],[497,134],[495,134],[494,134],[492,135],[491,136],[486,136],[485,137],[482,137],[472,137],[462,138],[450,138],[442,138],[435,138],[418,138],[408,138],[399,138],[378,138],[368,138],[357,138],[329,138],[320,138],[300,138],[293,138],[291,139],[290,139],[290,139],[285,139],[284,138],[281,138],[275,138],[273,138],[272,138],[270,138],[269,138]))},{name:"quadrilateral",nbr:1,data:new Array(new Array([298,110],[298,111],[295,112],[295,113],[286,119],[281,124],[275,129],[260,142],[242,157],[223,172],[212,179],[205,187],[191,198],[185,202],[182,203],[178,205],[177,205],[178,206],[179,207],[180,208],[192,218],[202,232],[215,244],[222,251],[238,268],[245,277],[252,286],[266,304],[274,312],[281,322],[289,329],[304,344],[311,352],[317,359],[329,371],[333,375],[336,379],[340,382],[341,382],[345,383],[345,384],[346,383],[348,382],[350,380],[355,378],[367,369],[375,364],[418,340],[430,331],[471,307],[482,301],[506,288],[514,288],[523,278],[523,277],[525,277],[525,276],[525,275],[525,274],[525,273],[525,272],[525,272],[525,271],[525,270],[525,268],[525,267],[524,265],[522,263],[520,261],[519,258],[515,252],[513,247],[510,242],[506,236],[500,223],[495,217],[490,209],[475,184],[469,176],[465,169],[457,154],[453,149],[450,142],[437,125],[434,121],[425,114],[424,112],[421,111],[421,110],[420,110],[417,108],[415,108],[415,107],[413,107],[412,107],[409,105],[405,102],[404,102],[403,101],[401,99],[401,98],[400,97],[399,97],[398,95],[397,93],[396,92],[395,92],[395,90],[395,89],[393,87],[390,85],[390,84],[390,84],[388,82],[388,82],[387,81],[387,80],[385,78],[385,77],[384,77],[383,77],[382,76],[382,75],[381,74],[380,74],[380,73],[380,73],[380,72],[380,72],[379,72],[379,71],[378,71],[376,69],[376,68],[376,67],[375,67],[375,67],[375,66],[375,65],[374,65],[373,65],[371,65],[369,66],[367,67],[365,67],[364,67],[360,67],[355,69],[353,71],[350,72],[346,73],[343,75],[342,77],[340,77],[340,77],[339,77],[339,78],[338,78],[337,79],[336,80],[335,80],[334,81],[334,82],[333,83],[332,83],[329,87],[327,88],[324,89],[323,90],[323,92],[322,92],[322,93],[321,94],[320,96],[320,96],[320,97],[319,98],[318,98],[318,99],[318,100],[316,101],[315,101],[314,101],[312,102],[311,102],[310,102],[310,102],[310,102],[309,103],[308,103]))},{name:"reflection",nbr:1,data:new Array(new Array([357,286],[390,266],[396,261],[397,260],[401,256],[404,254],[411,249],[416,245],[421,239],[474,187],[516,154],[522,150],[528,145],[534,141],[539,138],[543,135],[552,129],[560,124],[570,119],[576,117],[584,114],[589,112],[589,111],[540,111],[537,111],[536,111],[501,117],[501,118],[565,109],[566,109],[569,109],[572,109],[575,109],[578,109],[581,109],[583,109],[588,109],[593,109],[596,109],[596,110],[578,136],[578,138],[577,139],[576,139],[575,140],[575,141],[574,142],[574,143],[574,144],[574,145],[573,145],[573,146],[573,147],[573,148],[572,149],[572,150],[571,151],[571,152],[570,152],[570,153],[570,154],[570,155],[570,156],[570,157],[570,159],[566,169],[566,170],[565,172],[565,173],[564,174],[562,177]))},{name:"reflection",nbr:1,data:new Array(new Array([375,308],[409,284],[410,283],[411,282],[415,280],[419,276],[427,270],[434,266],[436,264],[440,261],[441,260],[446,257],[450,254],[451,253],[457,248],[461,245],[463,244],[467,241],[473,239],[477,238],[482,235],[488,232],[493,230],[498,227],[502,225],[509,222],[512,220],[514,219],[516,219],[520,217],[522,216],[528,213],[529,213],[532,212],[535,211],[540,210],[543,209],[543,208],[513,206],[507,206],[508,206],[533,204],[536,204],[542,203],[544,204],[540,223],[540,224],[540,225],[540,226],[540,230],[540,231],[540,233],[540,234],[535,235]))},{name:"reflection",nbr:1,data:new Array(new Array([372,160],[373,160],[374,160],[376,160],[382,160],[388,160],[390,160],[393,160],[400,160],[405,160],[408,160],[412,159],[415,159],[418,159],[421,158],[425,158],[428,158],[431,158],[434,158],[436,158],[438,158],[441,158],[443,158],[445,157],[447,157],[449,156],[452,156],[454,156],[455,156],[458,156],[459,156],[460,156],[462,156],[464,156],[467,156],[468,156],[470,156],[473,156],[475,156],[477,156],[480,155],[482,155],[484,155],[486,155],[488,155],[490,155],[492,154],[494,154],[496,154],[498,154],[500,154],[502,154],[504,154],[506,154],[508,154],[509,154],[511,154],[514,154],[515,154],[517,154],[519,154],[521,154],[522,154],[524,154],[525,154],[527,154],[529,154],[531,154],[532,154],[534,154],[535,154],[537,154],[538,154],[540,154],[542,154],[543,154],[545,154],[546,154],[547,154],[548,154],[549,154],[551,154],[552,154],[554,154],[555,154],[556,154],[558,154],[560,154],[562,154],[563,154],[565,154],[566,154],[568,154],[569,154],[571,154],[572,154],[573,154],[575,154],[576,154],[577,154],[579,154],[581,153],[583,153],[585,153],[586,153],[587,153],[588,153],[589,153],[590,153],[591,153],[592,153],[593,153],[594,153],[595,153],[597,153],[598,153],[599,153],[600,153],[601,153],[602,153],[601,153],[600,153],[599,152],[597,152],[595,151],[594,150],[591,149],[588,148],[586,148],[585,147],[583,147],[580,146],[578,145],[577,145],[574,144],[572,143],[571,143],[569,142],[568,142],[566,141],[565,141],[563,141],[562,141],[561,140],[560,139],[559,139],[558,138],[557,138],[555,138],[554,137],[553,137],[551,136],[550,136],[548,135],[547,135],[546,135],[544,134],[543,134],[542,134],[541,133],[540,132],[538,132],[537,132],[536,131],[535,131],[534,130],[533,129],[532,129],[531,129],[530,128],[529,128],[528,127],[527,127],[526,127],[525,126],[524,125],[523,125],[522,124],[521,124],[520,124],[519,123],[518,122],[513,120],[512,120],[511,119],[510,118],[509,118],[508,118],[507,118],[506,117],[505,117],[504,117],[504,116],[503,116],[502,115],[501,115],[500,115],[499,115],[499,114],[498,114],[497,114],[498,114],[501,116],[504,118],[507,119],[510,120],[513,121],[515,121],[517,122],[519,123],[522,124],[524,124],[526,125],[528,126],[531,127],[532,127],[534,128],[536,129],[537,129],[539,130],[540,131],[542,131],[543,132],[545,133],[546,133],[547,133],[548,134],[550,134],[551,135],[552,135],[553,136],[554,136],[556,137],[557,137],[559,138],[560,138],[561,139],[563,139],[564,140],[565,140],[566,141],[568,141],[568,142],[570,142],[571,143],[572,143],[573,144],[574,144],[575,144],[576,145],[577,146],[578,147],[580,147],[581,148],[582,148],[584,148],[584,149],[585,150],[586,150],[587,150],[588,150],[589,151],[590,151],[591,151],[592,151],[592,152],[593,152],[594,152],[595,152],[595,153],[596,153],[597,154],[599,154],[600,155],[602,155],[603,156],[604,156],[605,157],[603,157],[601,158],[600,158],[599,158],[597,158],[596,159],[594,159],[593,160],[592,161],[590,161],[587,162],[586,162],[583,163],[580,164],[577,165],[575,165],[573,166],[570,167],[567,168],[564,169],[562,169],[560,170],[558,171],[556,172],[553,172],[551,173],[548,173],[546,175],[544,175],[542,176],[540,177],[537,178],[535,179],[533,179],[530,181],[527,182],[524,183],[522,183],[520,185],[518,185],[517,186],[514,186],[512,187],[511,187],[510,188],[509,188],[508,189],[506,189],[506,190],[504,190],[502,191],[501,192],[500,192],[499,193],[498,193],[497,193],[496,194],[496,195],[495,195]))},{name:"reflection",nbr:1,data:new Array(new Array([289,356],[289,355],[289,354],[289,353],[289,352],[289,351],[289,349],[289,348],[289,347],[290,345],[289,340],[289,338],[289,333],[289,327],[289,324],[289,321],[289,318],[289,315],[289,314],[290,310],[290,307],[290,304],[290,298],[290,293],[290,288],[290,279],[290,273],[290,269],[292,259],[292,254],[292,250],[292,247],[292,238],[292,235],[292,230],[292,226],[292,221],[292,210],[292,205],[292,200],[292,195],[291,190],[292,189],[291,185],[291,184],[292,184],[292,182],[292,180],[292,179],[292,178],[292,174],[292,173],[293,172],[292,170],[293,164],[293,163],[293,162],[293,161],[294,161],[294,162],[294,164],[296,168],[296,171],[298,172],[299,175],[305,183],[307,184],[311,189],[313,191],[315,192],[315,194],[316,194],[317,195],[317,196],[318,196],[318,197],[318,195],[317,191],[317,189],[315,187],[315,186],[314,183],[313,180],[312,178],[310,174],[309,172],[307,171],[307,169],[306,167],[306,166],[304,166],[304,165],[303,165],[302,164],[301,164],[299,163],[298,162],[297,161],[296,161],[295,161],[295,160]))},{name:"tangent",nbr:1,data:new Array(new Array([352,253],[352,252],[352,251],[352,250],[354,244],[355,239],[356,236],[356,233],[356,229],[356,226],[356,221],[357,218],[357,215],[357,212],[357,208],[357,204],[357,199],[357,194],[356,192],[356,188],[356,184],[355,170],[355,164],[355,159],[355,154],[355,152],[355,150],[354,146],[354,143],[354,139],[354,137],[354,132],[354,130],[351,130],[345,128],[332,126],[318,124],[305,123],[300,123],[294,123],[287,123],[281,123],[277,123],[272,123],[269,123],[259,123],[257,124],[255,124],[254,124],[255,124],[258,124],[263,122],[271,122],[284,122],[292,122],[300,122],[312,122],[335,122],[344,122],[349,122],[356,122],[364,122],[369,122],[377,122],[382,122],[388,122],[395,122],[401,122],[410,122],[418,122],[424,122],[433,122],[443,122],[450,122],[457,122],[463,122],[470,122],[474,122]))},{name:"tangent",nbr:1,data:new Array(new Array([771,207],[771,206],[775,200],[780,193],[788,182],[794,174],[800,167],[806,158],[810,146],[813,134],[816,123],[817,120],[821,114],[823,110],[825,107],[825,106],[826,106],[827,104],[829,102],[832,98],[833,97],[834,95],[835,93],[836,93],[837,91],[840,86],[840,85],[836,83],[808,73],[753,57],[732,48],[727,45],[727,45],[734,47],[762,59],[792,70],[828,86],[883,107],[935,127],[981,145],[992,150],[1011,153],[1031,161],[1046,166]))},{name:"tangent",nbr:1,data:new Array(new Array([492,232],[493,233],[493,235],[494,237],[495,239],[495,241],[496,245],[497,248],[498,250],[498,252],[498,253],[498,254],[499,256],[499,258],[499,260],[499,262],[499,268],[499,273],[499,276],[499,279],[499,282],[499,285],[499,288],[499,290],[499,293],[499,295],[499,297],[499,301],[499,304],[499,307],[498,311],[498,314],[498,317],[498,320],[498,323],[498,325],[497,328],[497,332],[497,335],[497,339],[497,343],[496,346],[496,349],[496,354],[494,362],[494,365],[494,368],[494,371],[493,376],[493,378],[493,382],[493,384],[493,385],[493,387],[493,388],[493,390],[494,392],[494,393],[495,394],[495,396],[495,397],[495,400],[495,401],[495,402],[495,403],[491,403],[486,403],[467,403],[452,404],[413,404],[379,402],[364,402],[333,400],[322,398],[302,394],[294,392],[279,390],[272,390],[262,390],[260,390],[256,390],[250,392],[234,394],[210,398],[181,402],[152,406],[135,409],[134,409],[144,411],[159,414],[183,416],[196,416],[229,418],[262,418],[280,418],[297,418],[329,418],[344,418],[373,418],[395,418],[407,418],[420,420],[433,420],[445,420],[456,420],[467,420],[479,420],[490,420],[501,420],[512,420],[521,420],[528,420],[533,420],[540,420],[546,420],[551,420],[558,420],[565,420],[572,418],[581,416],[590,416],[599,416],[609,416],[627,414],[636,414],[656,414],[678,413],[688,413],[699,413],[725,411],[738,411],[759,411],[772,411],[800,411],[814,411],[842,411],[856,411],[881,409],[890,409],[904,409],[910,409],[916,409],[918,409],[922,409],[923,409],[926,409],[927,409],[928,409],[928,410]))},{name:"triangle",nbr:1,data:new Array(new Array([66,236],[66,235],[84,214],[87,210],[94,201],[106,183],[114,175],[119,168],[126,162],[130,156],[135,148],[138,145],[144,137],[150,129],[155,123],[161,117],[166,112],[172,103],[176,94],[183,88],[189,80],[195,74],[203,69],[207,62],[214,55],[217,48],[218,46],[218,45],[219,45],[220,45],[221,45],[225,47],[227,50],[231,57],[235,63],[239,68],[247,80],[250,87],[253,92],[257,99],[262,111],[267,120],[272,128],[282,141],[287,148],[293,160],[296,165],[302,174],[306,181],[311,191],[314,197],[320,209],[323,215],[328,223],[329,227],[335,236],[339,241],[347,255],[352,262],[356,271],[358,274],[359,275],[359,276],[360,276],[358,276],[355,276],[348,276],[332,273],[321,272],[317,272],[313,272],[311,271],[309,270],[301,269],[286,264],[279,263],[265,262],[246,261],[236,261],[222,261],[214,260],[207,259],[197,258],[193,258],[185,256],[175,255],[169,255],[159,254],[155,254],[148,254],[145,254],[139,253],[128,253],[116,253],[113,253],[109,253],[108,253],[107,253],[105,253],[100,252],[97,251],[93,251],[90,249],[85,248],[83,247],[79,245],[77,245],[76,245],[74,245],[60,242],[60,241],[60,240]))},{name:"triangle",nbr:1,data:new Array(new Array([107,39],[107,45],[100,87],[97,105],[97,109],[96,114],[95,122],[95,131],[95,137],[95,143],[94,147],[94,155],[93,164],[93,172],[91,178],[91,183],[91,184],[91,185],[92,185],[115,185],[120,185],[126,185],[130,185],[134,185],[140,185],[147,185],[161,185],[165,185],[168,185],[173,185],[180,187],[188,187],[193,187],[201,188],[205,189],[208,189],[213,191],[222,193],[225,193],[227,193],[233,193],[236,193],[241,193],[243,193],[248,193],[249,193],[250,193],[249,193],[248,192],[243,188],[240,186],[236,183],[229,176],[222,170],[210,158],[207,156],[206,156],[205,155],[202,152],[194,149],[181,139],[141,108],[135,98],[132,94],[131,92],[129,90],[127,88],[121,81],[119,78],[116,72],[115,69],[110,62],[109,61],[108,58],[106,57],[106,56],[106,55],[105,54],[104,54],[104,53],[104,52]))},{name:"triangle",nbr:1,data:new Array(new Array([335,111],[347,96],[357,86],[360,82],[362,79],[365,75],[368,72],[370,69],[371,67],[373,64],[375,61],[378,58],[378,57],[379,55],[380,53],[381,52],[383,51],[384,51],[385,51],[386,52],[388,53],[391,55],[394,58],[397,60],[400,64],[402,66],[405,70],[407,74],[411,79],[414,85],[416,89],[418,94],[419,98],[422,104],[423,109],[426,114],[428,121],[429,125],[431,131],[432,135],[433,138],[435,143],[436,147],[438,151],[439,156],[442,160],[442,166],[443,170],[444,174],[445,177],[446,180],[447,182],[448,184],[448,185],[449,187],[450,188],[450,190],[451,192],[452,193],[453,194],[452,194],[449,195],[447,194],[444,194],[442,194],[438,194],[432,193],[425,192],[419,192],[415,191],[408,191],[382,189],[373,189],[367,189],[363,188],[358,188],[355,188],[350,188],[347,188],[344,188],[341,188],[337,188],[335,188],[332,187],[328,187],[326,187],[322,187],[317,186],[315,186],[309,185],[304,185],[300,184],[296,183],[294,183],[294,182],[293,180],[294,179],[295,175],[297,172],[299,169],[302,164],[304,161],[306,158],[309,154],[310,152],[312,150],[313,150],[314,148],[316,146],[317,144],[319,143],[320,141],[322,139],[323,137],[325,135],[327,134],[328,132],[330,130],[331,129],[332,128],[332,126],[333,125],[335,123],[336,122],[338,120],[339,119],[341,118],[342,117],[343,114],[344,113],[345,113],[346,112],[346,110],[347,109],[348,108],[349,107],[350,106],[350,105],[351,104],[352,104],[352,103],[354,102],[355,101],[355,100],[355,99],[356,98],[357,98],[358,97],[359,96],[360,96]))},{name:"triangle",nbr:1,data:new Array(new Array([134,204],[135,204],[137,202],[138,201],[147,194],[151,190],[154,187],[160,182],[165,178],[169,174],[172,170],[177,165],[180,161],[185,156],[188,151],[190,147],[193,142],[196,139],[200,133],[202,131],[206,125],[209,121],[212,118],[215,114],[217,111],[219,108],[222,105],[224,102],[226,100],[229,97],[231,95],[233,92],[235,91],[238,87],[239,85],[241,82],[242,81],[244,78],[246,75],[248,74],[248,72],[250,71],[250,70],[251,69],[252,68],[252,67],[253,67],[254,67],[255,68],[256,70],[256,71],[258,73],[260,75],[261,77],[263,79],[264,81],[265,83],[267,85],[268,88],[271,90],[273,94],[275,97],[278,101],[280,105],[284,110],[287,116],[292,123],[296,130],[299,136],[304,144],[309,150],[315,161],[318,167],[324,179],[328,187],[333,198],[338,207],[342,220],[348,234],[354,248],[360,262],[365,276],[371,291],[377,308],[383,323],[390,343],[395,358],[400,371],[407,389],[411,400],[416,415],[420,425],[424,436],[427,447],[430,455],[433,463],[434,469],[436,476],[438,481],[440,487],[441,492],[442,495],[443,498],[443,500],[444,501],[444,502],[444,501],[444,500],[442,499],[441,497],[440,496],[438,494],[437,493],[434,491],[433,489],[430,487],[428,484],[425,483],[421,479],[417,475],[413,472],[409,469],[405,464],[401,461],[397,457],[391,452],[387,448],[380,442],[375,437],[370,432],[365,426],[357,419],[351,414],[342,404],[334,397],[326,390],[314,380],[306,373],[297,365],[290,359],[283,353],[276,347],[269,341],[261,334],[254,328],[248,323],[241,317],[235,312],[229,307],[223,301],[217,297],[212,292],[207,286],[203,283],[198,278],[192,273],[187,269],[184,264],[179,260],[175,256],[170,250],[166,246],[163,242],[159,238],[156,235],[153,231],[151,228],[147,225],[145,222],[142,218],[140,215],[137,213],[135,210],[134,208],[132,207],[131,205],[129,203],[128,201],[126,200],[125,198],[124,197],[124,196],[123,196]))},{name:"triangle",nbr:1,data:new Array(new Array([351,239],[352,239],[353,239],[354,239],[357,241],[367,247],[371,250],[377,253],[383,255],[388,258],[395,261],[398,263],[401,265],[405,267],[409,269],[414,270],[418,272],[422,273],[425,275],[429,278],[433,280],[437,283],[440,285],[444,287],[448,290],[454,292],[460,295],[465,297],[468,299],[473,301],[478,303],[482,305],[487,308],[491,309],[497,311],[500,313],[504,314],[508,316],[511,317],[515,319],[520,320],[525,322],[531,325],[536,326],[542,328],[548,330],[554,332],[559,334],[564,335],[568,337],[573,338],[578,339],[582,340],[587,340],[591,340],[594,340],[603,340],[604,340],[605,340],[611,339],[622,335],[635,330],[649,326],[664,322],[679,319],[694,316],[709,313],[726,310],[740,308],[753,305],[768,303],[781,301],[794,298],[809,297],[821,295],[833,294],[845,292],[855,291],[867,290],[879,289],[891,288],[905,286],[917,286],[930,285],[943,283],[955,283],[967,281],[976,281],[986,280],[1027,278],[1035,278],[1043,277],[1052,276],[1058,276],[1066,276],[1072,275],[1080,274],[1090,274],[1099,274],[1107,273],[1117,273],[1125,273],[1134,273],[1140,272],[1145,271],[1150,271],[1157,269],[1160,269],[1163,268],[1167,267],[1169,266],[1167,266],[1155,267],[1140,267],[1121,267],[1105,268],[1087,269],[1065,270],[1038,270],[1014,270],[995,270],[974,271],[956,272],[936,272],[913,272],[895,272],[875,272],[856,272],[833,272],[810,273],[788,273],[769,273],[752,273],[734,273],[719,272],[703,272],[689,272],[675,272],[664,272],[652,272],[638,271],[624,271],[611,270],[599,269],[583,268],[570,267],[558,266],[545,265],[535,265],[527,264],[517,264],[507,262],[498,262],[489,261],[480,261],[472,260],[466,259],[459,258],[449,257],[440,255],[432,252],[425,251],[419,249],[410,248],[404,247],[397,247],[388,247],[382,247],[377,247],[375,247],[370,247],[366,247],[364,247],[363,247]))},{name:"triangle",nbr:1,data:new Array(new Array([333,179],[334,179],[335,179],[336,179],[342,176],[345,175],[349,173],[353,171],[358,169],[364,165],[374,162],[384,157],[393,153],[400,150],[413,145],[430,136],[444,129],[462,121],[480,113],[498,105],[518,95],[536,86],[554,78],[575,67],[597,57],[611,50],[620,45],[626,42],[632,39],[633,38],[635,37],[636,37],[641,41],[644,47],[648,50],[655,58],[662,68],[671,80],[685,100],[701,124],[717,147],[729,166],[746,192],[768,226],[787,256],[806,285],[821,312],[836,336],[846,358],[853,371],[860,386],[863,395],[865,400],[866,402],[867,404],[868,404],[868,405],[867,405],[862,404],[855,402],[848,400],[839,397],[829,393],[813,389],[797,384],[781,379],[759,372],[741,366],[721,360],[696,352],[675,345],[647,336],[626,329],[605,322],[581,315],[563,310],[546,306],[528,301],[510,297],[498,293],[480,288],[467,284],[451,278],[438,274],[423,269],[410,264],[397,261],[387,258],[374,253],[364,250],[356,247],[347,244],[340,242],[333,240],[329,238],[325,237],[322,236],[318,235],[310,232],[304,230],[297,228],[292,226],[289,225],[285,224],[281,223],[278,223],[276,222],[274,221],[273,221],[271,221],[269,220],[267,219],[264,219],[263,217],[262,217],[261,217],[260,217],[259,216],[257,216],[256,216],[255,216],[256,215],[264,211],[272,208],[280,205],[287,203],[294,200],[301,197],[306,195],[314,191],[322,189],[328,185],[334,183],[339,180],[344,179],[348,177],[352,174],[355,173],[358,172],[362,170],[366,167],[369,166],[374,163],[377,161],[381,159],[384,157],[386,156],[387,155]))},{name:"triangle",nbr:1,data:new Array(new Array([184,219],[184,220],[185,220],[187,221],[194,225],[199,226],[202,226],[207,228],[211,229],[223,233],[229,235],[232,236],[235,237],[238,239],[241,240],[246,242],[249,242],[253,244],[256,245],[259,246],[262,247],[266,249],[268,250],[273,251],[276,253],[281,254],[286,256],[290,258],[294,259],[298,260],[302,262],[307,264],[312,266],[316,267],[323,271],[328,274],[334,277],[340,280],[349,283],[355,286],[364,290],[372,293],[380,296],[387,299],[393,302],[398,304],[403,306],[407,308],[414,310],[419,313],[426,316],[434,319],[440,321],[446,323],[453,327],[462,331],[469,335],[477,339],[487,343],[497,346],[506,350],[513,353],[519,357],[528,363],[540,369],[552,375],[564,381],[575,386],[587,393],[598,398],[608,403],[615,407],[620,410],[626,412],[632,415],[637,417],[642,420],[646,422],[651,424],[656,426],[660,427],[669,429],[671,430],[672,430],[673,430],[674,430],[676,431],[679,431],[683,433],[683,432],[676,426],[668,419],[658,411],[646,402],[633,393],[619,385],[604,376],[588,368],[572,362],[560,355],[550,349],[539,342],[528,335],[518,330],[509,324],[502,319],[495,313],[488,307],[479,300],[472,293],[465,286],[459,280],[453,275],[448,269],[444,264],[439,259],[434,255],[430,250],[425,245],[419,239],[413,233],[406,226],[401,221],[398,218],[396,216],[393,213],[392,211],[390,210],[389,208],[386,205],[385,202],[384,202],[383,202],[364,204],[344,207],[318,212],[290,216],[267,221],[251,223],[239,225],[228,228],[219,230],[211,232],[206,232],[204,232],[203,232],[201,233],[198,234],[196,234],[195,234]))}]};JXG.extend(JXG,{Draw:{areEqual:function(b,a){if(JXG.isArray(b)){if(JXG.isArray(a)){return JXG.Draw.areEqualArrays(b,a)}else{return false}}if(JXG.isArray(a)){return false}if(JXG.isObject(b)){if(JXG.isObject(a)){return JXG.Draw.areEqualObjects(b,a)}else{return false}}if(JXG.isObject(a)){return false}return b===a},areEqualArrays:function(c,b){if(c.length!=b.length){return false}for(var a=0;a<c.length;a++){if(!JXG.Draw.areEqual(c[a],b[a])){return false}}return true},areEqualObjects:function(d,c){for(var b in d){if(d.hasOwnProperty(b)){if(!JXG.Draw.areEqual(d[b],c[b])){return false}}}for(var a in c){if(c.hasOwnProperty(a)){if(!JXG.Draw.areEqual(c[a],d[a])){return false}}}return true},dist:function(d,c){var b=[],a=[];if(d.coords!=null){b.push(d.coords.usrCoords[1]);b.push(d.coords.usrCoords[2])}else{if(d.usrCoords!=null){b.push(d.usrCoords[1]);b.push(d.usrCoords[2])}else{console.log("inconsistency in dist")}}if(c.coords!=null){a.push(c.coords.usrCoords[1]);a.push(c.coords.usrCoords[2])}else{if(c.usrCoords!=null){a.push(c.usrCoords[1]);a.push(c.usrCoords[2])}else{console.log("inconsistency in dist")}}return(b[0]-a[0])*(b[0]-a[0])+(b[1]-a[1])*(b[1]-a[1])},findHittedObjs:function(n,m,l,d,a,j,k,q){var c,p=l.options.precision.hasPoint,h,f=[],g=[];if(typeof q=="undefined"){q=false}l.options.precision.hasPoint=d;for(var b in l.objects){if(l.objects.hasOwnProperty(b)){c=l.objects[b];if(c.visProp.islabel||(c.visProp.priv&&c.visProp.priv===true)){continue}if(typeof j!="undefined"&&GUI.collectionContains(j,c.type)){continue}if(c.hasPoint&&(c.visProp.visible||q)&&GUI.collectionContains(a,c.elementClass)){if(d===0||c.hasPoint(n,m)){f.push(c);if(typeof k!="undefined"&&k==f.length){break}}}}}l.options.precision.hasPoint=p;for(h=0;h<f.length;h++){if(f[h].type==JXG.OBJECT_TYPE_TEXT&&f[h].id.search("Label")!=-1){f[h]=GUI.board.objects[f[h].id.replace(/Label.*/,"")]}if(JXG.exists(f[h])){g.push(f[h])}}f=JXG.uniqueArray(g);return f},findHittedObjsBySegment:function(d,m,l,j,b,a,h,i){var k,f,n,g=[];if(typeof i=="undefined"){k=Infinity}else{k=i}if(m>l){f=-1}else{f=1}if(m>=d.length){m=d.length-1}if(l>=d.length){l=d.length-1}n=m;do{g=g.concat(JXG.Draw.findHittedObjs(d[n].scrCoords[1],d[n].scrCoords[2],j,b,a,h));n+=f}while(g.length<k&&f*n<f*l);return JXG.uniqueArray(g)},countContainedPoints:function(f,h,c,b){var d=0,g=b.options.precision.hasPoint;b.options.precision.hasPoint=c;if(h.hasPoint){for(var a=0;a<f.length;a++){if(h.hasPoint(f[a].scrCoords[1],f[a].scrCoords[2])){d++}}}b.options.precision.hasPoint=g;return d},findPointNextTo:function(k,f,d){var j,b,a,g,h=Infinity,c=null;if(JXG.exists(k.coords)){b=k.coords}else{b=k}for(j=0;j<f.length;j++){if(f[j].coords!=null){a=f[j].coords}else{a=f[j]}g=(b.scrCoords[1]-a.scrCoords[1])*(b.scrCoords[1]-a.scrCoords[1])+(b.scrCoords[2]-a.scrCoords[2])*(b.scrCoords[2]-a.scrCoords[2]);if(g<h&&(g<d||d===0)){h=g;c=f[j]}}return c},shortStraw:function(s,g,n){var c,t,k=s.slice(0),o=[],p=[],d=[],h=[],u=3,j=0.95,a=1,r=false;if(typeof n!="undefined"){r=(n===true)}var q=function(F){var C=F.length,w,A,z=Number.POSITIVE_INFINITY,G=[z,z,-z,-z],E,D,B;for(A=0;A<C;A++){F[A].catchIdx=A;w=F[A].scrCoords;if(w[1]<G[0]){G[0]=w[1]}if(w[1]>G[2]){G[2]=w[1]}if(w[2]<G[1]){G[1]=w[2]}if(w[2]>G[3]){G[3]=w[2]}}E=G[2]-G[0];D=G[3]-G[1];B=Math.sqrt(E*E+D*D);return B/40};var b=function(H,A,C){var w=0,B,E,G,F,z;if(r){for(B=0;B<H.length;B++){C.create("point",H[B].usrCoords,{fixed:true,withLabel:false,size:1,color:"blue"})}}o.push(H[0]);for(B=1;B<H.length;B++){E=H[B-1].distance(JXG.COORDS_BY_SCREEN,H[B]);if(w+E>=A){G=H[B-1].scrCoords[1]+(A-w)*(H[B].scrCoords[1]-H[B-1].scrCoords[1])/E;F=H[B-1].scrCoords[2]+(A-w)*(H[B].scrCoords[2]-H[B-1].scrCoords[2])/E;z=new JXG.Coords(JXG.COORDS_BY_SCREEN,[G,F],C);z.catchIdx=H[B].catchIdx;o.push(z);H.splice(B,0,z);w=0}else{w+=E}}o.push(H[H.length-1]);if(r){for(B=0;B<o.length;B++){C.create("point",o[B].usrCoords,{fixed:true,withLabel:false,size:1,color:"red"})}}};var v=function(B,A){var w=B.length,z,y,C,x;p.push(0);for(z=u;z<w-u;z++){h[z]=B[z-u].distance(JXG.COORDS_BY_SCREEN,B[z+u])}y=JXG.Math.Statistics.median(h)*j;for(z=u;z<w-u;z++){if(h[z]<y){C=Number.POSITIVE_INFINITY;x=z;while(z<w-u&&h[z]<y){if(h[z]<C){C=h[z];x=z}z++}p.push(x)}}p.push(w-1);l(B,A)};var l=function(F,D){var w,A,z,y,G,C=0,x=F.length,B,E;do{w=true;for(A=1;A<p.length;A++){z=p[A-1];y=p[A];if(!m(F,z,y,a)){G=f(z,y);if(G>z&&G<y){p.splice(A,0,G);w=false;if(r&&false){D.create("point",F[p[A]].usrCoords,{fixed:true,withLabel:false,size:4,color:"blue"})}}C++;if(C>=x){return}}}}while(!w);for(A=1;A<p.length-1;A++){z=p[A-1];y=p[A+1];if(m(F,z,y,a)){p.splice(A,1);A--}}B=p.length;if(B>2){E=F[p[0]].distance(JXG.COORDS_BY_SCREEN,F[p[B-1]]);if(E<30){p.pop()}}};var m=function(B,z,y,x){var C=B[z].distance(JXG.COORDS_BY_SCREEN,B[y]),A,w=0;for(A=z;A<y-1;A++){w+=B[A].distance(JXG.COORDS_BY_SCREEN,B[A+1])}return(C>w*x)};var f=function(y,x){var B=Math.floor((x-y)/4),w=Number.POSITIVE_INFINITY,A,z;for(z=y+B;z<x-B;z++){if(h[z]<w){w=h[z];A=z}}return A};c=q(k);b(k,c,g);v(o,g);for(t=0;t<p.length;t++){d.push(o[p[t]])}if(r){for(t=0;t<d.length;t++){g.create("point",d[t].usrCoords,{fixed:true,name:t,withLabel:true,size:6,label:{offsets:[-10,-10]},strokeColor:"blue",fillColor:"none"})}}return d},findCorners:function(b,a,c){return JXG.Draw.shortStraw(b,a,c)},bestRightAngleCorner:function(f,d,l){var g=Infinity,h=f.length,k,j,c,b=Math.PI;if(h<4){return 1}j=1;for(c=1;c<h-1;c++){k=JXG.Math.Geometry.rad(d.usrCoords.slice(1),f[c].usrCoords.slice(1),l.usrCoords.slice(1));k+=2*b-b*0.5;k=Math.min(Math.abs(k%b),Math.abs(k%b-b));if(k<g){g=k;j=c}}return j},removeLine:function(a,c){for(var b in a.ancestors){if(a.ancestors.hasOwnProperty(b)){c.removeObject(a.ancestors[b])}}c.removeObject(a)},visualize:function(c,b){var a,d=b.length;if(b[0]!=b[d-1]){c.create("line",[[b[d-1].usrCoords[1],b[d-1].usrCoords[2]],[b[0].usrCoords[1],b[0].usrCoords[2]]],{straightFirst:false,straightLast:false})}for(a=0;a<d-1;a++){c.create("line",[[b[a].usrCoords[1],b[a].usrCoords[2]],[b[a+1].usrCoords[1],b[a+1].usrCoords[2]]],{straightFirst:false,straightLast:false})}},pointAlreadyExists:function(d,a){var c,f,b;for(c in d.objects){if(d.objects.hasOwnProperty(c)){b=true;if(d.objects[c].elementClass==JXG.OBJECT_CLASS_POINT&&d.objects[c]!=a){for(f in d.objects[c].ancestors){if(d.objects[c].ancestors.hasOwnProperty(f)){if(!GUI.collectionContains(a.ancestors,d.objects[c].ancestors[f])){b=false;break}}}if(b){for(f in a.ancestors){if(a.ancestors.hasOwnProperty(f)){if(!GUI.collectionContains(d.objects[c].ancestors,a.ancestors[f])){b=false;break}}}}if(b&&d.objects[c].visProp.priv){b=false}if(b){b=(Math.abs(a.coords.usrCoords[1]-d.objects[c].coords.usrCoords[1])+Math.abs(a.coords.usrCoords[2]-d.objects[c].coords.usrCoords[2])<0.1)}if(b){return d.objects[c]}}}}return null},sortXY:function(d){var c,b,a;for(b=0;b<d.length;b++){for(a=b+1;a<d.length;a++){if(d[a].usrCoords[1]<d[b].usrCoords[1]||(d[a].usrCoords[1]==d[b].usrCoords[1]&&d[a].usrCoords[2]<d[b].usrCoords[2])){c=d[a];d[a]=d[b];d[b]=c}}}},convexHull:function(g,f,h){var j=function(k,i,l){return((i.usrCoords[1]-k.usrCoords[1])*(l.usrCoords[2]-k.usrCoords[2])-(i.usrCoords[2]-k.usrCoords[2])*(l.usrCoords[1]-k.usrCoords[1]))};var d,c,a=0,b=[];JXG.Draw.sortXY(f);for(d=0;d<f.length;d++){while(a>=2&&j(b[a-2],b[a-1],f[d])<=0){a--}b[a++]=f[d]}for(d=f.length-2,c=a+1;d>=0;d--){while(a>=c&&j(b[a-2],b[a-1],f[d])<=0){a--}b[a++]=f[d]}b.length=a;if(typeof h!="undefined"&&h){JXG.Draw.visualize(g,b)}return b},buildTupels:function(l,b,h){var a,d,c,m,f=[],g=[];if(b===0||l.length<b){return g}if(b==1){for(d=0;d<l.length;d++){g.push([l[d]])}return g}if(typeof h=="undefined"){h=true}for(d=0;d<l.length;d++){m=[];if(h){a=d+1}else{a=0}for(c=a;c<l.length;c++){if(c==d){continue}m.push(l[c])}f=JXG.Draw.buildTupels(m,b-1,h);for(c=0;c<f.length;c++){JXG.Draw.sortXY(f[c].push(l[d]));g.push(f[c]);if(g.length>2){return JXG.uniqueArray(g)}}}return JXG.uniqueArray(g)},findMaxAreaPoints:function(m,u,f){var h,g,s,b,t=-1,r=-Infinity,d=u.length;var o=[],q=[],c=[],l;for(h=0;h<d;h++){if(typeof u[h].elementClass!="undefined"){o.push(u[h])}else{q.push(u[h])}}while(o.length>f){o.pop()}if(o.length==f){return{req:o,status:true}}if(q.length<f-o.length){console.log("too few optional points!");console.log("k: "+f);console.log("n: "+d);console.log("optional: "+q.length);console.log("required: "+o.length);return{req:o,status:false}}if(q.length>f-o.length){console.log("too much optional points!");l=JXG.Draw.buildTupels(q,f-o.length,true);for(h=0;h<l.length;h++){c=[];for(g=0;g<l[h].length;g++){c[g]=m.create("point",[l[h][g].usrCoords[1],l[h][g].usrCoords[2]],{visible:false})}c.push(c[0]);b=m.create("polygon",c,{visible:false});m.removeObject(b);for(g=0;g<c.length;g++){m.removeObject(c[g])}s=b.Area();if(s>=r){r=s;t=h}}if(t!=-1){for(h=0;h<l[t].length;h++){o.push(l[t][h])}}else{console.log("Tupels: "+l.length);console.log("k: "+f);console.log("n: "+d);console.log("optional: "+q.length);console.log("required: "+o.length);console.log("max area error");return{req:[],status:false}}}else{for(h=0;h<q.length;h++){o.push(q[h])}}return{req:o,status:true}},fitPoints:function(d,a){var c,f,b=[];if(a.length===0){return d}for(c=0;c<a.length;c++){f=JXG.Draw.findPointNextTo(a[c],d,0);if(f==null){console.log("inconsistency in fitPoints: data.len is smaller than ref.len");break}else{JXG.removeElementFromArray(d,f);b.push(a[c])}}for(c=0;c<d.length;c++){b.push(d[c])}return b},glideInterCombinedMigMove:function(m,l,a,b,n,f,h){var g,d,o,p,j,i,c={},k=[];if(JXG.isTouchDevice()){d=GUI.board.touches[0].targets[0].Xstart[0];o=GUI.board.touches[0].targets[0].Ystart[0];p=JXG.deepCopy(GUI.board.touches[0].obj.coords.usrCoords)}else{d=GUI.board.mouse.targets[0].Xstart[0];o=GUI.board.mouse.targets[0].Ystart[0];p=JXG.deepCopy(GUI.board.mouse.obj.coords.usrCoords)}GUI.board.mouse=GUI.board.touches=null;j={type:JXG.GENTYPE_MOVEMENT,src_ids:[a],dest_sub_ids:[],dest_id:0,args:{obj_type:JXG.OBJECT_TYPE_POINT,xstart:d,ystart:o,coords:[{usrCoords:p}]}};k.push(j);if(n){if(GUI.board.objects[b].type!=JXG.OBJECT_TYPE_GLIDER){c.type=JXG.GENTYPE_GLIDER;c.src_ids=[b];c.dest_sub_ids=[];c.args={undoIsEmpty:true,usrCoords:[1,m,l]};g=c.dest_id=JXG.SketchReader.id();k.push(c)}else{g=b}}else{c.type=JXG.GENTYPE_INTERSECTION;c.src_ids=[f[h[0][1][1]].id,f[h[0][1][2]].id];c.dest_id=h[0][1][0].id;c.args={choice:h[0][1][3],fillColor:"#ffffff",undoIsEmpty:true};g=c.dest_id;k.push(c);GUI.board.removeObject(GUI.board.objects[g])}i={type:JXG.GENTYPE_MIGRATE,args:{migrateToGlider:true,usrCoords:JXG.deepCopy(GUI.ctx_curr_coords.usrCoords),orig_name:GUI.board.objects[a].name,fillColor:JXG.Options.point.fillColor,strokeColor:JXG.Options.point.strokeColor},src_ids:j.src_ids,dest_sub_ids:[],dest_id:g};k.push(i);JXG.Draw.recordStepMeta({type:JXG.GENTYPE_COMBINED,src_ids:i.src_ids,dest_sub_ids:[],dest_id:i.dest_id,args:{steps:k}},true);return g},gliderDialog:function(a,g,f,d,c,b){GUI.createSelectDialog(f,(function(i){if(d){if(b){JXG.Draw.glideInterCombinedMigMove(a,g,c,i,true,[],[])}else{var h=JXG.Draw.drawGlider(i,a,g);JXG.Draw.recordStepMeta({type:JXG.GENTYPE_MIGRATE,src_ids:[c],dest_sub_ids:[],dest_id:h},true)}GUI.removeActionEvent(true)}else{JXG.Draw.drawGlider(i,a,g)}GUI.showPanel(false,0);GUI.selection=[];GUI.delight();GUI.removeToolEvents(true)}),GUI.ctxPosProps);GUI.selection=[]},touchIssDialogHandler:function(c){var a,b;for(a=0;a<GUI.intersect_obj.length;a++){b="sel_"+GUI.intersect_obj[a][0]+GUI.intersect_obj[a][1]+ +GUI.intersect_obj[a][2];if(GUI.isTouchInElementsBounds(c,b)){if(a!=GUI.int_click){if(GUI.int_click!=-1){$("#sel_"+GUI.intersect_obj[GUI.int_click][0]+GUI.intersect_obj[GUI.int_click][1]+GUI.intersect_obj[GUI.int_click][2]).removeClass("proplight_active");GUI.iss_delight()}GUI.int_click=a;$("#sel_"+GUI.intersect_obj[a][0]+GUI.intersect_obj[a][1]+GUI.intersect_obj[a][2]).addClass("proplight_active");GUI.iss_highlight(GUI.intersect_obj[a][0],GUI.intersect_obj[a][1],GUI.intersect_obj[a][2])}break}else{$(b).removeClass("proplight_active")}}if(c&&c.preventDefault){c.preventDefault()}else{window.event.returnValue=false}},intersectionDialog:function(l,k,f,j,m,a){var g,d,c,b,h;if(m){GUI.disableConstDragMode();h=GUI.Lang.std.ablateOnIntersection+"<br><br>"}else{h=GUI.Lang.std.selectIntersection+"<br><br>"}GUI.intersect_obj=[];for(g=0;g<j.length;g++){if(j[g][1][0].coords.usrCoords[0]!==0){d=f[j[g][1][1]];c=f[j[g][1][2]];b="sel_"+d.id+c.id+j[g][1][3];h+='<a href="#" tabindex="'+GUI.intersect_obj.length+'" id="'+b+'" class="proplight">';h+=GUI.resolveObjectType(d);if(d.visProp.withlabel&&d.label.content.visProp.visible){h+=" "+d.name}h+=" &#8745; "+GUI.resolveObjectType(c);if(c.visProp.withlabel&&c.label.content.visProp.visible){h+=" "+c.name}h+="</a>";GUI.intersect_obj.push([d.id,c.id,j[g][1][3]])}GUI.board.removeObject(j[g][1][0])}GUI.showPanelHTML(h,GUI.ctxPosProps,false);GUI.int_click=-1;if(JXG.isTouchDevice()){JXG.addEvent(GUI.getId("ctx_panel"),"touchstart",JXG.Draw.touchIssDialogHandler,GUI);JXG.addEvent(GUI.getId("ctx_panel"),"touchmove",JXG.Draw.touchIssDialogHandler,GUI);JXG.addEvent(GUI.getId("ctx_panel"),"touchend",function(){$("#ctx_panel").unbind();if(m){JXG.Draw.glideInterCombinedMigMove(l,k,a,0,false,f,j)}else{JXG.Draw.drawIntersection(GUI.intersect_obj[GUI.int_click][0],GUI.intersect_obj[GUI.int_click][1],GUI.intersect_obj[GUI.int_click][2])}GUI.iss_delight();GUI.removeActionEvent(true)},GUI)}else{for(g=0;g<GUI.intersect_obj.length;g++){b=$("#sel_"+GUI.intersect_obj[g][0]+GUI.intersect_obj[g][1]+GUI.intersect_obj[g][2]);b.bind(GUI.out_event,function(i){$("#"+i.currentTarget.id).removeClass("proplight_active");GUI.iss_delight()});b.bind(GUI.over_event,function(n){var i=$("#"+n.currentTarget.id).attr("tabindex");$("#"+n.currentTarget.id).addClass("proplight_active");GUI.iss_highlight(GUI.intersect_obj[i][0],GUI.intersect_obj[i][1],GUI.intersect_obj[i][2])});b.bind(GUI.click_event,function(n){var i=$("#"+n.currentTarget.id).attr("tabindex");if(m){JXG.Draw.glideInterCombinedMigMove(l,k,a,0,false,f,j)}else{JXG.Draw.drawIntersection(GUI.intersect_obj[i][0],GUI.intersect_obj[i][1],GUI.intersect_obj[i][2])}$("#"+n.currentTarget.id).removeClass("proplight_active");GUI.removeActionEvent(true);GUI.iss_delight()})}}},drawPoint:function(f,r,a,b,g){var s,q,l,k,t=[],h=[],u=[JXG.OBJECT_TYPE_TEXT,JXG.OBJECT_TYPE_POLYGON],c={src_ids:[],dest_sub_ids:[],dest_id:0,args:{}};if(a){k=a;for(s=0;s<k.length;s++){if(k[s].elementClass==JXG.OBJECT_CLASS_POINT){t.push(k[s])}}if(t.length>0){k=t}if(k.length==1&&k[0].elementClass==JXG.OBJECT_CLASS_POINT){return k[0].id}}else{if(typeof r[0]=="undefined"||typeof r[0].scrCoords=="undefined"){return c.dest_id}k=JXG.Draw.findHittedObjs(r[0].scrCoords[1],r[0].scrCoords[2],f,JXG.Options.sensitive_area,[JXG.OBJECT_CLASS_LINE,JXG.OBJECT_CLASS_CIRCLE,JXG.OBJECT_CLASS_POINT,JXG.OBJECT_CLASS_CURVE,JXG.OBJECT_CLASS_AREA,JXG.OBJECT_CLASS_OTHER],u);for(s=0;s<k.length;s++){if(k[s].elementClass==JXG.OBJECT_CLASS_POINT){JXG.removeElementFromArray(k,k[s]);s--}}}if(k.length<=1){c.dest_id=JXG.SketchReader.id();c.args.usrCoords=JXG.deepCopy(r[0].usrCoords);if(k.length!==0){c.type=JXG.GENTYPE_GLIDER;c.src_ids=[k[0].id]}else{c.type=JXG.GENTYPE_POINT}if(b){return c}else{this.recordStepMeta(c,true)}}else{var x,m,o,n,v=[],d=false,w=2*JXG.Options.sensitive_area/(f.unitX+f.unitY);if(JXG.Options.device=="tablet"){w*=2}f.suspendUpdate();for(s=0;s<k.length;s++){for(q=s+1;q<k.length;q++){o=f.create("intersection",[k[s],k[q],0],{id:JXG.SketchReader.id(),fillColor:"#ffffff"});n=f.create("intersection",[k[s],k[q],1],{id:JXG.SketchReader.id(),fillColor:"#ffffff"});v.push([o,s,q,0]);if(o.coords.usrCoords[0]==n.coords.usrCoords[0]&&o.coords.usrCoords[1]==n.coords.usrCoords[1]&&o.coords.usrCoords[2]==n.coords.usrCoords[2]){f.removeObject(n)}else{v.push([n,s,q,1])}}}l=f.create("point",r[0].usrCoords);m=v[0][0].nameHTML;x=v[0][0].name;for(s=0;s<v.length;s++){if(l.Dist(v[s][0])<w&&JXG.Draw.pointAlreadyExists(f,v[s][0])==null){h.push([s,v[s]]);JXG.removeElementFromArray(v,v[s]);s--}}f.removeObject(l);for(s=0;s<v.length;s++){f.removeObject(v[s][0])}f.unsuspendUpdate();if(h.length===0||h.length>1){d=true}else{if(h[0][0]!==0){h[0][1][0].nameHTML=m;h[0][1][0].setAttribute({name:x});h[0][1][0].label.content.setText(x)}if(g){return JXG.Draw.glideInterCombinedMigMove(r[0].usrCoords[1],r[0].usrCoords[2],b,k[0].id,false,k,h)}else{c.type=JXG.GENTYPE_INTERSECTION;c.src_ids=[k[h[0][1][1]].id,k[h[0][1][2]].id];c.dest_id=h[0][1][0].id;c.args.choice=h[0][1][3];c.args.fillColor="#ffffff";this.recordStepMeta(c,false)}}if(GUI&&d){if(h.length>0){JXG.Draw.intersectionDialog(r[0].usrCoords[1],r[0].usrCoords[2],k,h,a,b)}else{JXG.Draw.gliderDialog(r[0].usrCoords[1],r[0].usrCoords[2],k,a,b,g)}if(a){return -1}}}return c.dest_id},drawGlider:function(d,b,a){var c={};c.type=JXG.GENTYPE_GLIDER;c.src_ids=[d];c.dest_sub_ids=[];c.dest_id=JXG.SketchReader.id();c.args={usrCoords:[1,b,a]};this.recordStepMeta(c,true);return c.dest_id},drawIntersection:function(b,a,d){var c={};c.type=JXG.GENTYPE_INTERSECTION;c.src_ids=[b,a];c.args={};c.args.choice=d;c.args.fillColor="#ffffff";c.dest_sub_ids=[];c.dest_id=JXG.SketchReader.id();this.recordStepMeta(c,true);return c.dest_id},drawMidPoint:function(b){if(b.length>=2){var a={type:JXG.GENTYPE_MID,args:{fillColor:"#ffffff"},src_ids:[b[0].id,b[b.length-1].id],dest_sub_ids:[],dest_id:JXG.SketchReader.id()};this.recordStepMeta(a,true);return a.dest_id}else{return 0}},drawReflection:function(j,m,o){var d,l,n,g=0,f=0,k,h,c,a,b={};a=JXG.Draw.findPointNextTo(m[0],o,0);c=JXG.Draw.findHittedObjsBySegment(m,m.length,m.length-m.length/3,j,JXG.Options.sensitive_area,[JXG.OBJECT_CLASS_LINE,JXG.OBJECT_CLASS_CIRCLE,JXG.OBJECT_CLASS_POINT,JXG.OBJECT_CLASS_CURVE,JXG.OBJECT_CLASS_AREA,JXG.OBJECT_CLASS_OTHER],[JXG.OBJECT_TYPE_TICKS,JXG.OBJECT_TYPE_TEXT]);for(d=0;d<c.length;d++){if(c[d].elementClass==JXG.OBJECT_CLASS_LINE){if((l=JXG.Draw.countContainedPoints(m,c[d],JXG.Options.sensitive_area,j))>g){if(c[d].hasPoint(a.coords.scrCoords[1],a.coords.scrCoords[2])){continue}g=l;k=d}}else{if(c[d].elementClass==JXG.OBJECT_CLASS_POINT){if((n=JXG.Draw.countContainedPoints(m,c[d],JXG.Options.sensitive_area,j))>f){f=n;h=d}}}}if(f===0){if(g===0){return}else{d=k}}else{d=h}if(o.length===0||(o.length==1&&c[d].elementClass==JXG.OBJECT_CLASS_POINT)){return}b.args={};b.dest_sub_ids=[];b.src_ids=[a.id,c[d].id];b.dest_id=JXG.SketchReader.id();b.args.fillColor="#ffffff";if(c[d].elementClass==JXG.OBJECT_CLASS_LINE){b.type=JXG.GENTYPE_REFLECTION}else{b.type=JXG.GENTYPE_MIRRORPOINT}this.recordStepMeta(b,true)},drawTangent:function(l,t){var h,o,k=JXG.Draw.findCorners(t,l),d,c,a,s,n,g,r;if(k.length<4){return}d=l.create("line",[[k[0].usrCoords[1],k[0].usrCoords[2]],[k[1].usrCoords[1],k[1].usrCoords[2]]]);c=l.create("line",[[k[k.length-2].usrCoords[1],k[k.length-2].usrCoords[2]],[k[k.length-1].usrCoords[1],k[k.length-1].usrCoords[2]]]);for(h in k){if(k.hasOwnProperty(h)){l.removeObject(k[h])}}a=l.create("intersection",[d,c,0]);s=a.coords.usrCoords[1];n=a.coords.usrCoords[2];JXG.Draw.removeLine(d,l);JXG.Draw.removeLine(c,l);l.removeObject(a);g=JXG.Draw.findHittedObjsBySegment(t,0,t.length,l,JXG.Options.sensitive_area,[JXG.OBJECT_CLASS_CIRCLE,JXG.OBJECT_CLASS_CURVE],[],1);var b={};b.type=JXG.GENTYPE_TANGENT;b.args={};b.src_ids=[];b.dest_sub_ids=[];if(g.length>0){b.src_ids=[g[0].id];r=JXG.Draw.findHittedObjsBySegment(t,0,t.length,l,JXG.Options.sensitive_area,[JXG.OBJECT_CLASS_POINT],[JXG.OBJECT_TYPE_POINT,JXG.OBJECT_TYPE_AXISPOINT,JXG.OBJECT_TYPE_CAS,JXG.OBJECT_TYPE_INTERSECTION]);if(r.length===0){a=l.create("point",[s,n]);a.setAttribute({fillColor:l.options.glider.fillColor});if(g[0].type==JXG.OBJECT_TYPE_CURVE){o=JXG.Math.Geometry.projectPointToCurve(a,g[0],l)}else{o=JXG.Math.Geometry.projectPointToCircle(a,g[0],l)}l.removeObject(a);b.args.create_point=true;b.args.usrCoords=JXG.deepCopy(o.usrCoords);b.args.fillColor=l.options.glider.fillColor;var j=JXG.SketchReader.id();b.dest_sub_ids=[JXG.SketchReader.id(),JXG.SketchReader.id(),j]}else{b.args.create_point=false;var m,q=-1,f=Infinity;for(h=0;h<r.length;h++){if(g[0].type==JXG.OBJECT_TYPE_CURVE){o=JXG.Math.Geometry.projectPointToCurve(r[h],g[0],l)}else{o=JXG.Math.Geometry.projectPointToCircle(r[h],g[0],l)}m=(o.usrCoords[1]-r[h].coords.usrCoords[1])*(o.usrCoords[1]-r[h].coords.usrCoords[1]);m+=(o.usrCoords[2]-r[h].coords.usrCoords[2])*(o.usrCoords[2]-r[h].coords.usrCoords[2]);if(m<f){q=h;f=m}}if(q>=0){b.src_ids=[r[q].id];b.dest_sub_ids=[JXG.SketchReader.id(),JXG.SketchReader.id()]}else{return}}b.dest_id=JXG.SketchReader.id();this.recordStepMeta(b,true)}},drawParallel:function(g,r){var t,q,n,d,a,m=[],s,o,k,f,b,l,h,v=0,u=0;var c={};c.args={};c.src_ids=[];c.dest_sub_ids=[];n=JXG.Draw.findHittedObjsBySegment(r,0,r.length/3,g,JXG.Options.sensitive_area,[JXG.OBJECT_CLASS_LINE,JXG.OBJECT_CLASS_CIRCLE,JXG.OBJECT_CLASS_POINT,JXG.OBJECT_CLASS_CURVE,JXG.OBJECT_CLASS_AREA,JXG.OBJECT_CLASS_OTHER],[]);d=JXG.Draw.findHittedObjsBySegment(r,r.length,r.length-r.length/3,g,JXG.Options.sensitive_area,[JXG.OBJECT_CLASS_LINE,JXG.OBJECT_CLASS_CIRCLE,JXG.OBJECT_CLASS_POINT,JXG.OBJECT_CLASS_CURVE,JXG.OBJECT_CLASS_AREA,JXG.OBJECT_CLASS_OTHER],[]);for(t=0;t<n.length;t++){if(n[t].elementClass==JXG.OBJECT_CLASS_LINE){if((f=JXG.Draw.countContainedPoints(r,n[t],JXG.Options.sensitive_area,g))>v){v=f;o=t}}}for(q=0;q<d.length;q++){if(d[q].elementClass==JXG.OBJECT_CLASS_LINE){if((f=JXG.Draw.countContainedPoints(r,d[q],JXG.Options.sensitive_area,g))>u){u=f;k=q}}}if(u>v){n=d;t=k;b=true}else{if(v>0){t=o;b=false}else{return}}a=JXG.Draw.findHittedObjsBySegment(r,0,r.length,g,JXG.Options.sensitive_area,[JXG.OBJECT_CLASS_LINE,JXG.OBJECT_CLASS_CIRCLE,JXG.OBJECT_CLASS_POINT,JXG.OBJECT_CLASS_CURVE,JXG.OBJECT_CLASS_AREA,JXG.OBJECT_CLASS_OTHER],[]);for(q=0;q<a.length;q++){if(a[q].elementClass==JXG.OBJECT_CLASS_POINT){m.push(a[q])}}if(m.length>0){if(b){h=m[0].id}else{h=m[m.length-1].id}s=JXG.Math.Geometry.projectPointToLine(g.objects[h],n[t],g);if(Math.abs(s.usrCoords[1]-g.objects[h].coords.usrCoords[1])<JXG.Math.eps&&Math.abs(s.usrCoords[2]-g.objects[h].coords.usrCoords[2])<JXG.Math.eps){m=[]}}c.type=JXG.GENTYPE_PARALLEL;if(m.length===0){if(b){l=r[0]}else{l=r[r.length-1]}h=JXG.SketchReader.id();c.args.usrCoords=JXG.deepCopy(l.usrCoords);c.args.create_point=true;c.src_ids=[n[t].id];c.dest_sub_ids=[JXG.SketchReader.id(),h]}else{c.args.create_point=false;c.src_ids=[n[t].id,h];c.dest_sub_ids=[JXG.SketchReader.id()]}c.dest_id=JXG.SketchReader.id();this.recordStepMeta(c,true)},drawBisector:function(r,s,t){var f={};f.args={};f.args.create_point=false;if(t.length==3){f.type=JXG.GENTYPE_BISECTOR;f.src_ids=[t[0].id,t[2].id,t[1].id];f.dest_sub_ids=[JXG.SketchReader.id()];f.dest_id=JXG.SketchReader.id()}else{var l,k,d,o;var c,n,b,h,a,g=100000;var m=JXG.Draw.findCorners(s,r);d=JXG.Draw.findHittedObjsBySegment(s,0,s.length/3,r,JXG.Options.sensitive_area,[JXG.OBJECT_CLASS_LINE],[JXG.OBJECT_TYPE_TEXT],1);o=JXG.Draw.findHittedObjsBySegment(s,s.length,s.length-s.length/3,r,JXG.Options.sensitive_area,[JXG.OBJECT_CLASS_LINE],[JXG.OBJECT_TYPE_TEXT],1);for(l=0;l<d.length;l++){if(d[l].elementClass==JXG.OBJECT_CLASS_LINE){break}}for(k=0;k<o.length;k++){if(o[k].elementClass==JXG.OBJECT_CLASS_LINE){break}}if(l<d.length&&k<o.length&&d[l]!=o[k]){if(m.length<4){return}f.type=JXG.GENTYPE_BISECTOR;f.args.create_point=true;f.args.fillColor=r.options.intersection.fillColor;b=r.create("intersection",[d[l],o[l]],{visible:false});h=m[2].usrCoords.slice(0);a=b.coords.usrCoords;h[0]=a[0];h[1]=g*(h[1]-a[1])+a[1];h[2]=g*(h[2]-a[2])+a[2];f.args.usrCoords=h.slice(0);c=this.pointAlreadyExists(r,b);r.removeObject(b);f.src_ids=[d[l].id,o[l].id];f.dest_sub_ids=[JXG.SketchReader.id(),JXG.SketchReader.id(),JXG.SketchReader.id()];if(c===null){f.args.create_intersection=true;f.dest_sub_ids[3]=JXG.SketchReader.id()}else{f.args.create_intersection=false;n=JXG.deepCopy(c.id);f.src_ids[2]=n}f.dest_id=JXG.SketchReader.id()}else{return}}this.recordStepMeta(f,true)},drawNormal:function(k,r,s){var f,o,j,n=0,d,l=[JXG.OBJECT_TYPE_POLYGON],h,g,a,m,q;d=JXG.Draw.findHittedObjsBySegment(r,0,r.length,k,JXG.Options.sensitive_area,[JXG.OBJECT_CLASS_LINE,JXG.OBJECT_CLASS_CIRCLE,JXG.OBJECT_CLASS_POINT,JXG.OBJECT_CLASS_CURVE,JXG.OBJECT_CLASS_AREA,JXG.OBJECT_CLASS_OTHER],l);for(f=0;f<d.length;f++){if(d[f].elementClass==JXG.OBJECT_CLASS_LINE){if((j=JXG.Draw.countContainedPoints(r,d[f],JXG.Options.sensitive_area,k))>n){n=j;o=f}}}if(n===0){return}var b={};b.args={};b.dest_sub_ids=[];b.dest_id=0;b.type=JXG.GENTYPE_NORMAL;b.src_ids=[d[o].id];h=JXG.Draw.findCorners(r,k);if(h.length<3||r.length<5){return}a=null;for(f=0;f<s.length;f++){m=s[f].coords.scrCoords;if(!d[o].hasPoint(m[1],m[2])){a=s[f];break}}q=this.bestRightAngleCorner(h,r[0],r[r.length-1]);if(a===null){a=JXG.Draw.findPointNextTo(h[q],s,32*JXG.Options.sensitive_area)}if(a===null){b.args.create_point=true;b.args.usrCoords=JXG.deepCopy(h[q].usrCoords);g=JXG.SketchReader.id();b.dest_sub_ids=[JXG.SketchReader.id(),g]}else{b.args.create_point=false;b.src_ids.push(a.id);b.dest_sub_ids=[JXG.SketchReader.id()]}b.dest_id=JXG.SketchReader.id();this.recordStepMeta(b,true)},drawLine:function(a,f){var d=null,c=null,b={};b.type=JXG.GENTYPE_LINE;b.args={};b.src_ids=[];b.dest_sub_ids=[];b.dest_id=0;b.args.create_point1=b.args.create_point2=false;b.args.first=b.args.last=true;if(f.length>0){d=JXG.Draw.findPointNextTo(a[0],f,GUI.rayFactor*JXG.Options.sensitive_area);if(d!=null){f=JXG.removeElementFromArray(f,d);b.args.first=false}c=JXG.Draw.findPointNextTo(a[a.length-1],f,GUI.rayFactor*JXG.Options.sensitive_area);if(c!=null){f=JXG.removeElementFromArray(f,c);b.args.last=false}if(d==null){if(f.length>0){d=f[0];f=JXG.removeElementFromArray(f,d)}else{d=a[0].usrCoords}}if(c==null){if(f.length>0){c=f[f.length-1]}else{c=a[a.length-1].usrCoords}}}else{d=a[0].usrCoords;c=a[a.length-1].usrCoords}b.src_ids=[];b.dest_sub_ids=[];if(!d.coords&&!c.coords){b.args.create_point1=b.args.create_point2=true;b.args.p1=[d[1]-100000*(c[1]-d[1]),d[2]-100000*(c[2]-d[2])];b.args.p2=[0,c[1]-d[1],c[2]-d[2]];b.dest_sub_ids=[JXG.SketchReader.id(),JXG.SketchReader.id()]}else{if(!d.coords){b.args.p1=[0,d[1]-c.coords.usrCoords[1],d[2]-c.coords.usrCoords[2]];b.args.create_point1=true;b.dest_sub_ids.push(JXG.SketchReader.id());b.args.p2=[c[1],c[2]];b.src_ids.push(c.id)}else{b.args.p1=[d[1],d[2]];b.src_ids.push(d.id);if(!c.coords){b.args.p2=[0,c[1]-d.coords.usrCoords[1],c[2]-d.coords.usrCoords[2]];b.args.create_point2=true;b.dest_sub_ids.push(JXG.SketchReader.id())}else{b.args.p2=[c[1],c[2]];b.src_ids.push(c.id)}}}b.dest_id=JXG.SketchReader.id();this.recordStepMeta(b,true)},drawPolygon:function(c){var b={type:JXG.GENTYPE_POLYGON,src_ids:[],args:{},dest_sub_ids:[],dest_id:JXG.SketchReader.id()};for(var a=0;a<c.length;a++){b.src_ids.push(c[a].id);b.dest_sub_ids.push(JXG.SketchReader.id())}this.recordStepMeta(b,true)},drawCircle2Points:function(c,b,h){var a,g=null,f=null;if(h.length>0){g=JXG.Draw.findPointNextTo(b[0],h,0)}a=JXG.Draw.findCorners(b,c);if(h.length==1&&g!=null&&JXG.Draw.dist(g,a[1])<JXG.Draw.dist(g,b[0])){g=null}if(g!=null){h=JXG.removeElementFromArray(h,g)}else{g=b[0].usrCoords}if(h.length>0){f=JXG.Draw.findPointNextTo(a[1],h,0)}if(f==null){f=b[b.length-1].usrCoords}var d={};d.args={};d.src_ids=[];d.dest_sub_ids=[];d.dest_id=0;d.type=JXG.GENTYPE_CIRCLE2POINTS;d.args.create_two_points=d.args.create_point=d.args.create_by_radius=false;if(!g.coords){if(f==null||!f.coords){d.args.create_two_points=true;d.args.x1=g[1];d.args.y1=g[2];d.args.x2=f[1];d.args.y2=f[2];d.dest_sub_ids=[JXG.SketchReader.id(),JXG.SketchReader.id()]}else{d.args.create_point=true;d.args.x=g[1];d.args.y=g[2];d.dest_sub_ids=[JXG.SketchReader.id()];d.src_ids.push(f.id)}}else{if(f==null||!f.coords){d.args.create_by_radius=true;d.args.r=(f[1]-g.coords.usrCoords[1])*(f[1]-g.coords.usrCoords[1]);d.args.r+=((f[2]-g.coords.usrCoords[2])*(f[2]-g.coords.usrCoords[2]));d.args.r=Math.sqrt(d.args.r);d.src_ids.push(g.id)}else{d.src_ids.push(g.id);d.src_ids.push(f.id)}}d.dest_id=JXG.SketchReader.id();this.recordStepMeta(d,true)},drawCircle:function(p,q){var g,k=[],n=[],j,b,m,l,h,d,a;var f={};f.type=JXG.GENTYPE_CIRCLE;f.src_ids=[];f.dest_sub_ids=[];f.dest_id=0;f.args={create_by_radius:false};f.dest_sub_ids=[JXG.SketchReader.id()];f.dest_id=JXG.SketchReader.id();if(q.length<=1){for(g=0;g<p.length;g++){k.push([p[g].usrCoords[1],p[g].usrCoords[2],1]);n.push(k[g][0]*k[g][0]+k[g][1]*k[g][1])}j=JXG.Math.transpose(k);b=JXG.Math.matMatMult(j,k);m=JXG.Math.matVecMult(j,n);l=JXG.Math.Numerics.Gauss(b,m);h=l[0]*0.5;d=l[1]*0.5;if(q.length===1){var o=[1,h,d];f.args.create_point=true;f.args.usrCoords=JXG.deepCopy(o);f.src_ids=[q[0].id]}else{a=Math.sqrt(l[2]+h*h+d*d);f.args.create_by_radius=true;f.args.x=h;f.args.y=d;f.args.r=a}}else{if(q.length==2){f.args={};f.type=JXG.GENTYPE_CIRCLE2POINTS;f.src_ids=[q[0].id,q[1].id]}else{if(q.length==3){JXG.Draw.drawOutcircle(q);return}else{JXG.Draw.drawPolygon(q);return}}}this.recordStepMeta(f,true)},drawOutcircle:function(b){var a={};a.type=JXG.GENTYPE_CIRCLE;a.args={};a.args.create_by_radius=false;a.dest_sub_ids=[JXG.SketchReader.id()];a.dest_id=JXG.SketchReader.id();a.src_ids=[b[0].id,b[1].id,b[2].id];this.recordStepMeta(a,true)},drawTriangle:function(k,n,o){var f,d,c,g,a,l,j,h=[],m=[];if(o.length>3){JXG.Draw.drawQuadrilateral(n,o);return}g=JXG.Draw.convexHull(k,JXG.Draw.findCorners(n,k),false);g.pop();j=JXG.uniqueArray(JXG.Draw.fitPoints(g,o));l=JXG.Draw.findMaxAreaPoints(k,j,3);if(!l.status){return}j=l.req;while(j.length>0){c=-1;for(f=0;f<j.length;f++){if(j[f].catchIdx<c||c==-1){c=j[f].catchIdx;d=f}else{if(j[f].catchIdx==c&&j[f].elementClass==JXG.OBJECT_CLASS_POINT){d=f}}}h.push(j[d]);j.splice(d,1)}for(f=0;f<h.length;f++){if(h[f].elementClass==JXG.OBJECT_CLASS_POINT){m.push(h[f])}else{m.push(k.create("point",h[f].usrCoords,{id:JXG.SketchReader.id()}))}}a=k.create("polygon",[m[0],m[1],m[2]],{borders:{ids:[JXG.SketchReader.id(),JXG.SketchReader.id(),JXG.SketchReader.id()]},id:JXG.SketchReader.id(),fillOpacity:JXG.Options.opacityLevel,hasInnerPoints:JXG.Options.polygon.hasInnerPoints,scalable:true});var b={};b.type=JXG.GENTYPE_TRIANGLE;b.args={};b.src_ids=[];b.dest_sub_ids=[];b.args.create_point=[false,false,false];b.args.coords=[];b.src_ids=[];b.dest_sub_ids=[];b.dest_id=a.id;for(f=0;f<a.vertices.length-1;f++){if(!GUI.collectionContains(h,a.vertices[f])){b.args.create_point[f]=true;b.args.coords.push({usrCoords:JXG.deepCopy(a.vertices[f].coords.usrCoords)});b.dest_sub_ids.push(a.vertices[f].id)}else{b.args.coords.push([]);b.dest_sub_ids.push(0);b.src_ids.push(a.vertices[f].id)}}for(f=0;f<a.borders.length;f++){b.dest_sub_ids.push(a.borders[f].id)}this.recordStepMeta(b,false)},drawQuadrilateral:function(j,n,o){var b={};b.type=JXG.GENTYPE_QUADRILATERAL;b.args={};b.src_ids=[];b.dest_sub_ids=[];b.dest_id=0;if(o.length==4){b.args.create_point=[false,false,false,false];b.args.coords=[];b.src_ids=[];for(f=0;f<4;f++){b.args.coords.push([]);b.src_ids.push(o[f].id)}b.dest_sub_ids=[0,0,0,0,JXG.SketchReader.id(),JXG.SketchReader.id(),JXG.SketchReader.id(),JXG.SketchReader.id()];b.dest_id=JXG.SketchReader.id();this.recordStepMeta(b,true)}else{if(o.length>4){JXG.Draw.drawPolygon(o)}else{var f,c,d,g,a,k,h,m=[],l=[];g=JXG.Draw.convexHull(j,JXG.Draw.findCorners(n,j));g.pop();h=JXG.uniqueArray(JXG.Draw.fitPoints(g,o));k=JXG.Draw.findMaxAreaPoints(j,h,4);if(!k.status){return}h=k.req;while(h.length>0){c=-1;for(f=0;f<h.length;f++){if(h[f].catchIdx<c||c==-1){c=h[f].catchIdx;d=f}else{if(h[f].catchIdx==c&&h[f].elementClass==JXG.OBJECT_CLASS_POINT){d=f}}}m.push(h[d]);h.splice(d,1)}for(f=0;f<m.length;f++){if(m[f].elementClass==JXG.OBJECT_CLASS_POINT){l[f]=m[f]}else{l[f]=j.create("point",m[f].usrCoords,{id:JXG.SketchReader.id()})}}a=j.create("polygon",[l[0],l[1],l[2],l[3]],{borders:{ids:[JXG.SketchReader.id(),JXG.SketchReader.id(),JXG.SketchReader.id(),JXG.SketchReader.id()]},id:JXG.SketchReader.id(),fillOpacity:JXG.Options.opacityLevel,hasInnerPoints:JXG.Options.polygon.hasInnerPoints,scalable:true});b.args.create_point=[false,false,false,false];b.args.coords=[];b.src_ids=[];b.dest_sub_ids=[];b.dest_id=a.id;for(f=0;f<a.vertices.length-1;f++){if(!GUI.collectionContains(m,a.vertices[f])){b.args.create_point[f]=true;b.args.coords.push({usrCoords:JXG.deepCopy(a.vertices[f].coords.usrCoords)});b.dest_sub_ids.push(a.vertices[f].id);b.src_ids.push(a.vertices[f].id)}else{b.args.coords.push([]);b.dest_sub_ids.push(0);b.src_ids.push(a.vertices[f].id)}}for(f=0;f<a.borders.length;f++){b.dest_sub_ids.push(a.borders[f].id)}this.recordStepMeta(b,false)}}},drawRuler:function(c,a){var b=[c[0]+1,c[1]];this.recordStepMeta({type:JXG.GENTYPE_RULER,args:{p1:c,p2:b,label:a},src_ids:[],dest_sub_ids:[JXG.SketchReader.id(),JXG.SketchReader.id()],dest_id:JXG.SketchReader.id()},true)},drawRegularPolygon:function(c){var a,b={type:JXG.GENTYPE_REGULARPOLYGON,args:{corners:JXG.Options.lastRegPolCorners},dest_sub_ids:[],src_ids:[c[0].id,c[1].id]};for(a=0;a<JXG.Options.lastRegPolCorners;a++){b.dest_sub_ids.push(JXG.SketchReader.id())}for(a=0;a<JXG.Options.lastRegPolCorners-2;a++){b.dest_sub_ids.push(JXG.SketchReader.id())}b.dest_id=JXG.SketchReader.id();this.recordStepMeta(b,true)},drawCircleSector:function(a){this.recordStepMeta({type:JXG.GENTYPE_SECTOR,src_ids:a,dest_sub_ids:[],dest_id:JXG.SketchReader.id()},true)},drawAngleSector:function(f){var d=JXG.SketchReader.id(),c=JXG.SketchReader.id(),b=JXG.SketchReader.id(),a=JXG.SketchReader.id();this.recordStepMeta({type:JXG.GENTYPE_ANGLE,src_ids:f,dest_sub_ids:[d,c,b],dest_id:a},true);GUI.ctx_measureAngle(a)},drawSlider:function(a){this.recordStepMeta({type:JXG.GENTYPE_SLIDER,dest_sub_ids:[JXG.SketchReader.id(),JXG.SketchReader.id(),JXG.SketchReader.id(),JXG.SketchReader.id(),JXG.SketchReader.id()],dest_id:JXG.SketchReader.id(),args:{x1:a[0].usrCoords[1],y1:a[0].usrCoords[2],x2:a[0].usrCoords[1]+3,y2:a[0].usrCoords[2],start:$("div.dlg#slider input#start").attr("value"),ini:$("div.dlg#slider input#ini").attr("value"),end:$("div.dlg#slider input#end").attr("value")}},true)},drawText:function(b){var a=JXG.SketchReader.id();this.recordStepMeta({type:JXG.GENTYPE_TEXT,src_ids:[],dest_sub_ids:[],dest_id:a,args:{x:b.usrCoords[1],y:b.usrCoords[2],str:"'Text'"}},true);return a}}});var GUI=GUI||{};JXG.extend(GUI,{Options:{finderEnabled:false,multiConstructEnabled:false},appId:"jsxgui",appName:"Sketchometry",version:"0.4.0",debug:false,langId:0,offline:false,ctxPosHide:128,ctxPosDelete:66,ctxPosProps:4,highlightSize:18,highlightColor:"#000000",plotColors:["black","red","blue","green","yellow","brown"],plotColor:0,opacityHidden:0.2,strokeHidden:2,incrementValue:10,precision:2,rayFactor:128,context_time_limit:1800,finder_time_limit:2000,init:{boundingbox:[-10,10,10,-10],keepaspectratio:false,zoom:{wheel:true},axis:false,grid:false,showNavigation:false,showCopyright:false,showInfobox:false,registerEvents:false},action:"standard",transition:"flip",axisVisible:false,gridVisible:false,snapToGrid:false,snapToPoints:false,showToolTips:true,mirroredToolTips:false,board:null,firstInit:true,firstResize:true,down_event:"",up_event:"",move_event:"",out_event:"",over_event:"",click_event:"",tap_event:"",toolType:[],toolFunc:{},transformation:{},navHandlersRegistered:false,showBlured:false,mouseDown:false,showHidden:false,mode:null,constModeSwitch:true,modeBeforeConstSwitch:null,modeBeforeToolSwitch:null,modeBeforeGallerySwitch:null,draftcurve:[],shadowCopyStep:"",intersect_obj:[],select_obj:[],highlightedObjs:[],highlightedObjsAblate:{},lastScaleX:1,lastScaleY:1,mirrorCenterId:0,rectSelect:[],selection:[],id_cnt:1,unredo:-1,intervalTimer:0,ctx_down_coords:null,ctx_curr_coords:null,ctx_timer:0,step_log:[],step_del_exclude:[],restore_state:[],dialog:{transform:null,pol:null,slider:null,sect:null,confirm:null},last_copy_pos:{},dialog_last_pos:{},boardText:null,nd_recognizer:new NDollarRecognizer(false),nd_mstrokestr:"",id:function(){return"GUI"+(GUI.id_cnt++)+""},recordStep:function(c,f,a){var b,d;if(GUI.unredo>=0&&JXG.Draw.areEqualObjects(GUI.step_log[GUI.unredo],c)){return}GUI.step_log.splice(GUI.unredo+1,GUI.step_log.length-(GUI.unredo+1));for(b=0;b<GUI.restore_state.length;b++){if(GUI.restore_state[b].step>GUI.unredo){break}}GUI.restore_state.splice(b);GUI.unredo=GUI.step_log.length-1;if(c.type>50){d=GUI.generateJCode(c,GUI.board)}else{d=JXG.SketchReader.generateJCode(c,GUI.board,GUI.step_log)}GUI.triggerEventHandlers(["step"],[c,d[0]]);if(f){if(c.type==JXG.GENTYPE_JCODE){GUI.executeJCode(d,false)}else{GUI.executeJCode(d,true)}}else{GUI.greenLog(d[0])}GUI.step_log.push(c);GUI.unredo++;if(c.type===JXG.GENTYPE_DELETE){for(b=0;b<c.args.steps.length;b++){GUI.step_del_exclude.push(c.args.steps[b])}}if(GUI.unredo>=1&&GUI.step_log[GUI.unredo].type!==JXG.GENTYPE_JCODE){GUI.enableUndo(true)}else{GUI.enableUndo(false)}GUI.enableRedo(false);GUI.enableMakeSnapshot(false);GUI.enablePrevSnapshot(GUI.restore_state.length>0);GUI.enableNextSnapshot(false);GUI.contextUpdate();if(GUI.currentConstruction&&!a){GUI.saveConstruction(GUI.currentConstruction,true)}},initSketchBoard:function(a){GUI.board=JXG.JSXGraph.initBoard(a,GUI.init);if(GUI.Settings.get("cursor")){GUI.board.renderer.createTouchpoints(2);GUI.board.renderer.showTouchpoint(0)}if(GUI.firstInit){if(JXG.isTouchDevice()){GUI.down_event="touchstart";GUI.up_event="touchend";GUI.move_event="touchmove";GUI.out_event="touchleave";GUI.over_event="touchenter";GUI.click_event="touchend";GUI.tap_event="touchstart";JXG.Options.device="tablet"}else{GUI.down_event="mousedown";GUI.up_event="mouseup";GUI.move_event="mousemove";GUI.out_event="mouseout";GUI.over_event="mouseover";GUI.click_event="click";GUI.tap_event="click";JXG.Options.device="pc"}GUI.initControls();GUI.firstInit=false}JXG.Options.elements.snapToPoints=false;JXG.Options.elements.snapToGrid=false},freeBoard:function(){var a=0;if(typeof GUI.board!="undefined"&&GUI.board!=null){a=GUI.board.containerObj.id;JXG.JSXGraph.freeBoard(GUI.board);GUI.board=null}return a},newBoard:function(c,b,a){GUI.id_cnt=1;GUI.unredo=-1;GUI.step_log=[];GUI.step_del_exclude=[];GUI.selection=[];GUI.restore_state=[];GUI.transformation={};GUI.axisVisible=false;GUI.gridVisible=false;GUI.plotColor=0;GUI.showBlured=false;GUI.showHidden=false;GUI.mousedown=false;GUI.enableUndo(false);GUI.enableRedo(false);GUI.enableMakeSnapshot(false);GUI.enablePrevSnapshot(false);GUI.enableNextSnapshot(false);GUI.initSketchBoard(GUI.freeBoard());if($("#control-boardprop").hasClass("button-selected")){GUI.activateBoardControls()}GUI.hideAllActions();GUI.deselectAllToolButtonsAndRemoveActions();if($("#control-tools-box").hasClass("button-selected")){GUI.activateToolControls()}$(".info").remove();GUI.removeActionEvent(true);$("#board-axis-visible").removeClass("button-selected");$("#board-axis-visible-box").removeClass("button-selected");$("#axis-scale-x").val(GUI.lastScaleX);$("#axis-scale-y").val(GUI.lastScaleY);$("#axis-scale-x").keyup(function(){GUI.scaleAxis(false)});$("#axis-scale-y").keyup(function(){GUI.scaleAxis(true)});GUI.board.options.grid.snapToGrid=false;GUI.board.options.grid.snapToPoints=false;GUI.board.options.point.snapToPoints=false;GUI.board.options.point.attractorDistance=0.5;$("#grid-visible").removeClass("button-selected");$("#grid-visible-box").removeClass("button-selected");$("#grid-snap-to-grid").removeClass("button-selected");$("#grid-snap-to-grid-box").removeClass("button-selected");$("#grid-snap-to-point").removeClass("button-selected");$("#grid-snap-to-point-box").removeClass("button-selected");if(GUI.mode==null){if(GUI.modeBeforeGallerySwitch!=null){GUI.switchMode(GUI.modeBeforeGallerySwitch,true);GUI.modeBeforeGallerySwitch=null}else{if(GUI.modeBeforeToolSwitch!=null){GUI.switchMode(GUI.modeBeforeToolSwitch,true);GUI.modeBeforeToolSwitch=null}else{GUI.switchMode("CD",true)}}}GUI.enableConstDragMode();GUI.resizeBoard();GUI.switchHandling(GUI.Settings.get("leftright"));GUI.setLanguage(GUI.Settings.get("language"));GUI.addTooltips();if(c){GUI.recordStep({type:JXG.GENTYPE_AXIS,src_ids:[],dest_sub_ids:["GUIOO","GUIE1","GUIE2","GUIx","GUIy"],args:{visible:false,coords:[{usrCoords:[1,0,0]},{usrCoords:[1,1,0]},{usrCoords:[1,0,1]}],name:["OO","E1","E2","x","y"],priv:[true,true,true,false,false]}},true,a)}GUI.showBoard(b)},clearBoard:function(){GUI.confirm(GUI.Lang.std.clear_reassure,false,function(){GUI.newBoard(true,false,false)})},resetBoard:function(){if(GUI.mode=="CD"||GUI.mode=="D"){GUI.board.mode=GUI.board.BOARD_MODE_DRAG}else{GUI.board.mode=GUI.board.BOARD_MODE_NONE}GUI.board.touches=[];GUI.board.downObjects=[]},resizeBoard:function(){var a,k,b,j,l,d,c,m,g,f;if(GUI.board==null||typeof GUI.board=="undefined"){return}l=parseInt($("#content").css("padding-left"))+parseInt($("#content").css("padding-right"))+parseInt($("#content").css("border-left-width"))+parseInt($("#content").css("border-right-width"));d=$("#content").outerHeight()-$("#content").height();d+=$("#toolbar-panel").outerHeight();k=window.innerWidth-l;b=window.innerHeight-d;GUI.board.resizeContainer(k,b);c=GUI.board.getBoundingBox();for(a=0;a<c.length;a++){if(isNaN(c[a])){GUI.firstResize=true;break}}if(GUI.firstResize){m=GUI.init.boundingbox[0];g=GUI.init.boundingbox[2]}else{m=c[0];g=c[2];f=c[1]}j=((g-m)*b)/k;if(GUI.firstResize){GUI.board.setBoundingBox([m,j/2,g,-j/2],true);GUI.firstResize=false}else{GUI.board.setBoundingBox([m,f,g,f-j],true)}$("#status-box").css("left",parseInt(($("#mainWindow").width()-$("#status").width())/2))},repositionCtxPanel:function(){var a=$("#toolbar-panel").outerHeight();$("#ctx_panel").css("bottom",a+"px");$("#ctx_panel").css("top","auto")},switchToolbarPos:function(a){if(a=="top"){$("#content").css("top",$("#toolbar-panel").outerHeight());$("#toolbar-overflow").css("bottom","");$("#toolbar-overflow").css("top","0px");$("#ctx_panel").css("bottom","");$("#ctx_panel").css("top",$("#toolbar-panel").outerHeight());$("#plot_panel").css("bottom","");$("#plot_panel").css("top",$("#toolbar-panel").outerHeight());$("#dialog-arrow").removeClass("vmirrored");$("#dialog-arrow").css("bottom","");$("#dialog-arrow").css("top",$("#toolbar-panel").outerHeight()-$("#dialog-arrow").outerHeight());$("#status-box").css("bottom","");$("#status-box").css("top",parseInt(($("#toolbar-panel").height()-$("#status").outerHeight())/2))}else{$("#content").css("top","0px");$("#toolbar-overflow").css("top","");$("#toolbar-overflow").css("bottom","0px");GUI.repositionCtxPanel();$("#plot_panel").css("top","");$("#plot_panel").css("bottom",$("#toolbar-panel").outerHeight());$("#dialog-arrow").css("top","");$("#dialog-arrow").css("bottom",$("#toolbar-panel").outerHeight()-$("#dialog-arrow").outerHeight());$("#dialog-arrow").addClass("vmirrored");$("#status-box").css("top","");$("#status-box").css("bottom",parseInt(($("#toolbar-panel").height()-$("#status").outerHeight())/2))}},switchHandling:function(a){var b;if(!$("#ctx_panel").hasClass("not-displayed")){b=$("#ctx_panel").outerWidth()}else{b=0}$("#content").css("margin-left","");$("#content").css("margin-right","");$("#ctx_panel").css("left","");$("#ctx_panel").css("right","");$("#plot_panel").css("left","");$("#plot_panel").css("right","");$("#dialog-arrow").css("left","");$("#dialog-arrow").css("right","");if(a=="left"){$("#content").css("margin-left",b);$("#kb-input-panel").removeClass("fright");$("#kb-input-panel").addClass("fleft");$("#kb-key-panel").removeClass("fleft");$("#kb-key-panel").addClass("fright");$("#keyboard-panel").removeClass("fleft");$("#keyboard-panel").addClass("fright");$("#plot_panel").css("right","10px");$("#control-undo-box").addClass("hmirrored");$("#control-redo-box").addClass("hmirrored");$("#control-drag-box").addClass("hmirrored");$("#control-construct-box").addClass("hmirrored");$("#control-actions-function-box").addClass("hmirrored");$("#control-tools-box").addClass("hmirrored");$("#control-actions-hide-box").addClass("hmirrored");$("#control-actions-del-box").addClass("hmirrored");$("#control-boardprop-box").addClass("hmirrored");$("#control-gallery-box").addClass("hmirrored");$("#status-box").addClass("hmirrored");$(".tools").addClass("hmirrored");$("#toolbar-panel").addClass("hmirrored")}else{if(a=="right"){$("#content").css("margin-right",b);$("#kb-input-panel").removeClass("fleft");$("#kb-input-panel").addClass("fright");$("#kb-key-panel").removeClass("fright");$("#kb-key-panel").addClass("fleft");$("#keyboard-panel").removeClass("fright");$("#keyboard-panel").addClass("fleft");$("#plot_panel").css("left","10px");$("#control-undo-box").removeClass("hmirrored");$("#control-redo-box").removeClass("hmirrored");$("#control-drag-box").removeClass("hmirrored");$("#control-construct-box").removeClass("hmirrored");$("#control-actions-function-box").removeClass("hmirrored");$("#control-tools-box").removeClass("hmirrored");$("#control-actions-hide-box").removeClass("hmirrored");$("#control-actions-del-box").removeClass("hmirrored");$("#control-boardprop-box").removeClass("hmirrored");$("#control-gallery-box").removeClass("hmirrored");$("#status-box").removeClass("hmirrored");$(".tools").removeClass("hmirrored");$("#toolbar-panel").removeClass("hmirrored")}}},switchMode:function(i,g){var j,h,b,f,a=GUI.mode;if(GUI.mode=="C"){GUI.removeConstructEvents()}else{if(GUI.mode=="CD"){GUI.removeConstructHooks();GUI.removeBoardHandlers();GUI.removeNavHandlers()}else{if(GUI.mode=="D"){GUI.removeBoardHandlers();GUI.removeNavHandlers()}}}j=$("#control-construct");b=$("#control-construct-box");h=$("#control-drag");f=$("#control-drag-box");if(i==null){if(GUI.board){GUI.board.mode=GUI.board.BOARD_MODE_NONE;GUI.deleteDraftcurves()}}if(i===-1){if(j.hasClass("button-selected")&&h.hasClass("button-selected")){GUI.mode="CD"}else{if(j.hasClass("button-selected")){GUI.mode="C"}else{if(h.hasClass("button-selected")){GUI.mode="D"}else{GUI.mode=null}}}}else{GUI.mode=i}if(i!=-1&&g){j.removeClass("button-selected");b.removeClass("button-selected");h.removeClass("button-selected");f.removeClass("button-selected")}if(GUI.mode=="D"){GUI.addBoardHandlers();GUI.addNavHandlers();if(i!=-1&&g){h.addClass("button-selected");f.addClass("button-selected")}}else{if(GUI.mode=="C"){GUI.addConstructEvents();if(i!=-1&&g){j.addClass("button-selected");b.addClass("button-selected")}}else{if(GUI.mode=="CD"){GUI.addBoardHandlers();GUI.addNavHandlers();GUI.addConstructHooks();if(i!=-1&&g){j.addClass("button-selected");b.addClass("button-selected");h.addClass("button-selected");f.addClass("button-selected")}}}}console.log("old mode: "+a+", new mode: "+GUI.mode)},showHiddenUnRedoUpdate:function(d){var c,b,a;if(GUI.showHidden){if(d.type==JXG.GENTYPE_DELETE){for(b=0;b<d.args.steps.length;b++){a=GUI.step_log[d.args.steps[b]];for(c=0;c<a.src_ids.length;c++){if(GUI.board.objects[a.src_ids[c]]){GUI.showHiddenObject(GUI.board.objects[a.src_ids[c]])}}}}else{if(d.type==JXG.GENTYPE_CTX_VISIBILITY){for(c=0;c<d.src_ids.length;c++){if(GUI.board.objects[d.src_ids[c]]){GUI.showHiddenObject(GUI.board.objects[d.src_ids[c]])}}}}}},undo:function(){var d,f,j;while(GUI.unredo>=1&&GUI.step_log[GUI.unredo].type!=JXG.GENTYPE_JCODE){f=GUI.step_log[GUI.unredo];while(f.type==0&&GUI.unredo>=1){GUI.unredo--;f=GUI.step_log[GUI.unredo]}if(GUI.unredo<1){break}if(f.type==JXG.GENTYPE_DELETE){for(d=0;d<f.args.steps.length;d++){JXG.removeElementFromArray(GUI.step_del_exclude,f.args.steps[d])}}if(f.type>50){j=GUI.generateJCode(f,GUI.board)}else{j=JXG.SketchReader.generateJCode(f,GUI.board,GUI.step_log)}if(j[2]!==""){try{GUI.revertJCode(j,true)}catch(g){console.log("Exception: "+g);console.log("error executing revert for step "+GUI.unredo)}GUI.contextUpdate();GUI.enableRedo(true);GUI.unredo--}else{var a,c,b,h;a=GUI.id_cnt;h=GUI.step_log;b=GUI.restore_state;c=GUI.unredo;GUI.newBoard(false,false,true);GUI.id_cnt=a;GUI.step_log=h;GUI.restore_state=b;GUI.unredo=1;if(GUI.step_log[GUI.unredo].type>50){j=GUI.generateJCode(GUI.step_log[GUI.unredo],GUI.board)}else{j=JXG.SketchReader.generateJCode(GUI.step_log[GUI.unredo],GUI.board,GUI.step_log)}try{GUI.executeJCode(j,true)}catch(g){console.log("Exception: "+g);console.log("error executing step "+GUI.unredo+"(general undo)")}while(GUI.unredo!=c-1){GUI.redo()}}break}GUI.showHiddenUnRedoUpdate(f);if(GUI.unredo<1||GUI.step_log[GUI.unredo].type==JXG.GENTYPE_JCODE){GUI.enableUndo(false)}GUI.updateSnapshotControls();GUI.board.update()},redo:function(){var a,b,d;while(!(GUI.unredo==GUI.step_log.length-1)){GUI.unredo++;b=GUI.step_log[GUI.unredo];while(b.type==0&&!(GUI.unredo==GUI.step_log.length-1)){GUI.unredo++;b=GUI.step_log[GUI.unredo]}if(b.type==JXG.GENTYPE_DELETE){for(a=0;a<b.dest_sub_ids.length;a++){if(GUI.contextShowsProps()==b.dest_sub_ids[a]){GUI.contextEdit(0);break}}for(a=0;a<b.args.steps.length;a++){GUI.step_del_exclude.push(b.args.steps[a])}}if(b.type!=0){if(b.type>50){d=GUI.generateJCode(b,GUI.board)}else{d=JXG.SketchReader.generateJCode(b,GUI.board,GUI.step_log)}try{GUI.executeJCode(d,true)}catch(c){console.log("Exception: "+c);console.log("error executing step "+GUI.unredo+"(redo)")}GUI.contextUpdate()}GUI.showHiddenUnRedoUpdate(b);if(GUI.unredo>=1&&GUI.step_log[GUI.unredo].type!=JXG.SketchReader.GENTYPE_JCODE){GUI.enableUndo(true)}else{GUI.enableUndo(false)}break}if(GUI.unredo==GUI.step_log.length-1){GUI.enableRedo(false)}GUI.updateSnapshotControls();GUI.board.update()},enableUndo:function(a){if(a){$("#control-undo-box").removeClass("button-disabled")}else{$("#control-undo-box").addClass("button-disabled")}},enableRedo:function(a){if(a){$("#control-redo-box").removeClass("button-disabled")}else{$("#control-redo-box").addClass("button-disabled")}},enableMakeSnapshot:function(a){if(a){$("#btn_togglemark").css("border-top","solid 1px yellow");$("#btn_togglemark").css("border-bottom","solid 1px yellow")}else{$("#btn_togglemark").css("border-top","solid 1px black");$("#btn_togglemark").css("border-bottom","solid 1px black")}},enablePrevSnapshot:function(a){if(a){$("#btn_prevmark").css("border-top","solid 1px yellow");$("#btn_prevmark").css("border-bottom","solid 1px yellow")}else{$("#btn_prevmark").css("border-top","solid 1px black");$("#btn_prevmark").css("border-bottom","solid 1px black")}},enableNextSnapshot:function(a){if(a){$("#btn_nextmark").css("border-top","solid 1px yellow");$("#btn_nextmark").css("border-bottom","solid 1px yellow")}else{$("#btn_nextmark").css("border-top","solid 1px black");$("#btn_nextmark").css("border-bottom","solid 1px black")}},showBoard:function(a){GUI.board.moveOrigin(GUI.board.canvasWidth/2,GUI.board.canvasHeight/2);if(typeof a=="undefined"||!a){$("div#mainWindow").removeClass("hidden")}},showBoardText:function(a,b){$("#action_message").html(GUI.boardText=a);$("#action_message").removeClass("not-displayed");$("#status-box").removeClass("not-displayed");if(b){window.setTimeout(GUI.hideBoardText,b)}},hideBoardText:function(){if(GUI.boardText!=null){$("#status-close").unbind();$("#action_message").addClass("not-displayed");$("#status-box").addClass("not-displayed");GUI.boardText=null}},showPanel:function(a,c){var b=GUI.Settings.get("leftright").toLowerCase();if(a){$("#ctx_panel").css(b,c+"px");$("#dialog-arrow").css(b,c+85+"px");$("#ctx_panel").removeClass("not-displayed");$("#dialog-arrow").removeClass("not-displayed")}else{$("#ctx_props").find("*").unbind();$("#ctx_textbox").find("*").unbind();$("#ctx_objects").children().unbind();$("#ctx_objects_extra").children().unbind();$("#ctx_props").addClass("not-displayed");$("#ctx_objects").addClass("not-displayed");$("#ctx_objects_extra").addClass("not-displayed");$("#ctx_textbox").addClass("not-displayed");$("#ctx_panel").addClass("not-displayed");$("#plot_panel").addClass("not-displayed");$("#dialog-arrow").addClass("not-displayed");document.activeElement.blur()}$("#control-boardprop").removeClass("button-selected");$("#control-boardprop-box").removeClass("button-selected")},showPropertyPanel:function(b,a){if(b=="board"){$("#ctx_props").addClass("not-displayed");$("#ctx_board").removeClass("not-displayed");$("#ctx_objects_extra").addClass("not-displayed");$("#ctx_objects").addClass("not-displayed");$(".board").removeClass("not-displayed");$(".property").addClass("not-displayed")}else{if(b=="props"){$("#ctx_props").removeClass("not-displayed");$("#ctx_board").addClass("not-displayed");$("#ctx_objects_extra").addClass("not-displayed");$("#ctx_objects").addClass("not-displayed");$(".board").addClass("not-displayed");$(".property").removeClass("not-displayed")}else{$("#ctx_props").addClass("not-displayed");$("#ctx_board").addClass("not-displayed");if(a){$("#ctx_objects_extra").removeClass("not-displayed")}else{$("#ctx_objects_extra").addClass("not-displayed")}$("#ctx_objects").removeClass("not-displayed")}}},showObjectsBlured:function(c){var a,b=GUI.board.objects;if(!GUI.showBlured){if(!c){return}GUI.board.suspendUpdate();for(a in b){if(b.hasOwnProperty(a)){if(!GUI.isStandardObj(b[a])){continue}if(typeof b[a].guiVisProp=="undefined"){b[a].guiVisProp={}}b[a].guiVisProp.fillOpacity=b[a].getAttribute("fillOpacity");b[a].guiVisProp.strokeOpacity=b[a].getAttribute("strokeOpacity");if(!b[a].guiVisProp.visible){b[a].setAttribute({fillOpacity:b[a].guiVisProp.fillOpacity/4});b[a].setAttribute({strokeOpacity:b[a].guiVisProp.strokeOpacity/4})}}}}else{if(c){return}GUI.board.suspendUpdate();for(a in b){if(b.hasOwnProperty(a)){if(!GUI.isStandardObj(b[a])){continue}if(b[a].guiVisProp){b[a].setAttribute({fillOpacity:b[a].guiVisProp.fillOpacity});b[a].setAttribute({strokeOpacity:b[a].guiVisProp.strokeOpacity})}}}}GUI.board.unsuspendUpdate();GUI.showBlured=!GUI.showBlured},showHiddenObject:function(a){if(!GUI.isStandardObj(a)||a.type==JXG.OBJECT_TYPE_AXIS||a.type==JXG.OBJECT_TYPE_GRID){return}if(!a.guiVisProp){a.guiVisProp={};a.guiVisProp.fillOpacity=a.getAttribute("fillOpacity");a.guiVisProp.strokeOpacity=a.getAttribute("strokeOpacity");a.guiVisProp.strokewidth=a.getAttribute("strokewidth")}a.guiVisProp.visible=a.getAttribute("visible");if(!GUI.isStandardObj(a)||a.type==JXG.OBJECT_TYPE_AXIS||a.type==JXG.OBJECT_TYPE_GRID){return}if(!a.guiVisProp.visible){a.setAttribute({visible:true});a.setAttribute({fillOpacity:GUI.opacityHidden});a.setAttribute({strokeOpacity:GUI.opacityHidden})}else{a.setAttribute({fillOpacity:a.guiVisProp.fillOpacity});a.setAttribute({strokeOpacity:a.guiVisProp.strokeOpacity})}if(a.guiVisProp.strokewidth==0){a.setAttribute({strokewidth:GUI.strokeHidden})}if(a.type==JXG.OBJECT_TYPE_POLYGON){a.visProp.hasinnerpoints=true}},showHiddenObjects:function(){var a,b=GUI.board.objects;GUI.board.suspendUpdate();if(!GUI.showHidden){for(a in b){if(b.hasOwnProperty(a)){GUI.showHiddenObject(b[a])}}}else{for(a in b){if(b.hasOwnProperty(a)){if(!GUI.isStandardObj(b[a])||b[a].type==JXG.OBJECT_TYPE_AXIS||b[a].type==JXG.OBJECT_TYPE_GRID){continue}if(b[a].guiVisProp){b[a].setAttribute({visible:b[a].guiVisProp.visible});b[a].setAttribute({fillOpacity:b[a].guiVisProp.fillOpacity});b[a].setAttribute({strokeOpacity:b[a].guiVisProp.strokeOpacity});b[a].setAttribute({strokewidth:b[a].guiVisProp.strokewidth});delete b[a].guiVisProp}if(b[a].type==JXG.OBJECT_TYPE_POLYGON){b[a].visProp.hasinnerpoints=false}}}}GUI.board.unsuspendUpdate();GUI.showHidden=!GUI.showHidden},toggleConstruct:function(a){if(a&&!a.handled){a.handled=true;if($("#control-construct").hasClass("button-selected")){$("#control-construct").removeClass("button-selected");$("#control-construct-box").removeClass("button-selected")}else{$("#control-construct").addClass("button-selected");$("#control-construct-box").addClass("button-selected")}console.log("-- const toggled --");GUI.switchMode(-1,true)}},toggleDrag:function(a){if(a&&!a.handled){a.handled=true;if($("#control-drag").hasClass("button-selected")){$("#control-drag").removeClass("button-selected");$("#control-drag-box").removeClass("button-selected")}else{$("#control-drag").addClass("button-selected");$("#control-drag-box").addClass("button-selected")}console.log("-- drag toggled --");GUI.switchMode(-1,true)}},scaleAxis:function(a){if(a){GUI.board.objects.GUIy.defaultTicks.setAttribute({scale:GUI.getId("axis-scale-y").value})}else{GUI.board.objects.GUIx.defaultTicks.setAttribute({scale:GUI.getId("axis-scale-x").value})}},toggleAxis:function(){if(GUI.axisVisible){GUI.board.objects.GUIx.setAttribute({visible:false});GUI.board.objects.GUIy.setAttribute({visible:false});GUI.getId("axis-scale-x").disabled="disabled";GUI.getId("axis-scale-y").disabled="disabled";$("#board-axis-visible").removeClass("button-selected");$("#board-axis-visible-box").removeClass("button-selected");if(GUI.gridVisible){GUI.gridVisible=false;GUI.toggleGrid()}}else{GUI.board.objects.GUIx.setAttribute({visible:true});GUI.board.objects.GUIx.defaultTicks.setAttribute({drawLabels:true,withlabel:true});GUI.board.objects.GUIy.setAttribute({visible:true});GUI.board.objects.GUIy.defaultTicks.setAttribute({drawLabels:true,withlabel:true});GUI.getId("axis-scale-x").removeAttribute("disabled");GUI.getId("axis-scale-y").removeAttribute("disabled");$("#board-axis-visible").addClass("button-selected");$("#board-axis-visible-box").addClass("button-selected")}GUI.axisVisible=!GUI.axisVisible},toggleGrid:function(){if(GUI.gridVisible){if(GUI.board.objects.GUIx.visProp.visible){GUI.board.objects.GUIx.defaultTicks.setAttribute({minorHeight:0,majorHeight:10,insertTicks:true})}else{GUI.board.objects.GUIx.defaultTicks.setAttribute({minorHeight:0,majorHeight:1,insertTicks:true})}if(GUI.board.objects.GUIy.visProp.visible){GUI.board.objects.GUIy.defaultTicks.setAttribute({minorHeight:0,majorHeight:10,insertTicks:true})}else{GUI.board.objects.GUIy.defaultTicks.setAttribute({minorHeight:0,majorHeight:1,insertTicks:true})}$("#grid-visible").removeClass("button-selected");$("#grid-visible-box").removeClass("button-selected")}else{GUI.board.objects.GUIx.defaultTicks.setAttribute({ticksDistance:1,insertTicks:false,majorHeight:-1,minorHeight:0,scale:1,visible:true,drawLabels:GUI.board.objects.GUIx.visProp.visible});GUI.board.objects.GUIy.defaultTicks.setAttribute({ticksDistance:1,insertTicks:false,majorHeight:-1,minorHeight:0,scale:1,visible:true,drawLabels:GUI.board.objects.GUIy.visProp.visible});$("#grid-visible").addClass("button-selected");$("#grid-visible-box").addClass("button-selected")}GUI.gridVisible=!GUI.gridVisible},toggleSnapToGrid:function(){var c,b=JXG.Options.elements.snapToGrid;for(c in GUI.board.objects){if(GUI.board.objects[c].visProp.priv==false&&GUI.board.objects[c].type!=JXG.OBJECT_TYPE_GLIDER){GUI.board.objects[c].visProp.snaptogrid=!b}}if(b){$("#grid-snap-to-grid").removeClass("button-selected");$("#grid-snap-to-grid-box").removeClass("button-selected")}else{$("#grid-snap-to-grid").addClass("button-selected");$("#grid-snap-to-grid-box").addClass("button-selected")}JXG.Options.elements.snapToGrid=!JXG.Options.elements.snapToGrid},toggleSnapToPoint:function(){var c,b=JXG.Options.elements.snapToPoints;for(c in GUI.board.objects){if(GUI.board.objects[c].visProp.priv==false&&GUI.board.objects[c].elementClass==JXG.OBJECT_CLASS_POINT){GUI.board.objects[c].visProp.snaptopoints=!b}}if(b){$("#grid-snap-to-point").removeClass("button-selected");$("#grid-snap-to-point-box").removeClass("button-selected")}else{$("#grid-snap-to-point").addClass("button-selected");$("#grid-snap-to-point-box").addClass("button-selected")}JXG.Options.elements.snapToPoints=!JXG.Options.elements.snapToPoints},updateNdollarStr:function(b){GUI.nd_mstrokestr="";GUI.nd_mstrokestr+="{ name: 'XYZ', nbr: 1, data: new Array(\n\tnew Array(";for(var a=0;a<b.length;a++){GUI.nd_mstrokestr+="["+b[a].scrCoords[1]+","+b[a].scrCoords[2]+"]";if(a<b.length-1){GUI.nd_mstrokestr+=","}}GUI.nd_mstrokestr+=")\n) };"},updateSnapshotControls:function(){GUI.enableMakeSnapshot(false);GUI.enablePrevSnapshot(false);GUI.enableNextSnapshot(false);for(var a=0;a<GUI.restore_state.length;a++){if(GUI.unredo==GUI.restore_state[a].step){GUI.enableMakeSnapshot(true)}if(GUI.unredo>GUI.restore_state[a].step){GUI.enablePrevSnapshot(true)}if(GUI.unredo<GUI.restore_state[a].step){GUI.enableNextSnapshot(true)}}},watchGallery:function(){if(typeof GUI.currentConstruction==="undefined"){GUI.currentConstruction=GUI.Gallery.createStorageItem(GUI.Lang.std.untitled+"-"+(GUI.fileCounter+1))}GUI.saveConstruction(GUI.currentConstruction,false);$("div#mainWindow").addClass("hidden");for(var a in GUI.dialog){if(GUI.dialog.hasOwnProperty(a)){if(GUI.dialog[a]!=null){GUI.dialog[a].removeDialog()}}}GUI.modeBeforeGallerySwitch=GUI.mode;GUI.switchMode(null,true);GUI.Gallery.switchGallery()},disableConstDragMode:function(){$("#control-mode").addClass("button-disabled");$("#control-drag-box").unbind(GUI.click_event,GUI.toggleDrag);$("#control-construct-box").unbind(GUI.click_event,GUI.toggleConstruct);$("#control-mode").bind(GUI.click_event,GUI.activateConstDragMode)},enableConstDragMode:function(){$("#control-mode").removeClass("button-disabled");$("#control-drag-box").bind(GUI.click_event,GUI.toggleDrag);$("#control-construct-box").bind(GUI.click_event,GUI.toggleConstruct);$("#control-mode").unbind(GUI.click_event,GUI.activateConstDragMode)},deactivatePropToolAction:function(){if($("#control-boardprop").hasClass("button-selected")){GUI.activateBoardControls()}GUI.deselectAllToolButtonsAndRemoveActions();if(GUI.action!="standard"){GUI[GUI.action+"Action"]()}},activateToolControls:function(){if(!$("#control-tools").hasClass("button-selected")){if(GUI.action!="standard"){GUI[GUI.action+"Action"]()}$("#control-tools").addClass("button-selected");$("#control-tools-box").addClass("button-selected");$("#caption-tools").removeClass("not-displayed")}else{$("#control-tools").removeClass("button-selected");$("#control-tools-box").removeClass("button-selected");$("#caption-tools").addClass("not-displayed");if(!$("#plot_panel").hasClass("not-displayed")){$("#plot_panel").addClass("not-displayed")}GUI.deselectAllToolButtonsAndRemoveActions()}},activateActionControls:function(){if(!$("#control-actions").hasClass("button-selected")){$("#control-actions").addClass("button-selected");$("#caption-actions").removeClass("not-displayed")}else{$("#control-actions").removeClass("button-selected");$("#caption-actions").addClass("not-displayed");if(GUI.dialog.transform!=null){GUI.dialog.transform.removeDialog()}GUI.removeActionEvent(true)}},activateBoardControls:function(){if(!$("#control-boardprop").hasClass("button-selected")){if(GUI.action!="standard"){GUI.removeActionEvent(true)}for(var a in GUI.dialog){if(GUI.dialog.hasOwnProperty(a)){if(GUI.dialog[a]!=null){GUI.dialog[a].removeDialog()}}}GUI.deselectAllToolButtonsAndRemoveActions();GUI.showPropertyPanel("board",false);GUI.showPanel(true,GUI.ctxPosProps);$("#control-boardprop").addClass("button-selected");$("#control-boardprop-box").addClass("button-selected");GUI.showBoardText(GUI.Lang.std.prop_instruct);GUI.addToolEvent(GUI.down_event,GUI.callOnClick,GUI.contextMenu)}else{$("#control-boardprop").removeClass("button-selected");$("#control-boardprop-box").removeClass("button-selected");GUI.removeActionEvent(true)}},activateConstDragMode:function(){if(!$("#control-mode").hasClass("button-selected")){GUI.deactivatePropToolAction()}},addTooltips:function(){$("#actions-mirror").attr("title",GUI.Lang.std.mirror_objects);$("#actions-copy").attr("title",GUI.Lang.std.copy_objects);$("#actions-ablate").attr("title",GUI.Lang.std.ablate_objects);$("#actions-transform").attr("title",GUI.Lang.std.transform_objects);$("#angle-button-rightangle-box").attr("title",GUI.Lang.std.right_angle);$("#angle-radius-label").attr("title",GUI.Lang.std.radius);$("#angle-radius-field").attr("title",GUI.Lang.std.radius);$("#angle-related-measure-box").attr("title",GUI.Lang.std.measure);$("#board-axis-visible").attr("title",GUI.Lang.std.axis_visibility);$("#board-clear-all").attr("title",GUI.Lang.std.board_clear_all);$("#board-clear-traces").attr("title",GUI.Lang.std.clear_traces);$("#circle-radius-label").attr("title",GUI.Lang.std.radius);$("#circle-radius").attr("title",GUI.Lang.std.radius);$("#color-field-minus").attr("title",GUI.Lang.std.minus);$("#color-field-plus").attr("title",GUI.Lang.std.plus);$("#color-field-label").attr("title",GUI.Lang.std.stroke_width+" / "+GUI.Lang.std.element_opacity+" / "+GUI.Lang.std.text_size);$("#color-field").attr("title",GUI.Lang.std.stroke_width+" / "+GUI.Lang.std.element_opacity+" / "+GUI.Lang.std.text_size);$("#color-panel").attr("title",GUI.Lang.std.colors);$("#color-tab-stroke").attr("title",GUI.Lang.std.stroke_settings);$("#color-tab-fill").attr("title",GUI.Lang.std.fill_settings);$("#color-tab-label").attr("title",GUI.Lang.std.label_settings);$("#control-undo-box").attr("title",GUI.Lang.std.control_undo);$("#control-redo-box").attr("title",GUI.Lang.std.control_redo);$("#control-drag-box").attr("title",GUI.Lang.std.drag_mode);$("#control-construct-box").attr("title",GUI.Lang.std.construct_mode);$("#control-tools-box").attr("title",GUI.Lang.std.tools);$("#control-actions-box").attr("title",GUI.Lang.std.actions);$("#control-actions-hide-box").attr("title",GUI.Lang.std.hide_objects);$("#control-actions-del-box").attr("title",GUI.Lang.std.del_objects);$("#control-boardprop-box").attr("title",GUI.Lang.std.navtoolprop);$("#control-gallery-box").attr("title",GUI.Lang.std.gallery);$("#grid-snap-to-grid").attr("title",GUI.Lang.std.snap_to_grid);$("#grid-snap-to-point").attr("title",GUI.Lang.std.snap_to_point);$("#grid-visible-box").attr("title",GUI.Lang.std.grid_visible);$("#input-text").attr("title",GUI.Lang.std.identifier);$("#label-visible").attr("title",GUI.Lang.std.label_visible);$("#line-button-first").attr("title",GUI.Lang.std.line_segment);$("#line-button-last").attr("title",GUI.Lang.std.line_segment);$("#line-button-arrow-first").attr("title",GUI.Lang.std.arrow);$("#line-button-arrow-last").attr("title",GUI.Lang.std.arrow);$("#line-related-measure-box").attr("title",GUI.Lang.std.measure);$("#line-related-midpoint").attr("title",GUI.Lang.std.midpoint);$("#measure-box").attr("title",GUI.Lang.std.measure);$("#nav-up").attr("title",GUI.Lang.std.move_up);$("#nav-down").attr("title",GUI.Lang.std.move_down);$("#nav-left").attr("title",GUI.Lang.std.move_left);$("#nav-right").attr("title",GUI.Lang.std.move_right);$("#nav-center").attr("title",GUI.Lang.std.center);$("#nav-zoom-in").attr("title",GUI.Lang.std.zoom_in);$("#nav-zoom-out").attr("title",GUI.Lang.std.zoom_out);$("#nav-zoom-100").attr("title",GUI.Lang.std.zoom_100);$("#point-coord").attr("title",GUI.Lang.std.coords);$("#point-glider-button-glider").attr("title",GUI.Lang.std.glider);$("#point-glider-button-free").attr("title",GUI.Lang.std.freePoint);$("#point-size").attr("title",GUI.Lang.std.element_size);$("#point-size-plus").attr("title",GUI.Lang.std.plus);$("#point-size-minus").attr("title",GUI.Lang.std.minus);$("#point-style").attr("title",GUI.Lang.std.point_face);$("#status-fix-box").attr("title",GUI.Lang.std.status_fix);$("#status-trace-box").attr("title",GUI.Lang.std.trace);$("#sector-related-measure-box").attr("title",GUI.Lang.std.measure);$("#tools-slider").attr("title",GUI.Lang.std.slide);$("#tools-anglesector").attr("title",GUI.Lang.std.angle_sector);$("#tools-circlesector").attr("title",GUI.Lang.std.circle_sector);$("#control-actions-function").attr("title",GUI.Lang.std.function_plot);$("#tools-polygon").attr("title",GUI.Lang.std.poly);$("#tools-regpolygon").attr("title",GUI.Lang.std.regular+" "+GUI.Lang.std.poly);$("#tools-text").attr("title",GUI.Lang.std.text_element);$("#btn_togglemark").attr("title",GUI.Lang.std.togglemark);$("#btn_prevmark").attr("title",GUI.Lang.std.prevmark);$("#btn_nextmark").attr("title",GUI.Lang.std.nextmark);$("#angle-button-right-angle-label").html(GUI.Lang.std.right_angle);$("#angle-radius-field-label").html(GUI.Lang.std.radius);$("#angle-related-measure-label").html(GUI.Lang.std.measure);$("#axis-scale-group-label").html(GUI.Lang.std.axis_scale);$("#board-axis-visible-label").html(GUI.Lang.std.axis_visibility);$("#board-clear-all-label").html(GUI.Lang.std.board_clear_all);$("#board-clear-traces-label").html(GUI.Lang.std.clear_traces);$("#circle-radius-field-label").html(GUI.Lang.std.radius);$("#control-actions-del-label").html(GUI.Lang.std.del);$("#control-actions-hide-label").html(GUI.Lang.std.hide);$("#control-boardprop-label").html(GUI.Lang.std.control_boardprop);$("#control-construct-label").html(GUI.Lang.std.control_construct);$("#control-drag-label").html(GUI.Lang.std.control_drag);$("#control-gallery-label").html(GUI.Lang.std.gallery);$("#control-redo-label").html(GUI.Lang.std.control_redo);$("#control-tools-label").html(GUI.Lang.std.control_tools);$("#control-undo-label").html(GUI.Lang.std.control_undo);$("#grid-snap-to-grid-label").html(GUI.Lang.std.grid_snap_to_grid);$("#grid-snap-to-point-label").html(GUI.Lang.std.grid_snap_to_point);$("#grid-visible-label").html(GUI.Lang.std.grid_visible);$("#input-text-label").html(GUI.Lang.identifier);$("#line-button-label").html(GUI.Lang.std.line_button);$("#line-button-arrow-label").html(GUI.Lang.std.arrow);$("#line-related-measure-label").html(GUI.Lang.std.measure);$("#measure-label").html(GUI.Lang.std.measure);$("#point-coord-label").html(GUI.Lang.std.point_coord);$("#point-size-field-label").html(GUI.Lang.std.element_size);$("#point-style-label").html(GUI.Lang.std.point_style);$("#recognition_line").html(GUI.Lang.std.line);$("#recognition_segment").html(GUI.Lang.std.line_segment);$("#recognition_ray").html(GUI.Lang.std.ray);$("#recognition_midpoint").html(GUI.Lang.std.midpoint);$("#recognition_circle").html(GUI.Lang.std.circle);$("#recognition_circle2points").html(GUI.Lang.std.circle2points);$("#recognition_triangle").html(GUI.Lang.std.triangle);$("#recognition_normal").html(GUI.Lang.std.normal);$("#recognition_reflection").html(GUI.Lang.std.reflect);$("#recognition_tangent").html(GUI.Lang.std.tangent);$("#recognition_parallel").html(GUI.Lang.std.parallel);$("#recognition_polygon").html(GUI.Lang.std.poly);$("#recognition_sector").html(GUI.Lang.std.sect);$("#recognition_bisector").html(GUI.Lang.std.bisector);$("#recognition_quadrilateral").html(GUI.Lang.std.quadrilateral);$("#recognition_perpendicularBisector").html(GUI.Lang.std.perpendicularBisector);$("#sector-related-measure-label").html(GUI.Lang.std.measure);$("#status-fix-label").html(GUI.Lang.std.status_fix);$("#status-trace-label").html(GUI.Lang.std.trace);$("#tools-slider-label").html(GUI.Lang.std.slide);$("#tools-anglesector-label").html(GUI.Lang.std.angle_element);$("#tools-circlesector-label").html(GUI.Lang.std.sect);$("#control-actions-function-label").html(GUI.Lang.std.tools_function);$("#tools-ruler-label").html(GUI.Lang.std.ruler);$("#tools-regpolygon-label").html(GUI.Lang.std.tools_regpolygon);$("#tools-text-label").html(GUI.Lang.std.text_element)},initControls:function(){GUI.switchToolbarPos(GUI.Settings.get("layouttop"));$(document).on("keydown",GUI.keyHandler);$('[id^="recognition_"]').addClass("not-displayed");$("#control-undo-box").bind(GUI.click_event,GUI.undo);$("#control-redo-box").bind(GUI.click_event,GUI.redo);$("#control-drag-box").bind(GUI.click_event,GUI.toggleDrag);$("#control-construct-box").bind(GUI.click_event,GUI.toggleConstruct);$("#control-actions-function-box").bind(GUI.click_event,GUI.plotAction);$("#control-tools-box").bind(GUI.click_event,function(){GUI.activateToolControls()});$("#control-actions-box").bind(GUI.click_event,function(){GUI.activateActionControls()});$("#control-actions-hide-box").bind(GUI.click_event,GUI.hideAction);$("#control-actions-del-box").bind(GUI.click_event,GUI.delAction);$("#actions-ablate").bind(GUI.click_event,GUI.ablateAction);$("#actions-transform").bind(GUI.click_event,GUI.transfAction);$("#control-boardprop-box").bind(GUI.click_event,function(){GUI.activateBoardControls()});$("#control-gallery-box").bind(GUI.click_event,function(){GUI.watchGallery()});$("#tools-slider-box").bind(GUI.click_event,GUI.slider);$("#tools-regpolygon-box").bind(GUI.click_event,function(){GUI.polygon()});$("#tools-anglesector-box").bind(GUI.click_event,function(){GUI.sector("angle")});$("#tools-circlesector-box").bind(GUI.click_event,function(){GUI.sector("circle")});$("#tools-ruler-box").bind(GUI.click_event,function(){GUI.ruler()});$("#tools-text-box").bind(GUI.click_event,GUI.text);$("#grid-visible-box").bind(GUI.click_event,GUI.toggleGrid);$("#grid-snap-to-grid-box").bind(GUI.click_event,function(){return GUI.toggleSnapToGrid()});$("#grid-snap-to-point-box").bind(GUI.click_event,GUI.toggleSnapToPoint);$("#board-axis-visible-box").on(GUI.click_event,GUI.toggleAxis);$("#board-clear-all-box").on("click",GUI.clearBoard);$("#board-clear-traces-box").on("click",function(){GUI.board.clearTraces()});$("#nav-left").bind(GUI.tap_event,function(){GUI.board.clickLeftArrow()});$("#nav-right").bind(GUI.tap_event,function(){GUI.board.clickRightArrow()});$("#nav-up").bind(GUI.tap_event,function(){GUI.board.clickDownArrow()});$("#nav-down").bind(GUI.tap_event,function(){GUI.board.clickUpArrow()});$("#nav-zoom-100").bind(GUI.tap_event,function(){GUI.board.zoomAllPoints()});$("#nav-zoom-in").bind(GUI.tap_event,function(){GUI.board.zoomIn()});$("#nav-zoom-out").bind(GUI.tap_event,function(){GUI.board.zoomOut()});$("#nav-center").bind(GUI.tap_event,function(){GUI.board.moveOrigin(GUI.board.canvasWidth/2,GUI.board.canvasHeight/2)});$("#key-go").bind(GUI.click_event,function(){GUI.Plot.checkAndPlot()});$("#key-backspace").bind(GUI.click_event,function(){GUI.Plot.deleteLast()});$("#key-clear").bind(GUI.click_event,function(){GUI.Plot.deleteLast(true)});$("#key-sin").bind(GUI.click_event,function(){GUI.Plot.addValue("sin(x)")});$("#key-cos").bind(GUI.click_event,function(){GUI.Plot.addValue("cos(x)")});$("#key-tan").bind(GUI.click_event,function(){GUI.Plot.addValue("tan(x)")});$("#key-sqrt").bind(GUI.click_event,function(){GUI.Plot.addValue("sqrt(x)")});$("#key-exp").bind(GUI.click_event,function(){GUI.Plot.addValue("exp(x)")});$("#key-log").bind(GUI.click_event,function(){GUI.Plot.addValue("log(x)")});$("#key-pow").bind(GUI.click_event,function(){GUI.Plot.addValue("pow(2,x)")});$("#key-abs").bind(GUI.click_event,function(){GUI.Plot.addValue("abs(x)")});$("#key-X").bind(GUI.click_event,function(){GUI.Plot.addValue("X()")});$("#key-Y").bind(GUI.click_event,function(){GUI.Plot.addValue("Y()")});$("#key-pi").bind(GUI.click_event,function(){GUI.Plot.addValue("PI")});$("#key-e").bind(GUI.click_event,function(){GUI.Plot.addValue("EULER")});$("#key-0").bind(GUI.click_event,function(){GUI.Plot.addValue("0")});$("#key-1").bind(GUI.click_event,function(){GUI.Plot.addValue("1")});$("#key-2").bind(GUI.click_event,function(){GUI.Plot.addValue("2")});$("#key-3").bind(GUI.click_event,function(){GUI.Plot.addValue("3")});$("#key-4").bind(GUI.click_event,function(){GUI.Plot.addValue("4")});$("#key-5").bind(GUI.click_event,function(){GUI.Plot.addValue("5")});$("#key-6").bind(GUI.click_event,function(){GUI.Plot.addValue("6")});$("#key-7").bind(GUI.click_event,function(){GUI.Plot.addValue("7")});$("#key-8").bind(GUI.click_event,function(){GUI.Plot.addValue("8")});$("#key-9").bind(GUI.click_event,function(){GUI.Plot.addValue("9")});$("#key-dot").bind(GUI.click_event,function(){GUI.Plot.addValue(".")});$("#key-div").bind(GUI.click_event,function(){GUI.Plot.addValue("/")});$("#key-mult").bind(GUI.click_event,function(){GUI.Plot.addValue("*")});$("#key-circ").bind(GUI.click_event,function(){GUI.Plot.addValue("^")});$("#key-plus").bind(GUI.click_event,function(){GUI.Plot.addValue("+")});$("#key-minus").bind(GUI.click_event,function(){GUI.Plot.addValue("-")});$("#key-percent").bind(GUI.click_event,function(){GUI.Plot.addValue("%")});$("#key-left-bracket").bind(GUI.click_event,function(){GUI.Plot.addValue("(")});$("#key-comma").bind(GUI.click_event,function(){GUI.Plot.addValue(",")});$("#key-right-bracket").bind(GUI.click_event,function(){GUI.Plot.addValue(")")});$("#key-xx").bind(GUI.click_event,function(){GUI.Plot.addValue("x")});GUI.switchHandling(GUI.Settings.get("leftright"))}});function init_jsx_gui(a){console.log("init_jsx_gui called");if(GUI.firstInit){console.log("first Init");$("#mainWindow").disableSelection();$("#content").css("position","absolute");$("#content").css("top",$("#toolbar-panel").outerHeight());$("#content").css("padding","0px");window.onresize=function(){GUI.resizeBoard()};GUI.detectDefaultLanguage();GUI.Settings.load();GUI.Settings.set("language",GUI.Settings.get("language"));GUI.Settings.set("magnify",GUI.Settings.get("magnify"));GUI.insertStrokes(GUI.nd_recognizer.Multistrokes);GUI.initSketchBoard(a);JXG.addEvent(document,GUI.up_event,GUI.timerHandler,GUI);JXG.addEvent(GUI.board.containerObj,GUI.move_event,GUI.magMove,GUI);JXG.addEvent(GUI.board.containerObj,GUI.up_event,function(b){window.setTimeout(function(){GUI.magMove(b)},300)},GUI)}}(function(){JXG.SketchReader.generateJCodeMeta=function(){return GUI.generateJCode.apply(GUI,arguments)};JXG.SketchReader.id=function(){return GUI.id()};JXG.Draw.recordStepMeta=function(){return GUI.recordStep.apply(GUI,arguments)};JXG.EventEmitter.eventify(GUI)})();GUI.Lang={};GUI.Lang.Map=[["de","en","fr","es","pt"],["Deutsch","English","Français","Español","Português"]];GUI.Lang.de=0;GUI.Lang.en=1;GUI.Lang.fr=2;GUI.Lang.es=3;GUI.Lang.pt=4;GUI.Lang.strings={ablateOnIntersection:["Abtragen auf","Copy on:","Copier vers","Copiar en","Copiar em"],ablate_objects:["Objekte abtragen","Copy objects","Copier les objets","Copiar objetos","Copiar objetos"],ablation_instruct:["Klicke auf das Objekt (Kreis / Strecke), das abgetragen werden soll.","Click on the object (circle / line segment) you want to copy.","Cliquer sur l&#39objet à copier(cercle/droite/segment).","Clic en objeto (círculo, línea, segmento) que desea copiar","Clique no objeto (círculo / reta /segmento) que você deseja copiar."],actions:["Aktions-Menü","Actions menu","Menu des actions","Menú de acciones","Menu de ações"],anglesector_selection:["Markiere: Punkt - Scheitel - Punkt","Mark: Point - Vertex - Point","Marquer les 3 points qui définissent le secteur angulaire","Marcar tres puntos para definir sector angular","Marque três pontos para definir o setor angular."],angle_button_rightangle:["Rechter Winkel","Right angle","Angle droit","Ángulo recto","Ângulo reto"],angle_element:["Winkel","Angle","Angle","Ángulo","Ângulo"],angle_measure:["Winkel messen","Measure angle","Mesurer angle","Medir ángulo","Medida de ângulo"],angle_sector:["Winkel einzeichnen","Angle sector","Secteur angulaire","Sector angular","Setor angular"],arrow:["Pfeilspitzen","Arrow heads","Flèches","Cabeza de flechas","Tipos de setas"],axis:["Achse","Axis","Axe","Eje","Eixo"],axispoint:["Achsenpunkt","Axis point","Point de l&#39axe","Punto en eje","Ponto do eixo"],axis_scale:["Skalierung","Scale","Échelle","Escala","Escala"],axis_visibility:["Achsen","Axes","Axes","Ejes","Eixos"],back:["Zurück","Back","Retour","Volver","Voltar"],bisector:["Winkelhalbierende","Angular bisector","Bissectrice","Bisectriz","Bissetriz"],board_clear_all:["Alles löschen","Remove all","Tout effacer","Eliminar todo","Remover tudo"],bottom:["Unten","Bottom","Bas","Abajo","Embaixo"],cancel:["Abbrechen","Cancel","Annule","Cancelar","Cancelar"],cantoverwrite:["Datei kann nicht überschrieben werden!","File already exists and can not be overwritten!","Le fichier existe déjà et ne peut pas être écraser !","Archivo existente y no puede volver a grabarse","O arquivo já existe e não pode ser sobrescrito."],cas:["Punkt","Point","Point","Punto","Ponto"],center:["Zentrieren","Center","Centrer","Centro","Centro"],chooseformat:["Sie müssen mindestens ein Dateiformat auswählen.","You have to choose at least one file format.","Vous devez choisir au moins un format de fichier","Escoger al menos un formato de archivo","Você deve escolher pelo menos um formato de arquivo"],choosesector:["Art des Sektors","Choose the sector type","Choisir le type de secteur","Escoger el tipo de sector","Escolha o tipo de setor"],circle:["Kreis","Circle","Cercle","Círculo","Círculo"],circle2points:["Kreis (Mittelpunkt - Punkt)","Circle (2P)","Cercle (2P)","Círculo (2 puntos)","Círculo (2P)"],circlesector_selection:["Markiere: Punkt - Mittelpunkt - Punkt","Mark: Point - Midpoint- Point","Marquer les trois points qui définissent le secteur circulaire.","Marcar tres puntos para definir sector circular","Marque os três pontos para definir o setor circular."],circle_sector:["Kreissektor","Circle sector","Secteur circulaire","Sector circular","Setor circular"],clear_reassure:["Wirklich alle Objekte löschen?","Do you really want to delete all objects on the board?","Voulez-vous vraiment supprimer tous les objets ?","¿Realmente desea eliminar todos los objetos del plano? ","Você deseja realmente apagar todos os objetos?"],clear_traces:["Spuren löschen","Clear traces","Effacer traces","Borrar trazas","Limpar traços"],clicktoconnect:["Verbindung herstellen mit","Connect with","Connecter avec","Conectar con","Conectar com"],clone:["Klonen","Clone","Cloner","Clonar","Clonar"],colors:["Farben","Colors","Couleurs","Colores","Cores"],confirmoverwrite:["Datei existiert bereits, überschreiben?","File already exists. Overwrite?","Le fichier existe déjà, écraser ?","Archivo existente, ¿grabar otra vez?","O arquivo já existe. Sobrescrever?"],confirmreset:["Bist du sicher? Es werden alle Einstellungen und Konstruktionen gelöscht!","Are you sure? All settings and constructions will be deleted!","Êtes-vous sûr ? Tous les paramètres et les constructions seront effacés.","¿Está seguro? Todas las configuraciones y objetos serán eliminados","Você tem certeza? Todas as configurações e construção serão apagadas!"],conic:["Kegelschnitt","Conic","Conique","Cónica","Cônica"],connecting:["Verbinde mit Cloud-Speicher.","Connecting to storage provider","Connexion au service de stockage en ligne","Conectando con el proveedor de almacenamiento","Conectando-se com o servidor"],construct_mode:["Konstruktionsmodus aktivieren","Activate Construct-Mode","Activer le mode construction","Activar modo construcción","Ativar Modo-de-Construção"],"continue":["Weiter","Continue","Continuer","Terminar autenticación","Terminar autenticação."],control_boardprop:["Eigensch.","Prop.","Prop.","Propiedades","Prop."],control_construct:["Konstr.","Constr.","Constr.","Construir","Construir"],control_drag:["Ziehen","Drag","Draguer","Arrastrar","Arrastar"],control_redo:["Vor","Redo","Refaire","Rehacer","Refazer"],control_tools:["Mehr","More","Plus","Más","Mais"],control_undo:["Zurück","Undo","Défaire","Deshacer","Desfazer"],coords:["Koordinaten","Coordinates","Coordonnées","Coordenadas","Coordenadas"],copy_instruct:["Klicke auf das Objekt, das kopiert werden soll.","Click on the object you want to copy.","Cliquer sur un objet à copier.","Clic en el objeto a copiar","Clique no objeto que você deseja copiar."],copy_objects:["Objekt kopieren","Copy objects","Copier les objets","Copiar objetos","Copiar objetos"],corners:["Eckenanzahl (>=3 und <=35)","Number of corners (>2 and <36)","Nombre de sommets (>=3 et <=35)","Número de vértices (mayot que 2 y menor que 36)","Número de vértices (> 2 e < 36)"],corner_amount:["Eckenzahl: mindestens 3, höchstens 35","The number of corners should be >= 3 and <= 35","Le nombre de sommets doit être >=3 et <=35","El número de vértices debería ser mayor o igual a 3 y menor o igual a 35","O número de vértices deve ser >= 3 e <= 35"],cursor:["Fadenkreuz","Crosshair","Réticule (pointeur croix)","Cruz","Cruz"],curve:["Kurve","Curve","Courbe","Curva","Curva"],del:["Löschen","Delete","Effacer","Eliminar","Apagar"],delete_reassure:["Diese Konstruktion wirklich löschen?","Do you really want to delete this construction?","Voulez-vous vraiment supprimer cette construction ?","¿Realmente desea eliminar esta construcción?","Você deseja realmente apagar esta construção?"],del_instruct:["Klicke auf das Objekt, das gelöscht werden soll.","Click on the object you want to delete.","Cliquer sur l&#39objet à supprimer","Clic en el objeto a eliminar","Clique no objeto que você deseja apagar."],del_objects:["Objekte löschen","Delete objects","Supprimer les objets","Eliminar objetos",""],drag_file:["Ziehe eine GEONExT- oder sketchometry-Konstruktion in dieses Feld um sie Ihrer Galerie hinzuzufügen.","Drop a GEONExT or sketchometry file here to import it.","Lâcher ici un fichier GEONEXT ou sketchometry pour l&#39importer dans votre galerie.","Dejar aquí un archivo GEONExT o Sketchometry para importarlo","Arraste um arquivo GEONExT ou Sketchometry aqui para importá-lo."],drag_mode:["Zugmodus aktivieren","Activate Drag-Mode","Activer le mode draguer","Activar modo arrastrar","Ativar Modo-de-Arraste"],drawGlider:["Platziere Gleiter auf","Place glider on:","Placer un glisseur","Colocar punto sobre:","Colocar marca em:"],element_opacity:["Fülltransparenz","Fill opacity","Opacité","Transparencia","Transparência"],element_size:["Größe","Size","Taille","Tamaño","Tamanho"],emptyfolder:["Leerer Ordner","Empty folder","Dossier vide","Carpeta vacía","Arquivo vazio"],english:["Englisch","English","Anglais","Inglés","Inglês"],exp:["Export","Export","Exporter","Exportar","Exportar"],expo:["Exportieren in die Cloud","Export to the cloud","Exporter vers le stockage en ligne","Exportar a la nube","Exportar para a nuvem"],fill_settings:["Fülloptionen","Fill settings","Remplissage","Completar los ajustes","Definir configurações"],finishauth:["Beende Authentifizierung","Finish authentication.","Finir l&#39authentification","Terminar autenticación","Terminar autenticação."],fixed_glider:["Fixer Gleiter","Fixed glider","Glisseur fixe","Deslizador fijo","Marca fixa"],fixed_point:["Fixer Punkt","Fixed point","Point fixe","Punto fijo","Ponto fixo"],free:["Frei","Free","Libre","Libre","Livre"],freeGlider:["Gleiter → Freier Punkt ...","Glider → Free point ...","Glisseur → point libre","Punto en objeto → Punto libre...","Marca → Ponto livre ..."],freePoint:["Freier Punkt","Free point","Point libre","Punto libre","Ponto livre"],function_plot:["Funktionsgraph","Function plot","Graphe d&#39une fonction","Graficar función","Gráfico de função"],gallery:["Galerie","Gallery","Galerie","Galería","Galeria"],german:["Deutsch","German","Allemand","Alemán","Alemão"],glider:["Gleiter","Glider","Glisseur","Punto en objeto","Marca"],glider_instruct:["Objekt an gewünschten Ort ziehen.","Release your finger / the mouse button on the object, where you want to place the glider.","Relâcher le doigt/la souris sur l&#39objet où sera placé le glisseur.","Toque con su dedo (presione el botón del mouse) sobre el lugar del objeto onde quiere colocar la marca","Pressione o seu dedo / botão do mouse sobre o lugar do objeto onde você quer colocar a marca"],grid_snap_to_grid:["Einrast. Gitter","Snap grid","Capture grille","Fijar a la cuadrícula","Capturar malha"],grid_snap_to_point:["Einrast. Pkt.","Snap points","Capture points","Fijar puntos","Capturar pontos"],grid_visible:["Gitter anzeigen","Show grid","Voir grille","Exhibir cuadrícula","Exibir malha"],help:["Hilfe","Help","Aide","Ayuda","Ajuda"],hide:["Versteck.","Hide","Cacher","Ocultar","Esconder"],hide_instruct:["Klicke auf das Objekt, das angezeigt / versteckt werden soll.","Click on the object you want to (un-)hide.","Cliquer sur l&#39objet à cacher/montrer.","Clic en objeto a (des)ocultar","Clique no objeto que você quer esconder / exibir."],hide_objects:["Objekte verstecken","Hide objects","Cacher des objets","Objetos ocultos","Esconder objetos"],identifier:["Bezeichner","Identifier","Identifier","Identificar","Identificar"],img:["Bild","Image","Image","Imagen","Imagem"],imp:["Import","Import","Importer","Importar","Importar"],impo:["Importieren aus der Cloud","Import from the cloud","Importer depuis le stockage en ligne","Importar desde la nube","Importar da nuvem"],intersect:["Schnittpunkt","Intersection point","Point intersection","Intersección punto","Interseção pontos"],label_settings:["Texteigenschaften","Label settings","Paramètres des étiquettes","Ajustes de la etiqueta","Configurações de rótulos"],label_visible:["Zeige Text","Show label","Montrer létiquette","Exhibir rótulos","Exibir rótulo"],language:["Sprache","Language","Langage","Lenguaje","Idioma"],left:["Links","Left","Gauche","Izquierda","Esquerda"],leftrightmode:["Links- / Rechtshändermodus","Left/Right hand mode","Mode main gauche/droite","Modo mano izquierda (derecha)","Modo mão esquerda/direita"],len:["Länge","Length","Longueur","Largo","Comprimento"],length_measure:["Längenmessung","Measure length","Mesurer une longueur","Medir longitud","Medida de comprimento"],line:["Gerade","Line","Droite","Recta","Reta"],line_button:["Streckenenden","Line endings","Segment extrémités","Marcación de rectas","Marcação de retas"],line_segment:["Segment","Segment","Segment","Segmento","Segmento"],loggedinas:["Eingeloggt als","Logged in as","Connecté en tant que","Inició sesión como ","Registrado como"],login:["Beginne Authentifizierung (öffnet neues Fenster).","Start authentication process (opens new window).","Début du processus d&#39authentification (ouvre une nouvelle fenêtre).","Comenzar proceso de autenticación (abrirá una nueva ventana)","Iniciar processo de autenticação (uma nova janela será aberta)"],logout:["Logout","Logout","Déconnecté","Cerrar sesión","Sair"],magnify:["Lupe","Magnifier","Loupe","Lupa","Lente de aumento"],mark_glider_object:["Markiere den Ort für den Gleiter.","Mark the object on which you want to place the glider.","Marquer lobjet sur lequel place un glisseur.","Marcar el objeto al que pertenecerá el punto","Marque o objeto no qual você deseja colocar a marca."],measure:["Messung","Measure","Mesurer","Medir","Medir"],measure_angle:["Markiere einen angezeigten Winkel oder drei Punkte zum Messen des Winkels.","Select either an angle object or three points to measure the corresponding angle value.","Sélectionner soit un angle, soit trois points pour obtenir la mesure de cet angle.","Seleccionar tres puntos para obtener la correspondiente medida angular","Selecione ou um ângulo ou três pontos para medir o ângulo correspondente."],measure_dist:["Markiere zwei Punkte oder ein Geradenstück zum Messen des Abstands oder der Länge.","Select either 2 points for measuring the distance between them or a line segment to measure its length.","Sélectionner soit 2 points pour obtenir leur distance, soit un segment pour obtenir sa longueur.","Seleccionar dos puntos para medir la distancia entre ellos ó el segmento que los une para medir su longitud","Selecione dois pontos para medir a distância entre eles ou segmento de reta para medir o seu comprimento."],measure_instruction:["Markiere einen Winkel-, Kreissektor oder ein Geradenstück, um dessen Länge zu messen.","Mark an angle, arc or segment to measure its length.","Marquer un angle, un arc ou un segment pour le mesurer.","",""],measure_sector:["Markiere einen Kreissektor, um dessen Bogenlänge zu messen.","Select a circle sector to measure the length of its arc.","Sélectionner un secteur circulaire pour mesurer la longueur de son arc. ","Seleccionar un sector circular para medir la longitud de su arco","Selecione um setor circular para medir o comprimento de seu arco."],measure_slider:["Wähle einen Schieberegler, um dessen Wert zu verwenden.","Select a slider to measure its value.","Sélectionner un curseur pour mesurer sa valeur.","Seleccionar un deslizador para obtener su valor","Selecione um controle deslizante para obter o seu valor."],midpoint:["Mittelpunkt","Midpoint","Milieu","Punto medio","Ponto médio"],minus:["Verringern","Decrease","Diminuer","Decrementa","Diminuir"],mir1_instruct:["Markiere eine Spiegelachse.","Click on the object which should act as mirror.","Cliquer sur l&#39objet qui sera axe de la symétrie (réflexion).","Clic en el objeto que será eleje de reflexión","Clique no objeto que será o centro da reflexão."],mir2_instruct:["Markiere das Objekt, das gespiegelt werden soll.","Click on the object you want to mirror.","Cliquer sur l&#39objet dont le symétrique est à construire.","Clic en el objeto que desea reflejar","Clique no objeto que você deseja refletir."],mirror_objects:["Objekte spiegeln","Mirror objects","Objets symétriques","Objeto reflejado","Refletir objetos"],move_down:["Nach unten bewegen","Move down","Vers le bas","Mover hacia abajo","Mover para baixo"],move_left:["Nach links bewegen","Move left","Vers la gauche","Mover a la izquierda","Mover para a esquerda"],move_right:["Nach rechts bewegen","Move right","Vers à droite","Mover a la derecha","Mover para a direito"],move_up:["Nach oben bewegen","Move up","Vers le haut","Mover hacia arriba","Mover para cima"],nav:["Zeige Navigation","Show navigation","Montrer navigation","Exhibir navegación","Exibir navegação"],navtoolprop:["Zeichenfläche- / Objekt-Eigenschaften","Board / Object Properties","Propriété zone dessin / objets","Propiedades del plano ó de un objeto","Propriedades da Janela de Visualização / Objeto"],neu:["Neu","New","Nouveau","Nuevo","Novo"],newConst:["Neue Konstruktion anlegen","Create new construction","Créer une nouvelle construction","Crear una nueva construcción","Criar uma nova contrução"],newfoldername:["Name des neuen Ordners","Name of the new folder","Nom du nouveau dossier","Nombre de la nueva carpeta","Dê um nome para o novo diretório"],nextmark:["Nächste Marke","Next mark","Marque suivante","Siguiente marca","Próxima marca"],none:["Keiner","None","Aucun","Ninguno",""],normal:["Senkrechte","Perpendicular","Perpendiculaire","Perpendicular","Perpendicular"],of:["von","of","de","de","de"],parallel:["Parallele","Parallel","Parallèle","Paralelo(a)","Paralelo"],paste_ablation_instruct:["Ziehe das Objekt zum Abtragen an den gewünschten Ort.","Release your finger / the mouse button, to paste the copy.","Relâcher le doigt ou le bouton souris pour coller la copie.","Levante su dedo (suelte el botón del mouse) para pegar","Levante o seu dedo / botão do mouse para colar."],paste_instruct:["Markiere den gewünschten Ort für die Kopie.","Click on the board to paste the copy.","Cliquer sur la zone de dessin pour coller la copie.","Clic en el plano para pegar la copia","Clique na janela de visualização para colar."],perpendicularBisector:["Mittelsenkrechte","Perpendicular Bisector","Médiatrice","Mediatriz","Mediatriz"],plus:["Erhöhen","Increase","Augmenter","Incrementa","Aumentar"],point_coord:["X- / Y-Koordinaten","X / Y coordinates","Coordonnées x/y","Coordenadas X/Y","Coordenadas X / Y"],point_face:["Symbol","Face","Rendu","Cara","Tipo"],point_style:["Punktform","Point style","Style de point","Estilo de punto","Tipo do ponto"],poly:["Polygon","Polygon","Polygone","Polígono","Polígono"],polygon_selection:["Markiere nacheinander alle Eckpunkte und zum Abschluss wieder den Anfangspunkt.","Select the points which should span the polygon. Finalize the selection by clicking another time on the first point.","Sélectionner les points qui forment le polygone. Finir la sélection en cliquant à nouveau sur le 1er point.","Seleccione los vértices que conformarán ","Selecione os pontos que gerarão o polígono. Finalize a seleção clicando uma outra vez no primeiro ponto."],precision:["Dezimalstellen","Decimal places","Décimales","Decimales",""],prevmark:["Vorherige Marke","Previous mark","Marque précédente","Marca anterior","Marca anterior"],prop_instruct:["Klicke auf das Objekt, das bearbeitet werden soll.","Click on the object you want to modify.","Cliquer sur l&#39objet à modifier.","Clic en el objeto que desea modificar","Clique no objeto que você deseja modificar."],quadrilateral:["Viereck","Quadrilateral","Quadrilatère","Cuadrilátero","Quadrilátero"],radius:["Radius","Radius","Rayon","Radio","Raio"],ray:["Halbgerade","Ray","Demi-droite","Rayo","Semirreta"],reflect:["Spiegelung","Reflection","Réflexion","Reflexión","Reflexão"],regular:["Regelmäßiges","Regular","Régulier","Regular","Regular"],reg_polygon_selection:["Markiere zwei Punkte zum Festlegen einer Polygonseite.","Select two board points, which will act as anchors for the regular polygon being created.","Sélectionner 2 points qui serviront d&#39ancres pour créer un polygone régulier","Seleccione dos puntos que serán los vértices iniciales del polígono regular","Selecione dois pontos que servirão como vértices para o polígono regular."],remove:["Löschen","Delete","Effacer","Eliminar","Apagar"],reset:["Zurücksetzen","Reset","Réinitialiser","Reiniciar","Reiniciar"],right:["Rechts","Right","Droite","Derecha","Direita"],right_angle:["Zeige 90° Punkt","Show 90° dot","Montre 90° point","Exhibir 90° punto","Exibir 90° ponto"],ruler:["Lineal","Ruler","Règle","La regla",""],ruler_selection:["Markiere eine Stelle auf der Zeichenfläche, um den Anfangspunkt des Lineals zu platzieren.","Mark a position on the board to place the starting point of the ruler.","Cliquer à 2 endroits de la zone de dessin pour placer les points de début et de fin de la règle.","",""],sect:["Sektor","Sector","Secteur","Sector","Setor"],sectordot:["Punkt","Dot","Point","Punto",""],sector_measure:["Bogenlänge messen","Measure arc","Mesurer un arc","Medir arco","Medir arco"],sector_related_measure:["Bogenlänge","Arc length","Longueur de larc","Longitud de arco","Comprimento de arco"],selectIntersection:["Markiere Schnittpunkt","Select an intersection:","Sélectionner une intersection:","Seleccionar una intersección","Selecionar uma interseção:"],select_transform:["Transformation auswählen","Select a transformation","Sélectionner une transformation","Seleccionar una transformación","Selecionar uma transformação:"],settings:["Optionen","Settings","Paramètres","Ajustes","Configurações"],show_tooltips:["Zeige Tooltips","Show tooltips","Montrer les infobulles","Mostrar sugerencias","Exibir dicas"],slide:["Regler","Slider","Curseur","Deslizdor","Controle deslizante"],slider_initialization:["Lege zunächst den Minimal-, Maximal- und Startwert des Reglers fest.","Define the start-, end- and the initial value of the slider:","Définir les valeurs de début, de fin et la valeur initiale du curseur:","Definir valores inicial y final del deslizador","Definir as extremidades e o valor inicial do controle deslizante."],slider_placement:["Markiere zur Platzierung des Reglers eine Stelle auf der Zeichenfläche.","Click on one place on the board to place the slider.","Cliquer à un endroit de la zone de dessin pour placer le curseur.","Clic en dos lugares del plano para ubicar eldeslizador","Clique em dois lugares para colocar o controle deslizante."],slider_value:["Wert des Schiebereglers","Slider value","Valeur du curseur","Valor del deslizador","Valor do controle deslizante"],snap_to_grid:["Einrasten auf Gitter","Snap to grid","Capturer à la grille","Fijar cuadrícula","Ajustar à malha"],snap_to_point:["Einrasten auf Punkt","Snap to point","Capturer au point","Fijar punto","Ajustar ao ponto"],sound:["Audio","Sound","Son","Sonido","Som"],square:["Quadrat","Square","Carré","Cuadrado",""],status_fix:["Fixieren","Fix","Fixer","Fijar","Fixar"],store_matrix:["Matrix speichern","Store matrix","Enregistrer la matrice","Matriz de almacenmiento","Matriz"],stroke_settings:["Stricheigenschaften","Stroke settings","Paramètres des traits","Ajustes de trazo","Configurações"],stroke_width:["Strichstärke","Stroke width","Epaisseur","Ajustes de ancho","Espessura"],tangent:["Tangente","Tangent","Tangente","Tangente","Tangente"],text_element:["Text","Text","Texte","Texto","Texto"],text_placement:["Markiere eine Stelle auf der Zeichenfläche <br>zum Platzieren des Textes.","Click on the board to place your text.","Cliquer sur la zone de dessin pour place le texte","Clic en el plano para colocar su texto","Clique na janela de visualização para colocar o seu texto."],text_size:["Textgröße","Label size","Taille étiquette","Tamaño del rótulo","Tamanho do rótulo"],ticks:["Ticks","Ticks","Point dintervalle","Marcas","Marcas"],to:["zu","to","vers","para","para"],togglemark:["Setze / Entferne Marke","(Un-)Set mark","(Dé)Faire une marque","Fijar(soltar) marcas","Definir / remover marca"],toolbarposition:["Toolbar Position","Toolbar position","Position de la barre d&#39outils","Posición de la barra de herramientas","Posição da barra de ferramentas"],tools:["Werkzeug-Menü","Tools menu","Menu des outils","Menú herramientas","Menu de ferramentas"],tools_function:["Plot","Plot","Tracer","Graficar","Gráfico"],tools_regpolygon:["Reg. Pol.","Reg. pol.","Pol. rég.","Pol. reg.","Pol. Reg."],top:["Oben","Top","Haut","Arriba","Em cima"],trace:["Spur","Trace","Trace","Traza","Traço"],transform_apply:["Markiere den Punkt, der transformiert werden soll.","Click on a point on which the transformation should be applied","Cliquer sur le point à transformer","Clic en objeto donde la transformación será aplicada","Clique no ponto que será transformado"],transform_objects:["Objekte transformieren","Transform objects","Transformer des objets","Transformar objetos","Transformar objetos"],triangle:["Dreieck","Triangle","Triangle","Triángulo","Triângulo"],turtle:["Turtle","Turtle","Tortue","Tortuga","Tartaruga"],unknown:["Unbekannt","Unknown","Inconnu","Desconocido",""],unsupported_file_format:["Dateiformat wird nicht unterstützt!","Unsupported file format","Format de fichier non supporté","formato de archivo no soportado","Formato de arquivo não suportado"],untitled:["Unbenannt","Untitled","Sans titre","Sin título","Sem título"],upload:["Hochladen","Upload","Téléverser","Subir","Transferir"],uploadsuccess:["Export erfolgreich","Upload successful.","Téléversé avec succès.","Subida exitosa","Transferência realizada com êxito"],vect:["Vektor","Vector","Vecteur","Vector","Vetor"],vibration:["Vibration","Vibration","Vibration","Vibración","Vibração"],volume:["Lautstärke","Volume","Volume","Volumen","Volume"],zoom_100:["Standard-Zoom","Default Zoom","Zoom par défaut","Vista estándar","Zoom Padrão"],zoom_in:["Zoom In","Zoom In","Agrandir","Acercar","Ampliar"],zoom_out:["Zoom Out","Zoom Out","Réduire","Alejar","Reduzir"]};GUI.Settings={definition:[{id:"language",label:"language",type:"list",values:GUI.Lang.Map[1],value:GUI.Lang.Map[1][1],action:function(a){GUI.setLanguage(a);GUI.Gallery.setCaptions()},enabled:true},{id:"layouttop",label:"toolbarposition",type:"list",values:["top","bottom"],value:"top",action:function(a){GUI.switchToolbarPos(a)},enabled:true},{id:"leftright",label:"leftrightmode",type:"list",values:["left","right"],value:"right",action:function(a){GUI.switchHandling(a)},enabled:true},{id:"rightangle",label:"angle_button_rightangle",type:"list",values:["sectordot","square","none"],value:"sectordot",action:function(a){if(a=="none"){a="sector"}JXG.Options.angle.orthotype=a},enabled:true},{id:"magnify",label:"magnify",type:"bool",value:false,action:function(a){if(!JXG.isTouchDevice()){if(a){$("#magnifier").removeClass("not-displayed")}else{$("#magnifier").addClass("not-displayed")}}},enabled:true},{id:"sound",label:"sound",type:"bool",value:true,enabled:false},{id:"volume",label:"volume",type:"volume",value:1,enabled:true},{id:"precision",label:"precision",type:"list",values:["0","2","4","8","16"],value:"2",action:function(a){GUI.precision=parseInt(a)},enabled:true},{id:"vibrate",label:"vibration",type:"bool",value:false,enabled:true},{id:"cursor",label:"cursor",type:"bool",value:false,enabled:true},{id:"captions",label:"buttoncaptions",type:"bool",value:true,action:function(a){if(a){$(".sui-button-box* > .buttonLabel").removeClass("not-displayed");$("#toolbar-panel").removeClass("tbHeight-small");$("#toolbar-panel").addClass("tbHeight-big");GUI.switchToolbarPos(GUI.Settings.get("layouttop"))}else{$(".sui-button-box* > .buttonLabel").addClass("not-displayed");$("#toolbar-panel").removeClass("tbHeight-big");$("#toolbar-panel").addClass("tbHeight-small");GUI.switchToolbarPos(GUI.Settings.get("layouttop"))}GUI.Gallery.setCaptions()},enabled:false},{id:"reset",label:"reset",type:"action",action:function(){GUI.confirm(GUI.Lang.std.confirmreset,false,function(){localStorage.clear();window.location.reload()})},enabled:true}],setaction:function(){},setlist:function(c,b){var a;for(a=0;a<this.definition[c].values.length;a++){if(this.definition[c].values[a]===b){this.definition[c].value=b}}},setbool:function(b,a){this.definition[b].value=!!a},setvolume:function(b,a){this.definition[b].value=a},get:function(a){var b,c;for(b=0;b<this.definition.length;b++){if(this.definition[b].id===a){c=this.definition[b].value}}return c},set:function(b,a){var c;for(c=0;c<this.definition.length;c++){if(this.definition[c].id===b){this["set"+this.definition[c].type](c,a);if(JXG.exists(this.definition[c].action)){this.definition[c].action(this.definition[c].value)}}}this.save()},load:function(){var a=GUI.Storage.getItem(GUI.appId+":meta:settings"),c,b;if(JXG.exists(a)){c=JSON.parse(a);for(b=0;b<this.definition.length;b++){if(JXG.exists(c[this.definition[b].id])){this.definition[b].value=c[this.definition[b].id];if(this.definition[b].action){this.definition[b].action(this.definition[b].value)}}}}},save:function(){var a=GUI.Storage.getItem(GUI.appId+":meta:settings"),c,b;if(JXG.exists(a)){c=JSON.parse(a)}else{c={}}for(b=0;b<this.definition.length;b++){c[this.definition[b].id]=this.definition[b].value}GUI.Storage.setItem(GUI.appId+":meta:settings",JSON.stringify(c))}};JXG.extend(GUI,{deselectToolButton:function(a){$("#"+a).removeClass("button-selected");$("#"+a+"-box").removeClass("button-selected");GUI.removeToolEvents(true);GUI.delight()},deselectAllToolButtonsAndRemoveActions:function(){GUI.deselectToolButton("tools-text");GUI.deselectToolButton("tools-ruler");GUI.deselectToolButton("tools-regpolygon");GUI.deselectToolButton("tools-circlesector");GUI.deselectToolButton("tools-anglesector");GUI.deselectToolButton("tools-slider");if(GUI.dialog.pol!=null){GUI.dialog.pol.removeDialog()}if(GUI.dialog.slider!=null){GUI.dialog.slider.removeDialog()}GUI.removeActionEvent(true)},selectToolButton:function(a){if($("#"+a).hasClass("button-selected")){GUI.deselectToolButton(a);return false}GUI.deselectAllToolButtonsAndRemoveActions();$("#"+a).addClass("button-selected");$("#"+a+"-box").addClass("button-selected");return true},ruler:function(){if(!GUI.selectToolButton("tools-ruler")){return}GUI.showBoardText(GUI.Lang.std.ruler_selection);GUI.selection=[];GUI.addToolEvent(GUI.down_event,GUI.addRulerEvt)},addRulerEvt:function(a){var b=function(){if(GUI.selection.length==1){JXG.Draw.drawRuler(GUI.selection[0],GUI.Lang.std.ruler);GUI.deselectToolButton("tools-ruler")}};GUI.select(a,"place",false,null,b)},text:function(){if(!GUI.selectToolButton("tools-text")){return}GUI.showBoardText(GUI.Lang.std.text_placement);GUI.addToolEvent(GUI.down_event,function(b){var a=JXG.Draw.drawText(GUI.getCoords(b));GUI.deselectToolButton("tools-text");GUI.activateBoardControls();GUI.contextEdit(a);window.setTimeout(function(){GUI.getId("input-text").focus()},25)},0,true)},polygon:function(){if(!GUI.selectToolButton("tools-regpolygon")){return}GUI.showBoardText(GUI.Lang.std.reg_polygon_selection);GUI.selection=[];GUI.addToolEvent(GUI.down_event,GUI.addRegPolygonEvt);var a=GUI.Lang.std.regular+" "+GUI.Lang.std.poly,b;b='<label for="poly_corners">'+GUI.Lang.std.corners+":</label> ";b+='<input id="poly_corners" name="poly_corners" type="text" ';b+="on"+GUI.click_event+"='";b+='this.value="";';b+="' value=\""+JXG.Options.lastRegPolCorners+'" size="1">';new GUI.Dialog("pol",b,a,[0,120],[320,0],"reg",function(){GUI.deselectToolButton("tools-regpolygon")});$("#dlg-header-left").css("background-position","-519px -165px")},addRegPolygonEvt:function(a){if(GUI.getId("poly_corners").value<3||GUI.getId("poly_corners").value>33){GUI.alert(GUI.Lang.std.corner_amount);return}var b=function(){if(GUI.selection.length==2){JXG.Options.lastRegPolCorners=GUI.getId("poly_corners").value;JXG.Draw.drawRegularPolygon(GUI.selection);GUI.deselectToolButton("tools-regpolygon");if(GUI.dialog.pol!=null){GUI.dialog.pol.removeDialog()}}};GUI.select(a,"point",false,null,b)},sector:function(c){var a,b;if(c=="circle"){if(!GUI.selectToolButton("tools-circlesector")){return}a=GUI.Lang.std.circlesector_selection;b=GUI.addCircleSectorEvt}else{if(!GUI.selectToolButton("tools-anglesector")){return}a=GUI.Lang.std.anglesector_selection;b=GUI.addAngleSectorEvt}GUI.showBoardText(a);GUI.selection=[];GUI.addToolEvent(GUI.down_event,b,c)},addAngleSectorEvt:function(a){var b=function(){if(GUI.selection.length==3){JXG.Draw.drawAngleSector([GUI.selection[0].id,GUI.selection[1].id,GUI.selection[2].id]);GUI.deselectToolButton("tools-anglesector")}};GUI.select(a,"point",false,null,b)},addCircleSectorEvt:function(a){var b=function(){if(GUI.selection.length==3){JXG.Draw.drawCircleSector([GUI.selection[1].id,GUI.selection[0].id,GUI.selection[2].id]);GUI.deselectToolButton("tools-circlesector")}};GUI.select(a,"point",false,null,b)},slider:function(){var a;if(GUI.dialog.slider!=null){GUI.dialog.slider.removeDialog();return}$("#btn_slider").css("color","#ffff00");a=GUI.Lang.std.slider_initialization;a+='<p class="center">';a+='<input class="slider" id="start" name="start" size="2" type="text" ';a+="on"+GUI.click_event+"='";a+='this.value="";';a+='\' value="0">';a+='<input class="slider" id="end" name="end" size="2" type="text" ';a+="on"+GUI.click_event+"='";a+='this.value="";';a+='\' value="2">';a+='<input class="slider" id="ini" name="ini" size="2" type="text" ';a+="on"+GUI.click_event+"='";a+='this.value="";';a+='\' value="1">';a+="</p>";a+=GUI.Lang.std.slider_placement;new GUI.Dialog("slider",a,GUI.Lang.std.slide,[0,0],[220,0],0,GUI.removeSliderEvt);GUI.selection=[];GUI.addToolEvent(GUI.down_event,GUI.addSliderEvt)},addSliderEvt:function(a){GUI.selection.push(GUI.getCoords(a));if(GUI.selection.length==1){JXG.Draw.drawSlider(GUI.selection);GUI.dialog.slider.removeDialog()}},removeSliderEvt:function(){GUI.removeToolEvents(true);$("#btn_slider").css("color","#ffffff")},Plot:{plot:function(){var d,a,b,c=this.getPlotType();switch(c){case"functiongraph":b="function(x) { return "+this.getValue()+"; }";a=GUI.plotColors[GUI.plotColor++];if(GUI.plotColor>=GUI.plotColors.length){GUI.plotColor=0}if((d=$("#editPlot").val())=="false"){GUI.recordStep({type:JXG.GENTYPE_PLOT,dest_id:GUI.id(),args:{plot_type:"plot",isPolar:false,isUpdate:false,func:b,color:a}},true)}else{GUI.recordStep({type:JXG.GENTYPE_PLOT,dest_id:d,args:{isUpdate:true,func:b,funcOld:GUI.board.objects[d].Y.toString()},color:a},true)}break}GUI.lastPlotFunc=this.getValue()},plotFunction:function(){$("#editPlot").val("false");$("#plot_panel").removeClass("not-displayed");if(JXG.isTouchDevice()){$("#fx-input").prop("readonly","true")}},getCaret:function(d){if(d.selectionStart){return d.selectionStart}else{if(!document.selection){return 0}}var g="\001",f=document.selection.createRange(),b=f.duplicate(),a;b.moveToElementText(d);f.text=g;a=b.text.indexOf(g);f.moveStart("character",-1);f.text="";return a},setCaret:function(b,c){if(b.setSelectionRange){b.focus();b.setSelectionRange(c,c)}else{if(b.createTextRange){var a=b.createTextRange();a.collapse(true);a.moveStart("character",c);a.moveEnd("character",c);a.select()}}},addValue:function(a){var d,c=GUI.getId("fx-input"),b=GUI.Plot.getCaret(c);d=c.value;c.value=c.value.slice(0,b);d=d.slice(b);c.value+=(a+d);GUI.Plot.setCaret(c,b+a.length)},deleteLast:function(c){var d,b=GUI.getId("fx-input"),a=GUI.Plot.getCaret(b);if(c){b.value=""}else{d=b.value;b.value=b.value.slice(0,a-1);d=d.slice(a);b.value+=d}GUI.Plot.setCaret(b,a-1)},getValue:function(){return GUI.getId("fx-input").value},getPlotType:function(){return"functiongraph"},checkAndPlot:function(){var a,d,c=this.getValue().sanitize().replace(/ /g,"");for(a=0;a<c.length;a++){if(c[a]=="x"){if(a>0&&c[a-1]!="("&&(c[a-1]==parseInt(c[a-1])||c[a-1]=="x")){d=c;c=c.slice(0,a);d=d.slice(a);c+=("*"+d)}}if(c[a]=="x"&&a<c.length-1&&c[a+1]!=")"&&c[a+1]!="%"&&c[a+1]!="+"&&c[a+1]!="-"&&c[a+1]!="*"&&c[a+1]!="/"&&(c[a+1]!="p"||((a-1)>=0&&c[a-1]!="e"))&&c[a+1]!="^"){d=c;c=c.slice(0,a+1);d=d.slice(a+1);c+=("*"+d)}if(c[a]==")"&&a<c.length-1&&c[a+1]!=")"&&c[a+1]!="%"&&c[a+1]!="+"&&c[a+1]!="-"&&c[a+1]!="*"&&c[a+1]!="/"&&c[a+1]!="^"){d=c;c=c.slice(0,a+1);d=d.slice(a+1);c+=("*"+d)}}GUI.getId("fx-input").value=c;try{GUI.board.jc.snippet(c,true);GUI.Plot.plot();$("#control-actions-function-box").trigger(GUI.click_event)}catch(b){console.log(b);console.log("Erroneous term/expression")}},texts:{durch:"",zum:"",mal:"*",geteilt:"/",dividiert:"/",plus:"+",und:"+",minus:"-",hoch:"^",quadrat:"^2",sinus:"sin",cosinus:"cos",tangens:"tan",betrag:"abs",wurzel:"sqrt",klammer:"",auf:"(",zu:")",x:"x"},levDist:function(b,a){if(!b.length){return a.length}if(!a.length){return b.length}return Math.min(this.levDist(b.substr(1),a)+1,this.levDist(a.substr(1),b)+1,this.levDist(b.substr(1),a.substr(1))+(b[0]!==a[0]?1:0))},parse:function(){var f=document.getElementById("fx-input").value,m=f.split(" "),c,b,h,g,l,k=m.length,a="",n,o;for(c=0;c<k;c++){n=m[c].toLowerCase();if(n.match(/[0-9]+/)!=null){a+=n;continue}g=1000000;for(b in this.texts){l=this.levDist(n,b)/n.length;if(l<g){g=l;h=this.texts[b];console.log(n,b,l,h)}if(g==0){break}}if(g<0.25){o=h}else{o=n}a+=o}document.getElementById("fx-input").value=a}}});JXG.extend(GUI,{actionTimer:function(a){if(GUI.ctx_timer!==0){clearTimeout(GUI.ctx_timer);GUI.ctx_timer=0}if(GUI.ctx_down_coords==null){return}if(JXG.Draw.findHittedObjs(GUI.ctx_down_coords.scrCoords[1],GUI.ctx_down_coords.scrCoords[2],GUI.board,JXG.Options.sensitive_area,[JXG.OBJECT_CLASS_LINE,JXG.OBJECT_CLASS_CIRCLE,JXG.OBJECT_CLASS_POINT,JXG.OBJECT_CLASS_CURVE,JXG.OBJECT_CLASS_AREA,JXG.OBJECT_CLASS_OTHER],[JXG.OBJECT_TYPE_CAS,JXG.OBJECT_TYPE_INTERSECTION,JXG.OBJECT_TYPE_TEXT]).length==0){return}GUI.action="ablation";GUI.addToolEvent(GUI.move_event,function(){});GUI.addAblateEvt(a,GUI.ctx_curr_coords)},hideAllActions:function(){if($("#actions-mirror").hasClass("button-selected")){$("#actions-mirror").trigger(GUI.click_event)}if($("#control-actions").hasClass("button-selected")){GUI.activateActionControls()}},plotAction:function(){var a=$("#control-actions-function"),b=$("#control-actions-function-box");if(a.hasClass("button-selected")){a.removeClass("button-selected");b.removeClass("button-selected");GUI.removeActionEvent(true);GUI.showPanel(false,0);return}GUI.deactivatePropToolAction();GUI.action="plot";a.addClass("button-selected");b.addClass("button-selected");GUI.Plot.plotFunction();GUI.showPropertyPanel("board",false);GUI.showPanel(true,GUI.ctxPosProps);$("#dialog-arrow").addClass("not-displayed");GUI.addActionEvent(GUI.down_event,function(){})},hideAction:function(){var a=$("#control-actions-hide"),b=$("#control-actions-hide-box");if(a.hasClass("button-selected")){a.removeClass("button-selected");b.removeClass("button-selected");GUI.removeActionEvent(true);GUI.showPanel(false,0);return}GUI.deactivatePropToolAction();GUI.action="hide";GUI.showHiddenObjects();a.addClass("button-selected");b.addClass("button-selected");GUI.showBoardText(GUI.Lang.std.hide_instruct);GUI.addActionEvent(GUI.down_event,function(c){GUI.addHideEvt(GUI.getScreenCoordsXY(c))});$("#control-actions").css("background-position",a.css("background-position"))},delAction:function(){var a=$("#control-actions-del"),b=$("#control-actions-del-box");if(a.hasClass("button-selected")){GUI.showHiddenObjects();a.removeClass("button-selected");b.removeClass("button-selected");GUI.removeActionEvent(true);GUI.showPanel(false,0);return}GUI.deactivatePropToolAction();GUI.action="del";GUI.showHiddenObjects();a.addClass("button-selected");b.addClass("button-selected");GUI.showBoardText(GUI.Lang.std.del_instruct);GUI.addActionEvent(GUI.down_event,function(c){GUI.addDelEvt(GUI.getScreenCoordsXY(c))});$("#control-actions").css("background-position",a.css("background-position"))},ablateAction:function(){var a=$("#actions-ablate");if(a.hasClass("button-selected")){GUI.removeActionEvent(true);return}if(GUI.action!="standard"){GUI[GUI.action+"Action"]()}GUI.action="ablation";a.addClass("button-selected");GUI.showBoardText(GUI.Lang.std.ablation_instruct);GUI.addActionEvent(GUI.down_event,function(b){GUI.addAblateEvt(b)},false,false);$("#control-actions").css("background-position",a.css("background-position"))},transfAction:function(){var b=$("#actions-transform");if(b.hasClass("button-selected")){GUI.removeActionEvent(true);return}if(GUI.action!="standard"){GUI[GUI.action+"Action"]()}b.addClass("button-selected");GUI.action="transf";b.addClass("button-selected");$("#caption-actions").addClass("not-displayed");var a=$("#transform-select"),c=$("#transform-input");if(GUI.countElements(GUI.transformation)==0){a.addClass("not-displayed");c.removeClass("sui-spacer")}else{a.removeClass("not-displayed");c.addClass("sui-spacer")}$("#caption-transform").removeClass("not-displayed");GUI.addActionEvent(GUI.down_event,function(){},false,false);$("#control-actions").css("background-position",b.css("background-position"))},fixAblation:function(b,a){if(typeof a!="undefined"){GUI.last_copy_pos=a}else{GUI.last_copy_pos=GUI.getCoords(b)}GUI.placeShadowCopy(GUI.selection,GUI.last_copy_pos);GUI.showBoardText(GUI.Lang.std.paste_ablation_instruct);GUI.addToolEvent(GUI.up_event,function(d,c){GUI.pasteAblation(d,c);if($("#control-actions").hasClass("button-selected")){GUI.ablateAction()}},GUI.selection,true)},pasteAblation:function(g,l){var d,c,b=[],k,f,m=true;var a=GUI.shadowCopyStep,n=GUI.placeShadowCopy(l,GUI.last_copy_pos);GUI.showObjectsBlured(false);GUI.pasteAblationDehighlight();if(a.type>50){f=GUI.generateJCode(a,GUI.board)}else{f=JXG.SketchReader.generateJCode(a,GUI.board,GUI.step_log)}GUI.parse(f[2],false);if(GUI.shadowCopyStep.type>50){f=GUI.generateJCode(GUI.shadowCopyStep,GUI.board)}else{f=JXG.SketchReader.generateJCode(GUI.shadowCopyStep,GUI.board,GUI.step_log)}GUI.parse(f[2],false);GUI.shadowCopyStep="";k=new JXG.Coords(JXG.COORDS_BY_USER,[GUI.board.objects[a.src_ids[0]].coords.usrCoords[1]-n[0],GUI.board.objects[a.src_ids[0]].coords.usrCoords[2]-n[1]],GUI.board);c=JXG.Draw.findHittedObjs(k.scrCoords[1],k.scrCoords[2],GUI.board,JXG.Options.sensitive_area,[JXG.OBJECT_CLASS_POINT,JXG.OBJECT_CLASS_CIRCLE,JXG.OBJECT_CLASS_LINE],[]);a.args.x=n[0];a.args.y=n[1];if(c.length>0){a.args.migrate=-1;for(d=0;d<c.length;d++){if(c[d].elementClass==JXG.OBJECT_CLASS_POINT){if(c[d].type!=JXG.OBJECT_TYPE_INTERSECTION||c[d].type!=JXG.OBJECT_TYPE_GLIDER){b.push(c[d])}c[d]=c[c.length-1];c.length--;if(d>0){d--}}}if(c.length==0&&b.length==1){a.args.migrate=b[0].id}else{if(b.length>=1){if(b.length==1&&$("#ctx_objects").hasClass("not-displayed")){a.args.migrate=b[0].id}else{GUI.createSelectDialog(b,(function(i){JXG.Draw.recordStepMeta({type:JXG.GENTYPE_MIGRATE,src_ids:[a.dest_sub_ids[0]],dest_sub_ids:[],dest_id:i},true);GUI.removeActionEvent(true);GUI.selection=[];GUI.delight();GUI.removeToolEvents(true)}),GUI.ctxPosProps,true);GUI.selection=[]}}else{if(c.length>0){var j,h=JXG.Draw.drawPoint(GUI.board,[k],c,a.dest_sub_ids[0]);a.args.migrate=h.dest_id;j={type:JXG.GENTYPE_COMBINED,args:{steps:[JXG.deepCopy(h),JXG.deepCopy(a)]}};a=j}}}}else{a.args.migrate=0}if(a.args.migrate==-1){GUI.ctx_curr_coords=null;m=false}GUI.recordStep(a,true);GUI.removeToolEvent(GUI.move_event);GUI.removeActionEvent(m);GUI.resetBoard()},createSelectDialog:function(f,c,g,a,d){var b=GUI.createSelectHTML(f);if(d){GUI.addToolEvent(GUI.down_event,console.log)}GUI.showPanel(false,0);GUI.showPanelHTML(b,g,a);GUI.registerSelectHandlers(f,(function(h){c(h)}))},createSelectHTML:function(d){var b=0,c,a="";for(c in d){if(d.hasOwnProperty(c)){a+='<a href="#" tabindex="'+b+'" id="sel_'+d[c].id+'" class="proplight">';a+=GUI.resolveObjectType(d[c]);if(d[c].visProp.withlabel&&d[c].label.content.visProp.visible){a+=" "+d[c].name}a+="</a>";b++}}return a},touchDialogHandler:function(b){var a;for(a=0;a<GUI.select_obj.length;a++){if(GUI.isTouchInElementsBounds(b,"sel_"+GUI.select_obj[a])){if(GUI.select_obj[a]!=GUI.int_click){if(GUI.int_click!=-1){$("#sel_"+GUI.int_click).removeClass("proplight_active");GUI.delight(GUI.int_click)}GUI.int_click=GUI.select_obj[a];$("#sel_"+GUI.int_click).addClass("proplight_active");GUI.highlight(GUI.int_click,false)}break}else{$("#sel_"+GUI.select_obj[a]).removeClass("proplight_active")}}if(b&&b.preventDefault){b.preventDefault()}else{window.event.returnValue=false}},registerSelectHandlers:function(d,b){var a,c;GUI.int_click=-1;GUI.select_obj=[];for(a=0;a<d.length;a++){GUI.select_obj.push(d[a].id)}if(JXG.isTouchDevice()){JXG.addEvent(GUI.getId("ctx_panel"),"touchstart",GUI.touchDialogHandler,GUI);JXG.addEvent(GUI.getId("ctx_panel"),"touchmove",GUI.touchDialogHandler,GUI);JXG.addEvent(GUI.getId("ctx_panel"),"touchend",function(){$("#ctx_panel").unbind();b(GUI.int_click)},GUI)}else{for(a=0;a<GUI.select_obj.length;a++){c=$("#sel_"+GUI.select_obj[a]);c.bind(GUI.out_event,function(){if(GUI.int_click!=-1){$("#sel_"+GUI.int_click).removeClass("proplight_active");GUI.delight(GUI.int_click);GUI.int_click=-1}});c.bind(GUI.over_event,function(f){GUI.int_click=GUI.select_obj[$("#"+f.currentTarget.id).attr("tabindex")];$("#sel_"+GUI.int_click).addClass("proplight_active");GUI.highlight(GUI.int_click,false)});c.bind(GUI.click_event,function(g){var h=GUI.select_obj[$("#"+g.currentTarget.id).attr("tabindex")];for(var f=0;f<GUI.select_obj.length;f++){$("#sel_"+GUI.select_obj[f]).unbind()}$("#sel_"+h).removeClass("proplight_active");b(h)})}}},addHideEvt:function(a){GUI.showPanel(false,0);GUI.selection=[];GUI.select("","act_object",false,{scrCoords:[1,a[0],a[1]]});if(GUI.selection.length==1){GUI.hideObjId(GUI.selection[0].id,false)}else{if(GUI.selection.length>2){GUI.createSelectDialog(GUI.selection,(function(b){GUI.hideObjId(b);GUI.delight();GUI.addHideEvt([a[0],a[1]])}),GUI.ctxPosHide)}else{if(GUI.selection.length==2){GUI.createSelectDialog(GUI.selection,(function(b){GUI.hideObjId(b);GUI.delight();GUI.showPanel(false,0)}),GUI.ctxPosHide)}}}GUI.selection=[]},addDelEvt:function(a){GUI.showPanel(false,0);GUI.selection=[];GUI.select("","act_object",true,{scrCoords:[1,a[0],a[1]]});if(GUI.selection.length==1){GUI.removeObjId(GUI.selection[0].id)}else{if(GUI.selection.length>2){GUI.createSelectDialog(GUI.selection,(function(b){GUI.removeObjId(b);GUI.delight();GUI.addDelEvt([a[0],a[1]])}),GUI.ctxPosDelete)}else{if(GUI.selection.length==2){GUI.createSelectDialog(GUI.selection,(function(b){GUI.removeObjId(b);GUI.delight();GUI.showPanel(false,0)}),GUI.ctxPosDelete)}}}GUI.selection=[];if(GUI.getLastConstructedObject()==0){GUI.removeActionEvent(true);$("#control-actions").removeClass("button-selected")}},addAblateEvt:function(f,c){GUI.selection=[];GUI.select(f,"ablatePoint",false,c);if(GUI.selection.length>0){var a=GUI.selection[0];GUI.selection=[];if(a.type==JXG.OBJECT_TYPE_GLIDER){a.visProp.snaptogrid=JXG.Options.elements.snapToGrid;GUI.context_set_type(a.id,JXG.OBJECT_TYPE_POINT);GUI.ctx_down_coords=null;GUI.removeActionEvent(true);GUI.showBoardText(GUI.Lang.std.freeGlider,1500);if(JXG.isTouchDevice()){GUI.board.touchStartListener(f,GUI.board.objects[a.id])}else{GUI.board.mouseDownListener(f,GUI.board.objects[a.id])}}else{if(a.type==JXG.OBJECT_TYPE_POINT){a.visProp.snaptogrid=false;GUI.context_set_type(a.id,JXG.OBJECT_TYPE_GLIDER);GUI.ctx_down_coords=null}}}else{GUI.select(f,"circleorline",false,c);if(GUI.selection.length>0){a=GUI.selection[0];if(a.elementClass==JXG.OBJECT_CLASS_CIRCLE){if(a.point2!=null){GUI.selection=[a.midpoint,a.point2]}else{GUI.selection=[a.midpoint]}GUI.selection.push(a.id)}else{if(a.elementClass==JXG.OBJECT_CLASS_LINE){if(a.point1.visProp.visible&&a.point2.visProp.visible){GUI.selection=[a.point1,a.point2];GUI.selection.push(a.id)}else{var d,b,g=[];if(a.point1.visProp.visible){g.push(a.point1)}if(a.point2.visProp.visible){g.push(a.point2)}for(b in a.descendants){d=a.descendants[b];if(d.elementClass==JXG.OBJECT_CLASS_POINT&&d.visProp.visible){g.push(d)}}if(g.length>=2){GUI.selection=[g[0],g[1]];GUI.selection.push(a.id)}else{GUI.selection=[]}}}else{GUI.selection=[]}}if(GUI.selection.length===0){GUI.delight();GUI.removeActionEvent(true);GUI.board.downObjects=[a];GUI.board.mode=GUI.board.BOARD_MODE_DRAG;a.highlight(true)}else{GUI.fixAblation(f,c)}}}},addGlideInterEvt:function(g,h){var b,a,f,d=[],c={};GUI.removeToolEvent(GUI.up_event);f=JXG.Draw.findHittedObjs(GUI.board.objects[h].coords.scrCoords[1],GUI.board.objects[h].coords.scrCoords[2],GUI.board,JXG.Options.sensitive_area,[JXG.OBJECT_CLASS_POINT,JXG.OBJECT_CLASS_LINE,JXG.OBJECT_CLASS_CIRCLE,JXG.OBJECT_CLASS_CURVE],[JXG.OBJECT_TYPE_POINT]);for(b=0;b<f.length;b++){if(!GUI.collectionContains(GUI.board.objects[h].descendants,f[b])&&f[b].id!=h){d.push(f[b])}}f=d;$("#ctx_objects").addClass("not-displayed");$("#ctx_objects_extra").addClass("not-displayed");if(f.length===0){GUI.removeGlideInterEvt(h);return}if(f.length>1){GUI.removeToolEvent(GUI.move_event);a=JXG.Draw.drawPoint(GUI.board,[GUI.board.objects[h].coords],f,h,true);if(a!=-1){if(GUI.board.objects[a].type==JXG.OBJECT_TYPE_GLIDER){c={type:JXG.GENTYPE_MIGRATE,args:{migrateToGlider:true,usrCoords:JXG.deepCopy(GUI.ctx_curr_coords.usrCoords),orig_name:GUI.board.objects[h].name,fillColor:JXG.Options.glider.fillColor,strokeColor:JXG.Options.glider.strokeColor},src_ids:[h],dest_sub_ids:[],dest_id:a};JXG.Draw.recordStepMeta(c,true)}else{if(GUI.board.objects[a].elementClass==JXG.OBJECT_CLASS_POINT){}}GUI.removeActionEvent(true)}}else{GUI.selection.push(f[0]);GUI.removeGlideInterEvt(h)}GUI.deleteDraftcurves()},removeGlideInterEvt:function(b){if(GUI.selection.length!==0){var a=GUI.selection[0];GUI.removeActionEvent(true);if(!GUI.collectionContains(GUI.board.objects[b].descendants,a)&&b!=a.id){GUI.context_set_type(b,JXG.OBJECT_TYPE_GLIDER,a.id);if(GUI.contextShowsProps()!=0){GUI.addToolEvent(GUI.down_event,GUI.callOnClick,GUI.contextMenu);GUI.contextEdit(b)}}}else{GUI.removeActionEvent(true);GUI.resetBoard()}},removeActionEvent:function(b){var a;GUI.removeToolEvents(b);$("#control-tools-box").removeClass("hidden");$("#caption-actions").addClass("not-displayed");$("#caption-transform").addClass("not-displayed");$('[id^="control-actions-"]').removeClass("button-selected");GUI.mirrorCenterId=0;if(GUI.showHidden){GUI.showHiddenObjects()}GUI.delight();if(GUI.shadowCopyStep!==""){if(GUI.shadowCopyStep.type>50){a=GUI.generateJCode(GUI.shadowCopyStep,GUI.board)}else{a=JXG.SketchReader.generateJCode(GUI.shadowCopyStep,GUI.board,GUI.step_log)}GUI.parse(a[2],false);GUI.shadowCopyStep=""}GUI.selection=[];$("#control-actions").css("background-position","-221px -62px");if(b){GUI.action="standard"}}});GUI.ContextSave={color:{}};JXG.extend(GUI,{setCtxColor:function(b,a,c){var d=$("#color-field");if(b.length>7){b=JXG.rgba2rgbo(b)[0]}if(!$("#color-tab-"+c).hasClass("button-disabled")){d.css("color",GUI.getBestSwContrast(b));d.css("background-color",b);if(c=="fill"){d.val(a.toFixed(0))}}},contextTextboxInit:function(){$("#input-text").bind(GUI.click_event,function(){$("#ctx_textbox").removeClass("not-displayed");$("#input-textbox").val($("#input-text").val());$("#input-text").bind(GUI.click_event,function(){$("#input-text").val($("#input-textbox").val());$("#ctx_textbox").addClass("not-displayed");GUI.contextTextboxInit()})})},contextEdit:function(b){var n,g,m,l,i,d,a,h,j=GUI.Settings.get("layouttop");$(".property").removeClass("not-displayed");$("#tooltips-point").addClass("not-displayed");$("#tooltips-line").addClass("not-displayed");$("#tooltips-angle").addClass("not-displayed");$("#tooltips-circle").addClass("not-displayed");$("#plot_panel").addClass("not-displayed");if(b===0){GUI.showPanelHTML("sketchometry.com",GUI.ctxPosProps,false);return}$("#id").val(b);GUI.ContextSave.radius=GUI.ContextSave.Xjc=GUI.ContextSave.Yjc=0;if(j=="Bottom"){window.setTimeout(function(){GUI.repositionCtxPanel()},5)}GUI.deleteDraftcurves();GUI.highlight(b);h=GUI.board.objects[b];if(h.elementClass!=JXG.OBJECT_CLASS_LINE&&h.elementClass!=JXG.OBJECT_CLASS_OTHER){$(".fillObjects").removeClass("not-displayed")}else{$(".fillObjects").addClass("not-displayed")}if(h.getAttribute("withLabel")){$(".labeledObjects").removeClass("not-displayed")}else{$(".labeledObjects").addClass("not-displayed")}if(h.type==JXG.OBJECT_TYPE_POINT||h.type==JXG.OBJECT_TYPE_GLIDER){$("#point-glider").removeClass("not-displayed")}else{$("#point-glider").addClass("not-displayed")}if(h.elementClass==JXG.OBJECT_CLASS_POINT){$("#tooltips-point").removeClass("not-displayed");$("#property-point").removeClass("not-displayed")}else{$("#property-point").addClass("not-displayed")}if((h.type==JXG.OBJECT_TYPE_POINT||h.type==JXG.OBJECT_TYPE_GLIDER)||(h.elementClass!=JXG.OBJECT_CLASS_POINT&&h.type!=JXG.OBJECT_TYPE_CURVE&&h.type!=JXG.OBJECT_TYPE_ANGLE&&h.type!=JXG.OBJECT_TYPE_SECTOR)){$("#status-fix-box").removeClass("button-disabled")}else{$("#status-fix-box").addClass("button-disabled")}if(h.type!=JXG.OBJECT_TYPE_CURVE&&h.type!=JXG.OBJECT_TYPE_TEXT){$("#status-trace-box").removeClass("button-disabled")}else{$("#status-trace-box").addClass("button-disabled")}if(h.elementClass==JXG.OBJECT_CLASS_LINE){$("#tooltips-line").removeClass("not-displayed");$("#property-line").removeClass("not-displayed");if(h.point1.getAttribute("visible")&&h.point2.getAttribute("visible")){$("#line-related").removeClass("not-displayed")}else{$("#line-related").addClass("not-displayed")}}else{$("#property-line").addClass("not-displayed")}if(h.elementClass==JXG.OBJECT_CLASS_CIRCLE){$("#tooltips-circle").removeClass("not-displayed");$("#property-circle").removeClass("not-displayed")}else{$("#property-circle").addClass("not-displayed")}if(h.type==JXG.OBJECT_TYPE_ANGLE||h.type==JXG.OBJECT_TYPE_SECTOR){$("#tooltips-angle").removeClass("not-displayed");$("#property-angle").removeClass("not-displayed");$("#angle-related").removeClass("not-displayed");if(h.type==JXG.OBJECT_TYPE_SECTOR){$("#angle-specific").addClass("not-displayed");$("#tooltips-angle-related").addClass("not-displayed");$("#tooltips-sector-related").removeClass("not-displayed")}else{$("#angle-specific").removeClass("not-displayed");$("#tooltips-angle-related").removeClass("not-displayed");$("#tooltips-sector-related").addClass("not-displayed")}}else{$("#property-angle").addClass("not-displayed")}if(h.type==JXG.OBJECT_TYPE_ANGLE){$("#angle-specfic").removeClass("not-displayed")}else{$("#angle-specfic").addClass("not-displayed")}if(j=="Bottom"){GUI.repositionCtxPanel()}if(h.type==JXG.OBJECT_TYPE_ANGLE){GUI.ContextSave.angleRadius=h.getAttribute("radius")}if(h.type==JXG.OBJECT_TYPE_TEXT){if(h.X&&typeof h.X.origin=="function"){GUI.ContextSave.Xjc=h.X.toString().sanitize()}else{GUI.ContextSave.Xjc=h.coords.usrCoords[1].toFixed(GUI.precision).trimTrailZeroes()}if(h.Y&&typeof h.Y.origin=="function"){GUI.ContextSave.Yjc=h.Y.toString().sanitize()}else{GUI.ContextSave.Yjc=h.coords.usrCoords[2].toFixed(GUI.precision).trimTrailZeroes()}}else{if(h.elementClass==JXG.OBJECT_CLASS_POINT){if(h.XEval&&typeof h.XEval.origin=="function"){GUI.ContextSave.Xjc=h.XEval.toString().sanitize()}else{GUI.ContextSave.Xjc=h.coords.usrCoords[1].toFixed(GUI.precision).trimTrailZeroes()}if(h.YEval&&typeof h.YEval.origin=="function"){GUI.ContextSave.Yjc=h.YEval.toString().sanitize()}else{GUI.ContextSave.Yjc=h.coords.usrCoords[2].toFixed(GUI.precision).trimTrailZeroes()}}else{if(h.type==JXG.OBJECT_TYPE_CIRCLE){if(JXG.exists(h.point2)){GUI.ContextSave.point2={usrCoords:h.point2.coords.usrCoords};$("#circle-radius").addClass("not-displayed")}else{$("#circle-radius").removeClass("not-displayed");if(h.updateRadius&&h.updateRadius.toString().sanitize()!="function () { return term; }"){GUI.ContextSave.radius=h.updateRadius.toString().sanitize()}else{GUI.ContextSave.radius=h.radius;GUI.getId("circle-radius-field").disabled=""}}}}}if(h.elementClass==JXG.OBJECT_CLASS_POINT){if(h.type==JXG.OBJECT_TYPE_INTERSECTION){$("#point-coord-x-field").disabled="disabled";$("#point-coord-x-field").addClass("button-disabled");$("#point-coord-y-field").disabled="disabled";$("#point-coord-y-field").addClass("button-disabled")}else{$("#point-coord-x-field").disabled="";$("#point-coord-x-field").removeClass("button-disabled");$("#point-coord-y-field").disabled="";$("#point-coord-y-field").removeClass("button-disabled")}}GUI.ContextSave.fillOpacity=h.getAttribute("fillOpacity");GUI.ContextSave.size=h.getAttribute("size");GUI.ContextSave.face=h.getAttribute("face");GUI.ContextSave.type=h.type;if(h.slideObject){GUI.ContextSave.slideObjectId=h.slideObject.id}if(GUI.showHidden){if(h.elementClass==JXG.OBJECT_CLASS_CIRCLE){GUI.ContextSave.ccvisible=h.midpoint.guiVisProp.visible}if(!h.guiVisProp){h.guiVisProp={visible:h.getAttribute("visible")}}GUI.ContextSave.visible=h.guiVisProp.visible;if(!h.guiVisProp){h.guiVisProp={strokewidth:h.getAttribute("strokewidth")}}GUI.ContextSave.strokewidth=h.guiVisProp.strokewidth}else{if(h.elementClass==JXG.OBJECT_CLASS_CIRCLE){GUI.ContextSave.ccvisible=h.midpoint.getAttribute("visible")}GUI.ContextSave.visible=h.getAttribute("visible")}GUI.ContextSave.withLabel=h.getAttribute("withLabel");if(h.elementClass==JXG.OBJECT_CLASS_POINT){switch(JXG.normalizePointFace(GUI.ContextSave.face)){case"o":$("#point-style-button-circle").addClass("button-selected");break;case"[]":$("#point-style-button-square").addClass("button-selected");break;case"x":$("#point-style-button-cross").addClass("button-selected");break;case"+":$("#point-style-button-plus").addClass("button-selected");break;default:}}if(h.type==JXG.OBJECT_TYPE_POINT){$("#point-glider-button-free").addClass("button-selected")}if(h.type==JXG.OBJECT_TYPE_GLIDER){$("#point-glider-button-glider").addClass("button-selected")}if(h.type==JXG.OBJECT_TYPE_TEXT){if(h.visProp.castext&&h.htmlStr!=h.visProp.castext){GUI.ContextSave.text=h.visProp.castext.toString().sanitize()}else{GUI.ContextSave.text=h.htmlStr}GUI.ContextSave.text=GUI.ContextSave.text.toString().cleanTerm();$("#input-text").val(GUI.ContextSave.text);$("#input-text").keyup(function(p){if(p.keyCode>=35&&p.keyCode<=40){return}$("#input-textbox").val($("#input-text").val());GUI.context_set_text(b)});$("#input-textbox").keyup(function(p){if(p.keyCode>=35&&p.keyCode<=40){return}$("#input-text").val($("#input-textbox").val());GUI.context_set_text(b)})}else{GUI.ContextSave.labelName=h.name;$("#input-text").val(GUI.ContextSave.labelName.replace(/"/,"&quot;"));$("#input-text").keyup(function(p){if(p.keyCode>=35&&p.keyCode<=40){return}$("#input-textbox").val($("#input-text").val());GUI.context_set_label(b)});$("#input-textbox").keyup(function(p){if(p.keyCode>=35&&p.keyCode<=40){return}$("#input-text").val($("#input-textbox").val());GUI.context_set_label(b)})}if(GUI.ContextSave.visible){if(h.type==JXG.OBJECT_TYPE_TEXT){$("#input-text").removeClass("button-disabled");$("#label-visible").addClass("button-selected")}}else{if(h.type==JXG.OBJECT_TYPE_TEXT){$("#input-text").addClass("button-disabled");$("#label-visible").removeClass("button-selected")}}if(GUI.ContextSave.withLabel){if(h.type!=JXG.OBJECT_TYPE_TEXT){$("#input-text").removeClass("button-disabled");$("#label-visible").addClass("button-selected")}}else{if(h.type!=JXG.OBJECT_TYPE_TEXT){$("#label-visible").removeClass("button-selected");$("#input-text").addClass("button-disabled")}}GUI.contextTextboxInit();$("#point-size-field").val(GUI.ContextSave.size);GUI.ContextSave.Xjc=GUI.ContextSave.Xjc.toString().cleanTerm();GUI.ContextSave.Yjc=GUI.ContextSave.Yjc.toString().cleanTerm();$("#point-coord-x-field").val(GUI.ContextSave.Xjc);$("#point-coord-y-field").val(GUI.ContextSave.Yjc);GUI.ContextSave.radius=GUI.ContextSave.radius.toString().cleanTerm();if(GUI.ContextSave.radius==parseFloat(GUI.ContextSave.radius)){$("#circle-radius-field").val(parseFloat(GUI.ContextSave.radius).toFixed(GUI.precision).trimTrailZeroes())}else{$("#circle-radius-field").val(GUI.ContextSave.radius)}if(GUI.ContextSave.angleRadius==parseFloat(GUI.ContextSave.angleRadius)){$("#angle-radius-field").val(parseFloat(GUI.ContextSave.angleRadius).toFixed(GUI.precision.trimTrailZeroes()))}else{$("#angle-radius-field").val(GUI.ContextSave.angleRadius)}if(h.type==JXG.OBJECT_TYPE_TEXT){GUI.ContextSave.strokeWidth=parseInt($("#"+h.rendNode.id).css("font-size"))}else{GUI.ContextSave.strokeWidth=h.getAttribute("strokeWidth")}$("#color-field").val((GUI.ContextSave.strokeWidth));if(h.getAttribute("fixed")){$("#status-fix").addClass("button-selected");$("#status-fix-box").addClass("button-selected")}else{$("#status-fix").removeClass("button-selected");$("#status-fix-box").removeClass("button-selected")}if(h.getAttribute("trace")){$("#status-trace").addClass("button-selected");$("#status-trace-box").addClass("button-selected")}else{$("#status-trace").removeClass("button-selected");$("#status-trace-box").removeClass("button-selected")}if(h.label&&h.label.content){GUI.ContextSave.labelSize=parseInt($("#"+h.label.content.rendNode.id).css("font-size"));GUI.ContextSave.color.labelstroke=JXG.rgbo2rgba(h.label.content.getAttribute("strokeColor"),h.label.content.getAttribute("strokeOpacity")).toLowerCase()}else{GUI.ContextSave.labelSize=12;GUI.ContextSave.color.labelstroke=GUI.board.options.text.strokeColor}if(GUI.ContextSave.color.labelstroke=="none"){GUI.ContextSave.color.labelstroke="transparent"}else{g=JXG.rgba2rgbo(GUI.ContextSave.color.labelstroke);m=GUI.bestColorDivIndex(g[0]);l=$('[class*="color-palette"]').eq(m).css("background-color");GUI.ContextSave.color.labelstroke=JXG.rgbo2rgba((g[0]=JXG.rgb2hex(l)),g[1])}GUI.ContextSave.color.fill=JXG.rgbo2rgba(h.getAttribute("fillColor"),GUI.ContextSave.fillOpacity);if(GUI.ContextSave.color.fill=="none"){GUI.ContextSave.color.fill="transparent"}else{g=JXG.rgba2rgbo(GUI.ContextSave.color.fill);m=GUI.bestColorDivIndex(g[0]);l=$('[class*="color-palette"]').eq(m).css("background-color");GUI.ContextSave.color.fill=JXG.rgbo2rgba(JXG.rgb2hex(l),g[1])}GUI.ContextSave.color.highlightstroke=JXG.rgbo2rgba(h.getAttribute("highlightstrokeColor"),h.getAttribute("highlightstrokeOpacity")).toLowerCase();if(GUI.ContextSave.color.highlightstroke=="none"){GUI.ContextSave.color.highlightstroke="transparent"}else{g=JXG.rgba2rgbo(GUI.ContextSave.color.highlightstroke);m=GUI.bestColorDivIndex(g[0]);l=$('[class*="color-palette"]').eq(m).css("background-color");GUI.ContextSave.color.highlightstroke=JXG.rgbo2rgba(JXG.rgb2hex(l),g[1])}GUI.ContextSave.color.highlightfill=JXG.rgbo2rgba(h.getAttribute("highlightfillColor"),h.getAttribute("highlightfillOpacity")).toLowerCase();if(GUI.ContextSave.color.highlightfill=="none"){GUI.ContextSave.color.highlightfill="transparent"}else{g=JXG.rgba2rgbo(GUI.ContextSave.color.highlightfill);m=GUI.bestColorDivIndex(g[0]);l=$('[class*="color-palette"]').eq(m).css("background-color");GUI.ContextSave.color.highlightfill=JXG.rgbo2rgba(JXG.rgb2hex(l),g[1])}GUI.ContextSave.color.stroke=JXG.rgbo2rgba(h.getAttribute("strokeColor"),h.getAttribute("strokeOpacity")).toLowerCase();if(GUI.ContextSave.color.stroke=="none"){GUI.ContextSave.color.stroke="transparent"}else{g=JXG.rgba2rgbo(GUI.ContextSave.color.stroke);m=GUI.bestColorDivIndex(g[0]);l=$('[class*="color-palette"]').eq(m).css("background-color");GUI.ContextSave.color.stroke=JXG.rgbo2rgba(JXG.rgb2hex(l),g[1])}if(h.type==JXG.OBJECT_TYPE_LINE){if(GUI.ContextSave.straightfirst=h.getAttribute("straightfirst")){$("#line-button-first").addClass("button-selected")}else{$("#line-button-first").removeClass("button-selected")}if(GUI.ContextSave.straightlast=h.getAttribute("straightlast")){$("#line-button-last").addClass("button-selected")}else{$("#line-button-last").removeClass("button-selected")}if(GUI.ContextSave.arrowfirst=h.getAttribute("firstarrow")){$("#line-button-arrow-first").addClass("button-selected")}else{$("#line-button-arrow-first").removeClass("button-selected")}if(GUI.ContextSave.arrowlast=h.getAttribute("lastarrow")){$("#line-button-arrow-last").addClass("button-selected")}else{$("#line-button-arrow-last").removeClass("button-selected")}if(h.point1.visProp.priv){$("#line-button-first").addClass("button-disabled");$("#line-button-arrow-first").addClass("button-disabled")}else{$("#line-button-first").removeClass("button-disabled");$("#line-button-arrow-first").removeClass("button-disabled")}if(h.point2.visProp.priv){$("#line-button-last").addClass("button-disabled");$("#line-button-arrow-last").addClass("button-disabled")}else{$("#line-button-last").removeClass("button-disabled");$("#line-button-arrow-last").removeClass("button-disabled")}}$("#label-visible").bind(GUI.click_event,function(){if(h.type==JXG.OBJECT_TYPE_TEXT){GUI.context_set_visibility(b)}else{if(GUI.board.objects[b].visProp.visible===false){return}GUI.context_set_withLabel(b)}});$('[id^="color-tab"]');$('[id^="color-tab"]').bind(GUI.click_event,function(){var p="";$('[id^="color-tab"]').addClass("button-disabled");$('[id^="color-tab"]').removeClass("button-selected");$(this).removeClass("button-disabled");$(this).addClass("button-selected");if($(this).attr("id").indexOf("fill")!=-1){$("#color-field-label").css("background-position","-362px -404px");g=JXG.rgba2rgbo(GUI.ContextSave.color.fill);n=100*GUI.ContextSave.fillOpacity;p="fill"}else{if($(this).attr("id").indexOf("label")!=-1){$("#color-field-label").css("background-position","-442px -404px");g=JXG.rgba2rgbo(GUI.ContextSave.color.labelstroke);n=GUI.ContextSave.labelSize;p="label"}else{if($(this).attr("id").indexOf("stroke")!=-1){$("#color-field-label").css("background-position","-280px -482px");g=JXG.rgba2rgbo(GUI.ContextSave.color.stroke);n=GUI.ContextSave.strokeWidth;p="stroke"}}}if(p!==""){GUI.setCtxColor(JXG.hex2rgb(g[0]),g[1],p)}$("#color-field").val(n.toFixed(0))});$("#color-tab-stroke").trigger(GUI.click_event);$('[class*="color-palette-c"]');$('[class*="color-palette-c"]').bind(GUI.click_event,function(){if($(this).attr("id")=="color-palette-none"){i="transparent"}else{i=$(this).css("background-color");if(i.length>7){i=JXG.rgba2rgbo(i)[0]}}$("#color-field").css("background-color",i);GUI.context_set_color(b)});$('[id^="status-"]');$('[id^="status-"]').bind("click",function(){if($(this).attr("id").indexOf("box")==-1){return}if($(this).attr("id").indexOf("fix")!=-1){if((h.elementClass!=JXG.OBJECT_CLASS_POINT&&h.type!=JXG.OBJECT_TYPE_CURVE&&h.type!=JXG.OBJECT_TYPE_ANGLE&&h.type!=JXG.OBJECT_TYPE_SECTOR)||(h.type==JXG.OBJECT_TYPE_POINT||h.type==JXG.OBJECT_TYPE_GLIDER)){GUI.context_set_fixed(b)}}else{if($(this).attr("id").indexOf("trace")!=-1){if(h.type!=JXG.OBJECT_TYPE_CURVE&&h.type!=JXG.OBJECT_TYPE_TEXT){GUI.context_set_trace(b)}}}});var c=function(p){if(p){d=parseInt($("#color-field").val())+GUI.incrementValue}else{d=parseInt($("#color-field").val())+1}$("#color-field").val(d);if(!$("#color-tab-stroke").hasClass("button-disabled")){if(h.type==JXG.OBJECT_TYPE_TEXT){GUI.context_set_labelSize(b)}else{GUI.context_set_strokeWidth(b)}}else{if(!$("#color-tab-fill").hasClass("button-disabled")){GUI.context_set_fillOpacity(b)}else{GUI.context_set_labelSize(b)}}};var f=function(p){if(p){d=parseInt($("#color-field").val())-GUI.incrementValue}else{d=parseInt($("#color-field").val())-1}$("#color-field").val(d);if(!$("#color-tab-stroke").hasClass("button-disabled")){if(h.type==JXG.OBJECT_TYPE_TEXT){GUI.context_set_labelSize(b)}else{GUI.context_set_strokeWidth(b)}}else{if(!$("#color-tab-fill").hasClass("button-disabled")){GUI.context_set_fillOpacity(b)}else{GUI.context_set_labelSize(b)}}};$("#color-field-plus").on(GUI.down_event,function(){GUI.incrementValue=10;c(false);GUI.intervalTimer=window.setInterval(function(){c(true);GUI.incrementValue*=2},500)});$("#color-field-plus").on(GUI.up_event,function(){window.clearInterval(GUI.intervalTimer)});$("#color-field-minus").on(GUI.down_event,function(){GUI.incrementValue=10;f(false);GUI.intervalTimer=window.setInterval(function(){f(true);GUI.incrementValue*=2},500)});$("#color-field-minus").on(GUI.up_event,function(){window.clearInterval(GUI.intervalTimer)});$("#color-field").keyup(function(p){if(p.keyCode>=35&&p.keyCode<=40){return}if(!$("#color-tab-stroke").hasClass("button-disabled")){GUI.context_set_strokeWidth(b)}else{if(!$("#color-tab-fill").hasClass("button-disabled")){GUI.context_set_fillOpacity(b)}else{GUI.context_set_labelSize(b)}}});var k=function(p){if(p){d=parseInt($("#point-size-field").val())-GUI.incrementValue}else{d=parseInt($("#point-size-field").val())-1}$("#point-size-field").val(d);GUI.context_set_size(b)};var o=function(p){if(p){d=parseInt($("#point-size-field").val())+GUI.incrementValue}else{d=parseInt($("#point-size-field").val())+1}$("#point-size-field").val(d);GUI.context_set_size(b)};$("#point-size-minus").on(GUI.down_event,function(){GUI.incrementValue=10;k(false);GUI.intervalTimer=window.setInterval(function(){k(true);GUI.incrementValue*=2},500)});$("#point-size-minus").on(GUI.up_event,function(){window.clearInterval(GUI.intervalTimer)});$("#point-size-plus").on(GUI.down_event,function(){GUI.incrementValue=10;o(false);GUI.intervalTimer=window.setInterval(function(){o(true);GUI.incrementValue*=2},500)});$("#point-size-plus").on(GUI.up_event,function(){window.clearInterval(GUI.intervalTimer)});$("#point-size-field").keyup(function(p){if(p.keyCode>=35&&p.keyCode<=40){return}GUI.context_set_size(b)});$("#point-style-button-circle").bind(GUI.click_event,function(){$("#point-style-button-circle").addClass("button-selected");$("#point-style-button-square").removeClass("button-selected");$("#point-style-button-cross").removeClass("button-selected");$("#point-style-button-plus").removeClass("button-selected");GUI.context_set_face(b)});$("#point-style-button-square").bind(GUI.click_event,function(){$("#point-style-button-circle").removeClass("button-selected");$("#point-style-button-square").addClass("button-selected");$("#point-style-button-cross").removeClass("button-selected");$("#point-style-button-plus").removeClass("button-selected");GUI.context_set_face(b)});$("#point-style-button-cross").bind(GUI.click_event,function(){$("#point-style-button-circle").removeClass("button-selected");$("#point-style-button-square").removeClass("button-selected");$("#point-style-button-cross").addClass("button-selected");$("#point-style-button-plus").removeClass("button-selected");GUI.context_set_face(b)});$("#point-style-button-plus").bind(GUI.click_event,function(){$("#point-style-button-circle").removeClass("button-selected");$("#point-style-button-square").removeClass("button-selected");$("#point-style-button-cross").removeClass("button-selected");$("#point-style-button-plus").addClass("button-selected");GUI.context_set_face(b)});$("#point-coord-x-field").keyup(function(p){if(p.keyCode>=35&&p.keyCode<=40){return}GUI.context_set_xcoord(b);GUI.delight();GUI.highlight(b)});$("#point-coord-y-field").keyup(function(p){if(p.keyCode>=35&&p.keyCode<=40){return}GUI.context_set_ycoord(b);GUI.delight();GUI.highlight(b)});$("#line-related-measure-box").addClass("not-displayed");$("#angle-related-measure-box").addClass("not-displayed");$("#sector-related-measure-box").addClass("not-displayed");if(h.type==JXG.OBJECT_TYPE_TEXT){GUI.removeMeasureEvt();$("#measure-box").bind(GUI.click_event,function(){GUI.measure()});$("#measure-box").removeClass("not-displayed");$("#measure-specific").removeClass("not-displayed")}else{$("#measure-box").addClass("not-displayed");$("#measure-specific").addClass("not-displayed")}if(h.elementClass==JXG.OBJECT_CLASS_LINE){$("#line-related-measure-box").removeClass("not-displayed");if(h.point1.visProp.priv||h.point2.visProp.priv){$("#measure-specific").addClass("not-displayed")}else{$("#measure-specific").removeClass("not-displayed")}if(h.point1){if((GUI.showHidden&&h.point1.guiVisProp&&h.point1.guiVisProp.visible)||(!GUI.showHidden&&h.point1.getAttribute("visible"))){$("#line-button-first").bind(GUI.click_event,function(){if($("#line-button-first").hasClass("button-selected")){$("#line-button-first").removeClass("button-selected")}else{$("#line-button-first").addClass("button-selected")}GUI.context_set_straightfirst(b)});$("#line-button-arrow-first").bind(GUI.click_event,function(){if($("#line-button-arrow-first").hasClass("button-selected")){$("#line-button-arrow-first").removeClass("button-selected")}else{$("#line-button-arrow-first").addClass("button-selected")}GUI.context_set_arrowfirst(b)})}}if(h.point2){if((GUI.showHidden&&h.point2.guiVisProp&&h.point2.guiVisProp.visible)||(!GUI.showHidden&&h.point2.getAttribute("visible"))){$("#line-button-last").bind(GUI.click_event,function(){if($("#line-button-last").hasClass("button-selected")){$("#line-button-last").removeClass("button-selected")}else{$("#line-button-last").addClass("button-selected")}GUI.context_set_straightlast(b)});$("#line-button-arrow-last").bind(GUI.click_event,function(){if($("#line-button-arrow-last").hasClass("button-selected")){$("#line-button-arrow-last").removeClass("button-selected")}else{$("#line-button-arrow-last").addClass("button-selected")}GUI.context_set_arrowlast(b)})}}if(h.point1&&h.point2){$("#line-related-measure-box").bind(GUI.click_event,function(){GUI.ctx_measureDistance(b)})}}else{if(h.type==JXG.OBJECT_TYPE_ANGLE){$("#angle-related-measure-box").removeClass("not-displayed");$("#measure-specific").removeClass("not-displayed");$("#angle-related-measure-box").bind(GUI.click_event,function(){GUI.ctx_measureAngle(b)});$("#angle-radius-field").keyup(function(p){if(p.keyCode>=35&&p.keyCode<=40){return}GUI.context_set_angleradius(b)});$("#angle-button-rightangle-box").bind(GUI.click_event,function(){GUI.context_set_dotvisibility(b)});$("#sector-related-measure-box").addClass("not-displayed");$("#line-related-measure-box").addClass("not-displayed")}else{if(h.type==JXG.OBJECT_TYPE_SECTOR){$("#sector-related-measure-box").removeClass("not-displayed");$("#measure-specific").removeClass("not-displayed");$("#sector-related-measure-box").bind(GUI.click_event,function(){GUI.ctx_measureSector(b)});$("#angle-related-measure-box").addClass("not-displayed");$("#line-related-measure-box").addClass("not-displayed")}else{if(h.type!=JXG.OBJECT_TYPE_TEXT){$("#angle-related-measure-box").addClass("not-displayed");$("#sector-related-measure-box").addClass("not-displayed");$("#line-related-measure-box").addClass("not-displayed");$("#measure-specific").addClass("not-displayed")}}}}$("#circle-radius-field").keyup(function(p){if(p.keyCode>=35&&p.keyCode<=40){return}GUI.context_set_radius(b)});if(h.type==JXG.OBJECT_TYPE_POLYGON){GUI.delight()}if(h.type==JXG.OBJECT_TYPE_CURVE){GUI.Plot.plotFunction();$("#fx-input").val(h.Y.toString().cleanTerm());$("#editPlot").val(b)}GUI.addTooltips();GUI.showPropertyPanel("props",false)},contextShowsProps:function(){if($("#control-boardprop").hasClass("button-selected")){if($("#id")&&typeof $("#id").val()!="undefined"){return $("#id").val()}return -1}else{return 0}},contextUpdate:function(){if(GUI.ctx_curr_coords!=null&&$("#control-boardprop").hasClass("button-selected")&&!$("#ctx_objects").hasClass("not-displayed")){GUI.contextMenu(GUI.ctx_curr_coords)}},showPanelHTML:function(b,c,a){if(typeof a=="undefined"){a=false}if(a){$("#ctx_objects_extra").html(b+"<br>")}else{$("#ctx_objects").html(b)}GUI.showPropertyPanel("objects",a);GUI.showPanel(true,c);if(c==GUI.ctxPosProps){$("#control-boardprop").addClass("button-selected");$("#control-boardprop-box").addClass("button-selected")}$(".property").addClass("not-displayed");return true},contextMenu:function(c){var a,b,f,d=[];GUI.showPanel(false,0);f=JXG.Draw.findHittedObjs(c.scrCoords[1],c.scrCoords[2],GUI.board,JXG.Options.sensitive_area,[JXG.OBJECT_CLASS_LINE,JXG.OBJECT_CLASS_CIRCLE,JXG.OBJECT_CLASS_POINT,JXG.OBJECT_CLASS_CURVE,JXG.OBJECT_CLASS_AREA,JXG.OBJECT_CLASS_OTHER],[]);for(a=0;a<f.length;a++){if(f[a].elementClass==JXG.OBJECT_CLASS_POINT||f[a].type==JXG.OBJECT_TYPE_ANGLE||f[a].type==JXG.OBJECT_TYPE_SECTOR){d.push(f[a])}}if(d.length>0){f=d}if(f.length!==0){if(f.length==1){GUI.contextEdit(f[0].id)}else{d=[];for(b in f){if(f.hasOwnProperty(b)&&f[b].visProp.visible===true&&GUI.isStandardObj(f[b])){d.push(f[b])}}if(d.length>0){if(d.length==1){GUI.contextEdit(f[0].id)}else{GUI.delight();GUI.createSelectDialog(d,(function(g){GUI.contextEdit(g)}),GUI.ctxPosProps,false)}}}}else{GUI.delight();GUI.showPropertyPanel("board",false)}GUI.showPanel(true,GUI.ctxPosProps);$("#control-boardprop").addClass("button-selected");$("#control-boardprop-box").addClass("button-selected");return false}});GUI.Dialog=function(b,l,q,o,r,j,f){var k,d,a,n,m=false,g=document.createElement("div");if(GUI.dialog[b]!=null){GUI.dialog[b].removeDialog()}for(var c in GUI.dialog){if(GUI.dialog.hasOwnProperty(c)){if(GUI.dialog[c]!=null){GUI.dialog[c].removeDialog()}}}this.id=b;g.setAttribute("id",b);g.setAttribute("class","dlg");g.setAttribute("data-role","none");k='<div id="dlg-header" class="center">';k+='   <div id="dlg-header-left" class="fleft"></div>';k+='   <div id="dlg-header-right" class="fright"></div>';k+='   <div id="dlg-header-middle" class="nobr"><nobr>'+q+"</nobr></div>";k+="</div>";k+='<div id="dlg-content">';if(typeof l!="undefined"){k+=l}k+="</div>";g.innerHTML=k;document.body.appendChild(g);GUI.dialog[b]=this;JXG.addEvent(document,GUI.move_event,function(h){if(GUI.dialog[b]==null){JXG.removeEvent(document,GUI.move_event,arguments.callee,GUI)}else{GUI.dialog[b].move(h)}},GUI);JXG.addEvent(document,GUI.up_event,function(h){if(GUI.dialog[b]==null){JXG.removeEvent(document,GUI.up_event,arguments.callee,GUI)}else{GUI.dialog[b].up()}},GUI);d=$("div.dlg#"+b+" div#dlg-header-right");d.bind(GUI.click_event,function(){if(GUI.dialog[b]==null){d.unbind(GUI.down_event,arguments.callee)}else{GUI.dialog[b].removeDialog()}});d=$("div.dlg#"+b+" div#dlg-header-middle");d.bind(GUI.down_event,function(h){if(GUI.dialog[b]==null){d.unbind(GUI.down_event,arguments.callee)}else{GUI.dialog[b].down(h)}});$("div.dlg#"+b).css("min-width",90+parseInt(d.css("width"))+"px");this.fitContent();a=n="";if(typeof o!="undefined"){if(o.scrCoords){o=o.scrCoords;o.splice(0,1)}if(o[0]!==0||o[1]!==0){if(o[0]!==0){n+="left:"+(o[0]+35)+"px; "}if(o[1]!==0){n+="top:"+o[1]+"px; "}}else{m=true}if(typeof r!="undefined"){if(r[0]!==0){a+="width:"+r[0]+"px; "}if(r[1]!==0){a+="height:"+r[1]+"px; "}if(typeof j!="undefined"){this.callback_param=j;this.callback=f}}}else{m=true}if(a!==""){g.setAttribute("style",a)}if(m){if(typeof GUI.dialog_last_pos[b]!="undefined"&&typeof GUI.dialog_last_pos[b][1]!="undefined"){n="left:"+GUI.dialog_last_pos[b][0]+"; top:"+GUI.dialog_last_pos[b][1]+";"}else{var p,i;p=window.innerWidth-$("div.dlg#"+b).outerWidth();p=parseInt(p/2);i=window.innerHeight-$("div.dlg#"+b).outerHeight();i=parseInt(i/2);n="left:"+p+"px; top:"+i+"px;"}}a+=n;if(a!==""){g.setAttribute("style",a)}};JXG.extend(GUI.Dialog.prototype,{id:null,callback_param:null,callback:null,down_state:false,offsetX:0,offsetY:0,fitContent:function(){var a=parseInt(window.screen.height);if($("#gallery").css("display")!="none"){a=parseInt(document.body.offsetHeight)}$("div.dlg#"+this.id+" #dialog_content").css("max-height",a-(parseInt($("#"+this.id).css("top"))+$("#dlg-header").outerHeight())-60+"px")},removeDialog:function(a){if(this.id==null){return}var b=$("div.dlg#"+this.id);GUI.dialog_last_pos[this.id]=new Array(b.css("left"),b.css("top"));if((typeof a=="undefined"||(a===false))&&GUI.dialog[this.id].callback_param!=null){GUI.dialog[this.id].callback(GUI.dialog[this.id].callback_param)}$("#"+this.id).find("*").unbind();if(this.id!=null){document.body.removeChild(GUI.getId(this.id));GUI.dialog[this.id]=null;this.id=null}$("#modalWindow").addClass("not-displayed")},down:function(c){if(this.id==null){return}var b=$("div.dlg#"+this.id),a=GUI.getCoords(c);GUI.dialog[this.id].down_state=true;GUI.dialog[this.id].offsetX=parseInt(b.css("left"))-a.scrCoords[1];GUI.dialog[this.id].offsetY=parseInt(b.css("top"))-a.scrCoords[2];if(c&&c.preventDefault){c.preventDefault()}else{window.event.returnValue=false}},up:function(){if(this.id==null){return}GUI.dialog[this.id].down_state=false;GUI.dialog[this.id].offsetX=0;GUI.dialog[this.id].offsetY=0},move:function(g){if(this.id==null){return}var f=$("div.dlg#"+this.id);if(this.down_state){var a,i,b,c,d=GUI.getCoords(g);a=d.scrCoords[1];i=d.scrCoords[2];if(!JXG.isTouchDevice()){a+=this.offsetX;i+=this.offsetY}if(a<0){a=0}if(i<0){i=0}if($("#gallery").css("display")=="none"){b=parseInt(GUI.board.canvasWidth);c=parseInt(GUI.board.canvasHeight)}else{b=parseInt(document.body.offsetWidth);c=parseInt(document.body.offsetHeight)}if(a>b){a=b}if(i>c-90){i=c-90}f.css("left",a);f.css("top",i);GUI.dialog_last_pos[this.id]=new Array(a,i);this.fitContent()}}});JXG.extend(GUI,{confirm:function(c,f,d){var b="",a='<div class="center">'+c+"</div>";if(f){a+=' &nbsp; <input id="confirmInput" size="30">'}a+='<div class="tspacer center"><button id="confirmOk">Ok</button>';if(typeof d!="undefined"){a+=' &nbsp; <button id="confirmCancel">Cancel</button>'}a+="</div>";$("#confirm #confirmInput").unbind();$("#confirm #confirmOk").unbind();$("#confirm #confirmCancel").unbind();$("#modalWindow").removeClass("not-displayed");new GUI.Dialog("confirm",a,b,[0,0],[380,0],0,function(g){});$("#confirm #confirmOk").addClass("button-selected");$("#confirm #confirmCancel").addClass("button-selected");$("#confirm #confirmCancel").bind(GUI.click_event,function(g){GUI.dialog.confirm.removeDialog();g.preventDefault()});$("#confirm #confirmOk").bind(GUI.click_event,function(g){if(typeof d=="function"){d()}GUI.dialog.confirm.removeDialog();g.preventDefault()})},alert:function(a){GUI.confirm(a,false)}});JXG.extend(GUI,{select:function(d,f,h,j,k){var b,g,c,a;if(typeof h=="undefined"){h=false}if(typeof j!="undefined"&&j!=null){g=j}else{g=GUI.getCoords(d)}switch(f){case"point":b=JXG.Draw.findHittedObjs(g.scrCoords[1],g.scrCoords[2],GUI.board,JXG.Options.sensitive_area,[JXG.OBJECT_CLASS_POINT],[]);if(b.length==1){GUI.Audio.play("plastic");GUI.selection.push(b[0]);GUI.highlight(b[0].id,false);if(k){k()}}else{if(b.length>1){GUI.createSelectDialog(b,(function(i){GUI.selection.push(GUI.board.objects[i]);GUI.showPanel(false,0);if(k){k()}GUI.removeToolEvents(true)}),GUI.ctxPosProps)}}break;case"ablatePoint":b=JXG.Draw.findHittedObjs(g.scrCoords[1],g.scrCoords[2],GUI.board,JXG.Options.sensitive_area,[JXG.OBJECT_CLASS_POINT],[JXG.OBJECT_TYPE_CAS,JXG.OBJECT_TYPE_INTERSECTION]);if(b.length==1){GUI.Audio.play("plastic");GUI.selection.push(b[0]);GUI.highlight(b[0].id,false)}else{if(b.length>1){GUI.alert("select dialog needed")}}break;case"object":b=JXG.Draw.findHittedObjs(g.scrCoords[1],g.scrCoords[2],GUI.board,JXG.Options.sensitive_area,[JXG.OBJECT_CLASS_POINT,JXG.OBJECT_CLASS_CURVE,JXG.OBJECT_CLASS_LINE,JXG.OBJECT_CLASS_CIRCLE,JXG.OBJECT_CLASS_OTHER],[],1);if(b.length>0){GUI.selection.push(b[0]);GUI.highlight(b[0].id,true)}break;case"act_object":b=JXG.Draw.findHittedObjs(g.scrCoords[1],g.scrCoords[2],GUI.board,JXG.Options.sensitive_area,[JXG.OBJECT_CLASS_POINT,JXG.OBJECT_CLASS_CURVE,JXG.OBJECT_CLASS_LINE,JXG.OBJECT_CLASS_CIRCLE,JXG.OBJECT_CLASS_OTHER,JXG.OBJECT_CLASS_AREA],[JXG.OBJECT_TYPE_ARROW,JXG.OBJECT_TYPE_AXIS,JXG.OBJECT_TYPE_AXISPOINT,JXG.OBJECT_TYPE_TICKS,JXG.OBJECT_TYPE_GRID]);if(b.length>0){if(b.length>1){h=true}for(c=0;c<b.length;c++){if(!b[c].visProp.islabel&&!b[c].visProp.priv){GUI.selection.push(b[c]);if(!h){GUI.highlight(b[c].id,true)}}}}break;case"circleorline":b=JXG.Draw.findHittedObjs(g.scrCoords[1],g.scrCoords[2],GUI.board,JXG.Options.sensitive_area,[JXG.OBJECT_CLASS_LINE,JXG.OBJECT_CLASS_CIRCLE],[]);for(c=0;c<b.length;c++){if(b[c].type==JXG.OBJECT_TYPE_LINE){GUI.selection.push(b[c]);GUI.highlight(b[c].id,true);return false}if(b[c].type==JXG.OBJECT_TYPE_CIRCLE){GUI.selection.push(b[c]);GUI.highlight(b[c].id,true);return true}}break;case"line":b=JXG.Draw.findHittedObjs(g.scrCoords[1],g.scrCoords[2],GUI.board,JXG.Options.sensitive_area,[JXG.OBJECT_CLASS_LINE,JXG.OBJECT_CLASS_POINT],[]);for(c=0;c<b.length;c++){if((b[c].type==JXG.OBJECT_TYPE_LINE||b[c].type==JXG.OBJECT_TYPE_AXIS)&&b[c].point1.visProp.priv==false&&b[c].point2.visProp.priv==false){GUI.selection=[b[c]];GUI.highlight(b[c].id,false);return true}}break;case"angleorpoints":b=JXG.Draw.findHittedObjs(g.scrCoords[1],g.scrCoords[2],GUI.board,JXG.Options.sensitive_area,[JXG.OBJECT_CLASS_POINT,JXG.OBJECT_CLASS_CURVE],[]);for(c=0;c<b.length;c++){if(b[c].type==JXG.OBJECT_TYPE_ANGLE){GUI.selection=[b[c]];GUI.highlight(b[c].id,true);return true}if(b[c].elementClass==JXG.OBJECT_CLASS_POINT){GUI.selection.push(b[c]);GUI.highlight(b[c].id,false);return false}}break;case"sector":b=JXG.Draw.findHittedObjs(g.scrCoords[1],g.scrCoords[2],GUI.board,JXG.Options.sensitive_area,[JXG.OBJECT_CLASS_CURVE],[]);for(c=0;c<b.length;c++){if(b[c].type==JXG.OBJECT_TYPE_SECTOR){GUI.selection=[b[c]];GUI.highlight(b[c].id,false);return true}}break;case"slider":b=JXG.Draw.findHittedObjs(g.scrCoords[1],g.scrCoords[2],GUI.board,JXG.Options.sensitive_area,[JXG.OBJECT_CLASS_POINT],[]);for(c=0;c<b.length;c++){if(b[c].type==JXG.OBJECT_TYPE_GLIDER){for(a in b[c].childElements){if(b[c].childElements.hasOwnProperty(a)){if(b[c].childElements[a].elType=="segment"){GUI.selection.push(b[c]);GUI.highlight(b[c].id,false);return true}}}}}break;case"place":GUI.selection.push(g.usrCoords.slice(1));if(k){k()}break;default:console.log("select call error!")}return false},generateHighlightCode:function(b){var a,d,f,c=GUI.id();f=GUI.board.objects[b];if(f.elementClass==JXG.OBJECT_CLASS_POINT){a=function(){GUI.board.create("point",[f.coords.usrCoords[1],f.coords.usrCoords[2]],{fillOpacity:GUI.opacityHidden,layer:1,id:c,name:"",priv:true,snaptogrid:false,withLabel:false,strokewidth:0,strokeColor:GUI.highlightColor,size:GUI.highlightSize})}}else{if(f.elementClass==JXG.OBJECT_CLASS_CIRCLE){a=function(){GUI.board.create("circle",[f.midpoint.id,f],{strokeOpacity:GUI.opacityHidden,fillOpacity:GUI.opacityHidden,id:c,name:"",priv:true,withLabel:false,strokeWidth:GUI.highlightSize,strokeColor:GUI.highlightColor})}}else{if(f.elementClass==JXG.OBJECT_CLASS_LINE){a=function(){GUI.board.create("line",[f.point1,f.point2.id],{strokeOpacity:GUI.opacityHidden,id:c,name:"",priv:true,withLabel:false,strokeWidth:GUI.highlightSize,strokeColor:GUI.highlightColor,straightFirst:f.visProp.straightfirst,straightLast:f.visProp.straightlast})}}else{a=function(){}}}}d=function(){GUI.board.removeObject(c)};a();return d},highlight:function(f,b,d){var a,c=GUI.board.objects[f];if(c.visProp.priv===true){return}if(c.type==JXG.OBJECT_TYPE_POLYGON){for(a=0;a<c.borders.length;a++){GUI.highlight(c.borders[a].id,b,d)}}else{for(a=0;a<GUI.highlightedObjs.length;a++){if(GUI.highlightedObjs[a].id===f){return}}if(typeof b=="undefined"||b==true){GUI.delight()}if(typeof d=="undefined"){d=0}GUI.highlightedObjs.push({id:f,code:GUI.generateHighlightCode(f),cid:d})}},delight:function(f,d){var a,b;if(typeof f!="undefined"&&f!=0){var c=GUI.board.objects[f];if(c.type==JXG.OBJECT_TYPE_POLYGON){for(a=0;a<c.borders.length;a++){GUI.delight(c.borders[a].id,d)}}else{for(b in GUI.highlightedObjs){if(GUI.highlightedObjs.hasOwnProperty(b)&&GUI.highlightedObjs[b].id==f){GUI.highlightedObjs[b].code();GUI.highlightedObjs[b]=GUI.highlightedObjs[GUI.highlightedObjs.length-1];GUI.highlightedObjs.length-=1;break}}}}else{if(typeof d=="undefined"){d=-1}for(b in GUI.highlightedObjs){if(GUI.highlightedObjs.hasOwnProperty(b)&&(d==-1||GUI.highlightedObjs[b].cid==d)){GUI.highlightedObjs[b].code()}}GUI.highlightedObjs=[]}GUI.board.dehighlightAll();GUI.board.update()},iss_highlight:function(b,a,c){GUI.board.create("intersection",[b,a,c],{id:"ISS",name:""});GUI.highlight(b,false);GUI.highlight(a,false);GUI.highlight("ISS",false)},iss_delight:function(){GUI.delight();if(GUI.board.objects.ISS){GUI.board.removeObject(GUI.board.objects.ISS)}},highlightAndCollectPointsOnCurve:function(c,f,h){var b,a,k=h.options.precision.hasPoint,j;h.options.precision.hasPoint=f;for(var d in h.objects){if(h.objects.hasOwnProperty(d)){b=h.objects[d];j=false;if(b.elementClass==JXG.OBJECT_CLASS_POINT&&b.visProp.priv===false&&b.visProp.visible===true){if(c.lastLength<=0&&c.GUIpoints.length>0){a=c.GUIpoints[0].scrCoords;j=b.hasPoint(a[1],a[2])}if(!j){j=c.hasPoint(b.coords.scrCoords[1],b.coords.scrCoords[2],Math.max(0,c.lastLength))}if(j){if(!b.catchIdx||b.catchIdx==-1){b.catchIdx=c.GUIpoints.length-1}if(!JXG.exists(c.lastPointId)||c.lastPointId!=b.id){c.hittedPoints.push(b);GUI.Audio.play("bubble");GUI.Audio.vibrate(100);c.lastPointId=b.id}}}}}h.options.precision.hasPoint=k;c.hittedPoints=JXG.uniqueArray(c.hittedPoints).sort(function(l,i){return(l.catchIdx>=i.catchIdx)});c.lastLength=c.GUIpoints.length-1;for(var g=0;g<c.hittedPoints.length;g++){GUI.highlight(c.hittedPoints[g].id,false,c.uuid)}},magnify:function(g){var d,f,b,h,c,a=GUI.board.renderer.svgRoot;a.setAttribute("xmlns","http://www.w3.org/2000/svg");a.setAttribute("width",GUI.board.canvasWidth);a.setAttribute("height",GUI.board.canvasHeight);b=new XMLSerializer().serializeToString(a);f=GUI.getId("magnifier").getContext("2d");d=new Image(100,100);d.onload=function(){f.clearRect(0,0,300,300);h=GUI.board.getMousePosition(g);f.drawImage(d,Math.max(h[0]-50,0),Math.max(h[1]-50,0),100,100,0,0,300,150)};if($.browser.mozilla){c=JXG.Util.Base64.encode(b);d.src="data:image/svg+xml;base64,"+c}else{d.src="data:image/svg+xml,"+b}},getFuncDeps:function(c){var b,a;var d=[];for(a in {XEval:1,YEval:1,X:1,Y:1}){if(c.hasOwnProperty(a)&&c[a].origin){for(b in c[a].origin.deps){if(c[a].origin.deps.hasOwnProperty(b)){d.push(b)}}}}return JXG.uniqueArray(d)},getAllFuncDependencies:function(b){var f,d,h,g,a,c;while(1){h=JXG.uniqueArray(b);for(f in GUI.board.objects){g=[];if(GUI.board.objects.hasOwnProperty(f)){a=GUI.getFuncDeps(GUI.board.objects[f]);for(d=0;d<b.length;d++){if(GUI.collectionContains(a,b[d])){g.push(GUI.board.objects[f].id)}}}for(d=0;d<g.length;d++){b.unshift(g[d])}}b=JXG.uniqueArray(b);if(h.length==b.length){break}}c=JXG.uniqueArray(b);return c},getAllDependencies:function(b){var a,c=[];if(JXG.keys(b.descendants,true).length===0){return c}for(a in b.descendants){if(b.descendants.hasOwnProperty(a)){c=c.concat(GUI.getAllDependencies(b.descendants[a]));if(b.descendants[a].id.search(/Label/)==-1){c.push(b.descendants[a].id)}}}return JXG.uniqueArray(c)},getAllAncestors:function(b){var a=[];if(b&&b.ancestors){for(var c in b.ancestors){if(b.ancestors.hasOwnProperty(c)){a=a.concat(GUI.getAllAncestors(b.ancestors[c]))}}a.push(b)}return JXG.uniqueArray(a)},getSelectionConstructSteps:function(){var f,d,c,g,a,b=[];while(1){g=JXG.uniqueArray(GUI.selection);for(d=0;d<g.length;d++){for(f=0;f<=GUI.unredo;f++){if(JXG.isInArray(GUI.step_del_exclude,f)){continue}if(GUI.step_log[f].type==JXG.GENTYPE_DELETE){for(c=0;c<GUI.step_log[f].dest_sub_ids.length;c++){JXG.removeElementFromArray(GUI.selection,GUI.step_log[f].dest_sub_ids[c])}}else{if(GUI.step_log[f].dest_id==g[d]||GUI.collectionContains(GUI.step_log[f].src_ids,g[d])||GUI.collectionContains(GUI.step_log[f].dest_sub_ids,g[d])){if((GUI.step_log[f].type==JXG.GENTYPE_CTX_TYPE_G&&GUI.step_log[f].src_ids[1]==g[d])||(GUI.step_log[f].type==JXG.GENTYPE_CTX_TYPE_P&&GUI.step_log[f].src_ids[1]==g[d])||(GUI.step_log[f].type==JXG.GENTYPE_GLIDER&&GUI.step_log[f].src_ids[0]==g[d])){if(GUI.step_log[f].type==JXG.GENTYPE_GLIDER){a=GUI.step_log[f].dest_id}else{a=GUI.step_log[f].src_ids[0]}if(!GUI.board.objects[a].slideObject){continue}}if(GUI.step_log[f].dest_sub_ids&&GUI.step_log[f].dest_sub_ids.length>0){for(c=0;c<GUI.step_log[f].dest_sub_ids.length;c++){if(GUI.step_log[f].dest_sub_ids[c]!==""&&GUI.step_log[f].dest_sub_ids[c]!==0){GUI.selection.push(GUI.step_log[f].dest_sub_ids[c])}}}if(GUI.step_log[f].dest_id!==0&&GUI.step_log[f].dest_id!==""){GUI.selection.push(GUI.step_log[f].dest_id)}b.push(f)}}}}GUI.selection=JXG.uniqueArray(GUI.selection);if(g.length==GUI.selection.length){break}}return JXG.uniqueArray(b).sort(function(i,h){return(i-h)})},hideObjId:function(c){var b,a=GUI.board.objects[c];a.visProp.visible=a.guiVisProp.visible;if(a.type==JXG.OBJECT_TYPE_POLYGON){for(b=0;b<a.vertices.length-1;b++){GUI.hideObjId(a.vertices[b].id)}for(b=0;b<a.borders.length;b++){GUI.hideObjId(a.borders[b].id)}}GUI.context_set_visibility(a.id);if(a.visProp.visible){a.guiVisProp.visible=true;if(a.guiVisProp.fillOpacity){a.setAttribute({fillOpacity:a.guiVisProp.fillOpacity})}if(a.guiVisProp.strokeOpacity){a.setAttribute({strokeOpacity:a.guiVisProp.strokeOpacity})}if(a.guiVisProp.strokewidth){a.setAttribute({strokewidth:a.guiVisProp.strokewidth})}}else{a.guiVisProp.visible=false;a.guiVisProp.strokewidth=a.getAttribute("strokewidth");a.guiVisProp.strokeOpacity=a.getAttribute("strokeOpacity");a.guiVisProp.fillOpacity=a.getAttribute("fillOpacity");if(a.guiVisProp.strokewidth==0){a.setAttribute({strokewidth:GUI.strokeHidden})}a.setAttribute({strokeOpacity:GUI.opacityHidden});a.setAttribute({fillOpacity:GUI.opacityHidden});a.setAttribute({visible:true})}},removeObjId:function(c){var b,a=[];if(GUI.board.objects[c].type==JXG.OBJECT_TYPE_POLYGON){for(b in GUI.board.objects[c].borders){if(GUI.board.objects[c].borders.hasOwnProperty(b)){a.push(GUI.board.objects[c].borders[b])}}}a.push(GUI.board.objects[c]);GUI.remove(a)},remove:function(g){var d,c,b,f=[],a=[];for(d in g){if(g.hasOwnProperty(d)){f.push(g[d].id)}}console.log("- Deletion -");GUI.selection=GUI.getAllFuncDependencies(f);b=GUI.getSelectionConstructSteps(false).sort(function(i,h){return(i>h)});console.log("Involved steps: "+b);for(c=0;c<b.length;c++){if(GUI.step_log[b[c]].dest_sub_ids){a=a.concat(GUI.step_log[b[c]].dest_sub_ids)}if(GUI.step_log[b[c]].dest_id){a.push(GUI.step_log[b[c]].dest_id)}}GUI.recordStep({type:JXG.GENTYPE_DELETE,args:{steps:JXG.deepCopy(b)},src_ids:[],dest_sub_ids:a,dest_id:0},true)},genPasteParams:function(k,c){var g,l=[],a=[];if(GUI.action=="copy"){var b,d,j,m=[],h=[];j=GUI.getSelectionConstructSteps();for(b in k){if(k.hasOwnProperty(b)){if(k[b]!=""){if(c){d={orig:k[b]}}else{d={orig:k[b],copy:GUI.id()}}l.push(d)}}}for(g=0;g<l.length;g++){if(GUI.board.objects[l[g].orig].type==JXG.OBJECT_TYPE_POINT){m.push(l[g])}}if(c){return{id_map:l,free_points:m}}else{for(g=0;g<j.length;g++){a=a.concat(GUI.step_log[j[g]].src_ids);h=h.concat(GUI.step_log[j[g]].dest_sub_ids);if(GUI.step_log[j[g]].dest_id!==0){h.push(GUI.step_log[j[g]].dest_id)}}for(g=0;g<m.length;g++){h.push(m[g].copy)}a=JXG.uniqueArray(a);h=JXG.uniqueArray(h);return{steps:j,id_map:l,free_points:m,src_ids:a,dest_sub_ids:h}}}else{if(GUI.action=="ablation"){var f;if(k.length==2){f=[k[1]]}else{if(k.length==3){f=[k[0].id,k[1].id]}else{console.log("such an ablation is not implemented!")}}for(g=0;g<k.length-1;g++){a.push(k[g].id)}if(c){l.push({orig:a[0]});return{id_map:l,free_points:[]}}else{l.push({orig:a[0],copy:GUI.id()});return{id_map:l,free_points:[],src_ids:a,dest_sub_ids:[l[0].copy,GUI.id()],fids:f}}}else{return{}}}},makeShadowCopy:function(c,b,f){var a,d;if(GUI.action=="standard"){return""}d=GUI.genPasteParams(c,false);if(GUI.action=="copy"){GUI.shadowCopyStep=JXG.SketchReader.replaceStepDestIds({type:JXG.GENTYPE_COPY,src_ids:JXG.deepCopy(d.src_ids),dest_sub_ids:JXG.deepCopy(d.dest_sub_ids),dest_id:0,args:{steps:JXG.deepCopy(d.steps),map:JXG.deepCopy(d.id_map),free_points:JXG.deepCopy(d.free_points),x:b,y:f,dep_copy:false}},d.id_map)}else{if(GUI.action=="ablation"){GUI.shadowCopyStep={type:JXG.GENTYPE_ABLATION,args:{x:b,y:f,fids:d.fids,migrate:0},src_ids:JXG.deepCopy(d.src_ids),dest_sub_ids:JXG.deepCopy(d.dest_sub_ids),dest_id:0}}}if(GUI.shadowCopyStep.type>50){a=GUI.generateJCode(GUI.shadowCopyStep,GUI.board)}else{a=JXG.SketchReader.generateJCode(GUI.shadowCopyStep,GUI.board,GUI.step_log)}GUI.parse(a[0],false);GUI.board.prepareUpdate().updateRenderer();GUI.addToolEvent(GUI.move_event,GUI.moveShadowCopy,d,true);return a[2]},placeShadowCopy:function(d,j){var c,f,b=null,a=0,h=0,g;g=GUI.genPasteParams(d,true);f=GUI.board.create("point",[j.usrCoords[1],j.usrCoords[2]]);if(g.free_points.length===0){for(c=0;c<g.id_map.length;c++){if(GUI.board.objects[g.id_map[c].orig].elementClass==JXG.OBJECT_CLASS_POINT){b=GUI.board.objects[g.id_map[c].orig];break}}}else{b=GUI.board.objects[g.free_points[0].orig]}if(b!=null){a=b.coords.usrCoords[1]-f.coords.usrCoords[1];h=b.coords.usrCoords[2]-f.coords.usrCoords[2]}GUI.board.removeObject(f);if(GUI.action=="copy"||GUI.action=="ablation"){GUI.showObjectsBlured(true)}GUI.makeShadowCopy(d,a,h);return new Array(a,h)},moveShadowCopy:function(g,b){var d,k,f=null,a,m,l,j,h;k=GUI.getCoords(g);if(GUI.Settings.get("cursor")){GUI.board.renderer.updateTouchpoint(0,k.scrCoords.slice(1))}if(b.free_points.length===0){for(d=0;d<b.id_map.length;d++){if(GUI.board.objects[b.id_map[d].orig].elementClass==JXG.OBJECT_CLASS_POINT){f=GUI.board.objects[b.id_map[d].orig];break}}if(f==null){return}}else{f=GUI.board.objects[b.free_points[0].orig]}a=k.usrCoords[1]-f.coords.usrCoords[1];m=k.usrCoords[2]-f.coords.usrCoords[2];h=new JXG.Coords(JXG.COORDS_BY_USER,[a,m],GUI.board);a=h.usrCoords[1];m=h.usrCoords[2];for(d=0;d<b.id_map.length;d++){if(GUI.board.objects[b.id_map[d].orig].elementClass==JXG.OBJECT_CLASS_POINT){GUI.board.objects[b.id_map[d].copy].moveTo([GUI.board.objects[b.id_map[d].orig].X()+a,GUI.board.objects[b.id_map[d].orig].Y()+m])}}for(d=0;d<b.free_points.length;d++){l=parseFloat(GUI.board.objects[b.free_points[d].orig].coords.usrCoords[1]+a);j=parseFloat(GUI.board.objects[b.free_points[d].orig].coords.usrCoords[2]+m);GUI.board.objects[b.free_points[d].copy].moveTo([l,j])}GUI.last_copy_pos=k;if(g.preventDefault){g.preventDefault()}else{window.event.returnValue=false}if(GUI.action=="ablation"){GUI.pasteAblationHighlight(g)}},movePoint:function(a,c){var b=GUI.getCoords(a);GUI.board.objects[c].moveTo([b.usrCoords[1],b.usrCoords[2]]);if(GUI.Settings.get("cursor")){GUI.board.renderer.updateTouchpoint(0,b.scrCoords.slice(1))}},pasteAblationHighlight:function(c){var b,d,a,f=GUI.getScreenCoordsXY(c);GUI.pasteAblationDehighlight(c);GUI.board.suspendUpdate();for(d in GUI.board.objects){if(GUI.board.objects.hasOwnProperty(d)){b=GUI.board.objects[d];if(b.elementClass===JXG.OBJECT_CLASS_POINT&&!b.visProp.priv&&b.visProp.visible&&!b.highlighted&&b.id!==GUI.shadowCopyStep.dest_sub_ids[0]&&b.hasPoint(f[0],f[1])){b.highlighted=true;a=GUI.board.create("point",[b.X(),b.Y()],{size:GUI.highlightSize,strokeWidth:0,withLabel:false,name:"",fillOpacity:GUI.opacityHidden});a.highlighted=b;GUI.highlightedObjsAblate[a.id]=a;GUI.Audio.play("click")}}}GUI.board.unsuspendUpdate()},pasteAblationDehighlight:function(b){var c,a,d=[0,0];if(b){d=GUI.getCoords(b)}GUI.board.suspendUpdate();for(c in GUI.highlightedObjsAblate){if(GUI.highlightedObjsAblate.hasOwnProperty(c)){if(!b||(GUI.highlightedObjsAblate[c]&&GUI.highlightedObjsAblate[c].hasPoint&&!GUI.highlightedObjsAblate[c].hasPoint(d[0],d[1]))){a=GUI.highlightedObjsAblate[c].highlighted;a.highlighted=false;GUI.board.removeObject(GUI.highlightedObjsAblate[c]);delete GUI.highlightedObjsAblate[c]}}}GUI.board.unsuspendUpdate()}});JXG.extend(GUI,{addBoardHandlers:function(){if(JXG.Options.device=="pc"){GUI.board.addMouseEventHandlers()}else{GUI.board.addTouchEventHandlers()}GUI.board.on(GUI.up_event,GUI.objectMoveHook,GUI.board);console.log("board handlers added")},removeBoardHandlers:function(){if(JXG.Options.device=="pc"){GUI.board.removeMouseEventHandlers()}else{GUI.board.removeTouchEventHandlers()}GUI.board.off(GUI.up_event,GUI.objectMoveHook);console.log("board handlers removed")},addNavHandlers:function(){if(!GUI.navHandlersRegistered){if(JXG.Options.device=="pc"){JXG.addEvent(GUI.board.containerObj,GUI.down_event,GUI.mms,GUI.board);JXG.addEvent(GUI.board.containerObj,GUI.move_event,GUI.mom,GUI.board);JXG.addEvent(GUI.board.containerObj,"mousewheel",GUI.mwl,GUI.board);JXG.addEvent(GUI.board.containerObj,"DOMMouseScroll",GUI.mwl,GUI.board)}else{JXG.addEvent(GUI.board.containerObj,GUI.down_event,GUI.tms,GUI.board);JXG.addEvent(GUI.board.containerObj,GUI.move_event,GUI.tom,GUI.board);JXG.addEvent(GUI.board.containerObj,"gesturestart",GUI.gsl,GUI.board);JXG.addEvent(GUI.board.containerObj,"gesturechange",GUI.gcl,GUI.board)}JXG.addEvent(document,GUI.up_event,GUI.ome,GUI.board);GUI.navHandlersRegistered=true}console.log("nav handlers added")},removeNavHandlers:function(){if(GUI.navHandlersRegistered){JXG.removeEvent(document,GUI.up_event,GUI.ome,GUI.board);if(JXG.Options.device=="pc"){JXG.removeEvent(GUI.board.containerObj,"DOMMouseScroll",GUI.mwl,GUI.board);JXG.removeEvent(GUI.board.containerObj,"mousewheel",GUI.mwl,GUI.board);JXG.removeEvent(GUI.board.containerObj,GUI.move_event,GUI.mom,GUI.board);JXG.removeEvent(GUI.board.containerObj,GUI.down_event,GUI.mms,GUI.board)}else{JXG.removeEvent(GUI.board.containerObj,"gesturechange",GUI.gcl,GUI.board);JXG.removeEvent(GUI.board.containerObj,"gesturestart",GUI.gsl,GUI.board);JXG.removeEvent(GUI.board.containerObj,GUI.move_event,GUI.tom,GUI.board);JXG.removeEvent(GUI.board.containerObj,GUI.down_event,GUI.tms,GUI.board)}GUI.navHandlersRegistered=false}console.log("nav handlers removed")},addConstructHooks:function(){GUI.board.on(GUI.down_event,GUI.downHandler,GUI);GUI.board.on(GUI.move_event,GUI.moveHandler,GUI);GUI.board.on(GUI.up_event,GUI.upHandler,GUI);console.log("const hooks added")},removeConstructHooks:function(){GUI.board.off(GUI.down_event,GUI.downHandler,GUI);GUI.board.off(GUI.move_event,GUI.moveHandler,GUI);GUI.board.off(GUI.up_event,GUI.upHandler,GUI);console.log("const hooks removed")},addConstructEvents:function(){JXG.addEvent(GUI.board.containerObj,GUI.down_event,GUI.downHandler,GUI);JXG.addEvent(GUI.board.containerObj,GUI.move_event,GUI.moveHandler,GUI);JXG.addEvent(document,GUI.up_event,GUI.upHandler,GUI);console.log("const events added")},removeConstructEvents:function(){JXG.removeEvent(document,GUI.up_event,GUI.upHandler,GUI);JXG.removeEvent(GUI.board.containerObj,GUI.move_event,GUI.moveHandler,GUI);JXG.removeEvent(GUI.board.containerObj,GUI.down_event,GUI.downHandler,GUI);console.log("const events removed")},magMove:function(a){if(GUI.Settings.get("magnify")){GUI.magnify(a)}},ome:function(a){GUI.board.originMoveEnd(a)},mms:function(a){if(GUI.board.mouseOriginMoveStart){GUI.board.mouseOriginMoveStart(a)}},mom:function(a){if(GUI.board.mouseOriginMove){GUI.board.mouseOriginMove(a)}},mwl:function(a){if(GUI.board.mouseWheelListener){GUI.board.mouseWheelListener(a)}},tms:function(a){if(GUI.board.touchOriginMoveStart){GUI.board.touchOriginMoveStart(a)}},tom:function(a){if(GUI.board.touchOriginMove){GUI.board.touchOriginMove(a)}},gsl:function(a){GUI.deleteDraftcurves();if(GUI.board.gestureStartListener){GUI.board.gestureStartListener(a)}},gcl:function(a){GUI.deleteDraftcurves();if(GUI.board.gestureChangeListener){GUI.board.gestureChangeListener(a)}},addActionEvent:function(a,b){GUI.addToolEvent(a,b);$("#caption-actions").addClass("not-displayed");$("#control-actions").removeClass("hidden")},addToolEvent:function(c,d,b,a){if(GUI.mode!=null){GUI.modeBeforeToolSwitch=GUI.mode;GUI.switchMode(null,true);$("#control-actions").addClass("hidden")}GUI.disableConstDragMode();if(GUI.collectionContains(GUI.toolType,c)){GUI.removeToolEvent(c)}if(typeof a=="undefined"){a=false}if(!a){GUI.addNavHandlers()}GUI.toolType.push(c);GUI.toolFunc[c]=function(f){d(f,b)};JXG.addEvent(GUI.board.containerObj,c,GUI.toolFunc[c],GUI);console.log("added tool evt for: "+c)},removeToolEvent:function(a){JXG.removeEvent(GUI.board.containerObj,a,GUI.toolFunc[a],GUI);JXG.removeElementFromArray(GUI.toolType,a);delete GUI.toolFunc[a];console.log("removed tool evt for type: "+a);if(GUI.toolType.length==0){GUI.hideBoardText();GUI.removeNavHandlers()}},removeToolEvents:function(b){$('[id*="-related-"]').removeClass("button-selected");for(var a=0;a<GUI.toolType.length;a++){GUI.removeToolEvent(GUI.toolType[a])}GUI.toolType=[];GUI.toolFunc={};if(b){if(GUI.modeBeforeToolSwitch!=null){GUI.switchMode(GUI.modeBeforeToolSwitch,true);GUI.modeBeforeToolSwitch=null;$("#control-actions").removeClass("hidden")}GUI.enableConstDragMode();GUI.showPanel(false,0)}GUI.delight()},checkRecognition:function(c){var f,a=[],d=50,k=false,h=c.hittedPoints.length;if(h>3&&c.recognized!="line"){c.recognized="polygon"}else{for(f=0;f<h;f++){if(c.hittedPoints[f].catchIdx<d){k=true;break}}if(!k){a=["midpoint","reflection"]}c.recognized=(GUI.nd_recognizer.Recognize(new Array(c.GUIpoints),false,false,true,a)).Name;if(h>0&&c.recognized=="line"){var b,g=false,j=false;b=JXG.Draw.findPointNextTo(c.GUIpoints[0],[c.hittedPoints[0]],GUI.rayFactor*JXG.Options.sensitive_area);if(b!=null){g=true}b=JXG.Draw.findPointNextTo(c.GUIpoints[c.GUIpoints.length-1],[c.hittedPoints[c.hittedPoints.length-1]],GUI.rayFactor*JXG.Options.sensitive_area);if(b!=null){j=true}if(g&&j){c.recognized="segment"}else{if(g||j){c.recognized="ray"}}}else{if(c.recognized=="circle2points"&&h==3){c.recognized="sector"}else{if(c.recognized=="bisector"&&h==2){}else{if(c.recognized=="tangent"&&h==2){c.recognized="midpoint"}}}}}},drawSector:function(c){var a=GUI.Lang.std.choosesector,b="";b+='<a class="highlight" id="circleSector">'+GUI.Lang.std.circle_sector+"</a>";b+='<a class="highlight" id="angleSector">'+GUI.Lang.std.angle_sector+"</a>";new GUI.Dialog("sect",b,a);$("#dlg-header-left").css("background-position","-679px -165px");$("#circleSector").bind(GUI.click_event,function(){JXG.Draw.drawCircleSector([c[0].id,c[1].id,c[2].id]);GUI.dialog.sect.removeDialog()});$("#angleSector").bind(GUI.click_event,function(){JXG.Draw.drawAngleSector([c[1].id,c[0].id,c[2].id]);GUI.dialog.sect.removeDialog()})},analyzeNdollarResult:function(c,a){var d,b;if(GUI.action!="standard"){return}d=GUI.draftcurve[c];b=d.GUIpoints;if(b.length<=8){if(!a){JXG.Draw.drawPoint(GUI.board,b);GUI.deleteDraftcurve(c)}return}if(a){GUI.highlightAndCollectPointsOnCurve(d,JXG.Options.sensitive_area,GUI.board)}if((GUI.Options.finderEnabled===false||$("#finder"+d.uuid).hasClass("not-displayed"))&&b.length>0&&GUI.board.mode!=GUI.board.BOARD_MODE_DRAG){if(d.recognized!="polygon"){GUI.checkRecognition(d)}if(!a||(a&&d.oldrecognized!==d.recognized)){if(d.recognized!="blank"){if(d.recognized=="line"||d.recognized=="ray"||d.recognized=="segment"){if(a){}else{JXG.Draw.drawLine(b,d.hittedPoints)}}else{if(d.recognized=="polygon"){if(a){}else{JXG.Draw.drawQuadrilateral(GUI.board,b,d.hittedPoints)}}else{if(d.recognized=="circle"){if(a){}else{JXG.Draw.drawCircle(b,d.hittedPoints)}}else{if(d.recognized=="normal"){if(a){}else{JXG.Draw.drawNormal(GUI.board,b,d.hittedPoints)}}else{if(d.recognized=="parallel"){if(a){}else{JXG.Draw.drawParallel(GUI.board,b)}}else{if(d.recognized=="midpoint"){if(a){}else{JXG.Draw.drawMidPoint(d.hittedPoints)}}else{if(d.recognized=="bisector"){if(a){}else{JXG.Draw.drawBisector(GUI.board,b,d.hittedPoints)}}else{if(d.recognized=="tangent"){if(a){}else{JXG.Draw.drawTangent(GUI.board,b)}}else{if(d.recognized=="circle2points"){if(a){}else{JXG.Draw.drawCircle2Points(GUI.board,b,d.hittedPoints)}}else{if(d.recognized=="triangle"){if(a){}else{JXG.Draw.drawTriangle(GUI.board,b,d.hittedPoints)}}else{if(d.recognized=="quadrilateral"){if(a){}else{JXG.Draw.drawQuadrilateral(GUI.board,b,d.hittedPoints)}}else{if(d.recognized=="perpendicularBisector"){if(a){}else{JXG.Draw.drawBisector(GUI.board,b,d.hittedPoints)}}else{if(d.recognized=="reflection"){if(a){}else{JXG.Draw.drawReflection(GUI.board,b,d.hittedPoints)}}else{if(a){}else{GUI.drawSector(d.hittedPoints)}}}}}}}}}}}}}}if(a){$("#recognition_"+d.oldrecognized).addClass("not-displayed");$("#recognition_"+d.recognized).removeClass("not-displayed");if(d.oldrecognized!=="blank"){$("#status-box").removeClass("not-displayed")}d.oldrecognized=d.recognized}else{GUI.updateNdollarStr(b)}}else{$("#status-box").addClass("not-displayed");$("#recognition_"+d.oldrecognized).addClass("not-displayed")}}}if(!a){GUI.deleteDraftcurve(c)}},createDraftcurve:function(d){var f,c,b,a=false;for(b=0;b<GUI.draftcurve.length;b++){if(!GUI.draftcurve[b].visProp.visible){f=GUI.draftcurve[b];a=true;break}}if(!a){f=GUI.board.create("curve",[[],[]],{curveType:"plot",strokeWidth:0.75*JXG.Options.sensitive_area,opacity:0.65,priv:true,id:"draft_"+GUI.draftcurve.length});f.highlight=function(){};f.noHighlight=function(){};GUI.draftcurve.push(f);f.updateDataArray=function(){for(var g=this.dataX.length;g<this.GUIpoints.length;g++){this.dataX[g]=this.GUIpoints[g].usrCoords[1];this.dataY[g]=this.GUIpoints[g].usrCoords[2]}}}f.GUIpoints=[];f.GUIpoints.push(d);f.hittedPoints=[];f.hittedLines=[];f.lastLength=0;f.uuid=JXG.Util.genUUID();f.name="DRAFTCURVE"+f.uuid;f.dontapply=false;f.finder_object=null;if(GUI.Options.finderEnabled){f.finder_timer=window.setTimeout(function(){GUI.finderTimer(f)},GUI.finder_time_limit)}f.recognized="";f.setAttribute({strokeColor:"grey",visible:true});if(GUI.Options.finderEnabled){c=document.createElement("div");c.setAttribute("id","finder"+f.uuid);c.setAttribute("class","info not-displayed");GUI.getId("mainWindow").appendChild(c)}return b},deleteDraftcurve:function(c){var d,b,a;if(typeof c=="number"){d=GUI.draftcurve[c]}else{d=c}if(GUI.Options.finderEnabled){if(d.finder_timer!==0){window.clearTimeout(d.finder_timer);d.finder_timer=0}GUI.removeFinderObject(d);b=GUI.getId("finder"+d.uuid);if(b!=null){GUI.getId("mainWindow").removeChild(b)}}$("#status-box").addClass("not-displayed");$("#toolbar-panel").removeClass("not-displayed");$('[id^="recognition_"]').addClass("not-displayed");d.setProperty({visible:false});d.GUIpoints=[];d.dataX=[];d.dataY=[];d.recognized="";for(a=0;a<d.hittedPoints.length;a++){d.hittedPoints[a].catchIdx=-1}GUI.delight(0,d.uuid)},deleteDraftcurves:function(){for(var a=0;a<GUI.draftcurve.length;a++){GUI.deleteDraftcurve(a)}GUI.board.update()},affectedDraftcurve:function(j,b){var f,k,h,a,l,g,c=0,d=-1;if(GUI.draftcurve.length===0){return -1}for(f=0;f<GUI.draftcurve.length;f++){a=GUI.draftcurve[f];if(!a.visProp.visible){continue}l=a.GUIpoints;k=j.scrCoords[1]-l[l.length-1].scrCoords[1];h=j.scrCoords[2]-l[l.length-1].scrCoords[2];g=k*k+h*h;if(d==-1||g<c){c=g;d=f}}if(b&&GUI.multiConstructEnabled&&c>JXG.Options.sensitive_area*100){return -1}return d},mapCoordsToDraftcurve:function(c,a){var b;if(typeof a=="undefined"){b=GUI.affectedDraftcurve(c,false)}else{b=a}if(b<0){return -1}GUI.draftcurve[b].GUIpoints.push(c);GUI.draftcurve[b].prepareUpdate().update().updateRenderer();GUI.analyzeNdollarResult(b,true);return b},isConstructive:function(b,a){if(a===false&&GUI.board.mode==GUI.board.BOARD_MODE_DRAG){return false}if((b.which&&b.which===2)||(b.button&&b.button===2)){GUI.activateBoardControls();GUI.contextMenu(GUI.getMouseCoords(b));return false}if(b.shiftKey||GUI.board.mode==GUI.board.BOARD_MODE_MOVE_ORIGIN){GUI.deleteDraftcurves();return false}if(GUI.multiConstructEnabled==false&&(b[JXG.touchProperty]&&b[JXG.touchProperty].length>=2)){GUI.deleteDraftcurves();return false}return true},visibleDraftcurveExists:function(){for(var a=0;a<GUI.draftcurve.length;a++){if(GUI.draftcurve[a].visProp.visible){return true}}return false},downHandler:function(f){GUI.ctx_down_coords=GUI.ctx_curr_coords=GUI.getCoords(f);if(GUI.Settings.get("cursor")){if(JXG.isTouchDevice()){GUI.board.renderer.showTouchpoint(0)}GUI.board.renderer.updateTouchpoint(0,GUI.ctx_curr_coords.scrCoords.slice(1))}if(JXG.isTouchDevice()){if(GUI.Settings.get("magnify")){$("#magnifier").removeClass("not-displayed")}}if(f[JXG.touchProperty]&&f[JXG.touchProperty].length>=2){if(GUI.ctx_timer!==0){clearTimeout(GUI.ctx_timer);GUI.ctx_timer=0}}else{if(f[JXG.touchProperty]||(f.which&&f.which===1)||(f.button&&f.button===1)){GUI.ctx_timer=window.setTimeout(function(){GUI.actionTimer(f)},GUI.context_time_limit)}}if(GUI.isConstructive(f,false)){if(f[JXG.touchProperty]){var c,b,d,a=[];for(c=0;c<f[JXG.touchProperty].length;c++){d=GUI.getTouchCoords(f,c);if((b=GUI.affectedDraftcurve(d,f.changedTouches.length>0))==-1){b=GUI.createDraftcurve(d)}a.push(GUI.draftcurve[b])}GUI.draftcurve=a.slice(0)}else{GUI.createDraftcurve(GUI.getMouseCoords(f));GUI.mouseDown=true}if(f&&f.preventDefault){f.preventDefault()}else{window.event.returnValue=false}}},moveHandler:function(d){GUI.ctx_curr_coords=GUI.getCoords(d);if(GUI.Settings.get("cursor")){GUI.board.renderer.updateTouchpoint(0,GUI.ctx_curr_coords.scrCoords.slice(1))}if((d[JXG.touchProperty]&&d[JXG.touchProperty].length>=2)){if(GUI.ctx_timer!==0){clearTimeout(GUI.ctx_timer);GUI.ctx_timer=0}}if(GUI.ctx_down_coords!=null){var a=GUI.ctx_curr_coords.scrCoords[1]-GUI.ctx_down_coords.scrCoords[1],f=GUI.ctx_curr_coords.scrCoords[2]-GUI.ctx_down_coords.scrCoords[2];if(a*a+f*f>JXG.Options.sensitive_area*10){GUI.ctx_down_coords=null;if(GUI.ctx_timer!==0){clearTimeout(GUI.ctx_timer);GUI.ctx_timer=0}}}if(GUI.isConstructive(d,false)){if(d[JXG.touchProperty]){var c,b;for(c=0;c<d[JXG.touchProperty].length;c++){b=GUI.mapCoordsToDraftcurve(GUI.getTouchCoords(d,c));if(b<0){return}GUI.draftcurve[b].dontapply=false;if(GUI.Options.finderEnabled){GUI.removeFinderObject(GUI.draftcurve[b]);GUI.checkFinderShootOff(b)}}}else{if(GUI.mouseDown){b=GUI.mapCoordsToDraftcurve(GUI.getMouseCoords(d));if(b<0){return}GUI.draftcurve[b].dontapply=false;if(GUI.Options.finderEnabled){GUI.removeFinderObject(GUI.draftcurve[b]);GUI.checkFinderShootOff(b)}}}for(c=0;c<GUI.draftcurve.length;c++){if(GUI.draftcurve[c].recognized!==""){break}}if(d&&d.preventDefault){d.preventDefault()}else{window.event.returnValue=false}}},upHandler:function(g){GUI.mouseDown=false;if(GUI.ctx_timer!==0){clearTimeout(GUI.ctx_timer);GUI.ctx_timer=0}if(JXG.isTouchDevice()){if(GUI.Settings.get("cursor")){GUI.board.renderer.hideTouchpoint(0)}if(GUI.Settings.get("magnify")){$("#magnifier").addClass("not-displayed")}}if(GUI.isConstructive(g,true)){if(GUI.mode=="CD"&&GUI.visibleDraftcurveExists()==false){if(GUI.ctx_down_coords&&GUI.ctx_curr_coords&&GUI.ctx_curr_coords.scrCoords&&GUI.ctx_down_coords.scrCoords&&GUI.ctx_curr_coords.distance(JXG.COORDS_BY_SCREEN,GUI.ctx_down_coords)<10){GUI.createDraftcurve(GUI.ctx_curr_coords)}}GUI.ctx_down_coords=GUI.ctx_curr_coords=null;if(GUI.visibleDraftcurveExists()){if(g[JXG.touchProperty]){var c,b,f;var d=[],a=[];for(c=0;c<GUI.draftcurve.length;c++){d.push(false)}for(c=0;c<g[JXG.touchProperty].length;c++){f=GUI.getTouchCoords(g,c);b=GUI.affectedDraftcurve(f,false);a.push(GUI.draftcurve[b]);d[b]=true}for(c=0;c<d.length;c++){if(!d[c]&&!GUI.draftcurve[c].dontapply&&(GUI.Options.finderEnabled===false||$("#finder"+GUI.draftcurve[c].uuid).hasClass("not-displayed"))){if(GUI.Options.finderEnabled){if(GUI.draftcurve[c].finder_timer!==0){window.clearTimeout(GUI.draftcurve[c].finder_timer);GUI.draftcurve[c].finder_timer=0}}GUI.analyzeNdollarResult(c,false)}}GUI.draftcurve=a.slice(0)}else{if(!GUI.draftcurve[0].dontapply&&(GUI.Options.finderEnabled===false||$("#finder"+GUI.draftcurve[0].uuid).hasClass("not-displayed"))){if(GUI.Options.finderEnabled){if(GUI.draftcurve[0].finder_timer!==0){window.clearTimeout(GUI.draftcurve[0].finder_timer);GUI.draftcurve[0].finder_timer=0}}GUI.analyzeNdollarResult(0,false)}GUI.draftcurve=[]}}if(GUI.visibleDraftcurveExists()==false){if(GUI.constModeSwitch&&GUI.modeBeforeConstSwitch!=null){GUI.switchMode(GUI.modeBeforeConstSwitch,false);GUI.modeBeforeConstSwitch=null}$("#control-actions").removeClass("hidden")}}},objectMoveHook:function(){if(GUI.board.mouse==null&&typeof GUI.board.touches==null){return}if(JXG.Options.device=="pc"&&GUI.board.mouse&&GUI.board.mouse.targets){GUI.logObjectMove(GUI.board.mouse.obj,GUI.board.mouse.targets[0].Xstart,GUI.board.mouse.targets[0].Ystart,GUI.board.mouse.targets[0].Zstart)}else{if(JXG.Options.device=="tablet"&&GUI.board.touches){for(var a in GUI.board.touches){if(GUI.board.touches.hasOwnProperty(a)){if(GUI.board.touches[a].obj&&GUI.board.touches[a].targets[0]){GUI.logObjectMove(GUI.board.touches[a].obj,GUI.board.touches[a].targets[0].Xstart,GUI.board.touches[a].targets[0].Ystart,GUI.board.touches[a].targets[0].Zstart)}}}}}},logObjectMove:function(d,k,b,g){var f,m,l,j,h;var a={};a.src_ids=[];a.dest_sub_ids=[];a.dest_id=0;a.type=JXG.GENTYPE_MOVEMENT;a.args={obj_type:d.type,coords:[]};if(d.type==JXG.OBJECT_TYPE_CAS||d.type==JXG.OBJECT_TYPE_INTERSECTION||d.type==JXG.OBJECT_TYPE_AXIS){return}else{if(d.type==JXG.OBJECT_TYPE_LINE){if(d.point1.coords.usrCoords[1]==k[0]&&d.point1.coords.usrCoords[2]==b[0]&&d.point1.coords.usrCoords[0]==g[0]&&d.point2.coords.usrCoords[1]==k[1]&&d.point2.coords.usrCoords[2]==b[1]&&d.point2.coords.usrCoords[0]==g[1]){return}a.src_ids.push(d.point1.id);a.src_ids.push(d.point2.id);a.args.coords.push({usrCoords:JXG.deepCopy(d.point1.coords.usrCoords)});a.args.coords.push({usrCoords:JXG.deepCopy(d.point2.coords.usrCoords)});a.args.xstart=k;a.args.ystart=b;a.args.zstart=g}else{if(d.type==JXG.OBJECT_TYPE_CIRCLE){m=d.midpoint.coords.usrCoords[1]-k[0];l=d.midpoint.coords.usrCoords[2]-b[0];if(d.midpoint.coords.usrCoords[1]==k[0]&&d.midpoint.coords.usrCoords[2]==b[0]&&d.point2==null){return}a.src_ids.push(d.midpoint.id);a.args.coords.push({usrCoords:JXG.deepCopy(d.midpoint.coords.usrCoords)});a.args.xstart=k[0];a.args.ystart=b[0];if((a.args.has_point2=(d.point2!=null))){j=d.point2.coords.usrCoords[1]-m;h=d.point2.coords.usrCoords[2]-l;if(d.midpoint.coords.usrCoords[1]==k[0]&&d.midpoint.coords.usrCoords[2]==b[0]&&d.point2.coords.usrCoords[1]==j&&d.point2.coords.usrCoords[2]==h){return}a.src_ids.push(d.point2.id);a.args.coords.push({usrCoords:JXG.deepCopy(d.point2.coords.usrCoords)});a.args.old_p2x=j;a.args.old_p2y=h}}else{if(d.type==JXG.OBJECT_TYPE_POLYGON){var c=false;for(f=0;f<d.vertices.length-1;f++){if(d.vertices[f].coords.usrCoords[1]!=k[f]||d.vertices[f].coords.usrCoords[2]!=b[f]){c=true}a.src_ids.push(d.vertices[f].id);a.args.coords.push({usrCoords:JXG.deepCopy(d.vertices[f].coords.usrCoords)})}if(!c){return}a.args.xstart=k;a.args.ystart=b;a.args.zstart=g}else{if(!d.coords){return}if(d.coords.usrCoords[1]==k[0]&&d.coords.usrCoords[2]==b[0]){return}a.src_ids.push(d.id);a.args.coords.push({usrCoords:JXG.deepCopy(d.coords.usrCoords)});a.args.xstart=k[0];a.args.ystart=b[0]}}}}GUI.recordStep(a,false)},keyHandler:function(b){var a;if(b.target.nodeName.toLowerCase()==="input"||b.target.nodeName.toLowerCase()==="textarea"){return}a=b.key||b.keyCode;switch(a){case 37:GUI.board.clickLeftArrow();break;case 39:GUI.board.clickRightArrow();break;case 38:GUI.board.clickDownArrow();break;case 40:GUI.board.clickUpArrow();break;case 90:if(b.ctrlKey){GUI.undo()}break;case 89:if(b.ctrlKey){GUI.redo()}break}},timerHandler:function(){if(GUI.intervalTimer){clearInterval(GUI.intervalTimer);GUI.intervalTimer=0}}});JXG.extend(GUI,{measure:function(){if($("#measure-box").hasClass("button-selected")){GUI.removeMeasureEvt();return}GUI.removeToolEvents(false);$("[class*=measure]").addClass("button-selected");$("#measure-box").addClass("button-selected");GUI.showBoardText(GUI.Lang.std.measure_instruction);GUI.addToolEvent(GUI.down_event,GUI.addMeasureEvt)},addMeasureEvt:function(b){var a,c;GUI.selection=[];if(GUI.select(b,"angleorpoints",false,null)){a=GUI.selection[0].getParents();c=GUI.selection[0].id+".getName() + ' = ' + trunc(deg("+GUI.board.objects[a[0]].id+", "+GUI.board.objects[a[1]].id+", "+GUI.board.objects[a[2]].id+"), "+2+") + '&deg;'"}else{if(GUI.select(b,"sector",false,null)){a=GUI.selection[0].getParents();c="'|&#x2312;| "+GUI.Lang.std.of+" ' + "+GUI.selection[0].name+".getName() + ' = ' + trunc(dist("+GUI.board.objects[a[1]].name+", "+GUI.board.objects[a[0]].name+") * rad("+GUI.board.objects[a[1]].name+", "+GUI.board.objects[a[0]].name+", "+GUI.board.objects[a[2]].name+"), "+2+")"}else{if(GUI.select(b,"line",false,null)){c="'|' + "+GUI.selection[0].point1.name+".getName() + "+GUI.selection[0].point2.name+".getName() + '| = ' + trunc(dist("+GUI.selection[0].point1.name+", "+GUI.selection[0].point2.name+"), "+2+")"}else{if(GUI.selection.length==3){c="'&#x2220;' + "+GUI.selection[0].name+".getName() + "+GUI.selection[1].name+".getName() + "+GUI.selection[2].name+".getName() + ' = ' + trunc(deg("+GUI.selection[0].id+", "+GUI.selection[1].id+", "+GUI.selection[2].id+"), "+2+") + '&deg;'"}else{return}}}}$("#input-text").val(c);GUI.context_set_text($("#id").val(),false);GUI.removeMeasureEvt()},removeMeasureEvt:function(){GUI.removeToolEvents(false);$("[class*=measure]").removeClass("button-selected");$("#measure-box").removeClass("button-selected");GUI.addToolEvent(GUI.down_event,GUI.callOnClick,GUI.contextMenu);GUI.selection=[]},ctx_measureAngle:function(b){var i,j,l=0,k=0,f=GUI.board.objects[b].point2.coords.usrCoords,c=GUI.board.objects[b].point1.coords.usrCoords,a=GUI.board.objects[b].point3.coords.usrCoords,h=[(f[1]+a[1])*0.5-c[1],(f[2]+a[2])*0.5-c[2]],g=Math.sqrt(h[0]*h[0]+h[1]*h[1]);i=GUI.board.objects[b].getParents();j="function () { return "+GUI.board.objects[b].id+".getName() + ' = ' + trunc(deg("+GUI.board.objects[i[0]].id+", "+GUI.board.objects[i[1]].id+", "+GUI.board.objects[i[2]].id+"), "+2+") + '°'; }";if(Math.abs(g)>JXG.Math.eps){l=-h[0]/g*30/GUI.board.unitX;k=-h[1]/g*30/GUI.board.unitY}GUI.recordStep({type:JXG.GENTYPE_TEXT,dest_id:GUI.id(),args:{x:l,y:k,str:j,anchor:GUI.board.objects[b].point1.id+".getName()"}},true)},ctx_measureDistance:function(d){var b,a,c;b="function () { return '|' + "+GUI.board.objects[d].point1.name+".getName() + "+GUI.board.objects[d].point2.name+".getName() + '| = ' + trunc(dist("+GUI.board.objects[d].point1.id+", "+GUI.board.objects[d].point2.id+"), "+2+"); }";a=(GUI.board.objects[d].point1.coords.usrCoords[1]+GUI.board.objects[d].point2.coords.usrCoords[1])/2;c=(GUI.board.objects[d].point1.coords.usrCoords[2]+GUI.board.objects[d].point2.coords.usrCoords[2])/2-GUI.board.objects[d].point1.Dist(GUI.board.objects[d].point2)/5;GUI.recordStep({type:JXG.GENTYPE_TEXT,dest_id:GUI.id(),args:{x:a,y:c,str:b}},true)},ctx_measureSector:function(d){var b,a,c;b="function () { return '|&#x2312;| "+GUI.Lang.std.of+" ' + "+GUI.board.objects[d].name+".getName() + '= ' + trunc(dist("+GUI.board.objects[d].point2.id+", "+GUI.board.objects[d].point1.id+") * rad("+GUI.board.objects[d].point2.id+", "+GUI.board.objects[d].point1.id+", "+GUI.board.objects[d].point3.id+"), "+2+"); }";a=(GUI.board.objects[d].point1.coords.usrCoords[1]+GUI.board.objects[d].point2.coords.usrCoords[1])/2;c=(GUI.board.objects[d].point1.coords.usrCoords[2]+GUI.board.objects[d].point2.coords.usrCoords[2])/2-GUI.board.objects[d].point1.Dist(GUI.board.objects[d].point2)/5;GUI.recordStep({type:JXG.GENTYPE_TEXT,dest_id:GUI.id(),args:{x:a,y:c,str:b}},true)}});JXG.Finder={gatherElements:function(d){var c,f,b=[],a=[],g=[];for(c in d.objects){if(d.objects.hasOwnProperty(c)){f=d.objects[c];if(f.visProp.visible===false){continue}if(JXG.isPoint(f)){b.push(f)}else{if(f.elementClass===JXG.OBJECT_CLASS_LINE){a.push(f)}else{if(f.elementClass===JXG.OBJECT_CLASS_CIRCLE){g.push(f)}}}}}return{points:b,lines:a,circles:g}},isMidpoint:function(a,d,c){var b=[(d.coords.usrCoords[1]+c.coords.usrCoords[1])/2,(d.coords.usrCoords[2]+c.coords.usrCoords[2])/2];if(JXG.Math.Geometry.distance(b,a.coords.usrCoords.slice(1))/d.Dist(c)<0.07){return new JXG.Finder.Fact("midpoint",a,[d,c])}return null},isReflection:function(d,c,a){var b=JXG.Math.Geometry.reflection(a,c,d.board);if(JXG.Math.Geometry.distance(b.usrCoords.slice(1),d.coords.usrCoords.slice(1))<1){return new JXG.Finder.Fact("reflection",d,[c,a])}return null},isParallel:function(d,a){var c=d.getSlope(),b=a.getSlope();if(Math.abs(c-b)<0.07||(Math.abs(c)>10000000000&&Math.abs(b)>10000000000)){return new JXG.Finder.Fact("parallel",d,[a])}return null},isNormal:function(f,c){var d=JXG.Math.Geometry.meetLineLine(f.stdform,c.stdform,0,f.board),b=JXG.Math.Geometry.rad(f.point1,d.usrCoords.slice(1),c.point1);if(Math.abs(Math.abs(b-Math.PI)-Math.PI/2)<0.25){return new JXG.Finder.Fact("normal",f,[c])}return null},isBisector:function(j,f,c){var g=JXG.Math.Geometry.meetLineLine(f.stdform,c.stdform,0,j.board),d=JXG.Math.Geometry.meetLineLine(j.stdform,f.stdform,0,j.board),i=(f.point1.coords.distance(JXG.COORDS_BY_USER,g)<0.2?"point2":"point1"),h=(c.point1.coords.distance(JXG.COORDS_BY_USER,g)<0.2?"point2":"point1"),b=JXG.Math.Geometry.rad(f[i],g.usrCoords.slice(1),j.point1),a=JXG.Math.Geometry.rad(j.point1,g.usrCoords.slice(1),c[h]);if(g.distance(JXG.COORDS_BY_USER,d)<0.5&&(Math.abs(b-a)<0.2||Math.abs(Math.abs(b-a)-Math.PI)<0.2)){return new JXG.Finder.Fact("bisector",j,[f,c])}return null},check:function(f){var g=f.board,a=this.gatherElements(g),h=JXG.isPoint(f),d=f.elementClass===JXG.OBJECT_CLASS_LINE,c,b,l,k=[];for(c=0;c<a.points.length;c++){if(a.points[c].id===f.id){continue}for(b=c;b<a.points.length;b++){if(a.points[b].id===f.id||a.points[c].id===a.points[b].id){continue}if(h){l=this.isMidpoint(f,a.points[c],a.points[b]);if(l&&l.what){k.push(l)}}}for(b=0;b<a.lines.length;b++){if(a.lines[b].id===f.id){continue}if(h){l=this.isReflection(f,a.points[c],a.lines[b]);if(l&&l.what){k.push(l)}l=this.isMirrorpoint(f,a.points[c],a.lines[b]);if(l&&l.what){k.push(l)}}}}for(c=0;c<a.lines.length;c++){if(a.lines[c].id===f.id){continue}if(d){l=this.isParallel(f,a.lines[c]);if(l&&l.what){k.push(l)}l=this.isNormal(f,a.lines[c]);if(l&&l.what){k.push(l)}}for(b=c;b<a.lines.length;b++){if(a.lines[b].id===f.id||a.lines[c].id===a.lines[b].id){continue}if(d){l=this.isBisector(f,a.lines[c],a.lines[b]);if(l&&l.what){k.push(l)}}}}return k}};JXG.Finder.Fact=function(d,c,b){var a;this.what=d;this.element=c;this.parents=b;this.parentnames=[];for(a=0;a<b.length;a++){this.parentnames.push(b[a].name)}};JXG.extend(GUI,{finderConstruct:function(d,f,b){b.updateDataArray=function(){};var a,c,g;GUI.highlightAndCollectPointsOnCurve(b,JXG.Options.sensitive_area,GUI.board);g=b.hittedPoints;switch(d.what){case"line":JXG.Draw.drawLine(f,g);break;case"normal":c=GUI.id();if(g.length>0){a=[d.parents[0].id,g[0].id]}else{a=[d.parents[0].id]}GUI.recordStep({type:JXG.GENTYPE_NORMAL,src_ids:JXG.deepCopy(a),args:{create_point:!(g.length>0),usrCoords:JXG.deepCopy(f[0].usrCoords)},dest_sub_ids:[c],dest_id:GUI.id()},true);break;case"parallel":c=GUI.id();if(g.length>0){a=[d.parents[0].id,g[0].id]}else{a=[d.parents[0].id]}GUI.recordStep({type:JXG.GENTYPE_PARALLEL,src_ids:JXG.deepCopy(a),args:{create_point:!(g.length>0),usrCoords:JXG.deepCopy(f[0].usrCoords)},dest_sub_ids:[GUI.id(),c],dest_id:GUI.id()},true);break;case"bisector":GUI.recordStep({type:JXG.GENTYPE_BISECTORLINES,src_ids:[d.parents[0].id,d.parents[1].id],dest_sub_ids:[GUI.id(),GUI.id(),GUI.id(),GUI.id(),GUI.id(),GUI.id()],dest_id:0},true);break;case"reflection":GUI.recordStep({type:JXG.GENTYPE_REFLECTION,src_ids:[d.parents[0].id,d.parents[1].id],args:{fillColor:"#ffffff"},dest_sub_ids:[],dest_id:GUI.id()},true);break;case"point":JXG.Draw.drawPoint(f);break;case"midpoint":JXG.Draw.drawMidPoint(d.parents);break;default:}GUI.deleteDraftcurve(b);GUI.contextUpdate()},finderTimer:function(j){if(GUI.board.mode==GUI.board.BOARD_MODE_DRAG){return}var d,n,m=[],f=$("#finder"+j.uuid),c,b,a,h=0,g=function(i,l,k){var o=JXG.Util.genUUID();f.append('<a href="#" class="finder_link" id="'+o+'">'+k+"</a>");h++;$("#"+o).bind(GUI.click_event,function(){GUI.finderConstruct(i,l,j);GUI.delight()})};f.html("");j.dontapply=true;b=j.GUIpoints.length-1;if(j.GUIpoints.length<3){j.finder_object=GUI.board.create("point",j.GUIpoints[0].usrCoords,{withLabel:false,name:"",visible:false});m=JXG.Finder.check(j.finder_object);g({what:"point"},j.GUIpoints,GUI.Lang.std.point);for(d=0;d<m.length;d++){g(m[d],j.GUIpoints,GUI.Lang.std[m[d].what]+" "+GUI.Lang.std.of+" "+m[d].parentnames.join(", "))}}else{n=GUI.nd_recognizer.Recognize(new Array(j.GUIpoints),false,false,false);if(n.Name==="line"){j.finder_object=GUI.board.create("line",[j.GUIpoints[0].usrCoords.slice(1),j.GUIpoints[b].usrCoords.slice(1)],{withLabel:false,name:"",visible:false});m=JXG.Finder.check(j.finder_object);g({what:"line"},j.GUIpoints,GUI.Lang.std.line);for(d=0;d<m.length;d++){g(m[d],j.GUIpoints,GUI.Lang.std[m[d].what]+" "+GUI.Lang.std.to+" "+m[d].parentnames.join(", "))}}}if(h===0){j.dontapply=false;f.addClass("not-displayed");f.find("*").unbind()}else{g({what:"cancel"},j.GUIpoints,GUI.Lang.std.cancel);f.css("top",(j.GUIpoints[b].scrCoords[2]-parseInt(f.css("height"))-20)+"px");if(GUI.Settings.get("leftright")=="Left"){f.css("left",(j.GUIpoints[b].scrCoords[1]-parseInt(f.css("width"))-20)+"px")}else{f.css("left",(j.GUIpoints[b].scrCoords[1]+20)+"px")}f.removeClass("not-displayed");for(c=0;c<GUI.draftcurve.length;c++){if(GUI.draftcurve[c]===j){break}}GUI.contextUpdate()}},checkFinderShootOff:function(a){if(GUI.draftcurve[a].GUIpoints[GUI.draftcurve[a].GUIpoints.length-1].distance(JXG.COORDS_BY_SCREEN,GUI.draftcurve[a].GUIpoints[GUI.draftcurve[a].GUIpoints.length-2])>JXG.Options.sensitive_area/3){if(GUI.draftcurve[a].finder_timer!==0){window.clearTimeout(GUI.draftcurve[a].finder_timer);GUI.draftcurve[a].finder_timer=0}GUI.draftcurve[a].finder_timer=window.setTimeout(function(){GUI.finderTimer(GUI.draftcurve[a])},GUI.finder_time_limit);$("#finder"+GUI.draftcurve[a].uuid).addClass("not-displayed");$("#finder"+GUI.draftcurve[a].uuid).find("*").unbind();return false}else{return true}},removeFinderObject:function(b){if(b.finder_object!=null){for(var a in b.finder_object.ancestors){if(b.finder_object.ancestors.hasOwnProperty(a)){GUI.board.removeObject(b.finder_object.ancestors[a])}}GUI.board.removeObject(b.finder_object)}}});JXG.extend(GUI,{getId:function(a){return document.getElementById(a)},getObj:function(a){if(a.indexOf("GUI")==-1){a="GUI"+a}return GUI.board.objects[a]},countElements:function(c){var b=0;for(var a in c){if(c.hasOwnProperty(a)){++b}}return b},collectionContains:function(a,b){if(JXG.isArray(a)){return JXG.isInArray(a,b)}if(JXG.isObject(a)){return JXG.isInObject(a,b)}return a===b},getMouseCoords:function(f){var d,a=JXG.getPosition(f),c,b;if(GUI.board){d=GUI.board.getCoordsTopLeftCorner();c=a[0]-d[0];b=a[1]-d[1];return new JXG.Coords(JXG.COORDS_BY_SCREEN,[c,b],GUI.board)}else{GUI.alert("no coords1");return{scrCoords:[1,a[0],a[1]]}}},getTouchCoords:function(h,d){var g,f,a=JXG.getPosition(h,d),c,b;if(GUI.board){f=GUI.board.getCoordsTopLeftCorner();c=a[0]-f[0];b=a[1]-f[1];return new JXG.Coords(JXG.COORDS_BY_SCREEN,[c,b],GUI.board)}else{GUI.alert("no coords2");return{scrCoords:[1,a[0],a[1]]}}},getCoords:function(a){if(a[JXG.touchProperty]){return GUI.getTouchCoords(a,-1)}else{return GUI.getMouseCoords(a)}},getScreenCoordsXY:function(a){var b;if(a[JXG.touchProperty]){b=GUI.getTouchCoords(a,-1)}else{b=GUI.getMouseCoords(a)}return[b.scrCoords[1],b.scrCoords[2]]},getLastConstructedObject:function(){var a,b;for(a=GUI.id_cnt-1;a>0;a--){b="GUI"+a;if(GUI.board.objects[b]&&GUI.board.objects[b].visProp.visible&&!GUI.board.objects[b].visProp.priv){break}}if(a===0){b=0}return b},isStandardObj:function(a){if(a.visProp.priv===false&&a.type!=JXG.OBJECT_TYPE_TICKS&&a.name.search(/DRAFTCURVE.+/)==-1&&a.id.toString().search(/ticks.+/)==-1&&a.id.toString().search(/infobox$/)==-1&&a.id.toString().search(/Label$/)==-1){return true}else{return false}},callOnClick:function(a,b){b(GUI.getCoords(a))},cutHex:function(a){return(a.charAt(0)=="#")?a.substring(1,7):a},hexToR:function(a){return parseInt((GUI.cutHex(a)).substring(0,2),16)},hexToG:function(a){return parseInt((GUI.cutHex(a)).substring(2,4),16)},hexToB:function(a){return parseInt((GUI.cutHex(a)).substring(4,6),16)},brightness:function(d,c,a){return(0.98*d+0.87*c+0.76*a)},colorDistance:function(i,h){var f,b,d,a,g,c;f=GUI.hexToR(i);d=GUI.hexToG(i);g=GUI.hexToB(i);b=GUI.hexToR(h);a=GUI.hexToG(h);c=GUI.hexToB(h);return(Math.abs(f-b)+Math.abs(d-a)+Math.abs(g-c))},bestColorDivIndex:function(b){var a=+Infinity,c=0,d={dist:a,idx:c};$('[class*="color-palette"]').each(function(f){if($(this).attr("id")=="color-palette-none"){return}var i,g=$(this).css("background-color"),h=g.split(",");h[0]=parseInt(h[0].slice(4));h[1]=parseInt(h[1]);h[2]=parseInt(h[2]);i=GUI.colorDistance(JXG.rgb2hex(h[0],h[1],h[2]),b);if(i<d.dist){d.dist=i;d.idx=f}});return d.idx},getBestSwContrast:function(d){var c,h,f,a;c=d.split(",");h=parseInt(c[0].slice(4));f=parseInt(c[1]);a=parseInt(c[2]);return(GUI.brightness(h,f,a)>200?"#000000":"#ffffff")},insertStrokes:function(l){var h,g,f;var d=[],c=[];l.length=0;for(h=0;h<ND.strokes.length;h++){d=[];for(g=0;g<ND.strokes[h].nbr;g++){c=[];for(f=0;f<ND.strokes[h].data[g].length;f++){c.push(new Point(ND.strokes[h].data[g][f][0],ND.strokes[h].data[g][f][1]))}d.push(c)}l.push(new Multistroke(ND.strokes[h].name,false,d))}},detectDefaultLanguage:function(){if(localStorage.getItem("jsxgui:meta:settings")==null){var a,b;if(window.navigator.userLanguage){b=window.navigator.userLanguage}else{if(window.navigator.language){b=window.navigator.language}}b=b.replace(/-.*/,"");for(a=0;a<GUI.Lang.Map[0].length;a++){if(GUI.Lang.Map[0][a]==b){break}}if(a<GUI.Lang.Map[0].length){GUI.Settings.set("language",GUI.Lang.Map[1][a])}}},setLanguage:function(b){if(GUI.Lang){GUI.Lang.std=JXG.deepCopy(GUI.Lang.strings);if(b=="Deutsch"){GUI.langId=GUI.Lang.de}else{if(b=="English"){GUI.langId=GUI.Lang.en}else{if(b=="Français"){GUI.langId=GUI.Lang.fr}else{if(b=="Español"){GUI.langId=GUI.Lang.es}else{if(b=="Português"){GUI.langId=GUI.Lang.pt}}}}}for(var a in GUI.Lang.std){if(GUI.Lang.strings[a][GUI.langId]!=""){GUI.Lang.std[a]=GUI.Lang.strings[a][GUI.langId]}else{GUI.Lang.std[a]=GUI.Lang.strings[a][GUI.Lang.en]}}}},resolveObjectType:function(a){switch(a.type){case JXG.OBJECT_TYPE_ARROW:return GUI.Lang.std.arrow;case JXG.OBJECT_TYPE_AXIS:return GUI.Lang.std.axis;case JXG.OBJECT_TYPE_AXISPOINT:return GUI.Lang.std.axispoint;case JXG.OBJECT_TYPE_TICKS:return GUI.Lang.std.ticks;case JXG.OBJECT_TYPE_CIRCLE:return GUI.Lang.std.circle;case JXG.OBJECT_TYPE_CONIC:return GUI.Lang.std.conic;case JXG.OBJECT_TYPE_CURVE:return GUI.Lang.std.curve;case JXG.OBJECT_TYPE_GLIDER:if(a.getAttribute("fixed")){return GUI.Lang.std.fixed_glider}else{return GUI.Lang.std.glider}case JXG.OBJECT_TYPE_IMAGE:return GUI.Lang.std.img;case JXG.OBJECT_TYPE_LINE:return GUI.Lang.std.line;case JXG.OBJECT_TYPE_POINT:if(a.getAttribute("fixed")){return GUI.Lang.std.fixed_point}else{return GUI.Lang.std.freePoint}case JXG.OBJECT_TYPE_SLIDER:return GUI.Lang.std.slide;case JXG.OBJECT_TYPE_CAS:return GUI.Lang.std.cas;case JXG.OBJECT_TYPE_POLYGON:return GUI.Lang.std.poly;case JXG.OBJECT_TYPE_SECTOR:return GUI.Lang.std.sect;case JXG.OBJECT_TYPE_TEXT:return GUI.Lang.std.text_element;case JXG.OBJECT_TYPE_ANGLE:return GUI.Lang.std.angle_element;case JXG.OBJECT_TYPE_INTERSECTION:return GUI.Lang.std.intersect;case JXG.OBJECT_TYPE_TURTLE:return GUI.Lang.std.turtle;case JXG.OBJECT_TYPE_VECTOR:return GUI.Lang.std.vect;default:return GUI.Lang.std.unknown}},unpack:function(c,b){var a=new JXG.Util.Unzip(JXG.Util.Base64.decodeAsArray(c)).unzip();if(typeof b=="undefined"){b=0}if(JXG.exists(a[0])){return JXG.Util.UTF8.decode(a[b][0])}else{return""}},greenLog:function(a){if(JXG.Options.device=="pc"&&navigator.userAgent.search("Apple")==-1){console.log("%c[L] "+a,"color:green;")}else{console.log("[L] "+a)}},parse:function(c,a){if(JXG.Options.device=="pc"&&navigator.userAgent.search("Apple")==-1){try{GUI.board.jc.parse(c);if(a){console.log("%c[E+L] "+c,"color:#3820a7;")}}catch(b){console.log("Exception: "+b);console.log("%c[ERR] Error parsing: "+c,"color:red;");return false}}else{try{GUI.board.jc.parse(c);if(a){console.log("[E+L] "+c)}}catch(b){console.log("Exception: "+b);console.log("[ERR] Error parsing: "+c);return false}}return true},executeJCode:function(d,c){var a=GUI.parse(d[0],c);if(JXG.isArray(d[1])){for(var b=0;b<d[1].length;b++){d[1][b]()}}else{if(JXG.isFunction(d[1])){d[1]()}}return a},revertJCode:function(d,c){var a=GUI.parse(d[2],c);if(JXG.isArray(d[3])){for(var b=0;b<d[3].length;b++){d[3][b]()}}else{if(JXG.isFunction(d[3])){d[3]()}}return a},isTouchInElementsBounds:function(c,g){var f,d,b,a;f=c.changedTouches[0];b=$("#"+g).outerHeight();a=$("#"+g).outerWidth();d=$("#"+g).offset();return(f.pageX>d.left&&f.pageX<d.left+a&&f.pageY>d.top&&f.pageY<d.top+b)}});JXG.extend(GUI,{ctx_visible:function(a){return(!$("div#ctx_panel").hasClass("not-displayed"))&&$("input#id").attr("value")==a},ctx_input_toggle:function(c,b,a){a=JXG.def(a,"button-selected");$(c)[b+"Class"](a);$(c+"-box")[b+"Class"](a)},context_set_fixed:function(c){var b=GUI.board.objects[c].getAttribute("fixed"),a;a={type:JXG.GENTYPE_CTX_SETFIXED,args:{s:!b},src_ids:[c],dest_sub_ids:[],dest_id:0};GUI.recordStep(a,true)},context_set_trace:function(c){var a=GUI.board.objects[c].getAttribute("trace"),b;b={type:JXG.GENTYPE_CTX_TRACE,args:{s:!a},src_ids:[c],dest_sub_ids:[],dest_id:0};GUI.recordStep(b,true)},context_set_withLabel:function(c){var a=GUI.board.objects[c].getAttribute("withLabel"),b;b={type:JXG.GENTYPE_CTX_WITHLABEL,args:{s:!a},src_ids:[c],dest_sub_ids:[],dest_id:0};GUI.recordStep(b,true)},context_set_visibility:function(c){var a=GUI.board.objects[c].getAttribute("visible"),b;b={type:JXG.GENTYPE_CTX_VISIBILITY,args:{s:!a},src_ids:[c],dest_sub_ids:[],dest_id:0};GUI.recordStep(b,true)},context_set_dotvisibility:function(d){var c=GUI.board.objects,a,b;if(GUI.showHidden){a=c[c[d].dot.id].guiVisProp.visible}else{a=c[c[d].dot.id].getAttribute("visible")}b={type:JXG.GENTYPE_CTX_DOTVISIBILITY,args:{s:!a},src_ids:[d],dest_sub_ids:[],dest_id:0};GUI.recordStep(b,true)},context_set_text:function(c){var a=$("#input-text").val().sanitize(),b;b={type:JXG.GENTYPE_CTX_TEXT,args:{s:a,old:GUI.ContextSave.text},src_ids:[c],dest_sub_ids:[],dest_id:0};GUI.recordStep(b,true)},context_set_angleradius:function(c){var b=GUI.getId("angle-radius-field").value;if(b==""||isNaN(b)||b==null){return}var a={type:JXG.GENTYPE_CTX_ANGLERADIUS,args:{s:b,old:GUI.ContextSave.angleRadius},src_ids:[c],dest_sub_ids:[],dest_id:0};GUI.recordStep(a,true)},context_set_label:function(c){var a=GUI.getId("input-text").value.sanitize().replace(/\\/g,"").replace(/'/g,"\\'"),b;if(a===""){return}b={type:JXG.GENTYPE_CTX_SETLABEL,args:{s:a,old:GUI.ContextSave.labelName},src_ids:[c],dest_sub_ids:[],dest_id:0};GUI.recordStep(b,true)},context_set_strokeWidth:function(c){var a=parseInt(GUI.getId("color-field").value),b;if(a<1){a=100}if(a>100||isNaN(a)){a=1}$("#color-field").val(a);b={type:JXG.GENTYPE_CTX_STROKEWIDTH,args:{s:a,old:GUI.ContextSave.strokeWidth},src_ids:[c],dest_sub_ids:[],dest_id:0};GUI.recordStep(b,true)},context_set_fillOpacity:function(c){var b=parseInt(GUI.getId("color-field").value),a;if(b<0){b=100}if(b>100||isNaN(b)){b=0}$("#color-field").val(b);a={type:JXG.GENTYPE_CTX_FILLOPACITY,args:{s:b,old:GUI.ContextSave.fillOpacity},src_ids:[c],dest_sub_ids:[],dest_id:0};GUI.recordStep(a,true)},context_set_labelSize:function(d){var a=parseInt(GUI.getId("color-field").value),c=d,b;if(a<1){a=100}if(a>100||isNaN(a)){a=1}$("#color-field").val(a);if(GUI.board.objects[d].type!=JXG.OBJECT_TYPE_TEXT){d+="Label"}b={type:JXG.GENTYPE_CTX_LABELSIZE,args:{s:a,old:GUI.ContextSave.labelSize},src_ids:[c,d],dest_sub_ids:[],dest_id:0};GUI.recordStep(b,true)},context_set_size:function(c){var a=parseInt(GUI.getId("point-size-field").value),b;if(a<1){a=100}if(a>100||isNaN(a)){a=1}$("#point-size-field").val(a);b={type:JXG.GENTYPE_CTX_SIZE,args:{s:a,old:GUI.ContextSave.size},src_ids:[c],dest_sub_ids:[],dest_id:0};GUI.recordStep(b,true)},context_set_face:function(c){var b,a;if($("#point-style-button-circle").hasClass("button-selected")){b="circle"}else{if($("#point-style-button-square").hasClass("button-selected")){b="square"}else{if($("#point-style-button-cross").hasClass("button-selected")){b="cross"}else{b="plus"}}}a={type:JXG.GENTYPE_CTX_FACE,args:{s:b,old:GUI.ContextSave.face},src_ids:[c],dest_sub_ids:[],dest_id:0};GUI.recordStep(a,true)},context_set_radius:function(d){var b=GUI.getId("circle-radius-field").value;if(b==""||isNaN(b)||b==null){return}var c,a;if(GUI.board.objects[d].point2!=null){c=GUI.board.objects[d].point2.coords.usrCoords}else{c=[]}a={type:JXG.GENTYPE_CTX_RADIUS,src_ids:[d],dest_sub_ids:[],dest_id:0,args:{s:b,old:GUI.ContextSave.radius,midpoint:{usrCoords:JXG.deepCopy(GUI.board.objects[d].midpoint.coords.usrCoords)},point2:{usrCoords:JXG.deepCopy(c)}}};GUI.recordStep(a,true)},context_set_straightfirst:function(c){var a=$("#line-button-first").hasClass("button-selected"),b;b={type:JXG.GENTYPE_CTX_STRAIGHT,args:{which:"first",s:a},src_ids:[c],dest_sub_ids:[],dest_id:0};GUI.recordStep(b,true)},context_set_xcoord:function(c){var a=GUI.getId("point-coord-x-field").value.sanitize(),b;b={type:JXG.GENTYPE_CTX_COORDS,args:{s:a,old:GUI.ContextSave.Xjc,set_x:true},src_ids:[c],dest_sub_ids:[],dest_id:0};GUI.recordStep(b,true)},context_set_ycoord:function(c){var b=GUI.getId("point-coord-y-field").value.sanitize(),a;a={type:JXG.GENTYPE_CTX_COORDS,args:{s:b,old:GUI.ContextSave.Yjc,set_x:false},src_ids:[c],dest_sub_ids:[],dest_id:0};GUI.recordStep(a,true)},context_set_straightlast:function(c){var a=$("#line-button-last").hasClass("button-selected"),b;b={type:JXG.GENTYPE_CTX_STRAIGHT,args:{which:"last",s:a},src_ids:[c],dest_sub_ids:[],dest_id:0};GUI.recordStep(b,true)},context_set_arrowfirst:function(d){var b=$("#line-button-arrow-first").hasClass("button-selected"),c;c={type:JXG.GENTYPE_CTX_ARROW,args:{which:"first",s:b},src_ids:[d],dest_sub_ids:[],dest_id:0};GUI.recordStep(c,true)},context_set_arrowlast:function(d){var b=$("#line-button-arrow-last").hasClass("button-selected"),c;c={type:JXG.GENTYPE_CTX_ARROW,args:{which:"last",s:b},src_ids:[d],dest_sub_ids:[],dest_id:0};GUI.recordStep(c,true)},context_set_color:function(h){var b,g,a,d,f;if(!$("#color-tab-label").hasClass("button-disabled")){b="labelstroke"}else{if(!$("#color-tab-stroke").hasClass("button-disabled")){b="stroke"}else{if(!$("#color-tab-fill").hasClass("button-disabled")){b="fill"}else{return}}}f=$("#color-field");if(f.css("background-color")!=="transparent"&&f.css("background-color")!=="rgba(0, 0, 0, 0)"){if(b=="fill"){a=f.val()/100}else{a=1}g=JXG.rgbo2rgba(JXG.rgb2hex(f.css("background-color")),a)}else{g="transparent"}d={type:JXG.GENTYPE_CTX_COLOR,src_ids:[h],dest_sub_ids:[],dest_id:0,args:{s:g,old:GUI.ContextSave.color[b],element:b,hasLabel:(GUI.board.objects[h].label&&GUI.board.objects[h].label.content)}};GUI.recordStep(d,true)},context_set_type:function(a,p,j){var n,o,b;if(typeof p=="undefined"){if($("#point-glider-button-free").hasClass("button-selected")){p=JXG.OBJECT_TYPE_POINT}else{p=JXG.OBJECT_TYPE_GLIDER}if(p==GUI.ContextSave.type){return}}n=GUI.ContextSave.color.fill;o=GUI.ContextSave.color.stroke;if(p==JXG.OBJECT_TYPE_GLIDER){if(typeof j=="undefined"){if(GUI.getId("slideObject")){j=GUI.getId("slideObject").value}else{j=""}}if(j===""){var d,g=JXG.Draw.findHittedObjs(GUI.board.objects[a].coords.scrCoords[1],GUI.board.objects[a].coords.scrCoords[2],GUI.board,JXG.Options.sensitive_area,[JXG.OBJECT_CLASS_POINT,JXG.OBJECT_CLASS_LINE,JXG.OBJECT_CLASS_CIRCLE,JXG.OBJECT_CLASS_CURVE],[]),l=[];for(d=0;d<g.length;d++){if(!GUI.collectionContains(GUI.board.objects[a].descendants,g[d])&&g[d].id!=a){l.push(g[d])}}g=l;if(g.length==1){j=g[0].id}}if(!n){n=JXG.Options.point.fillColor}if(!o){o=JXG.Options.point.strokeColor}if(j!==""){var c,m,q,k,h;b={type:JXG.GENTYPE_CTX_TYPE_G,src_ids:[a,j],dest_sub_ids:[],dest_id:0,args:{fill:n,stroke:o,Xjc:GUI.board.objects[a].coords.usrCoords[1],Yjc:GUI.board.objects[a].coords.usrCoords[2]}};if(JXG.isTouchDevice()){c=GUI.board.touches[0].targets[0].Xstart[0];m=GUI.board.touches[0].targets[0].Ystart[0];q=JXG.deepCopy(GUI.board.touches[0].obj.coords.usrCoords)}else{c=GUI.board.mouse.targets[0].Xstart[0];m=GUI.board.mouse.targets[0].Ystart[0];q=JXG.deepCopy(GUI.board.mouse.obj.coords.usrCoords)}k={type:JXG.GENTYPE_MOVEMENT,src_ids:b.src_ids,dest_sub_ids:[],dest_id:0,args:{obj_type:JXG.OBJECT_TYPE_POINT,xstart:c,ystart:m,coords:[{usrCoords:q}]}};h={type:JXG.GENTYPE_COMBINED,src_ids:b.src_ids,dest_sub_ids:[],dest_id:0,args:{steps:[k,b]}};GUI.recordStep(h,true);GUI.board.update();GUI.removeGlideInterEvt()}else{GUI.removeToolEvents(false);if(GUI.action=="ablation"){GUI.showBoardText(GUI.Lang.std.glider_instruct)}else{GUI.showBoardText(GUI.Lang.std.mark_glider_object)}GUI.addToolEvent(GUI.move_event,GUI.movePoint,a,true);GUI.addToolEvent(GUI.up_event,GUI.addGlideInterEvt,a,false)}}else{var f=GUI.ContextSave.slideObjectId;if(!n){n=JXG.Options.glider.fillColor}if(!o){o=JXG.Options.glider.strokeColor}if(!f){f=GUI.board.objects[a].slideObject.id}b={type:JXG.GENTYPE_CTX_TYPE_P,src_ids:[a,f],dest_sub_ids:[],dest_id:0,args:{fill:n,stroke:o,Xjc:GUI.board.objects[a].coords.usrCoords[1],Yjc:GUI.board.objects[a].coords.usrCoords[2]}};GUI.recordStep(b,true)}},generateJCode:function(z,l){var I,a,o,v,y,t,k,F,m="",D="",f="",G="";o=l.objects;var i=function(L){return function(){if(GUI.ctx_visible(L)){$("#point-glider-button-glider").addClass("button-selected");$("#point-glider-button-free").removeClass("button-selected");$("#point-coord").addClass("not-displayed");l.update()}}};var j=function(L){return function(){if(GUI.ctx_visible(L)){$("#point-glider-button-free").addClass("button-selected");$("#point-glider-button-glider").removeClass("button-selected");$("#point-coord").removeClass("not-displayed")}}};switch(z.type){case JXG.GENTYPE_CTX_TYPE_G:m=z.src_ids[0]+".glide("+z.src_ids[1]+"); ";if(o[z.src_ids[1]].elementClass==JXG.OBJECT_CLASS_POINT){m+=z.src_ids[0]+".visible = false; "}else{m+=z.src_ids[0]+".fillColor = '"+JXG.Options.glider.fillColor+"'; ";m+=z.src_ids[0]+".strokeColor = '"+JXG.Options.point.strokeColor+"'; "}D=z.src_ids[0]+".free(); ";if(o[z.src_ids[1]].elementClass==JXG.OBJECT_CLASS_POINT){D+=z.src_ids[0]+".visible = true; "}else{if(z.args.fill&&z.args.stroke){D+=z.src_ids[0]+".fillColor = '"+z.args.fill+"'; ";D+=z.src_ids[0]+".strokeColor = '"+z.args.stroke+"'; "}}D+=z.src_ids[0]+".move(["+z.args.Xjc+", "+z.args.Yjc+"], 0); ";f=i(z.src_ids[0]);G=j(z.src_ids[0]);break;case JXG.GENTYPE_CTX_TYPE_P:m=z.src_ids[0]+".free(); "+z.src_ids[0]+".fillColor = '";m+=JXG.Options.point.fillColor+"'; ";m+=z.src_ids[0]+".strokeColor = '"+JXG.Options.point.strokeColor+"'; ";D=z.src_ids[0]+".fillColor = '"+z.args.fill+"'; ";D+=z.src_ids[0]+".strokeColor = '"+z.args.stroke+"'; ";D+=z.src_ids[0]+".glide("+z.src_ids[1]+"); ";f=j(z.src_ids[0]);G=i(z.src_ids[0]);break;case JXG.GENTYPE_CTX_WITHLABEL:var H=function(L,M){return function(){if(GUI.ctx_visible(M)){$("#input-text").removeClass("button-disabled");$("#label-visible").addClass("button-selected");$("#color-tab-label").removeClass("not-displayed");GUI.ContextSave.withLabel=L}}};var w=function(L,M){return function(){if(GUI.ctx_visible(M)){$("#input-text").addClass("button-disabled");$("#label-visible").removeClass("button-selected");$("#color-tab-label").addClass("not-displayed");$("#color-tab-stroke").trigger(GUI.click_event);GUI.ContextSave.withLabel=L}}};if(typeof z.args.s=="undefined"){z.args.s=z.args.l}if(z.args.s){m=z.src_ids[0]+".withLabel = true; ";D=z.src_ids[0]+".withLabel = false; ";f=H(true,z.src_ids[0]);G=w(false,z.src_ids[0])}else{m=z.src_ids[0]+".withLabel = false; ";D=z.src_ids[0]+".withLabel = true; ";f=w(false,z.src_ids[0]);G=H(true,z.src_ids[0])}break;case JXG.GENTYPE_CTX_VISIBILITY:if(typeof z.args.s=="undefined"){z.args.s=z.args.v}m+=z.src_ids[0]+".visible = "+z.args.s+"; ";D+=z.src_ids[0]+".visible = "+!z.args.s+"; ";var g=function(L,N,M){return function(){if(GUI.ctx_visible(N)){var O,Q="add",P="remove";if(!L){O=P;P=Q;Q=O}GUI.ctx_input_toggle("#input-text",P,"button-disabled");if(M.type==JXG.OBJECT_TYPE_TEXT){GUI.ctx_input_toggle("#label-visible",Q)}GUI.ContextSave.visible=L}if(!M){M=GUI.board.objects[N]}}};a=o[z.src_ids[0]];if(z.args.s){f=g(true,z.src_ids[0],a);G=g(false,z.src_ids[0],a)}else{f=g(false,z.src_ids[0],a);G=g(true,z.src_ids[0],a)}break;case JXG.GENTYPE_CTX_DOTVISIBILITY:if(typeof z.args.s=="undefined"){z.args.s=z.args.v}m=z.src_ids[0]+".orthotype = "+(z.args.s?"'sectordot'":"'sector'")+"; ";D=z.src_ids[0]+".orthotype = "+(z.args.s?"'sector'":"'sectordot'")+"; ";var n=function(M,L){return function(){if(GUI.ctx_visible(L)){GUI.ctx_input_toggle("#angle-button-rightangle",M)}}};if(z.args.s){f=n("add",z.src_ids[0]);G=n("remove",z.src_ids[0])}else{f=n("remove",z.src_ids[0]);G=n("add",z.src_ids[0])}break;case JXG.GENTYPE_CTX_MPVISIBILITY:if(z.args.s=="undefined"){z.args.s=z.args.v}m=z.src_ids[1]+".visible = "+z.args.s+"; ";D=z.src_ids[1]+".visible = "+!z.args.s+"; ";var K=function(L,O,N,M){return function(){if(GUI.ctx_visible(N)){GUI.ctx_input_toggle("#line-related-midpoint",O)}M.guiVisProp=M.guiVisProp||{};M.guiVisProp.visible=L}};a=o[z.src_ids[1]];if(z.args.s){f=K(true,"add",z.src_ids[0],a);G=K(false,"remove",z.src_ids[0],a)}else{f=K(false,"remove",z.src_ids[0],a);G=K(true,"add",z.src_ids[0],a)}break;case JXG.GENTYPE_CTX_SETFIXED:if(typeof z.args.s=="undefined"){z.args.s=z.args.f}m=z.src_ids[0]+".fixed = "+z.args.s+"; ";D=z.src_ids[0]+".fixed = "+!z.args.s+"; ";var h=function(M,L){return function(){if(GUI.ctx_visible(L)){GUI.ctx_input_toggle("#status-fix",M);$("#point-coord")[M+"Class"]("not-displayed")}}};if(z.args.s){f=h("add",z.src_ids[0]);G=h("remove",z.src_ids[0])}else{f=h("remove",z.src_ids[0]);G=h("add",z.src_ids[0])}break;case JXG.GENTYPE_CTX_TRACE:if(typeof z.args.s=="undefined"){z.args.s=z.args.t}m=z.src_ids[0]+".trace = "+z.args.s+"; ";D=z.src_ids[0]+".trace = "+!z.args.s+"; ";var B=function(M,L){return function(){if(GUI.ctx_visible(L)){GUI.ctx_input_toggle("#status-trace",M)}}};if(z.args.s){f=B("add",z.src_ids[0]);G=B("remove",z.src_ids[0])}else{f=B("remove",z.src_ids[0]);G=B("add",z.src_ids[0])}break;case JXG.GENTYPE_CTX_SETLABEL:if(typeof z.args.s=="undefined"){z.args.s=z.args.l}m=z.src_ids[0]+".name = '"+z.args.s+"'; ";m+=z.src_ids[0]+".label.setText('"+z.args.s+"'); ";z.args.old=z.args.old.sanitize().replace(/\\/g,"").replace(/'/g,"\\'");D=z.src_ids[0]+".name = '"+z.args.old+"'; ";D+=z.src_ids[0]+".label.setText('"+z.args.old+"'); ";var c=function(L,M){return function(){if(GUI.ctx_visible(M)){$("#input-text").attr("value",L);GUI.ContextSave.labelName=L}}};f=c(z.args.s,z.src_ids[0]);G=c(z.args.old,z.src_ids[0]);break;case JXG.GENTYPE_CTX_STROKEWIDTH:if(z.args.s=="undefined"){z.args.s=z.args.w}m=z.src_ids[0]+".strokeWidth = "+z.args.s+"; ";D=z.src_ids[0]+".strokeWidth = "+z.args.old+"; ";var A=function(L,M){return function(){if(GUI.ctx_visible(M)){if(!$("#color-tab-stroke").hasClass("button-disabled")){$("#color-field").val(L)}GUI.ContextSave.strokeWidth=L}}};f=A(z.args.s,z.src_ids[0]);G=A(z.args.old,z.src_ids[0]);break;case JXG.GENTYPE_CTX_LABELSIZE:m=z.src_ids[1]+".fontSize = "+z.args.s+"; ";D=z.src_ids[1]+".fontSize = "+z.args.old+"; ";var x=function(L,M){return function(){if(GUI.ctx_visible(M)){if(!$("#color-tab-label").hasClass("button-disabled")){$("#color-field").val(L)}GUI.ContextSave.labelSize=L}}};f=x(z.args.s,z.src_ids[0]);G=x(z.args.old,z.src_ids[0]);break;case JXG.GENTYPE_CTX_SIZE:m=z.src_ids[0]+".size = "+z.args.s+"; ";D=z.src_ids[0]+".size = "+z.args.old+"; ";var E=function(L,M){return function(){if(GUI.ctx_visible(M)){$("#point-size-field").val(L);GUI.ContextSave.size=L}}};f=E(z.args.s,z.src_ids[0]);G=E(z.args.old,z.src_ids[0]);break;case JXG.GENTYPE_CTX_FACE:if(typeof z.args.s=="undefined"){z.args.s=z.args.f}m=z.src_ids[0]+".face = '"+z.args.s+"'; ";D=z.src_ids[0]+".face = '"+z.args.old+"'; ";var J=function(L,M){return function(){if(GUI.ctx_visible(M)){$("#point-style-button-circle").removeClass("button-selected");$("#point-style-button-square").removeClass("button-selected");$("#point-style-button-cross").removeClass("button-selected");$("#point-style-button-plus").removeClass("button-selected");$("#point-style-button-"+L).addClass("button-selected");GUI.ContextSave.face=L}}};f=J(z.args.s,z.src_ids[0]);G=J(z.args.old,z.src_ids[0]);break;case JXG.GENTYPE_CTX_STRAIGHT:m=D=z.src_ids[0]+".straight"+z.args.which+" = ";m+=z.args.s+"; ";D+=!z.args.s+"; ";var q=function(L,M){return function(){if(GUI.ctx_visible(M)){v=$("#line-button-"+z.args.which);if(L){v.addClass("button-selected")}else{v.removeClass("button-selected")}}}};f=q(z.args.s,z.src_ids[0]);G=q(!z.args.s,z.src_ids[0]);break;case JXG.GENTYPE_CTX_ARROW:if(typeof z.args.s=="undefined"){z.args.s=z.args.a}m=D=z.src_ids[0]+"."+z.args.which+"arrow = ";m+=z.args.s+"; ";D+=!z.args.s+"; ";var u=function(L,M){return function(){if(GUI.ctx_visible(M)){v=$("#line-button-arrow-"+z.args.which);if(L){v.addClass("button-selected")}else{v.removeClass("button-selected")}}}};f=u(z.args.s,z.src_ids[0]);G=u(!z.args.s,z.src_ids[0]);break;case JXG.GENTYPE_CTX_ANGLERADIUS:if(typeof z.args.s=="undefined"){z.args.s=z.args.r}m=z.src_ids[0]+".radius = "+z.args.s+"; ";D=z.src_ids[0]+".radius = "+z.args.old+"; ";var p=function(L,M){return function(){if(GUI.ctx_visible(M)){$("#angle-radius-field").val(L);GUI.ContextSave.angleRadius=L}}};f=p(z.args.s,z.src_ids[0]);G=p(z.args.old,z.src_ids[0]);break;case JXG.GENTYPE_CTX_RADIUS:if(typeof z.args.s=="undefined"){z.args.s=z.args.r}m=z.src_ids[0]+".setRadius(function () { return "+z.args.s+"; }); ";D=z.src_ids[0]+".setRadius(function () { return "+z.args.old+"; }); ";var b=function(L,M){return function(){if(GUI.ctx_visible(M)){$("#circle-radius-field").val(L);GUI.ContextSave.radius=L}}};f=b(z.args.s,z.src_ids[0]);G=b(z.args.old,z.src_ids[0]);break;case JXG.GENTYPE_CTX_COORDS:if(typeof z.args.s=="undefined"){if(typeof z.args.y=="undefined"){z.args.s=z.args.x}else{z.args.s=z.args.y}}if(z.args.set_x){k=z.args.s;F=z.args.old;t="X"}else{k=z.args.s;F=z.args.old;t="Y"}m=z.src_ids[0]+"."+t+" = function() { return "+k+"; }; ";if(parseFloat(k)==k){m+=z.src_ids[0]+".free(); "}D=z.src_ids[0]+"."+t+" = function() { return "+F+"; }; ";if(F.toString().search("function")==-1){D+=z.src_ids[0]+".free(); "}var r=function(L,N,M){return function(){if(GUI.ctx_visible(M)){$("#point-coord-"+L.toLowerCase()+"-field").val(N);GUI.ContextSave[L+"jc"]=N}}};f=r(t,k,z.src_ids[0]);G=r(t,F,z.src_ids[0]);break;case JXG.GENTYPE_CTX_TEXT:if(typeof z.args.s=="undefined"){z.args.s=z.args.t}if(z.args.s.search(/'/)==-1){m=z.src_ids[0]+".setText('"+z.args.s+"'); "}else{m=z.src_ids[0]+".setText(function () { return "+z.args.s+"; }); "}if(z.args.old.search(/function/)==-1){D=z.src_ids[0]+".setText('"+z.args.old+"'); "}else{D=z.src_ids[0]+".setText(function () { return "+z.args.old+"; }); "}var d=function(L,M){return function(){if(GUI.ctx_visible(M)){$("#input-text").val(L);GUI.ContextSave.text=L}}};f=d(z.args.s,z.src_ids[0]);G=d(z.args.old,z.src_ids[0]);break;case JXG.GENTYPE_CTX_FILLOPACITY:if(typeof z.args.s=="undefined"){z.args.s=z.args.o}m=z.src_ids[0]+".fillOpacity = "+(z.args.s/100)+"; ";D=z.src_ids[0]+".fillOpacity = "+z.args.old+"; ";var C=function(L,N,M){return function(){if(GUI.ctx_visible(N)){if(L>1){L/=100}if(!$("#color-tab-fill").hasClass("button-disabled")){$("#color-field").val(L*100)}GUI.ContextSave.fillOpacity=L;GUI.ContextSave.color.fill=JXG.rgbo2rgba(M.getAttribute("fillColor"),L)}}};a=o[z.src_ids[0]];f=C(z.args.s,z.src_ids[0],a);G=C(z.args.old,z.src_ids[0],a);break;case JXG.GENTYPE_CTX_COLOR:if(z.args.element.substr(0,5)=="label"){y=".label."}else{y="."}if(typeof z.args.s=="undefined"){z.args.s=z.args.c}m=z.src_ids[0]+y+z.args.element.replace("label","")+"Color = '";m+=z.args.s+"'; ";D=z.src_ids[0]+y+z.args.element.replace("label","")+"Color = '";D+=z.args.old+"'; ";a=o[z.src_ids[0]];if(z.args.element=="stroke"&&a.type==JXG.OBJECT_TYPE_POLYGON){for(I in a.borders){if(a.borders.hasOwnProperty(I)){m=a.borders[I].id+y+z.args.element.replace("label","")+"Color = '"+z.args.s+"'; "+m;D=D+a.borders[I].id+y+z.args.element.replace("label","");D+="Color ='"+z.args.old+"'; "}}}if(z.args.element.substr(0,9)=="highlight"&&z.args.hasLabel){m+=z.src_ids[0]+".label."+z.args.element+"Color = '"+z.args.s+"'; ";D=z.src_ids[0]+".label."+z.args.element+"Color = '"+z.args.old+"'; "}var s=function(M,L,N){return function(){var O=JXG.rgba2rgbo(M),P={labelstroke:"label",stroke:"stroke",fill:"fill"};if(GUI.ctx_visible(N)){v=$("#color-field");if(!$("#color-tab-"+P[L]).hasClass("button-disabled")){v.css("background-color",O[0]);v.css("color",GUI.getBestSwContrast(JXG.hex2rgb(O[0])))}GUI.ContextSave.color[L]=M}}};f=s(z.args.s,z.args.element,z.src_ids[0]);G=s(z.args.old,z.args.element,z.src_ids[0]);break;default:return[]}return[m,f,D,G]}});GUI.tpl=(function(){var a={};return{load:function(b){a[b]=a[b]||this.trim(document.getElementById(b).innerHTML);return a[b]},trim:function(b){b=b.replace(/^\s+/,"");b=b.replace(/\s+$/,"");return b},render:function(d,f){var b,c;b=this.load(d)||"Template not found";c=/%L-(.*?)%/;while(c.test(b)){b=b.replace(c,GUI.Lang.std[RegExp.$1]||("#!$"+RegExp.$1+"#!$"))}c=/%(.*?)%/;while(c.test(b)){b=b.replace(c,(typeof f[RegExp.$1]!=="undefined"&&f[RegExp.$1]!==null?f[RegExp.$1]:("#!$"+RegExp.$1+"#!$")))}c=/#!\$/g;b=b.replace(c,"%");return b}}})();var Flow=function(c,a){var b=this;this.id=c;this.hid="#"+c;this.speed=100;this.root=$(this.hid);this.itemlist=$(this.hid+" .itemlist");this.width=parseInt(this.root.css("width"));this.height=a.previewHeight||502;this.previewWidth=a.previewWidth||502;this.itemSpace=a.itemSpace||50;this.itemPreview=(this.width-this.previewWidth-2*this.itemSpace)/2;this.scrollWidth=this.itemSpace+this.previewWidth;this.items=[];this.eventHandlers={};this.currentItem=0;this.handleKbd=false;this.eventCapture=a.eventCapture||c;if(!JXG.isArray(this.eventCapture)){this.eventCapture=[this.eventCapture]}$.each($(this.hid+" .itemlist .item"),function(f,d){d.id=null;b.items.push(d)});this.initMarkers();this.addEventListener()};Flow.prototype.initMarkers=function(){this.spacerStart=$(document.createElement("div"));this.spacerStart.css("width",this.itemPreview+"px");this.spacerStart.css("height",this.height+"px");this.spacerStart.addClass("carousel-marker yzBackgroundColorM");this.spacerStart.attr("id",this.id+"startmarker");this.itemlist.prepend(this.spacerStart);this.spacerEnd=$(document.createElement("div"));this.spacerEnd.css("width",(this.itemPreview+this.itemSpace)+"px");this.spacerEnd.css("height",this.height+"px");this.spacerEnd.addClass("carousel-marker yzBackgroundColorM");this.spacerEnd.attr("id",this.id+"endmarker");this.itemlist.append(this.spacerEnd)};Flow.prototype.indexById=function(b){var a;for(a=0;a<this.items.length;a++){if(this.items[a].id===b){return a}}return -1};Flow.prototype.append=function(a,c){var b=$(a);b.id=c;this.items.push(b);b.insertBefore(this.hid+"endmarker");this.update()};Flow.prototype.prepend=function(a,c){var b=$(a);b.id=c;this.items.splice(0,0,b);b.insertAfter(this.hid+"startmarker");this.update()};Flow.prototype.insertBefore=function(c,b,f){var d,a=this.indexById(c);if(a>-1){d=$(b);d.id=f;d.insertBefore(this.items[a]);this.items.splice(a,0,d)}else{this.prepend(b,f)}this.update()};Flow.prototype.insertAfter=function(c,b,f){var d,a=this.indexById(c);if(a>-1){d=$(b);d.id=f;d.insertAfter(this.items[a]);this.items.splice(a+1,0,d)}else{this.append(b,f)}this.update()};Flow.prototype.remove=function(b){var a=this.indexById(b);if(a>-1){this.items[a].remove();this.items.splice(a,1)}};Flow.prototype.update=function(){this.itemlist.css("width",(this.previewWidth+this.itemSpace)*this.items.length+this.itemSpace+2*this.itemPreview+"px")};Flow.prototype.on=function(a,b){if(!this.eventHandlers[a]){this.eventHandlers[a]=[]}this.eventHandlers[a].push(b)};Flow.prototype.triggerEventHandlers=function(b){var a;if(!this.eventHandlers[b]){return}if(!this.items[this.currentItem]){return}for(a=0;a<this.eventHandlers[b].length;a++){this.eventHandlers[b][a](this.items[this.currentItem].id)}};Flow.prototype.doScroll=function(a){this.root.animate({scrollLeft:this.currentItem*this.scrollWidth},a);this.triggerEventHandlers("scroll")};Flow.prototype.moveTo=function(a,b){if(a>=0&&a<this.items.length){this.currentItem=a;this.doScroll(b)}};Flow.prototype.moveToId=function(c,b){var a=this.indexById(c);if(a>-1){this.currentItem=a;this.doScroll(b)}};Flow.prototype.moveRight=function(a){if(this.currentItem<this.items.length-1){this.currentItem+=1;this.doScroll(a)}};Flow.prototype.moveLeft=function(a){if(this.currentItem>0){this.currentItem-=1;this.doScroll(a)}};Flow.prototype.addEventListener=function(){var h=this,b,f,k,a=false,d,c,j=document.getElementById("gallery");if(!this.down){this.down=function(g){g.preventDefault();g.stopPropagation();h.triggerEventHandlers("down");if(g.targetTouches){f=[g.targetTouches[0].screenX,g.targetTouches[0].screenY]}else{f=[g.clientX,g.clientY]}k=h.root.scrollLeft();a=true;return false};this.up=function(g){if(!JXG.exists(f)){return}g.preventDefault();g.stopPropagation();if(b>0){h.moveLeft(h.speed)}else{if(b<0){h.moveRight(h.speed)}else{f=f[0];if(f<(h.width-h.previewWidth)/2+h.itemSpace){h.moveLeft(h.speed)}else{if(f>(h.width+h.previewWidth)/2+3*h.itemSpace){h.moveRight(h.speed)}else{h.triggerEventHandlers("click")}}}}f=null;b=0;a=false};this.move=function(i){var l,g;if(a){if(i.targetTouches){g=i.targetTouches[0].screenX-f[0]}else{g=i.clientX-f[0]}b=g>0?1:-1;b=Math.abs(g)<20?0:b;l=g/h.width;h.root.scrollLeft(k-l*h.scrollWidth)}};this.keyup=function(i){var g;g=i.key||i.keyCode;switch(g){case 37:h.moveLeft(h.speed);break;case 39:h.moveRight(h.speed);break;case 38:h.triggerEventHandlers("edit");break;case 40:break;case 35:h.moveTo(h.items.length-1);break;case 36:h.moveTo(0);break;case 13:case 14:break;case 79:h.triggerEventHandlers("click");break;case 59:break;default:}}}$(document).on("keyup",this.keyup);this.handleKbd=true;$(j).on("mouseup",this.up);$(j).on("mousemove",this.move);JXG.addEvent(j,"touchend",this.up,this);JXG.addEvent(j,"touchmove",this.move,this);for(c=0;c<this.eventCapture.length;c++){d=document.getElementById(this.eventCapture[c]);$(d).on("mousedown",this.down);JXG.addEvent(d,"touchstart",this.down,this)}};Flow.prototype.removeEventListener=function(){var b,a,c=document.getElementById("gallery");$(c).off("mouseup");$(c).off("mousemove");JXG.removeEvent(c,"touchend",this.up,this);JXG.removeEvent(c,"touchmove",this.move,this);for(a=0;a<this.eventCapture.length;a++){b=document.getElementById(this.eventCapture[a]);JXG.removeEvent(b,"touchstart",this.down,this);$(b).off("mousedown")}$(document).off("keyup")};Flow.prototype.suspendKeyboardListener=function(){$(document).off("keyup");this.handleKbd=false};Flow.prototype.resumeKeyboardListener=function(){if(!this.handleKbd){$(document).on("keyup",this.keyup);this.handleKbd=true}};Flow.prototype.cleanup=function(){this.removeEventListener();this.itemlist.html("")};Flow.prototype.resize=function(a,b){this.height=b;this.width=parseInt(this.root.css("width"));this.scrollWidth=this.itemSpace+this.previewWidth;this.itemPreview=(this.width-this.previewWidth-2*this.itemSpace)/2;this.spacerStart.css("width",this.itemPreview+"px");this.spacerStart.css("height",this.height+"px");this.spacerEnd.css("width",(this.itemPreview+this.itemSpace)+"px");this.spacerEnd.css("height",this.height+"px");this.update()};GUI.scroll=function(k){var o=JXG.Util.genUUID(),b=$("#gallery"),m=$(k),u,f,n,j,g,a,c,p,s=false,r,l,h,i,d,t,q;b.append('<div id="'+o+'" class="scrollbar"></div>');if($.browser.mozilla||$.browser.opera){m.css("overflow-y","hidden")}a=$("#"+o);u=function(){f=m.offset();j=f.top;n=m.height();g=n/m.prop("scrollHeight");c=n*(1-g);q=0;a.css("top",j);a.css("left",f.left+m.width()+2);a.css("height",n*g)};u();d=function(v){q=m.scrollTop()*g;a.css("top",j+q)};m.on("scroll",d);i=function(w){var v=w.detail?w.detail*(-10):w.wheelDelta/4;v=v;q=Math.max(0,Math.min(q-v,c));m.scrollTop(q/g);a.css("top",j+q)};if($.browser.opera){JXG.addEvent(m[0],"mousewheel",i,m[0])}JXG.addEvent(m[0],"DOMMouseScroll",i,m[0]);l=function(v){p=v.touches?v.touches[0].pageY:v.pageY;t=q;s=true;$(document).on("mousemove",r);$(document).on("mouseup",h);return false};a.on("mousedown",l);r=function(w){var x=w.touches?w.touches[0].pageY:w.pageY,v=w.touches?1:-1;if(s){q=Math.max(0,Math.min(t+(x+v*p),c));a.css("top",j+q);m.scrollTop(q/g)}return false};h=function(v){s=false;$(document).off("mouseup",h);$(document).off("mousemove",r);return false};return{hide:function(){a.hide()},show:function(){a.show()},resize:function(){u()},free:function(){m.off("mousedown",l);m.off("scroll",d);if($.browser.opera){JXG.removeEvent(m[0],"mousewheel",i,m[0])}JXG.removeEvent(m[0],"DOMMouseScroll",i,m[0]);a.remove()}}};GUI.Gallery={flow:null,files:[],currentItem:0,currentSort:"name",useImages:true,padding:8,previewHeight:270,previewWidth:360,editHeight:38,buttonWidth:64,toolbarSpacing:32,boxPrefix:"item-preview-",itemPrefix:"item-",editPrefix:"item-edit-name-",itemButtonHandlers:[],waitAnimShow:false,waitAnimHide:false,indexByKey:function(b){var a;for(a=0;a<this.files.length;a++){if(this.files[a].fullid===b||this.files[a].id===b){return a}}return -1},selectionChanged:function(c){var b,a;this.currentItem=this.indexByKey(c);GUI.Storage.setItem(GUI.appId+":meta:current",this.currentItem);while(b=this.itemButtonHandlers.pop()){$("#item-export-"+b+"-group").off();$("#item-clone-"+b+"-group").off();$("#item-delete-"+b+"-group").off()}$("#item-export-"+c+"-group").on("click",GUI.Gallery.exportClick);$("#item-clone-"+c+"-group").on("click",GUI.Gallery.cloneClick);$("#item-delete-"+c+"-group").on("click",GUI.Gallery.deleteClick);this.itemButtonHandlers.push(c);$(".item").removeClass("bg-selected");$("#item-"+c).addClass("bg-selected");$(".item-edit").removeClass("bg-selected");$("#item-edit-name-"+c).addClass("bg-selected");$(".item-export").removeClass("item-button-selected");$("#item-export-"+c).addClass("item-button-selected");$(".item-clone").removeClass("item-button-selected");$("#item-clone-"+c).addClass("item-button-selected");$(".item-delete").removeClass("item-button-selected");$("#item-delete-"+c).addClass("item-button-selected");$(".item-edit").removeClass("item-edit-selected");$("#item-edit-name-"+c).addClass("item-edit-selected");$(".item-edit").attr("disabled","disabled");$("#item-edit-name-"+c).removeAttr("disabled");$(".item-caption").removeClass("item-caption-selected");$("#item-export-"+c+"-caption").addClass("item-caption-selected");$("#item-clone-"+c+"-caption").addClass("item-caption-selected");$("#item-delete-"+c+"-caption").addClass("item-caption-selected")},attachEditEvents:function(a){a=this.files[a].id;$("#item-edit-name-"+a).on("focus",this.editFocus);$("#item-edit-name-"+a).on("blur",this.editBlur);$("#item-edit-name-"+a).on("keyup",this.editKeyUp);GUI.Gallery.setCaptions()},editFocus:function(){GUI.Gallery.flow.suspendKeyboardListener()},editBlur:function(){GUI.Gallery.rename();GUI.Gallery.flow.resumeKeyboardListener()},editKeyUp:function(d){var c=d.key||d.keyCode,a=GUI.Gallery.files[GUI.Gallery.currentItem],b=$("#item-edit-name-"+a.id);switch(c){case 13:case 14:GUI.Gallery.rename();b.blur();break;case 27:b.val(GUI.Gallery.files[GUI.Gallery.currentItem].data.name);b.blur();break}},addBoard:function(b){var d,a,c;c=this;try{d=this.files[b].data;if(GUI.Gallery.useImages&&d.image&&d.image.length>0&&JXG.exists(d.code)){$("#"+this.boxPrefix+this.files[b].id).html('<canvas id="'+this.boxPrefix+this.files[b].id+'-canvas" width="'+this.previewWidth+'" height="'+this.previewHeight+'"></canvas>');this.files[b].canvas=true;a=new Image();a.onload=function(){var h,g;h=document.getElementById(c.boxPrefix+c.files[b].id+"-canvas");g=h.getContext("2d");g.drawImage(a,0,0)};a.src=d.image}else{if(d.content.length>0){this.files[b].board=this.createBoard(this.boxPrefix+this.files[b].id,d);d.image=this.files[b].board.renderer.canvasRoot.toDataURL();GUI.Storage.setItem(this.files[b].fullid,JSON.stringify(d));$("#"+this.boxPrefix+this.files[b].id+"-wait").remove()}}}catch(f){JXG.debug("gallery: "+f+f.stack)}this.files[b].done=true},createBoard:function(c,n){var k,f,o,m,a,d,g,h,l;g=JXG.Options.renderer;h=JXG.Options.text.visible;l=JXG.Options.point.withLabel;n.code="";a=JSON.parse(GUI.unpack(n.content));m=a.pop();JXG.Options.renderer="canvas";JXG.Options.text.visible=false;JXG.Options.point.withLabel=false;k=JXG.JSXGraph.initBoard(c,{axis:false,boundingbox:m.boundingBox,showNavigation:false,showCopyright:false,keepaspectratio:true});k.suspendUpdate();if(typeof m.unredo==="undefined"){o=a.length-1}else{o=m.unredo}for(f=0;f<=o;f++){if(a[f].type>50){d=GUI.generateJCode(a[f],k)}else{d=JXG.SketchReader.generateJCode(a[f],k,a)}if(JXG.isArray(d)&&d.length>0){try{n.code+=d[0]+"\n";k.jc.parse(d[0])}catch(i){JXG.debug("Error parsing: '"+d[0]+"'; "+i)}}}if(m.axisVisible){k.objects.GUIx.setAttribute({visible:true});k.objects.GUIy.setAttribute({visible:true})}else{k.objects.GUIx.defaultTicks.setAttribute({majorHeight:0,minorHeight:0,visible:false,drawZero:false,drawLabels:false});k.objects.GUIy.defaultTicks.setAttribute({majorHeight:0,minorHeight:0,visible:false,drawZero:false,drawLabels:false})}JXG.Options.renderer=g;if(JXG.exists(h)){JXG.Options.text.visible=h}else{delete JXG.Options.text.visible}JXG.Options.point.withLabel=l;k.removeEventHandlers();k.unsuspendUpdate();k.fullUpdate();k.suspendUpdate();return k},updateFilelist:function(){var a,c,b=this;if(GUI.Gallery.files.length===0&&GUI.Gallery.flow.items.length>0&&GUI.Gallery.flow.items[0].id==="INITIALADDHINT"){GUI.Gallery.flow.remove("INITIALADDHINT")}for(a in GUI.Storage){if((!GUI.Storage.hasOwnProperty||GUI.Storage.hasOwnProperty(a))&&a.indexOf(GUI.appId+":file:")>-1&&this.indexByKey(a)===-1){c=JSON.parse(GUI.Storage.getItem(a));this.files.push({fullid:a,id:a.substr(GUI.appId.length+6),data:c,done:false,idx:c.index})}}if(this.files.length<=0){if($("#gallery-tooltip-start").length===0){}return}else{if($("#gallery-tooltip-start").length!==0){$("#gallery-tooltip-start").remove()}}if(this.currentItem>-1&&this.files[this.currentItem].done){if(this.files[this.currentItem].board){JXG.JSXGraph.freeBoard(this.files[this.currentItem].board);this.files[this.currentItem].board=false}else{if(this.files[this.currentItem].canvas){$("#"+this.boxPrefix+this.files[this.currentItem].id+"-canvas").remove();this.files[this.currentItem].canvas=false}}this.files[this.currentItem].data=JSON.parse(GUI.Storage.getItem(this.files[this.currentItem].fullid));$("#"+this.boxPrefix+this.files[this.currentItem].id).html('<img id="'+this.boxPrefix+this.files[this.currentItem].id+'-wait" src="pics/wait-animation-big.gif" class="gallery-wait-animation-big" />');window.setTimeout(function(){b.addBoard(b.currentItem)},500)}this.sort(this.files,"idx")},load:function(d,b){var c,a=true;if(JXG.exists(d)&&JXG.exists(b)){if(d>=0&&!this.files[d].done){this.flow.insertBefore(this.files[d+1].id,GUI.tpl.render("gallery-item-template",{id:this.files[d].id,name:this.files[d].data.name}),this.files[d].id);this.addBoard(d);this.flow.moveRight(0);this.attachEditEvents(d)}if(b<this.files.length&&!this.files[b].done){this.flow.insertAfter(this.files[b-1].id,GUI.tpl.render("gallery-item-template",{id:this.files[b].id,name:this.files[b].data.name}),this.files[b].id);this.addBoard(b);this.attachEditEvents(b)}}else{if(JXG.exists(d)){if(!this.files[d].done){this.flow.append(GUI.tpl.render("gallery-item-template",{id:this.files[d].id,name:this.files[d].data.name}),this.files[d].id);this.addBoard(d);this.attachEditEvents(d)}this.flow.moveToId(this.files[d].id,0);b=d}else{a=false;this.resize();c=parseInt(GUI.Storage.getItem(GUI.appId+":meta:current"),10);if(c>-1&&c<this.files.length){this.load(c)}else{if(this.files.length>0){this.load(0)}}}}if(a&&(d>=0||b<this.files.length)&&GUI.activePage==="gallery"){window.setTimeout(function(){GUI.Gallery.load(d-1,b+1)},10)}},resize:function(){var i=$("#gallerycontent").outerWidth()-$("#gallerycontent").width(),f=$("#gallerycontent").outerHeight()-$("#gallerycontent").height(),c=parseInt($("#gallery-css-indicator").width(),10),d,b,g,a;b=window.innerWidth-i;g=window.innerHeight-f;if(c===50){this.padding=4;this.previewHeight=162;this.previewWidth=216;this.editHeight=16;this.buttonWidth=40}else{this.padding=8;this.previewHeight=270;this.previewWidth=360;this.editHeight=38;this.buttonWidth=64}$("#gallery").height(g);this.toolbarSpacing=parseInt($("#toolbar-container").css("margin-top"),10);this.headerHeight=(g-this.previewHeight-this.editHeight-13*this.padding)/2;d=this.headerHeight*5.3125;if(d>b){this.headerHeight*=b/d}$("#gallery-header").css("height",this.headerHeight);$("#gallery-header-watermark").css("margin-top",0.15*this.headerHeight);a=b/2-this.previewWidth/2-2*this.padding;$("#carousel-eventcapture-left").css("width",a);$("#carousel-eventcapture-right").css("width",a);if($("#gallery-tooltip-start").length!==0){$("#gallery-tooltip-start").css("top",this.headerHeight+this.previewHeight+6*this.padding+this.editHeight+this.toolbarSpacing-200)}if(this.flow){this.flow.previewWidth=this.previewWidth+2*this.padding;this.flow.height=this.previewHeight+3*this.padding+this.editHeight;this.flow.itemSpace=this.padding;this.flow.resize(b,g);if(GUI.Gallery.files.length>0&&GUI.Gallery.currentItem<GUI.Gallery.files.length&&GUI.Gallery.currentItem>-1){this.flow.moveToId(GUI.Gallery.files[GUI.Gallery.currentItem].id,0)}}return[b,g]},rename:function(){var c,b=this.files[this.currentItem].fullid,a=GUI.Storage.getItem(b);c=JSON.parse(a);c.name=$("#item-edit-name-"+this.files[this.currentItem].id).val();this.files[this.currentItem].data.name=c.name;GUI.Storage.setItem(b,JSON.stringify(c))},createStorageItem:function(b,c){var a={};GUI.fileCounter+=1;GUI.Storage.setItem(GUI.appId+":meta:counter",GUI.fileCounter);GUI.Gallery.currentItem=GUI.Gallery.files.length;GUI.Storage.setItem(GUI.appId+":meta:current",GUI.Gallery.currentItem);a.name=b;if(c){a.content=c}else{a.content=""}a.index=GUI.fileCounter;a.image="";a.timestamp=new Date().getTime();b=GUI.appId+":file:"+JXG.Util.genUUID();b="jsxgui:file:"+JXG.Util.genUUID();GUI.Storage.setItem(b,JSON.stringify(a));return b},switchMainWindow:function(){$("#gallery").hide();$("#mainWindow").show();GUI.resizeBoard();GUI.switchHandling(GUI.Settings.get("leftright"));if(!GUI.Gallery.files[GUI.Gallery.currentItem]&&(!GUI.currentConstruction.source||GUI.currentConstruction.source!=="db")){GUI.newBoard(true,false,false)}else{if(!GUI.currentConstruction||GUI.currentConstruction.source!=="db"){GUI.currentConstruction={source:"ls",id:GUI.Gallery.files[GUI.Gallery.currentItem].fullid}}GUI.loadConstruction(GUI.currentConstruction)}GUI.activePage="mainWindow"},switchGallery:function(){var b=['<span id="gallery-','copyright" style="">&copy; 2013 ',"All rights reser",'ved</span> <a href="http://www.sketchomet','ry.com/" target="_blank">Sketchome',"try D","ev-T","eam</a>&nbsp;&dash;&nbsp;",'<span id="gallery-vers','ion">',GUI.version,"</span>"],a=$(["#gallery-foot","note-co","py"].join(""));$("#mainWindow").hide();$("#gallery").show();GUI.activePage="gallery";GUI.Gallery.shown=true;GUI.Gallery.flow.resumeKeyboardListener();GUI.Gallery.updateFilelist();GUI.Gallery.load();if(a.length){a.html(b.join(""))}else{window.location["href"]="http://beta.sketchometry.com"}document.title=GUI.appName+" :: Home"},newConstruction:function(a){if(a&&!a.handled){a.handled=true;GUI.currentConstruction={source:"ls",id:GUI.Gallery.createStorageItem(GUI.Lang.std.untitled+"-"+(GUI.fileCounter+1))};GUI.created=new Date().toString();GUI.Gallery.switchMainWindow();return true}},open:function(){if(GUI.Gallery.files[GUI.Gallery.currentItem]){GUI.Gallery.flow.suspendKeyboardListener();GUI.Gallery.switchMainWindow()}},exportClick:function(){if(GUI.Gallery.files.length===0){return}GUI.Gallery.flow.suspendKeyboardListener();$("#gallery-disabled-layer").show();$("#gallery-export-bg").show();$("#gallery-export-icon").removeClass("gallery-export-icon-import");$("#gallery-export-icon").addClass("gallery-export-icon-export");$("#gallery-export-edit").val(GUI.Gallery.Export.encodeFilename(GUI.Gallery.files[GUI.Gallery.currentItem].data.name));if(GUI.Gallery.Export.exportToolbar){GUI.Gallery.Export.showExportToolbar()}GUI.Gallery.currentDialog="export";if(GUI.Gallery.Export.reload){GUI.Gallery.Export.start()}if(!GUI.Gallery.Export.scrollbar){GUI.Gallery.Export.scrollbar=GUI.scroll($("#gallery-export"))}else{GUI.Gallery.Export.scrollbar.show()}GUI.Gallery.Export.scrollbar.resize()},deleteClick:function(a){if(a&&!a.handled){a.handled=true;if(GUI.Gallery.files.length===0){return}GUI.confirm(GUI.Lang.std.delete_reassure,false,function(){GUI.Gallery.deleteConfirmed()})}},deleteConfirmed:function(){var a=GUI.Gallery;if(!a.files[a.currentItem]){return}var b=a.files[a.currentItem].id;GUI.Storage.removeItem(a.files[a.currentItem].fullid);a.files.splice(a.currentItem,1);a.flow.remove(b);a.currentItem=Math.min(a.currentItem,a.files.length-1);GUI.Storage.setItem(GUI.appId+":meta:current",a.currentItem);if(a.files[a.currentItem]){a.flow.moveToId(a.files[a.currentItem].id,0)}if(a.files.length===0){GUI.fileCounter=0;GUI.Storage.setItem(GUI.appId+":meta:counter",0)}},cloneClick:function(d){var b=GUI.appId+":file:"+JXG.Util.genUUID(),a=GUI.Gallery.currentItem,c;if(!d.handled){if(!GUI.Gallery.files[a]){return}d.handled=true;GUI.fileCounter+=1;GUI.Storage.setItem(GUI.appId+":meta:counter",GUI.fileCounter);GUI.Gallery.currentItem=GUI.Gallery.files.length;GUI.Storage.setItem(GUI.appId+":meta:current",GUI.Gallery.currentItem);c={name:"Copy of "+GUI.Gallery.files[a].data.name,content:GUI.Gallery.files[a].data.content,index:GUI.fileCounter,timestamp:new Date().getTime()};GUI.Storage.setItem(b,JSON.stringify(c));GUI.currentConstruction={source:"ls",id:b};GUI.Gallery.updateFilelist();GUI.Gallery.load(GUI.Gallery.currentItem);GUI.Gallery.flow.moveToId(b,"fast");return true}},setCaptions:function(){if(GUI.Settings.get("captions")){$("#toolbar-button-import-caption").html(GUI.Lang.std.imp);$("#toolbar-button-new-caption").html(GUI.Lang.std.neu);$("#gallery-footnote-settings-caption").html(GUI.Lang.std.settings);$("#gallery-footnote-help-caption").html(GUI.Lang.std.help);$(".item-clone-caption").html(GUI.Lang.std.clone);$(".item-export-caption").html(GUI.Lang.std.exp);$(".item-delete-caption").html(GUI.Lang.std.remove)}else{$("#toolbar-button-import-caption").empty();$("#toolbar-button-new-caption").empty();$("#gallery-footnote-settings-caption").empty();$("#gallery-footnote-help-caption").empty();$(".item-clone-caption").empty();$(".item-export-caption").empty();$(".item-delete-caption").empty()}$("#flow-container").attr("title",GUI.Lang.std.drag_file);$("#toolbar-button-new").attr("title",GUI.Lang.std.newConst);$("#toolbar-button-import").attr("title",GUI.Lang.std.impo);$("#gallery-footnote-help").attr("title",GUI.Lang.std.help);$("#gallery-footnote-settings").attr("title",GUI.Lang.std.settings)},backup:function(){var c,b={},a=GUI.Storage.getItem(GUI.appId+":version");if(!JXG.exists(a)){for(c in GUI.Storage){if(GUI.Storage.hasOwnProperty(c)){b[c]=GUI.Storage[c]}}GUI.Storage.setItem(GUI.appId+":backup:"+GUI.version,JSON.stringify(b))}GUI.Storage.setItem(GUI.appId+":version",GUI.version)},init:function(){var b,d,c,a={dropbox:"Dropbox",skydrive:"Skydrive",ubuntuone:"UbuntuOne",googledrive:"Googledrive"};if(GUI.release){$("#debug-bar").hide()}$("#gallery-version").html(GUI.version);GUI.Gallery.backup();this.resize();GUI.setLanguage(GUI.Settings.get("language"));if(this.flow){this.flow.cleanup()}this.flow=new Flow("carousel",{previewWidth:this.previewWidth+2*this.padding,previewHeight:this.previewHeight+3*this.padding+this.editHeight,itemSpace:this.padding,eventCapture:["carousel-eventcapture","carousel-eventcapture-left","carousel-eventcapture-right"]});this.flow.on("scroll",function(f){GUI.Gallery.selectionChanged(f)});this.flow.on("click",function(f){GUI.Gallery.open()});this.flow.on("down",function(f){if(GUI.Gallery.files.length===0){GUI.Gallery.newConstruction(f)}else{GUI.Gallery.rename()}});this.flow.on("edit",function(){$("#item-edit-name-"+GUI.Gallery.files[GUI.Gallery.currentItem].id).focus()});this.files=[];this.updateFilelist();b=parseInt(GUI.Storage.getItem(GUI.appId+":meta:current"),10);if(isNaN(b)){b=this.files.length-1}this.currentItem=b;b=parseInt(GUI.Storage.getItem(GUI.appId+":meta:counter"),10);if(isNaN(b)){b=this.files.length;GUI.Storage.setItem(GUI.appId+":meta:counter",this.files.length)}GUI.fileCounter=b;this.currentItem=Math.min(this.files.length-1,this.currentItem);GUI.Storage.setItem(GUI.appId+":meta:current",this.currentItem);$("#gallery-footnote-group-left").on("click",function(){GUI.Gallery.flow.suspendKeyboardListener();$("#gallery-disabled-layer").show();$("#gallery-options-bg").show();GUI.Gallery.Options.render();if(!GUI.Gallery.Options.scrollbar){GUI.Gallery.Options.scrollbar=GUI.scroll($("#gallery-options"))}else{GUI.Gallery.Options.scrollbar.show()}});$("#toolbar-group-new").on("click",function(f){GUI.Gallery.newConstruction(f)});$("#toolbar-group-import").on("click",function(){GUI.Gallery.flow.suspendKeyboardListener();$("#gallery-disabled-layer").show();$("#gallery-export-bg").show();$("#gallery-export-icon").removeClass("gallery-export-icon-export");$("#gallery-export-icon").addClass("gallery-export-icon-import");GUI.Gallery.currentDialog="import";GUI.Gallery.Export.hideExportToolbar();if(GUI.Gallery.Export.reload){GUI.Gallery.Export.start()}if(!GUI.Gallery.Export.scrollbar){GUI.Gallery.Export.scrollbar=GUI.scroll($("#gallery-export"))}else{GUI.Gallery.Export.scrollbar.show()}GUI.Gallery.Export.scrollbar.resize()});$("#toolbar-button-list").on("click",function(){GUI.Gallery.flow.suspendKeyboardListener();$("#gallery-disabled-layer").show();$("#gallery-list-bg").show();$("#gallery-list-button-sort-name").click()});$("#toolbar-button-close").on("click",function(){$("#debug-bar").css("display","none")});this.addGalleryListEvents();this.Export.addGalleryExportEvents();this.Options.addGalleryOptionsEvents();for(c in a){d=GUI.Storage.getItem(GUI.appId+":meta:"+c);if(d){d=JSON.parse(d);if(d&&d.state==="requested"){GUI.Export[a[c]].performAction(GUI.Export[a[c]].getAccountInfo,function(){})}}}$("#gallery")[0].addEventListener("dragover",GUI.dragHandler,false);$("#gallery")[0].addEventListener("drop",GUI.dropHandler,false);$(window).resize(function(){GUI.Gallery.resize()});GUI.Gallery.setCaptions();window.setTimeout(function(){GUI.Gallery.load()},10)},zipAll:function(){var b=new JSZip(),a;for(a=0;a<this.files.length;a++){b.add(this.files[a].data.name+".sketch",this.files[a].data.content)}return b.generate()}};JXG.extend(GUI.Gallery,{cloudInterface:null,sort:function(d,c){var f,b,a;do{f=false;for(a=1;a<d.length;a++){if(d[a-1][c]>d[a][c]){b=d[a];d[a]=d[a-1];d[a-1]=b;f=true}}}while(f);return d}});JXG.extend(GUI.Gallery,{listFetch:function(b){var a,c=[];for(a=0;a<this.files.length;a++){if(this.files[a].data.name.toLowerCase().indexOf(b)>-1){c.push({name:this.files[a].data.name,nameLC:this.files[a].data.name.toLowerCase(),timestamp:this.files[a].data.timestamp,id:this.files[a].id})}}return c},listPrint:function(h,c){var b,f="",d=false,g=$("#gallery-list>ul"),a=function(i){return function(){GUI.Gallery.listClickItem(i)}};for(b=0;b<h.length;b++){if((c==="name")&&(f!==h[b].name.charAt(0).toUpperCase())){d=true;f=h[b].name.charAt(0).toUpperCase()}else{if((c==="date")&&(f!==new Date(h[b].timestamp).toLocaleDateString())){d=true;f=new Date(h[b].timestamp).toLocaleDateString()}}if(d){d=false;g.append(GUI.tpl.render("gallery-list-header-template",{last:f}))}g.append(GUI.tpl.render("gallery-list-item-template",{i:b,id:h[b].id,name:h[b].name,date:new Date(h[b].timestamp).toLocaleString()}));$("#gallery-list-item-"+h[b].id).on("click",a(h[b].id))}},listSortName:function(){var b,a=$("#gallery-list-edit-search").val().toLowerCase();this.currentSort="name";$("#gallery-list>ul").empty();b=this.sort(this.listFetch(a),"nameLC");this.listPrint(b,"name")},listSortDate:function(){var b,a=$("#gallery-list-edit-search").val().toLowerCase();this.currentSort="date";$("#gallery-list>ul").empty();b=this.sort(this.listFetch(a),"timestamp");this.listPrint(b,"date")},listClickItem:function(a){$("#gallery-list-button-close").click();GUI.Gallery.flow.moveToId(a,"fast")},close:function(){var a=$(e.target).attr("id");if(a==="gallery-list-button-close"||a==="gallery-list-bg"){$("#gallery-disabled-layer").hide();$("#gallery-list-bg").hide();$("#gallery-list").find(">ul").empty();GUI.Gallery.flow.resumeKeyboardListener()}},addGalleryListEvents:function(){$("#gallery-list-button-sort-name").on("click",function(){GUI.Gallery.listSortName();$("#gallery-list-button-sort-name").addClass("button-selected");$("#gallery-list-button-sort-date").removeClass("button-selected")});$("#gallery-list-button-sort-date").on("click",function(){GUI.Gallery.listSortDate();$("#gallery-list-button-sort-name").removeClass("button-selected");$("#gallery-list-button-sort-date").addClass("button-selected")});$("#gallery-list-edit-search").on("keyup",function(){if(GUI.Gallery.currentSort==="name"){GUI.Gallery.listSortName()}else{GUI.Gallery.listSortDate()}return false});$("#gallery-list-button-close").on("click",this.close);$("#gallery-list-bg").on("click",this.close)}});GUI.Gallery.Browser={parentFolders:[],currentFolder:"",currentFolderName:"",parentFolderNames:[],root:"",currentFolders:[],currentFiles:[],handleFolder:function(){},handleFile:function(){},load:function(c,d,b,a){$("#gallery-browser").remove();if(d){this.handleFolder=d}if(b){this.handleFile=b}this.currentFolder=a;this.currentFolderName="";this.parentFolders=[];this.parentFolderNames=[];this.currentFolders=[];this.currentFiles=[];this.root=a;c.html(GUI.tpl.render("gallery-browser-template",{}));this.clear()},clear:function(){$("#gallery-browser > ul").empty()},populate:function(c,f){var b,g=$("#gallery-browser>ul"),a=function(i,h){return function(){GUI.Gallery.Browser.clickFolder(i,h)}},d=function(i,h){return function(){GUI.Gallery.Browser.clickFile(i,h)}};this.clear();for(b=0;b<c.length;b++){g.append(GUI.tpl.render("gallery-browser-folder-template",{name:c[b].name,id:b}));$("#gallery-browser-folder-"+b).on("click",a(c[b].id,c[b].name))}for(b=0;b<f.length;b++){g.append(GUI.tpl.render("gallery-browser-file-template",{name:f[b].name,id:b}));$("#gallery-browser-file-"+b).on("click",d(f[b].id,f[b].name))}this.currentFolders=c;this.currentFiles=f;if(c.length===0&&f.length===0){g.append(GUI.tpl.render("gallery-browser-empty-template"))}},remove:function(){$("#gallery-browser").remove();this.currentFolders=[];this.currentFiles=[]},clickFolder:function(c,a){var b=GUI.Gallery.Browser;b.parentFolders.push(b.currentFolder);b.parentFolderNames.push(b.currentFolderName);b.currentFolder=c;b.currentFolderName=a;b.handleFolder(b.currentFolder)},clickFile:function(c,a){var b=GUI.Gallery.Browser;b.handleFile(c,a)},clickBreadcrumb:function(b,a){if(b=="__spfld__HOME"&&a==-1){GUI.Gallery.Export.start()}if(a<GUI.Gallery.Browser.parentFolderNames.length){GUI.Gallery.Browser.currentFolder=GUI.Gallery.Browser.parentFolders[a];GUI.Gallery.Browser.currentFolderName=GUI.Gallery.Browser.parentFolderNames[a];GUI.Gallery.Browser.parentFolderNames=GUI.Gallery.Browser.parentFolderNames.slice(0,a);GUI.Gallery.Browser.parentFolders=GUI.Gallery.Browser.parentFolders.slice(0,a)}GUI.Gallery.Export.cloudInterface.performAction(GUI.Gallery.Export.cloudInterface.getFolderContent,b,true,GUI.Gallery.Export.loadFolder)},folderUp:function(){var a,b;if(this.parentFolders.length===0){a=this.currentFolder;b=this.currentFolderName}else{a=this.parentFolders.pop();b=this.parentFolderNames.pop()}this.currentFolder=a;this.currentFolderName=b;return a},breadCrumbs:function(){var b,d=[],c=[],a=GUI.Gallery.Export.encodeFilename;d.push(GUI.tpl.render("gallery-browser-breadcrumbs-item-template",{name:"Home",id:"__spfld__HOME"}));c.push({id:"__spfld__HOME",fid:"__spfld__HOME",pos:-1});d.push("/");d.push(GUI.tpl.render("gallery-browser-breadcrumbs-item-template",{name:GUI.Gallery.Export.cloudInterface.serviceName,id:a(this.root)}));c.push({id:a(this.root),fid:this.root,pos:0});for(b=1;b<this.parentFolderNames.length;b++){if(this.parentFolderNames[b].length>0){if(this.parentFolderNames[b].charAt(0)!=="/"){d.push("/")}d.push(GUI.tpl.render("gallery-browser-breadcrumbs-item-template",{name:this.parentFolderNames[b],id:a(this.parentFolders[b])}));c.push({id:a(this.parentFolders[b]),fid:this.parentFolders[b],pos:b})}}if(this.currentFolder!==this.root){if(this.parentFolderNames.length>0){d.push("/")}d.push(GUI.tpl.render("gallery-browser-breadcrumbs-item-template",{name:this.currentFolderName,id:a(this.currentFolder)}));c.push({id:a(this.currentFolder),fid:this.currentFolder,pos:this.parentFolderNames.length})}return{html:d.join(""),handlers:c}}};GUI.Gallery.Export={cloudInterface:null,exportToolbar:false,formatSketch:true,formatJC:false,formatHTML:false,reload:true,providers:{icloud:{name:"iCloud",inter:"iCloud"},dropbox:{name:"Dropbox",inter:"Dropbox"},skydrive:{name:"SkyDrive",inter:"Skydrive"},ubuntuone:{name:"UbuntuOne",inter:"UbuntuOne"},googledrive:{name:"Google Drive",inter:"Googledrive"},webdav:{name:"WebDAV",inter:"Webdav"}},clearCredentials:function(a){if(a in this.providers){GUI.Export[this.providers[a].inter].clear();GUI.Gallery.Export.start()}},checkStatus:function(){var b,a=this,c=function(d){return function(f){a.checkLogins(d,a.providers[d].name,f)}};for(b in this.providers){if(this.providers.hasOwnProperty(b)){GUI.Export[this.providers[b].inter].isAuthenticated(c(b))}}},checkLogins:function(d,b,c){var a=GUI.Export[this.providers[d].inter];if(c.status===200&&c.response_data){a.performAction(a.getAccountInfo,function(f){GUI.Gallery.Export.printStatus(d,b,f)})}else{this.printStatus(d,b,{status:401})}},printStatus:function(d,b,c){var a;if(c.status===200){if(d==="icloud"){$("#gallery-status-icloud").html(GUI.Lang.std.loggedinas+" "+c.response_data.display_name);$("#gallery-modal-storage-select-icloud").show();$("#gallery-export-logout-icloud").hide()}else{a=GUI.tpl.render("gallery-auth-status-template",{what:d,name:c.response_data.display_name});$("#gallery-status-"+d).html(a);$("#gallery-export-logout-"+d).on("click",function(){GUI.Gallery.Export.clearCredentials(d)});$("#gallery-export-logout-"+d).attr("href","javascript:void(0);")}}else{if(c.status===599){var a=b+": "+GUI.Lang.std.connection_error;$("#gallery-status-"+d).html(a)}else{GUI.Export[this.providers[d].inter].start(function(g){var f=GUI.Lang.std.clicktoconnect+" "+b+" ...";$("#gallery-status-"+d).html(f);$("#gallery-status-"+d).on("click",function(){GUI.Gallery.Export.isAuthenticated(d)})})}}},start:function(){var a,b=function(c){return function(){GUI.Gallery.Export.isAuthenticated(c)}};this.hideExportToolbar();this.exportToolbar=false;this.reload=true;$("#gallery-export").html(GUI.tpl.render("gallery-auth-choose-provider-template",{}));for(a in this.providers){if(this.providers.hasOwnProperty(a)){$("#gallery-modal-storage-select").append(GUI.tpl.render("gallery-auth-provider-template",{provider:a,display:this.providers[a].name}));$("#gallery-modal-storage-logo-"+a).on("click",b(a))}}this.checkStatus();$("#gallery-export-icon-anim").hide()},isAuthenticated:function(a){if(this.providers[a]){this.cloudInterface=GUI.Export[this.providers[a].inter]}else{$("#gallery-export-button-close").click();return}this.cloudInterface.isAuthenticated(this.checkAuth)},checkAuth:function(a){$("#gallery-export").html(GUI.tpl.render("gallery-auth-connect-template",{}));if(a.status===200&&a.response_data){GUI.Gallery.Export.cloudInterface.performAction(GUI.Gallery.Export.cloudInterface.getAccountInfo,GUI.Gallery.Export.greeting)}else{GUI.Gallery.Export.cloudInterface.start(GUI.Gallery.Export.initAuth)}},initAuth:function(b){var a=GUI.Gallery.Export;if(b.status==200){if(a.cloudInterface.auth==="oauth"){$("#gallery-export").html(GUI.tpl.render("gallery-auth-login-template",{url:b.response_data}));$("#gallery-auth-login-link").attr("href",b.response_data);$("#gallery-auth-login-link").on("click",function(){a.authenticationStarted()})}else{$("#gallery-export").html(GUI.tpl.render("gallery-auth-password-login-form"),{});$("#gallery-auth-password-login-continue").attr("href","javascript:void(0);");$("#gallery-auth-password-login-continue").on("click",function(){a.cloudInterface.passwordLogin($("#gallery-auth-password-login-host").val(),$("#gallery-auth-password-login-name").val(),$("#gallery-auth-password-login-pass").val());a.cloudInterface.performAction(a.cloudInterface.getAccountInfo,GUI.Gallery.Export.greeting)})}}else{}},authenticationStarted:function(){$("#gallery-export").html(GUI.tpl.render("gallery-auth-finish-template",{what:"export"}));$("#gallery-auth-continue-link").attr("href","javascript:void(0);");$("#gallery-auth-continue-link").on("click",function(){GUI.Gallery.Export.cloudInterface.performAction(GUI.Gallery.Export.cloudInterface.getAccountInfo,GUI.Gallery.Export.greeting)})},greeting:function(b){var a=$("#gallery-export");if(b.status===200){if(GUI.Gallery.currentDialog==="export"){GUI.Gallery.Browser.load(a,GUI.Gallery.Export.clickFolder,GUI.Gallery.Export.exportFile,b.response_data.rootFolderId);GUI.Gallery.Export.showExportToolbar()}else{GUI.Gallery.Browser.load(a,GUI.Gallery.Export.clickFolder,GUI.Gallery.Export.importFile,b.response_data.rootFolderId)}GUI.Gallery.Export.exportToolbar=true;GUI.Gallery.Export.cloudInterface.performAction(GUI.Gallery.Export.cloudInterface.getFolderContent,b.response_data.rootFolderId,true,GUI.Gallery.Export.loadFolder)}else{GUI.Gallery.Export.clearCredentials()}},clickFolder:function(a){GUI.Gallery.Export.cloudInterface.performAction(GUI.Gallery.Export.cloudInterface.getFolderContent,a,true,GUI.Gallery.Export.loadFolder)},exportFile:function(b,a){$("#gallery-export-edit").val(GUI.Gallery.Export.extractFilename(a))},uploadFile:function(k,h){var l=false,m=true,c=GUI.Gallery.Browser.currentFolders,b=GUI.Gallery.Browser.currentFiles,j=GUI.Gallery.files[k].data.content,d=GUI.Gallery.files[k].data.code,a=$("#gallery-export-edit").val(),g=GUI.Gallery.Export.encodeFilename(a)+GUI.Gallery.Export.cloudInterface.fileExt,f;if(!GUI.Gallery.Export.formatSketch&&!GUI.Gallery.Export.formatJC&&!GUI.Gallery.Export.formatHTML){GUI.alert(GUI.Lang.std.chooseformat);return}for(f=0;f<c.length;f++){if(c[f].name.toLowerCase()===g.toLowerCase()){l=true;m=false;break}}if(!l){for(f=0;f<b.length;f++){if(b[f].name.toLowerCase()===g.toLowerCase()){l=true;break}}}if(!m){GUI.alert(GUI.Lang.std.cantoverwrite)}else{if(l){GUI.confirm(GUI.Lang.std.confirmoverwrite,false,function(){GUI.Gallery.Export.overwrite(j,d,g)})}else{GUI.Gallery.Export.overwrite(j,d,g)}}},overwrite:function(d,b,a){var c=new JSZip("DEFLATE");c.add("construction.sketch",d);c.add("construction.jc",b);GUI.Gallery.Export.cloudInterface.performAction(GUI.Gallery.Export.cloudInterface.uploadString,encodeURI(c.generate()),GUI.Gallery.Export.formatSketch,GUI.Gallery.Export.formatJC,GUI.Gallery.Export.formatHTML,a,GUI.Gallery.Browser.currentFolder,true,GUI.Gallery.Export.uploadDone)},uploadDone:function(a){if(a.status===200){GUI.alert(GUI.Lang.std.uploadsuccess);$("#gallery-export-button-close").click();GUI.Gallery.Export.clickFolder(GUI.Gallery.Browser.currentFolder)}else{$("#gallery-export").html(GUI.tpl.render("gallery-auth-error-template",{message:a.response_data}));GUI.Gallery.Export.addAuthErrorHandlers()}},importFile:function(b,a){GUI.Gallery.Export.cloudInterface.performAction(GUI.Gallery.Export.cloudInterface.downloadString,b,GUI.Gallery.Export.downloadFile)},downloadFile:function(c){var b,a=GUI.Gallery.Export.extractFilename(c.response_data.name);if(c.status===200){$("#gallery-export-button-close").click();if(GUI.Gallery.Export.cloudInterface.isHTML(c.response_data.name)||GUI.Gallery.Export.cloudInterface.isJC(c.response_data.name)){b=GUI.saveJCContent(a,c.response_data.content,true)}else{if(GUI.Gallery.Export.cloudInterface.isSketch(c.response_data.name)){b=GUI.Gallery.createStorageItem(a,c.response_data.content)}else{GUI.alert(GUI.Lang.std.unsupported_file_format)}}GUI.Gallery.updateFilelist();GUI.Gallery.load(GUI.Gallery.files.length-1);GUI.Gallery.flow.moveToId(b)}else{if(c.status===415){GUI.alert(GUI.Lang.std.unsupported_file_format)}else{$("#gallery-export").html(GUI.tpl.render("gallery-auth-error-template",{message:"error "+c.status+": "+c.response_data}));GUI.Gallery.Export.addAuthErrorHandlers()}}},loadFolder:function(f){var c,g,b=[],d=[],a=function(i,h){return function(){GUI.Gallery.Browser.clickBreadcrumb(i,h)}};if(!JXG.isArray(f.response_data)){GUI.Gallery.Export.start()}GUI.Gallery.Export.reload=false;for(c=0;c<f.response_data.length;c++){if(f.response_data[c].isDir){b.push(f.response_data[c])}else{d.push(f.response_data[c])}}GUI.Gallery.Browser.clear();GUI.Gallery.Browser.populate(b,d);g=GUI.Gallery.Browser.breadCrumbs();$("#gallery-browser-current-folder-status").html(g.html);for(c=0;c<g.handlers.length;c++){$("#gallery-browser-breadcrumbs-item-"+g.handlers[c].id).on("click",a(g.handlers[c].fid,g.handlers[c].pos));$("#gallery-browser-breadcrumbs-item-"+g.handlers[c].id).attr("href","javascript:void(0);")}GUI.Gallery.Export.scrollbar.resize()},extractFilename:function(a){var b=a.split(".");b.splice(b.length-1);if(b[b.length-1]==="sketch"){b.splice(b.length-1)}return b.join(".")},encodeFilename:function(a){a=a.replace(/\W/g,"_");return a},folderCreated:function(b,a){if(b.status===200||b.status===404){GUI.Gallery.Browser.clickFolder(b.response_data.id,b.response_data.name)}else{GUI.Gallery.Export.start()}},handleServerErrors:function(b){var a=$("#gallery-export");if(b.status===503){a.html(GUI.tpl.render("gallery-auth-error-template",{what:"export",message:"Service unavailable (503)."}))}else{a.html(GUI.tpl.render("gallery-auth-error-template",{what:"export",message:"Authentication error (401)."}))}GUI.Gallery.Export.addAuthErrorHandlers()},addAuthErrorHandlers:function(){$("#gallery-auth-error-template").attr("href","javascript:void(0)");$("#gallery-auth-error-restart").on("click",function(){GUI.Gallery.Export.clearCredentials()})},showExportToolbar:function(){$("#gallery-export-button-newfolder").show();$("#gallery-export-edit").show();$("#gallery-export-button-upload").show();$("#gallery-export-button-format").show();$("#gallery-export-formats").show();GUI.Gallery.Browser.handleFile=GUI.Gallery.Export.exportFile},hideExportToolbar:function(){$("#gallery-export-button-newfolder").hide();$("#gallery-export-edit").hide();$("#gallery-export-button-upload").hide();$("#gallery-export-button-format").hide();$("#gallery-export-formats").hide();GUI.Gallery.Browser.handleFile=GUI.Gallery.Export.importFile},close:function(a){var b=$(a.target).attr("id");if(b==="gallery-export-button-close"||b==="gallery-export-bg"){$("#gallery-disabled-layer").hide();$("#gallery-export-bg").hide();$("#gallery-export-formats").hide();GUI.Gallery.Export.scrollbar.hide();GUI.Gallery.flow.resumeKeyboardListener()}},createFolder:function(a){var b=GUI.Gallery.Export;if(a&&a!=""&&b.encodeFilename(a)!==""){b.cloudInterface.performAction(b.cloudInterface.createFolder,a,GUI.Gallery.Browser.currentFolder,function(c){b.folderCreated(c)})}},addGalleryExportEvents:function(){$("#gallery-export-button-close").on("click",this.close);$("#gallery-export-bg").on("click",this.close);$("#gallery-export-button-newfolder").on("click",function(){GUI.confirm(GUI.Lang.std.newfoldername+":",true,function(){GUI.Gallery.Export.createFolder($("#confirmInput").val())})});$("#gallery-export-button-upload").on("click",function(){var b=GUI.Gallery,a=b.Export.encodeFilename(b.files[b.currentItem].data.name);if(a!=""){b.Export.uploadFile(b.currentItem,false)}});$("#gallery-export-format-sketch").on("click",function(){GUI.Gallery.Export.formatSketch=!GUI.Gallery.Export.formatSketch;$("#gallery-export-format-sketch").toggleClass("button-selected",GUI.Gallery.Export.formatSketch)});$("#gallery-export-format-jc").on("click",function(){GUI.Gallery.Export.formatJC=!GUI.Gallery.Export.formatJC;$("#gallery-export-format-jc").toggleClass("button-selected",GUI.Gallery.Export.formatJC)});$("#gallery-export-format-html").on("click",function(){GUI.Gallery.Export.formatHTML=!GUI.Gallery.Export.formatHTML;$("#gallery-export-format-html").toggleClass("button-selected",GUI.Gallery.Export.formatHTML)})}};GUI.Gallery.Options={renderAction:function(d){var b,c,a;switch(d.type){case"list":b=GUI.tpl.render("gallery-settings-action-list",{id:d.id,value:GUI.Lang.std[d.value]||d.value});c=function(f){$("#gallery-options-list").empty();$("#gallery-options-list").append(GUI.tpl.render("gallery-settings-list-item",{id:"back",emph:"normal",label:'<div id="gallery-options-list-item-back"></div>'+GUI.Lang.std.back}));$("#gallery-settings-list-item-back").on("click",function(){GUI.Gallery.Options.render()});for(a=0;a<d.values.length;a++){$("#gallery-options-list").append(GUI.tpl.render("gallery-settings-list-item",{id:d.values[a].toLowerCase(),label:GUI.Lang.std[d.values[a]]||d.values[a],emph:d.values[a]===d.value?"bold":"normal"}));$("#gallery-settings-list-item-"+d.values[a].toLowerCase()).on("click",(function(g){return function(){GUI.Settings.set(d.id,d.values[g]);GUI.Gallery.Options.render()}}(a)))}};break;case"action":b=GUI.tpl.render("gallery-settings-action-action",{id:d.id});c=function(f){if(JXG.exists(d.action)){d.action()}};break;case"bool":b=GUI.tpl.render("gallery-settings-action-bool",{id:d.id,status:d.value.toString()});c=function(g){var f=$("#gallery-options-"+d.id+"-action");f.removeClass("gallery-options-action-bool-"+d.value.toString());GUI.Settings.set(d.id,!d.value);f.addClass("gallery-options-action-bool-"+d.value.toString())};break;case"volume":b=GUI.tpl.render("gallery-settings-action-volume",{id:d.id,value:d.value.toString()});c=[{id:"#gallery-options-"+d.id+"-down",fun:function(f){$("#gallery-options-"+d.id+"-status").removeClass("gallery-options-action-volume-"+d.value);GUI.Settings.set(d.id,Math.max(d.value-1,0));$("#gallery-options-"+d.id+"-status").addClass("gallery-options-action-volume-"+d.value);GUI.Audio.play("plastic")},event:"click"},{id:"#gallery-options-"+d.id+"-up",fun:function(f){$("#gallery-options-"+d.id+"-status").removeClass("gallery-options-action-volume-"+d.value);GUI.Settings.set(d.id,Math.min(d.value+1,3));$("#gallery-options-"+d.id+"-status").addClass("gallery-options-action-volume-"+d.value);GUI.Audio.play("plastic")},event:"click"}];break}return{html:b,handler:c}},renderSetting:function(b){var c=this.renderAction(b),a;$("#gallery-options-list").append(GUI.tpl.render("gallery-settings-item",{label:GUI.Lang.std[b.label]||b.label,id:b.id,action:c.html}));if(JXG.isArray(c.handler)){for(a=0;a<c.handler.length;a++){$(c.handler[a].id).on(c.handler[a].event||"click",c.handler[a].fun)}}else{$("#gallery-options-item-"+b.id+"").on("click",c.handler)}},render:function(){var a;$("#gallery-options-list").empty();for(a=0;a<GUI.Settings.definition.length;a++){if(GUI.Settings.definition[a].enabled){this.renderSetting(GUI.Settings.definition[a])}}},toggle:function(g,a,h,f){var d=$("#gallery-options-"+g),c=$("#gallery-options-"+a),b;f=JXG.def(f,"button-selected");h=JXG.def(h,function(){});b=d.hasClass(f);if(!b){c.removeClass(f);d.addClass(f);h()}},close:function(a){var b=$(a.target).attr("id");if(b==="gallery-options-button-close"||b==="gallery-options-bg"){$("#gallery-disabled-layer").hide();$("#gallery-options-bg").hide();GUI.Gallery.Options.scrollbar.hide();GUI.Gallery.flow.resumeKeyboardListener()}},addGalleryOptionsEvents:function(){$("#gallery-options-button-close").on("click",this.close);$("#gallery-options-bg").on("click",this.close)}};JXG.extend(GUI,{dragHandler:function(a){a.stopPropagation();a.preventDefault()},dropHandler:function(a){a.preventDefault();a.stopPropagation();a.target=a.target||{};a.target.files=a.dataTransfer.files;GUI.uploadHandler(a)},uploadHandler:function(c){var d,h,j,b,a,g=c.target.files;for(d=0;h=g[d];d++){if((j=h.name.search(/.*\.sketch$/))!=-1){b="sketch"}else{if((j=h.name.search(/.*\.gxt$/))!=-1){b="gxt"}else{console.log("Unsupported file type!");return}}j=h.name.replace(/\..*/,"");a=new FileReader();a.onload=(function(i,f,k){return function(l){if(l.target.readyState==FileReader.DONE){if(k=="sketch"){GUI.Gallery.createStorageItem(f,l.target.result)}else{if(k=="gxt"){GUI.saveGxtContent(f,l.target.result)}else{return}}GUI.Gallery.updateFilelist();GUI.Gallery.load()}}})(h,j,b);a.onerror=function(f){console.log("filereader error");console.log(f)};a.readAsBinaryString(h)}},saveGxtContent:function(a,b){JXG.FileReader.parseString(b,GUI.board,"geonext",true);b=JXG.Dump.toJessie(GUI.board);b=b.replace(/\/\/.*/g,"");b=b.replace(/\n/g,"");b=b.replace(/ ;/g,";\n");b=b.replace(/s0 =.*OO'>> ;/,"");b=b.replace(/s1 =.*E1'>> ;/,"");b=b.replace(/s2 =.*E2'>> ;/,"");b=b.replace(/s3 =.*x'>> ;/,"");b=b.replace(/s4 =.*y'>> ;/,"");return GUI.saveJCContent(a,b)},saveJCContent:function(c,d,b){var a;GUI.newBoard(true,true,true);if(b){GUI.step_log=[]}GUI.recordStep({type:JXG.GENTYPE_JCODE,args:{code:d},src_ids:[],dest_sub_ids:[],dest_id:0},true);a={id:GUI.Gallery.createStorageItem(c),source:"ls"};GUI.board.getBoundingBox=function(){return this.plainBB};GUI.saveConstruction(a,false);return a.id},combineMoves:function(b,a){if(b.args.obj_type!=a.args.obj_type||!JXG.Draw.areEqual(b.src_ids,a.src_ids)){console.log("Type mismatch in combineMoves!");return}if(b.args.obj_type==JXG.OBJECT_TYPE_LINE){b.args.xstart=JXG.deepCopy(a.args.xstart);b.args.ystart=JXG.deepCopy(a.args.ystart);b.args.zstart=JXG.deepCopy(a.args.zstart)}else{if(b.args.obj_type==JXG.OBJECT_TYPE_CIRCLE){b.args.xstart=a.args.xstart;b.args.ystart=a.args.ystart;if(a.args.has_point2){b.args.old_p2x=a.args.old_p2x;b.args.old_p2y=a.args.old_p2y}}else{if(b.args.obj_type==JXG.OBJECT_TYPE_GLIDER){b.args.xstart=a.args.xstart}else{if(b.args.obj_type==JXG.OBJECT_TYPE_POLYGON){b.args.xstart=JXG.deepCopy(a.args.xstart);b.args.ystart=JXG.deepCopy(a.args.ystart)}else{b.args.xstart=a.args.xstart;b.args.ystart=a.args.ystart}}}}},cleanSteps:function(){var c,b,a;for(c=0;c<GUI.step_log.length;c++){if(GUI.step_log[c].type==0){JXG.removeElementFromArray(GUI.step_del_exclude,c);for(b=c+1;b<GUI.step_log.length;b++){if((GUI.step_log[b].type==JXG.GENTYPE_DELETE||GUI.step_log[b].type==JXG.GENTYPE_COPY)&&JXG.isInArray(GUI.step_log[b].args.steps,c)){JXG.removeElementFromArray(GUI.step_log[b].args.steps,c)}}}}for(c=0;c<GUI.step_log.length;c++){if(GUI.step_log[c].type==0){for(a=0;a<GUI.restore_state.length;a++){if(GUI.restore_state[a].step>c){GUI.restore_state[a].step--}else{if(GUI.restore_state[a].step==c){GUI.restore_state[a].step=c+1}}}for(b=c+1;b<GUI.step_log.length;b++){if(GUI.step_log[b].type==JXG.GENTYPE_DELETE||GUI.step_log[b].type==JXG.GENTYPE_COPY){for(a=0;a<GUI.step_log[b].args.steps.length;a++){if(GUI.step_log[b].args.steps[a]>c){GUI.step_log[b].args.steps[a]--}}}GUI.step_log[b-1]=GUI.step_log[b];if(GUI.unredo==b-1){GUI.unredo--}}if(GUI.unredo==GUI.step_log.length-1){GUI.unredo--}GUI.step_log.length--;c--}}GUI.restore_state=JXG.uniqueArray(GUI.restore_state)},loadJSON:function(a,l){var c,b,f,d=false,g,h,k,m=false;if(l!==""){g=JSON.parse(l);if((h=GUI.unpack(g.content))){GUI.step_log=JSON.parse(h);k=GUI.step_log.pop();if(typeof k.unredo=="undefined"){GUI.unredo=GUI.step_log.length-1}else{GUI.unredo=k.unredo}d=true}}if(k&&k.created){GUI.created=k.created}else{GUI.created="Before ";if(k.access){GUI.created+=k.access}else{GUI.created+=(new Date()).toString()}}console.log(">>>> Created: "+GUI.created+" <<<<");if(k.access){console.log(">>>> Last access: "+k.access+" <<<<")}GUI.board.suspendUpdate();while(d){d=false;if(GUI.debug){GUI.unredo=0}else{for(c=0;c<=GUI.unredo;c++){if(GUI.step_log[c].type==0){continue}if(GUI.step_log[c]>50){f=GUI.generateJCode(GUI.step_log[c],GUI.board)}else{f=JXG.SketchReader.generateJCode(GUI.step_log[c],GUI.board,GUI.step_log)}if(!GUI.executeJCode(f,true)){console.log("Erroneous step: #"+c);console.log(GUI.step_log[c]);GUI.unredo=c-1;GUI.step_log.length=c;d=true}}}if(k.axisVisible){GUI.axisVisible=k.axisVisible}if(k.gridVisible){GUI.gridVisible=k.gridVisible}if(k.plotColor){GUI.plotColor=k.plotColor}if(k.snapToGrid){JXG.Options.elements.snapToGrid=k.snapToGrid}if(k.snapToPoints){JXG.Options.elements.snapToPoints=k.snapToPoints}GUI.id_cnt=k.idCnt;f=k.boundingBox;GUI.board.setBoundingBox(f);GUI.transformation=k.transformation;GUI.restore_state=k.restoreState;GUI.board.unsuspendUpdate()}if(GUI.unredo>=1&&GUI.step_log[GUI.unredo].type!=JXG.GENTYPE_JCODE){GUI.enableUndo(true)}else{GUI.enableUndo(false)}if(GUI.unredo<GUI.step_log.length-1){GUI.enableRedo(true)}else{GUI.enableRedo(false)}GUI.updateSnapshotControls();if(GUI.axisVisible){GUI.axisVisible=false;GUI.toggleAxis()}if(GUI.gridVisible){GUI.gridVisible=false;GUI.toggleGrid()}if(JXG.Options.elements.snapToGrid){JXG.Options.elements.snapToGrid=false;GUI.toggleSnapToGrid()}if(JXG.Options.elements.snapToPoints){JXG.Options.elements.snapToPoints=false;GUI.toggleSnapToPoint()}if(m&&!GUI.axisVisible){window.setTimeout(GUI.toggleAxis,2000)}document.title=GUI.appName+" :: "+g.name;GUI.resizeBoard();GUI.switchHandling(GUI.Settings.get("leftright"));$("div#mainWindow").removeClass("hidden")},loadConstruction:function(a){var b;GUI.newBoard(false,false,true);if(a.source!=="db"){b=GUI.Storage.getItem(a.id);GUI.loadJSON(a,b)}else{$.ajax({url:"api/v1/session/result",type:"GET",dataType:"json",data:"sessionid="+a.id,success:function(c){b={content:c.result||"",name:"server api",timestampe:new Date().getTime(),code:""};GUI.loadJSON(a,JSON.stringify(b))}})}},saveConstruction:function(a,k){var f,d,h,m,l,b,g,o,n=[],c=new JSZip("DEFLATE");b=a;g=JSON.parse(GUI.Storage.getItem(b.id));if(!k){for(m=0;m<=GUI.unredo;m++){if(GUI.step_log[m].type==JXG.GENTYPE_COMBINED||GUI.step_log[m].type==JXG.GENTYPE_CTX_TYPE_G||GUI.step_log[m].type==JXG.GENTYPE_CTX_TYPE_P){continue}h=1;d=0;for(l=m+1;l<=GUI.unredo;l++){if((GUI.step_log[m].type>50||GUI.step_log[m].type==JXG.GENTYPE_MOVEMENT)&&GUI.step_log[m].type==GUI.step_log[l].type&&JXG.Draw.areEqual(GUI.step_log[m].src_ids,GUI.step_log[l].src_ids)){if(GUI.step_log[l].type==JXG.GENTYPE_MOVEMENT){GUI.combineMoves(GUI.step_log[l],GUI.step_log[m])}else{if(GUI.step_log[m].args.which&&GUI.step_log[m].args.which!=GUI.step_log[l].args.which){continue}if(GUI.step_log[m].args.set_x&&GUI.step_log[m].args.set_x!=GUI.step_log[l].args.set_x){continue}h++;if(GUI.step_log[l].args.old){GUI.step_log[l].args.old=GUI.step_log[m].args.old;if(GUI.step_log[l].args.old==GUI.step_log[l].args.s){GUI.step_log[l]={type:0,src_ids:[],dest_sub_ids:[],dest_id:0}}}else{f=GUI.step_log[l].src_ids;d=GUI.step_log[l].type}}GUI.step_log[m]={type:0,src_ids:[],dest_sub_ids:[],dest_id:0}}}if(d&&h%2==0){for(l=m+1;l<=GUI.unredo;l++){if(GUI.step_log[l].type==d&&JXG.Draw.areEqual(GUI.step_log[l].src_ids,f)){GUI.step_log[l]={type:0,src_ids:[],dest_sub_ids:[],dest_id:0}}}}}}GUI.cleanSteps();for(m=0;m<GUI.step_log.length;m++){n.push(GUI.step_log[m])}o={unredo:GUI.unredo,restoreState:GUI.restore_state,boundingBox:GUI.board.getBoundingBox(),transformation:GUI.transformation,idCnt:GUI.id_cnt,axisVisible:GUI.axisVisible,gridVisible:GUI.gridVisible,snapToGrid:JXG.Options.elements.snapToGrid,snapToPoints:JXG.Options.elements.snapToPoints,plotColor:GUI.plotColor,created:GUI.created,access:new Date().toString(),version:GUI.version};n.push(o);c.add("construction.json",JSON.stringify(n));if(b.source!=="db"){g.content=c.generate();g.timestamp=new Date().getTime();g.image="";GUI.Storage.setItem(b.id,JSON.stringify(g));document.title=GUI.appName+" :: "+g.name}else{if(b.source==="db"&&!k){$.ajax({url:"api/v1/session/store",type:"GET",dataType:"json",data:"sessionid="+a.id+"&sketch="+encodeURI(c.generate()),success:function(i){if(b.redirect!=="undefined"){window.location.href=b.redirect}},error:function(i){GUI.alert("An error occurred, data might not have been transmitted.")}})}}},storeTransformation:function(){var d,c,b,a=[];b=GUI.getId("name").value;for(d=1;d<=3;d++){for(c=1;c<=3;c++){a.push(GUI.getId("a"+d+""+c).value)}}if(b!=""){GUI.transformation[b]=a;$("#transform-input").addClass("sui-spacer");$("#transform-select").removeClass("not-displayed");GUI.dialog.transform.removeDialog()}}});GUI.fakeLS=(function(){return{getItem:function(a){return this[a]},setItem:function(b,a){this[b]=a},removeItem:function(a){delete this[a]}}})();GUI.Storage=(function(){var b,a;if(typeof localStorage!="undefined"){try{b=localStorage.getItem("tmp");localStorage.setItem("tmp",0);if(b){localStorage.setItem("tmp",b)}else{localStorage.removeItem("tmp")}a=localStorage}catch(c){a=GUI.fakeLS}}else{a=GUI.fakeLS}return a})();GUI.Export=GUI.Export||{};GUI.Export.CloudInterface={serviceName:"Abstract",serviceId:"abstract",debug:false,reauth:false,token:null,auth:"oauth",sessionid:"",fileExt:".sketch",jcExt:".jc",htmlExt:".html",baseURI:GUI.release?"https://sketchometry.uni-bayreuth.de/":"https://sketchometry.uni-bayreuth.de/dev/",phpURI:"interface.php",sessionURI:"interface_session.php",isSketch:function(a){var b="."+a.split(".").pop().toLowerCase();return b===this.fileExt},isHTML:function(a){var b="."+a.split(".").pop().toLowerCase();return b===this.htmlExt},isJC:function(a){var b="."+a.split(".").pop().toLowerCase();return b===this.jcExt},paramFromToken:function(){if(this.token!=null){return"token="+this.token.token+"&secret="+this.token.secret}return""},paramFromRequestToken:function(){return this.paramFromToken()},setRequest:function(c,b,d){if(JXG.isMetroApp()){WinJS.xhr({url:this.baseURI+c,type:"POST",responseType:"json",data:b,headers:{"Content-type":"application/x-www-form-urlencoded"},}).done(function a(f){response=f.responseText;if(response.length>2){response=response.substring(1,response.length-2)}else{response="{}"}var g=$.parseJSON(response);d(g)})}else{$.jsonp({callbackParameter:"jsonp_callback",url:this.baseURI+c,data:b+"&sid="+encodeURIComponent(this.sessionid),success:function(f){d(f)},error:function(){d({result_code:599})}})}},start:function(b){var a=this;if(this.auth==="oauth"){this.setRequest(this.sessionURI,"action=start",function(c){a.handleStarted(c,b)})}else{b({status:200})}},handleStarted:function(a,b){if(a.result_status==="OK"){GUI.Storage.setItem(GUI.appId+":meta:"+this.serviceId,JSON.stringify({token:a.token,secret:a.secret,sid:a.sid,state:"requested"}));if(a.sid){this.sessionid=a.sid}b({status:200,response_data:a.uri});if(this.debug){console.log(a.uri)}}else{b({status:a.result_code})}},finish:function(b){var a=this;this.checkAuthentication();if(this.token!=null&&this.auth==="oauth"){this.setRequest(this.sessionURI,"action=getAccessToken&"+this.paramFromRequestToken(),function(c){a.handleFinished(c,b)})}else{b({status:200})}},handleFinished:function(a,b){if(a.result_status==="OK"){GUI.Storage.setItem(GUI.appId+":meta:"+this.serviceId,JSON.stringify({token:a.token,secret:a.secret,state:"authenticated"}));b({status:200})}else{b({status:a.result_code,response_data:a.error_message})}if(this.debug){console.log(a)}},checkAuthentication:function(){var a=GUI.Storage.getItem(GUI.appId+":meta:"+this.serviceId);this.token=null;if(a!=null){this.token=JSON.parse(a);this.sessionid=this.token.sid}},isAuthenticated:function(a){this.checkAuthentication();if(this.token==null){a({status:200,response_data:false})}else{if(this.token.state==="requested"){a({status:200,response_data:false})}else{a({status:200,response_data:true})}}},performAction:function(c){var b=Array.prototype.slice.call(arguments,1),d=b[b.length-1],a=this;if(typeof GUI==="object"&&GUI.Gallery){$("#gallery-export-icon-anim").show()}this.checkAuthentication();if(this.token==null){this.start(d)}else{if(this.token.state==="authenticated"){c.apply(this,b)}else{this.finish(function(f){if(f.status===200){a.checkAuthentication();c.apply(a,b)}else{d({status:f.status})}})}}},handleActionResponse:function(a,d,c){var b=this;if(GUI&&GUI.Gallery){$("#gallery-export-icon-anim").hide()}if(a.result_status==="OK"){d({status:200,response_data:a.result_data})}else{if(this.reauth&&(a.result_code===403||a.result_code===401)){if(this.debug){console.log("TOKEN EXPIRED - REAUTHENTICATE")}this.reauthenticate(c)}else{d({status:a.result_code,response_data:a.error_message})}}if(this.debug){console.log(a)}},reauthenticate:function(b){var a=this;this.setRequest(this.phpURI,"action=reauthenticate&token="+this.token.refresh_token,function(c){a.handleReauthenticated(c,b)})},uploadString:function(f,i,h,c,b,a,d,j){var k=this,g=Array.prototype.slice.call(arguments,0);g.unshift(this.uploadString);this.setRequest(this.phpURI,"action=uploadString&"+this.paramFromToken()+"&content="+f+"&sketch="+i+"&jc="+h+"&html="+c+"&fileName="+b+"&folderName="+a+"&overwrite="+d,function(l){k.handleActionResponse(l,j,g)})},downloadString:function(a,d){var c=Array.prototype.slice.call(arguments,0),b=this;c.unshift(this.downloadString);this.setRequest(this.phpURI,"action=downloadString&"+this.paramFromToken()+"&fileId="+a,function(f){b.handleActionResponse(f,d,c)})},getFolderContent:function(d,c,f){var b=Array.prototype.slice.call(arguments,0),a=this;b.unshift(this.getFolderContent);this.setRequest(this.phpURI,"action=getFolderContent&"+this.paramFromToken()+"&folderName="+encodeURIComponent(d)+"&recurse="+c,function(g){a.handleActionResponse(g,f,b)})},createFolder:function(d,a,f){var c=Array.prototype.slice.call(arguments,0),b=this;c.unshift(this.createFolder);this.setRequest(this.phpURI,"action=createFolder&"+this.paramFromToken()+"&folderName="+encodeURIComponent(d)+"&folderId="+a,function(g){b.handleActionResponse(g,f,c)})},getAccountInfo:function(c){var b=Array.prototype.slice.call(arguments,0),a=this;b.unshift(this.getAccountInfo);this.setRequest(this.phpURI,"action=getAccountInfo&"+this.paramFromToken(),function(d){a.handleActionResponse(d,c,b)})},passwordLogin:function(b,c,a){GUI.Storage.setItem(GUI.appId+":meta:"+this.serviceId,JSON.stringify({host:b,user:c,pass:a,state:"authenticated"}))},clear:function(){GUI.Storage.removeItem(GUI.appId+":meta:"+this.serviceId);this.token=null}};GUI.Export=GUI.Export||{};GUI.Export.Dropbox=JXG.deepCopy(GUI.Export.CloudInterface,{serviceName:"Dropbox",serviceId:"dropbox",baseURI:GUI.release?"https://sketchometry.uni-bayreuth.de/dropbox/":"https://sketchometry.uni-bayreuth.de/dev/dropbox/",phpURI:"dropbox.php",sessionURI:"dropbox.php"});GUI.Export=GUI.Export||{};GUI.Export.Skydrive=JXG.deepCopy(GUI.Export.CloudInterface,{serviceName:"SkyDrive",serviceId:"skydrive",reauth:true,fileExt:".sketch.txt",jcExt:".jc.txt",htmlExt:".html.txt",requestToken:null,baseURI:GUI.release?"https://sketchometry.uni-bayreuth.de/skydrive/":"https://sketchometry.uni-bayreuth.de/dev/skydrive/",phpURI:"skydrive.php",sessionURI:"skydrive_session.php",isSketch:function(a){var b="."+a.split(".").splice(-2,2).join(".").toLowerCase();return b===this.fileExt},isHTML:function(a){var b="."+a.split(".").splice(-2,2).join(".").toLowerCase();return b===this.htmlExt},isJC:function(a){var b="."+a.split(".").splice(-2,2).join(".").toLowerCase();return b===this.jcExt},paramFromToken:function(){return"token="+this.token.access_token},paramFromRequestToken:function(){return"requestToken="+this.token.requestToken},handleStarted:function(a,b){if(a.result_status==="OK"){GUI.Export.Skydrive.requestToken=a.requestToken;GUI.Storage.setItem(GUI.appId+":meta:"+this.serviceId,JSON.stringify({requestToken:a.requestToken,state:"requested",sid:a.sid}));this.sessionid=a.sid;b({status:200,response_data:a.uri})}else{b({status:403})}},handleFinished:function(a,c){var b=this;if(a.result_status==="OK"){a.WLData.state="authenticated";a.WLData.request_date=new Date().getTime();a.WLData.expiry_date=a.WLData.request_date+(parseInt(a.WLData.expires_in,10)*1000);GUI.Storage.setItem(GUI.appId+":meta:"+this.serviceId,JSON.stringify(a.WLData));this.setRequest(this.sessionURI,"action=stop",function(d){if(b.debug){console.log(d)}});c({status:200})}else{c({status:a.result_code,response_data:a.error_message})}if(this.debug){console.log(a)}},handleReauthenticated:function(a,b){if(a.result_status==="OK"){a.WLData.state="authenticated";a.WLData.request_date=new Date().getTime();a.WLData.expiry_date=a.WLData.request_date+(parseInt(a.WLData.expires_in,10)*1000);GUI.Storage.setItem(GUI.appId+":meta:"+this.serviceId,JSON.stringify(a.WLData));this.performAction.apply(this,b)}else{b[b.length-1]({status:401})}}});GUI.Export=GUI.Export||{};GUI.Export.UbuntuOne=JXG.deepCopy(GUI.Export.CloudInterface,{serviceName:"UbuntuOne",serviceId:"ubuntuone",token:null,baseURI:GUI.release?"https://sketchometry.uni-bayreuth.de/u1/":"https://sketchometry.uni-bayreuth.de/dev/u1/",phpURI:"ubuntuone.php",sessionURI:"ubuntuone_session.php"});GUI.Export=GUI.Export||{};GUI.Export.Googledrive=JXG.deepCopy(GUI.Export.CloudInterface,{serviceName:"Google Drive",serviceId:"googledrive",reauth:true,requestToken:null,baseURI:GUI.release?"https://sketchometry.uni-bayreuth.de/googledrive/":"https://sketchometry.uni-bayreuth.de/dev/googledrive/",phpURI:"googledrive.php",sessionURI:"googledrive_session.php",paramFromToken:function(){return"token="+this.token.access_token},paramFromRequestToken:function(){return"requestToken="+this.token.requestToken},handleStarted:function(a,b){if(a.result_status==="OK"){GUI.Export.Googledrive.requestToken=a.requestToken;GUI.Storage.setItem(GUI.appId+":meta:"+this.serviceId,JSON.stringify({requestToken:a.requestToken,state:"requested",sid:a.sid}));this.sessionid=a.sid;b({status:200,response_data:a.uri})}else{b({status:403})}},handleFinished:function(a,c){var b=this;if(a.result_status=="OK"){a.GDData.state="authenticated";a.GDData.request_date=new Date().getTime();a.GDData.expiry_date=a.GDData.request_date+(parseInt(a.GDData.expires_in,10)*1000);GUI.Storage.setItem(GUI.appId+":meta:"+this.serviceId,JSON.stringify(a.GDData));this.setRequest(this.sessionURI,"action=stop",function(d){if(b.debug){console.log(d)}});c({status:200})}else{c({status:a.result_code,response_data:a.error_message})}if(this.debug){console.log(a)}},handleReauthenticated:function(a,b){if(a.result_status==="OK"){a.GDData.state="authenticated";a.GDData.request_date=new Date().getTime();a.GDData.expiry_date=a.GDData.request_date+(parseInt(a.GDData.expires_in,10)*1000);GUI.Storage.setItem(GUI.appId+":meta:"+this.serviceID,JSON.stringify(a.GDData));this.performAction.apply(this,b)}else{b[b.length-1]({status:401})}}});GUI.Export=GUI.Export||{};GUI.Export.Webdav=JXG.deepCopy(GUI.Export.CloudInterface,{serviceName:"Webdav",serviceId:"webdav",auth:"password",baseURI:GUI.release?"https://sketchometry.uni-bayreuth.de/webdav/":"https://sketchometry.uni-bayreuth.de/dev/webdav/",phpURI:"webdav.php",sessionURI:"webdav.php",paramFromToken:function(){return"host="+encodeURIComponent(this.token.host)+"&user="+encodeURIComponent(this.token.user)+"&password="+encodeURIComponent(this.token.pass)},paramFromRequestToken:function(){return this.paramFromToken()}});GUI.Export=GUI.Export||{};GUI.Export.iCloud=JXG.deepCopy(GUI.Export.CloudInterface,{callbacks:[],serviceName:"iCloud",isAvailable:false,actions:{list:1,load:2,save:3,"delete":4,create:5},sendToAppleApp:function(c){var a,d,b;if(c.length==0){return}d=c[0];for(a=1;a<c.length;a++){d=d+":##sendToApp##"+c[a]}b=document.createElement("IFRAME");b.setAttribute("src",d);document.documentElement.appendChild(b);b.parentNode.removeChild(b);b=null},requestAction:function(c,f,d,b,a){this.sendToAppleApp([c,f,d,b,a])},requestList:function(a){this.requestAction(GUI.Export.iCloud.actions.list,a)},listCallback:function(b){var a=GUI.Export.iCloud.actions.list;if(typeof this.callbacks[a]==="function"){this.callbacks[a](b)}},requestDownload:function(a,b){this.requestAction(GUI.Export.iCloud.actions.load,a,b)},downloadCallback:function(b){var a=GUI.Export.iCloud.actions.load;if(typeof this.callbacks[a]==="function"){this.callbacks[a](b)}},requestUpload:function(a,c,b){this.requestAction(GUI.Export.iCloud.actions.save,a,c,b)},uploadCallback:function(b){var a=GUI.Export.iCloud.actions.save;if(typeof this.callbacks[a]==="function"){this.callbacks[a](b)}},createCallback:function(b){var a=GUI.Export.iCloud.actions.create;if(typeof this.callbacks[a]==="function"){this.callbacks[a](b)}},requestDelete:function(a,b){this.requestAction(GUI.Export.iCloud.actions["delete"],a,b)},requestCreate:function(a){this.requestAction(GUI.Export.iCloud.actions.create,a)},createFolder:function(a,c,d){var b=GUI.Export.iCloud.actions.create;this.callbacks[b]=d;this.requestCreate(a)},downloadString:function(a,c){var b=GUI.Export.iCloud.actions.load;this.callbacks[b]=c;this.requestDownload(a,".")},getAccountInfo:function(b){var a=this.isAvailable?200:401;b({status:a,response_data:{display_name:"Apple User",rootFolderId:"/"}})},getFolderContent:function(d,a,c){var b=GUI.Export.iCloud.actions.list;this.callbacks[b]=c;if(typeof d=="undefined"){d="/"}if(d=="%id%"||d=="__spfld__HOME"){d="/"}this.requestList(d)},isAuthenticated:function(a){a({status:200,response_data:this.isAvailable})},performAction:function(b){var a=Array.prototype.slice.call(arguments,1);b.apply(this,a)},uploadString:function(h,j,i,f,c,b,g,k){var d,a=GUI.Export.iCloud.actions.save;this.callbacks[a]=k;if(j){d=GUI.unpack(h,0);this.requestUpload(c,d,g)}if(i){c=c+".jc";d=GUI.unpack(h,1);this.requestUpload(c,d,g)}},start:function(){}});